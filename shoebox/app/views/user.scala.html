@(userWithSocial: UserWithSocial, bookmarks: Seq[Bookmark], socialUserInfos: Seq[SocialUserInfo], 
  rawInfos: Seq[SocialUserRawInfo], socialConnections: Seq[SocialUserInfo], fortyTwoConnections: Seq[UserWithSocial], 
  follows: Seq[NormalizedURI], kifiInstallations: Seq[KifiInstallation], comments: Seq[(NormalizedURI, Comment)], messages: Seq[(NormalizedURI, Comment, Seq[UserWithSocial])])

@userWithFacebookDisplay(userWithSocial: UserWithSocial) = {
  <span style="margin:2px">
    <a data-hover="tooltip" title="@userWithSocial.user.firstName @userWithSocial.user.lastName+" class="name_tooltip_link" href="http://www.facebook.com/@userWithSocial.socialUserInfo.socialId.id" target="_blank">
      <img class="user-avatar" src="https://graph.facebook.com/@userWithSocial.socialUserInfo.socialId.id/picture?type=square"/>
      @userWithSocial.socialUserInfo.socialId.id
    </a>
  </span>
}

@admin("User: " + userWithSocial.user.firstName + " " + userWithSocial.user.lastName) {
  <h2>User details </h2>
   <button class="btn" onclick="refreshAllSociaUserInfo()">Refresh Social User Info!</button>&nbsp
   <button class="btn" onclick="blockUser()">Block User</button>&nbsp
   <button class="btn" onclick="makeAdmin()">Make Admin</button>&nbsp
   <button class="btn" onclick="impersonate()">Impersonate User</button>&nbsp
   <button class="btn" onclick="unimpersonate()">Stop Impersonating</button>&nbsp
   <button class="btn" onclick="configSearch()">Config Search</button>
   <br/>
   <table class="table table-bordered">
      <tr>
        <th>Name</th><td>@userWithSocial.user.firstName @userWithSocial.user.lastName</td>
      </tr>
      <tr>
        <th>Id</th><td>@userWithSocial.user.id</td>
      </tr>
      <tr>
        <th>Facebook Account</th><td>@userWithFacebookDisplay(userWithSocial)</td>
      </tr>
      <tr>
        <th>Created At</th><td>@adminHelper.dateDisplay(userWithSocial.user.createdAt) @adminHelper.timeDisplay(userWithSocial.user.createdAt)</td>
      </tr>
      <tr>
        <th>Last Update</th><td>@adminHelper.dateDisplay(userWithSocial.user.updatedAt) @adminHelper.timeDisplay(userWithSocial.user.updatedAt)</td>
      </tr>
      <tr>
        <th>Email</th>
        <td>
          <form action="@com.keepit.controllers.routes.UserController.updateUser(userWithSocial.user.id.get)" method="POST" class="form-inline">
            <input type="text" name="emails" value="@{userWithSocial.emails.map(_.address).mkString(",")}">
            <input type="submit" value="Change emails">
          </form>
        </td>
      </tr>
      <tr>
        <th>Experiments</th><td id="experiments">@userWithSocial.experiments.mkString(",")</td>
      </tr>
      <tr>
        <th>OAuth</th><td><textarea class="json-textArea">@socialUserInfos</textarea></td>
      </tr>
      <tr>
        <th>Social Raw info</th><td><textarea class="json-textArea">@rawInfos</textarea></td>
      </tr>
      <tr>
        <th>Social User</th>
        <td>@for(socialUserInfo <-socialUserInfos) {
            @adminHelper.socialUserDisplay(socialUserInfo, true)
        }</td>
      </tr>
  </table>

	<div class="row-fluid">
	  <ul class="thumbnails">
      <li class="span6 well">
        <h2>@socialConnections.size Social Users</h2>
        <div class="scrollArea">
          <ol>
          @for(socialConnection <- socialConnections) {
            <li>@adminHelper.socialUserDisplay(socialConnection)</li>
          }
          </ol>
        </div>
      </li>
	    <li class="span6 well">
	      <h2>@fortyTwoConnections.size FortyTwo Users</h2>
	      <div class="scrollArea">
	        <ol>
	        @for(userWithSocial <- fortyTwoConnections) {
	          <li>@adminHelper.userDisplay(userWithSocial)</li>
	        }
	        </ol>
	      </div>
	    </li>
	  </ul>
	</div>

  <h2>User follows @follows.size pages</h2>
  <table class="table table-bordered">
   <tr>
     <th>#</th>
     <th>Following</th>
   </tr>
   @for((uri, i) <- follows.zipWithIndex) {
     <tr>
        <td>@{i+1}</td>
        <td>@adminHelper.articleDisplay(uri)</td>
     </tr>
   }
  </table>
  
  <h2>User kept @bookmarks.size Bookmarks</h2>

  <form class="navbar-form" action="/bookmarks/update" method="POST">
    <button type="submit" class="btn">Update</button><br/><br/>
			<table class="table table-bordered">
		    <tr>
		      <th>#</th>
		      <th>BID</th>
		      <th>Private</th>
		      <th>Active</th>
		      <th>Bookmark</th>
		      <th>Source</th>
		      <th>Created At</th>
		    </tr>
			 @for((bookmark, i) <- bookmarks.zipWithIndex) {
			   <tr>
		        <td>@{i+1}</td>
		        <td><span class="badge">@bookmark.id.get.id</span></td>
		        <td>
		          <input type="hidden" name="private_@{bookmark.id.get.id}" value="0" />
  					  <center><input type="checkbox" id="private_@bookmark.id.get.id" name="private_@{bookmark.id.get.id}" value="1" @if(bookmark.isPrivate) {checked="checked"}"></input></center>
		        </td>
		        <td>
              <input type="hidden" name="active_@{bookmark.id.get.id}" value="0" />
							<center><input type="checkbox" id="active_@bookmark.id.get.id" name="active_@{bookmark.id.get.id}" value="1" @if(bookmark.state.value == "active") {checked="checked"}"></input></center>
		        </td>
		        <td>@adminHelper.bookmarkDisplay(bookmark)</td>
		        <td>@bookmark.source</td>
            <td>@adminHelper.dateDisplay(bookmark.createdAt) @adminHelper.timeDisplay(bookmark.createdAt)</td>
			   </tr>
			 }
			</table>
    <button type="submit" class="btn">Update</button>
  </form>

  <h2>User has @comments.size comments</h2>
  <table class="table table-bordered">
   <tr>
     <th>#</th>
     <th>Page Title</th>
     <th>Page</th>
     <th>Creation</th>
   </tr>
   @for(((uri, comment), i) <- comments.zipWithIndex) {
     <tr>
       <td rowspan="2">@{i+1}</td>
       <td>@comment.pageTitle</td>
       <td>@adminHelper.articleDisplay(uri)</td>
       <td>@adminHelper.dateDisplay(comment.createdAt) @adminHelper.timeDisplay(comment.createdAt)</td>
     </tr>
     <tr>
       <td colspan="2">@comment.text</td>
     </tr>
   }
  </table>
  
  <h2>User has @messages.size messages</h2>
  <table class="table table-bordered">
   <tr>
     <th>#</th>
     <th>Page Title</th>
     <th>Page</th>
     <th>Recipients</th>
     <th>Creation</th>
   </tr>
   @for(((uri, message, recipients), i) <- messages.zipWithIndex) {
     <tr>
       <td rowspan="2">@{i+1}</td>
       <td>@message.pageTitle</td>
       <td>@adminHelper.articleDisplay(uri)</td>
       <td>@for(recipient <- recipients) { 
         @adminHelper.userDisplay(recipient)
       }</td>
       <td>@adminHelper.dateDisplay(message.createdAt) @adminHelper.timeDisplay(message.createdAt)</td>
     </tr>
     <tr>
       <td colspan="3">@message.text</td>
     </tr>
   }
  </table>

  <script type="text/javascript">
    function refreshAllSociaUserInfo() {
      location.href="@com.keepit.controllers.routes.UserController.refreshAllSocialInfo(userWithSocial.user.id.get)"
    }
    function impersonate() {
      $.post("@com.keepit.controllers.routes.AuthController.impersonate(userWithSocial.user.id.get)")
    }
    function unimpersonate() {
      $.post("@com.keepit.controllers.routes.AuthController.unimpersonate()")
    }
    function blockUser() {
      $.post('@com.keepit.controllers.routes.UserController.addExperiment(userWithSocial.user.id.get, "block")', function(data) {
        var list = $("<ul/>")
        $(data).each(function(i, e){list.append($("<li>" + e + "</li>"));})
        $('#experiments').html(list);
      });
    }
    function makeAdmin() {
      $.post('@com.keepit.controllers.routes.UserController.addExperiment(userWithSocial.user.id.get, "admin")', function(data) {
        var list = $("<ul/>")
        $(data).each(function(i, e){list.append($("<li>" + e + "</li>"));})
        $('#experiments').html(list);
      });
    }
    function configSearch() {
      location.href="@com.keepit.controllers.routes.SearchConfigController.showUserConfig(userWithSocial.user.id.get)"
    }
  </script>
}
