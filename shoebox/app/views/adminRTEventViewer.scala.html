@()(implicit request: RequestHeader)


@admin("What's Happening on Kifi?", stylesheets = List("admin_activity")) {

<table class="table activity-table">
  <thead>
    <tr>
      <td>Time</td><td>Event</td><td>Body</td>
    </tr>
  </thead>
  <tbody id="event_body">
    
  </tbody>
</table>

<script type="text/javascript" charset="utf-8">
  $(function() {

    var formatTime = function (dateStr) {
      var date = new Date(dateStr)
      var hours   = date.getHours()
      var minutes = date.getMinutes()
      var seconds = date.getSeconds()

      if (hours   < 10) {hours   = "0"+hours;}
      if (minutes < 10) {minutes = "0"+minutes;}
      if (seconds < 10) {seconds = "0"+seconds;}
      var time    = hours+':'+minutes+':'+seconds;
      return time;
    }
      
    var WS = window['MozWebSocket'] ? MozWebSocket : WebSocket
    var eventSocket = new WS("@com.keepit.controllers.admin.routes.AdminEventController.eventStream.webSocketURL()")
    
    var receiveEvent = function(event) {
      var data = JSON.parse(event.data)

      var el = $('<tr><td class="time"></td><td class="event-family"></td><td class="event-name"></td><td class="body"></td></tr>')

      $("td.time", el).text(formatTime(data.time))

      var family = data.family
      var name = data.name
      var user = data.user

      $("td.event-family", el).text(family)
      $("td.event-name", el).text(name)

      var person = '<div class="person"><a href="/admin/user/' + user.id + '"><img src="' + user.avatar + '">' + user.name + '</a></div>'
      $("td.body", el).html(person)

      $('#event_body').prepend(el).children(":nth-child(n+25)").remove();

    }
    eventSocket.onmessage = receiveEvent
      
  });
</script>

}