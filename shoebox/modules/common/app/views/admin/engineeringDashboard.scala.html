@admin("Engineering Dashboard", scripts = List("graphite")) {

<p>
  <a href="@com.keepit.controllers.admin.routes.AdminSearchPerformanceController.viewSearchPerformance"><font size="5">Search Performance</font></a>
  <p><img id="search" class="img-polaroid"></p>
</p>
<p>
  <a href="@com.keepit.controllers.admin.routes.AdminCacheController.serviceView"><font size="5">Cache Performance</font></a>
  <p><img id="cache" class="img-polaroid"></p>
</p>

<script>

  var options = $.fn.graphite.defaults = {
  url: "https://www.hostedgraphite.com/a3d638f9/b4e709e5-45b0-4b89-904b-a6cc7e517e04/graphite/render/",
  lineMode: "connected",
  width: 1100,
  height: 400,
  hideGrid: "true",
  from: "-3h"
  };

  var baseTargets = ["drawAsInfinite(gauges.*.deploys)"];

  // Search Chart

  var searchTargets = baseTargets.concat(["timers.search.extSearch.total.mean"]);
  options.drawNullAsZero = "false";
  options.target = searchTargets;
  $("#search").graphite(options);

  // Cache Chart

  function sumSeries(metric) {
    return "sumSeries(" + ["counters.*.*", metric, "count"].join(".") + ")"
  }

  var cacheCountTargets = ["hits", "misses", "sets"].map(function (metric) {return sumSeries(metric)});
  var cacheRatioTarget = ["scale(divideSeries(" + sumSeries("hits") + "," + sumSeries("{hits,misses}") + "),100)"];
  var cacheTargets = baseTargets.concat(cacheCountTargets).concat(cacheRatioTarget);

  options.drawNullAsZero = "true";
  options.target = cacheTargets;
  $("#cache").graphite(options);

</script>
}


