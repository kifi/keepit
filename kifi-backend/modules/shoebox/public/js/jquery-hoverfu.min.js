// jquery-hoverfu.js
// home-grown at FortyTwo, not intended for distribution
!function(k){"use strict";function p(a,b,c){var e=Date.now(),f=a.$a[0];b.call(f,function l(b,h){if(!a.$h)if(h||"object"!=typeof b||b.nodeType||b.jquery)if(a.mouseoutTimeStamp>a.mouseoverTimeStamp)console.log("[hoverfu.configureHover] left before could configure");else{var g=a.$h=k(b).data("hoverfu",a);a.opts=h=h||{};h.position&&g.css({visibility:"hidden",display:"block"}).appendTo("body").position(h.position).css({visibility:"",display:""}).detach();if(h.canLeaveFor)g.on("mouseover.hoverfu",k.proxy(q,null,null)).on("mouseout.hoverfu",
r);g=c?0:(h.mustHoverFor||0)-(Date.now()-e);0<g?a.show=setTimeout(m.bind(f),g):m.call(f)}else s(b).call(f,l)})}function m(){var a=g(this);clearTimeout(a.show);delete a.show;!a.$h||a.showing||n(a)||(a.$h.appendTo("body").each(function(){this.offsetHeight}).addClass("showing"),a.showTime=Date.now(),a.showing=!0,a.opts.hideAfter&&(a.hide=setTimeout(h.bind(this),a.opts.hideAfter)),k(document).on("mousewheel.hoverfu",h.bind(this)))}function h(){var a=g(this);clearTimeout(a.show||a.hide);delete a.show;
delete a.hide;k(document).off("mousewheel.hoverfu mousemove.hoverfu");a.showing?(a.showing=!1,a.fadeOutStartTime=Date.now(),a.$h.removeClass("showing").on("transitionend",function c(e){e.target===this&&"opacity"===e.originalEvent.propertyName&&(delete a.fadeOutStartTime,a.$h.off("transitionend",c).remove(),delete a.$h,a.mouseoverTimeStamp>a.mouseoutTimeStamp&&this.contains(a.mouseoverEl)&&(console.log("[hoverfu.hide:transitionend] faking mouseout"),a.$a.trigger(k.Event("mouseout",{relatedTarget:document}))))})):
n(a)||delete a.$h}function q(a,b){if(!b.relatedTarget||!this.contains(b.relatedTarget)){var c=g(this);c.mouseoverTimeStamp=b.timeStamp||Date.now();c.mouseoverEl=b.target;c.$h?c.showing&&(clearTimeout(c.hide),delete c.hide,c.opts.canLeaveFor&&k(document).off("mousemove.hoverfu"),c.opts.hideAfter&&this===c.$a[0]&&(c.hide=setTimeout(h.bind(this),c.opts.hideAfter))):p(c,a)}}function r(a){if(!a.relatedTarget||!this.contains(a.relatedTarget)){var b=g(this),c=b.$a[0],e;clearTimeout(b.show);delete b.show;
b.mouseoutTimeStamp=a.timeStamp||Date.now();if(b.showing){b.opts.hideAfter&&(clearTimeout(b.hide),delete b.hide);var f;if(f=b.opts.canLeaveFor){var d=this===c?b.$h[0]:c;e=a.clientX;f=a.clientY;var l=this.getBoundingClientRect(),d=d.getBoundingClientRect();f=e=l.bottom<d.top&&f>=l.bottom&&f<=d.top?{x1:d.left,x2:d.right,y1:d.top,y2:d.top}:d.bottom<l.top&&f>=d.bottom&&f<=l.top?{x1:d.right,x2:d.left,y1:d.bottom,y2:d.bottom}:l.right<d.left&&e>=l.right&&e<=d.left?{x1:d.left,x2:d.left,y1:d.bottom,y2:d.top}:
d.right<l.left&&e>=d.right&&e<=l.left?{x1:d.right,x2:d.right,y1:d.top,y2:d.bottom}:null}f?(b.hide=setTimeout(h.bind(c),b.opts.canLeaveFor),b.x=a.clientX,b.y=a.clientY,k(document).on("mousemove.hoverfu",u.bind(c,e,b))):h.call(c)}else n(b)||delete b.$h}}function u(a,b,c){var e=b.x,f=b.y,d=c.clientX-e,g=c.clientY-f;(a.y1-f)*d>(a.x1-e)*g&&(a.x2-e)*g>(a.y2-f)*d?(b.x=c.clientX,b.y=c.clientY):b.x!==c.clientX&&b.y!==c.clientY&&(k(document).off("mousemove.hoverfu"),h.call(this))}function n(a){return 500>Date.now()-
(a.fadeOutStartTime||0)}function s(a){return function(b){b(k("<div>",{"class":this.dataset.tipClass,html:this.dataset.tipHtml}),a)}}function g(a){var b=k.data(a);return b.hoverfu||(b.hoverfu={$a:k(a)})}k.fn.hoverfu=function(a){return(a=t[a])?a.apply(this,Array.prototype.slice.call(arguments,1)):t.init.apply(this,arguments)};var t={init:function(a,b){b||(b=a,a=null);"function"!=typeof b&&(b=s(b));return this.on("mouseover.hoverfu",a,k.proxy(q,null,b)).on("mouseout.hoverfu",a,r).on("mousedown.hoverfu",
a,function(a){var e=g(this);e.opts&&e.opts.click&&!n(e)&&("hide"==e.opts.click?h.call(this):"toggle"==e.opts.click&&(a.isTrigger||160<Date.now()-Math.max(e.showTime||0,e.fadeOutStartTime||0))&&(e.showing?h.call(this):e.$h?m.call(this):p(e,b,!0)))}).on("hoverfu:show.hoverfu",a,function(){var a=g(this);a.$h?m.call(this):p(a,b,!0)})},show:function(){return this.trigger("hoverfu:show")},destroy:function(){return this.each(function(){var a=g(this)||{};clearTimeout(a.show||a.hide);a.$h&&a.$h.remove()}).off(".hoverfu").removeData("hoverfu")}}}(jQuery);
