"use strict";angular.module("kifi",["ngCookies","ngResource","ngRoute","ngSanitize","ngAnimate","util","dom","antiscroll","nodraginput","jun.smartScroll","angularMoment","kifi.home","kifi.search","kifi.tagKeeps","kifi.keepView","kifi.helprank","kifi.profile","kifi.friends","kifi.friendService","kifi.friends.friendCard","kifi.friends.friendRequestCard","kifi.friends.compactFriendsView","kifi.social","kifi.social.networksNeedAttention","kifi.socialService","kifi.invite","kifi.invite.connectionCard","kifi.invite.wtiService","kifi.focus","kifi.youtube","kifi.templates","kifi.profileService","kifi.tags","kifi.keeps","kifi.keep","kifi.addKeep","kifi.tagList","kifi.layout.header","kifi.layout.main","kifi.layout.nav","kifi.layout.rightCol","kifi.undo","kifi.installService","kifi.dragService","jun.facebook","ui.slider","angulartics","kifi.mixpanel","kifi.alertBanner","kifi.minVersion","kifi.sticky"]).run(["$route",angular.noop]).config(["$routeProvider","$locationProvider","$httpProvider",function(a,b,c){b.html5Mode(!0).hashPrefix("!"),a.otherwise({redirectTo:"/"}),c.defaults.withCredentials=!0}]).constant("linkedinConfigSettings",{appKey:"r11loldy9zlg"}).config(["$FBProvider",function(a){var b=window.location.host||window.location.hostname,c=/^dev\.ezkeep\.com|localhost$/.test(b);a.appId(c?"530357056981814":"104629159695560").scope("email").cookie(!0).logging(!1)}]).factory("env",["$location",function(a){var b=a.host(),c=/^dev\.ezkeep\.com|localhost$/.test(b),d=9e3===a.port(),e=d?a.protocol()+"://"+b+":"+a.port():"https://www.kifi.com";return{local:d,dev:c,production:!c,origin:e,xhrBase:e+"/site",xhrBaseEliza:e.replace("www","eliza")+"/eliza/site",xhrBaseSearch:e.replace("www","search"),picBase:(d?"//d1scct5mnc9d9m":"//djty7jcqog9qu")+".cloudfront.net"}}]).factory("injectedState",["$location",function(a){function b(a){return _.forOwn(a,function(a,b){c[b]=a}),c}var c={};return _.size(a.search())>0&&(_.forOwn(a.search(),function(a,b){c[b]=a}),"/find"!==a.path()&&a.search({})),{state:c,pushState:b}}]).controller("AppCtrl",["profileService","$window","$rootScope","friendService","$timeout",function(a,b,c,d,e){e(function(){a.fetchPrefs(),d.getRequests()})}]),angular.module("kifi.alertBanner",[]).directive("kfAlertBanner",[function(){return{scope:{action:"=",actionText:"@"},replace:!0,restrict:"A",transclude:!0,templateUrl:"common/directives/alertBanner/alertBanner.tpl.html",link:function(){}}}]),angular.module("antiscroll",["kifi.scrollbar"]).directive("antiscroll",["$timeout","scrollbar",function(a,b){return{restrict:"A",transclude:!0,link:function(c,d,e){var f;e.antiscroll&&(f=c.$eval(e.antiscroll)),c.scroller=d.antiscroll(f).data("antiscroll"),c.refreshScroll=function(){return a(function(){c.scroller&&c.scroller.refresh()})},c.refreshScroll(),c.width="calc(100% + "+b.getAntiscrollWidth()+"px)",c.$on("refreshScroll",c.refreshScroll)},template:'<div class="antiscroll-inner" ng-attr-style="width: {{width}}" ng-transclude></div>'}}]),angular.module("kifi.focus",[]).directive("focusWhen",["$timeout",function(a){return{restrict:"A",scope:{focusWhen:"="},link:function(b,c){function d(){c.focus(),b.focusWhen=!1}b.$watch("focusWhen",function(b){b&&a(d)})}}}]).directive("kfFocusIf",[function(){return{restrict:"A",scope:{focusCond:"="},link:function(a,b){a.$watch("focusCond",function(a){a&&b.focus()})}}}]).directive("kfAutofocus",[function(){return{restrict:"A",link:function(a,b){b.focus()}}}]),angular.module("kifi.keepWhoPics",["kifi.keepWhoService"]).directive("kfKeepWhoPic",["$window","$timeout","$rootElement","$compile","$templateCache","keepWhoService",function(a,b,c,d,e,f){return{restrict:"A",replace:!0,templateUrl:"common/directives/keepWho/keepWhoPic.tpl.html",scope:{keeper:"="},link:function(g,h){g.tooltipEnabled=!1,g.getPicUrl=f.getPicUrl,g.getName=f.getName;var i=null,j=null;g.cancelTimeout=function(){b.cancel(j)},g.$on("$destroy",function(){g.cancelTimeout(),i&&i.remove()}),g.showTooltip=function(){i||(i=angular.element(e.get("common/directives/keepWho/friendCard.tpl.html")),c.append(i),d(i)(g));var f=42,k=1,l=i.find(".kifi-fr-kcard-tri"),m=h.offset().left+h.width()/2-f,n=h.offset().top-91,o=f-k;a.innerWidth-m-i.width()<3&&(m+=2*f-i.width(),o=i.width()-f-k),i.css({left:m+"px",top:n+"px",width:i.width()+"px",visibility:"hidden"}),l.css({left:o}),j=b(function(){i.css("visibility","visible"),g.tooltipEnabled=!0},500)},g.hideTooltip=function(){g.cancelTimeout(),g.tooltipEnabled=!1}}}}]).directive("kfKeepWhoPics",["keepWhoService",function(a){return{restrict:"A",replace:!0,templateUrl:"common/directives/keepWho/keepWhoPics.tpl.html",scope:{me:"=",keepers:"=",keep:"="},link:function(b){b.getPicUrl=a.getPicUrl,b.getName=a.getName,b.isMyBookmark=b.keep&&b.keep.isMyBookmark}}}]),angular.module("kifi.keepWhoText",["kifi.profileService"]).directive("kfKeepWhoText",["profileService",function(a){return{restrict:"A",replace:!0,templateUrl:"common/directives/keepWho/keepWhoText.tpl.html",scope:{keep:"="},link:function(b){b.me=a.me,b.helprankEnabled=!1,b.$watch(function(){return a.me.seqNum},function(){b.helprankEnabled=a.me&&a.me.experiments&&a.me.experiments.indexOf("helprank")>-1}),b.isPrivate=function(){return b.keep.isPrivate||!1},b.hasKeepers=function(){var a=b.keep;return!(!a.keepers||!a.keepers.length)},b.hasOthers=function(){var a=b.keep;return a.others>0},b.getFriendText=function(){var a,c=b.keep.keepers,d=c&&c.length||0;return a=1===d?"1 friend":d+" friends",b.keep.isMyBookmark?"and "+a:a},b.getOthersText=function(){var a,c=b.keep.others||0;return a=1===c?"1 other":c+" others",(b.keep.isMyBookmark||b.keep.keepers.length>0)&&(a="and "+a),a},b.isOnlyMine=function(){return!b.hasKeepers()&&!b.keep.others}}}}]),angular.module("kifi.minVersion",["kifi.installService"]).directive("kfMinVersion",["installService",function(a){return{restrict:"A",link:function(b,c,d){a.hasMinimumVersion(d.kfMinVersion,d.minCanary)||c.remove()}}}]),angular.module("nodraginput",[]).directive("kfNoDragInput",[function(){return{restrict:"A",link:function(a,b){function c(a){a.dataTransfer&&(a.dataTransfer.dropEffect="none"),a.stopPropagation(),a.preventDefault()}b.attr("draggable","false"),b.on("dragstart",function(){return!1}),b.on("dragenter",c),b.on("dragover",c),b.on("drop",c)}}}]),angular.module("kifi.sticky",["kifi.sticky"]).directive("kfSticky",["$window",function(a){return{restrict:"A",scope:{maxTop:"="},link:function(b,c){function d(a){return parseInt(c.css(a),10)}function e(){h=d("marginLeft"),g=d("marginTop"),i=d("borderLeftWidth"),j=d("borderTopWidth"),k=d("borderRightWidth"),l=d("borderBottomWidth"),m=c.offset().top-g,n=c.offset().left-h,o=c.width()+i+k,p=c.height()+j+l}function f(a){var d=m-(q.scrollTop()+a.originalEvent.deltaY);d<=b.maxTop?r||(e(),c.css({position:"fixed",top:b.maxTop,left:n,width:o,height:p,zIndex:1}),c.after(s),t=b.$watch(function(){return{width:s.width(),left:s.offset().left}},function(a){c.css("width",a.width+i+k),c.css("left",a.left-h)},!0),r=!0):r&&(c.css({position:"",top:"",left:"",width:"",height:"",zIndex:""}),s.remove(),t(),r=!1)}var g,h,i,j,k,l,m,n,o,p,q=angular.element(a),r=!1;e();var s=c.clone();s.css("visibility","hidden");var t;q.on("mousewheel",f),b.$on("$destroy",function(){q.off("mousewheel",f)})}}}]),angular.module("kifi.youtube",[]).directive("kfYoutube",[function(){function a(a){return"//www.youtube.com/v/"+a+"&rel=0&theme=light&showinfo=0&disablekb=1&modestbranding=1&controls=0&hd=1&autohide=1&color=white&iv_load_policy=3"}function b(a){return'<embed src="'+a+'" type="application/x-shockwave-flash" allowfullscreen="true" style="width:100%; height: 100%;" allowscriptaccess="always"></embed>'}return{restrict:"A",replace:!0,scope:{videoId:"="},template:'<div class="kf-youtube"></div>',link:function(c,d){function e(c){f!==c&&(f=c,c&&d.html(b(a(c))))}var f=null;e(c.videoId),c.$watch("videoId",e)}}}]),angular.module("dom",[]).value("dom",{scrollIntoViewLazy:function(a,b){var c;if(a&&(c=a.offsetParent)){var d=c.scrollTop,e=c.clientHeight,f=d+e,g=a.offsetTop,h=g+a.offsetHeight;h>f?c.scrollTop=h+(b||0)-e:d>g&&(c.scrollTop=g-(b||0))}},absOffsets:function(a){for(var b=0,c=0;a;)b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent;return{x:b,y:c}}}),angular.module("kifi.modal",[]).directive("kfModal",["$document",function(a){return{restrict:"A",replace:!0,scope:{show:"="},templateUrl:"common/modal/modal.tpl.html",transclude:!0,controller:["$scope",function(b){function c(a){27===a.which&&(b.hideModal(a),b.$apply())}var d=null;this.setDefaultHideAction=function(a){d=a},this.hideModal=function(a){b.noUserHide&&b.show||("function"==typeof a?a():d&&d(),b.show=!1)},this.show=b.show||!1,b.hideModal=this.hideModal,b.$watch(function(){return b.show},function(){this.show=b.show||!1,b.show?a.on("keydown",c):a.off("keydown",c)}),b.$on("$destroy",function(){a.off("keydown",c)})}],link:function(a,b,c){a.dialogStyle={},a.backdropStyle={},a.noUserHide=void 0!==c.noUserHide||!1,c.kfWidth&&(a.dialogStyle.width=c.kfWidth),c.kfHeight&&(a.dialogStyle.height=c.kfHeight),a.backdropStyle.opacity=c.kfOpacity||.3,a.backdropStyle.backgroundColor=c.kfBackdropColor||"rgba(0, 40, 90, 1)"}}}]).directive("kfBasicModalContent",["$window",function(a){return{restrict:"A",replace:!0,scope:{action:"&",cancel:"&",title:"@"},templateUrl:"common/modal/basicModalContent.tpl.html",transclude:!0,require:"^kfModal",link:function(b,c,d,e){b.title=d.title||"",b.singleAction=d.singleAction||!0,b.actionText=d.actionText,b.withCancel=void 0!==d.withCancel||!1,b.withWarning=void 0!==d.withWarning||!1,b.cancelText=d.cancelText,b.centered=d.centered,e.setDefaultHideAction(b.cancel),b.hideAndCancel=e.hideModal,b.hideAndAction=function(){e.hideModal(b.action)};var f=c.find(".dialog-body-wrap"),g=_.debounce(function(){var b=a.innerHeight;f.css({"max-height":b-160+"px","overflow-y":"auto","overflow-x":"hidden"})},100);b.$watch(function(){return e.show},function(b){b?(g(),a.addEventListener("resize",g)):a.removeEventListener("resize",g)}),b.$on("$destroy",function(){a.removeEventListener("resize",g)})}}}]),angular.module("jun.facebook",[]).provider("$FB",function(){function a(a,b){return void 0===b?e[a]:(e[a]=b,d)}function b(a){!a||a.error?this.reject(a&&a.error||!1):this.resolve(a)}function c(a,b){var c=a.promise;return"function"==typeof b&&c.then(b),c}var d=this,e={appId:null,cookie:!1,logging:!0,status:!0,xfbml:!1,authResponse:void 0,frictionlessRequests:!1,hideFlashCallback:null,scope:"",enable_profile_selector:!1,profile_selector_ids:""};angular.forEach(["appId","cookie","logging","status","xfbml","authResponse","frictionlessRequests","hideFlashCallback","scope","enable_profile_selector","profile_selector_ids"],function(b){d[b]=angular.bind(d,a,b)}),this.option=function(b,c){return"object"==typeof b?(angular.extend(e,b),d):a(b,c)};var f,g,h,i,j,k;this.$get=["$window","$timeout","$q",function(a,b,c){return k=c,i=a,j=b,d}],this.loading=!1,this.loaded=!1,this.FB=null,this.load=function(){if(!g){var a=i,b=k.defer();a.fbAsyncInit=function(){f=d.FB=a.FB,d.loading=!1,d.loaded=!0,j(function(){b.resolve(f)})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/all.js",e.parentNode.insertBefore(d,e))}(a.document,"script","facebook-jssdk"),d.loading=!0,g=b.promise}return g},this.initialized=!1,this.init=function(a){return h||(h=d.load().then(function(b){if(a=angular.extend({appId:e.appId,cookie:e.cookie,logging:e.logging,status:e.status,xfbml:e.xfbml,authResponse:e.authResponse,frictionlessRequests:e.frictionlessRequests,hideFlashCallback:e.hideFlashCallback},a),!a.appId)throw new Error("$FB: appId is not set!");return b.init(a),d.initialized=!0,b})),h},this.getLoginStatus=function(a){return d.init().then(function(d){var e=k.defer();return d.getLoginStatus(angular.bind(e,b)),c(e,a)})},this.api=function(){var a=arguments;return d.init().then(function(d){var e,f=k.defer(),g=Array.prototype.slice.call(a);return"function"==typeof g[g.length-1]&&(e=g.pop()),g.push(angular.bind(f,b)),d.api.apply(d,g),c(f,e)})},this.ui=function(){var a=arguments;return d.init().then(function(d){var e,f=k.defer(),g=Array.prototype.slice.call(a);return"function"==typeof g[g.length-1]&&(e=g.pop()),g.push(angular.bind(f,b)),d.ui.apply(d,g),c(f,e)})},this.login=function(a,f){return d.init().then(function(d){function g(a){var b=f&&f[a];return void 0===b?e[a]:b}var h=k.defer();return"function"!=typeof a&&(a=null,f=a),d.login(angular.bind(h,b),{scope:g("scope"),enable_profile_selector:g("enable_profile_selector"),profile_selector_ids:g("profile_selector_ids")}),c(h,a)})},this.logout=function(a){return d.getLoginStatus().then(function(d){var e=k.defer();return d.authResponse?f.logout(angular.bind(e,b)):e.reject(d),c(e,a)})},this.disconnect=function(a){return d.init().then(function(d){var e=k.defer();return d.api("/me/permissions","DELETE",angular.bind(e,b)),c(e,a)})}}),angular.module("kifi.clutch",[]).factory("Clutch",["$q","$timeout","util",function(a,b,c){var d=function(){function b(a,b){this._config=_.defaults({},b,g),this._getter=a,this._cache={}}function d(a){return JSON.stringify(Array.prototype.slice.call(a))}function e(a,b){return h()-a>b}function f(b,d){var e=a.defer(),f=this._getter.apply(this,d),g=this._cache[b]||{};g.q=e.promise,g.activeRequest=!0,this._cache[b]=g;var i=this;return f.then(function(a){if(g.time=h(),g.activeRequest=!1,g.value){if(g.value===a)return e.resolve(g.value);if(angular.isArray(a))c.replaceArrayInPlace(g.value,a);else{if(!angular.isObject(a))throw new TypeError("Supplied function must return an array/object");c.replaceObjectInPlace(g.value,a)}}else g.value=a,i._cache[b]=g;e.resolve(g.value)})["catch"](function(a){g.activeRequest=!1,g.value&&"ignore"===i._config.remoteError?e.resolve(g.value):e.reject(a)}),e.promise}var g={remoteError:"ignore",cache:!1,cacheDuration:3e4,returnPreviousOnExpire:!1,defaultValue:!1,somethingAboutOffline:!0},h=Date.now||function(){return(new Date).getTime()};return b.prototype.get=function(){var b=d(arguments),c=this._cache[b];return c?!c.value||c.activeRequest?c.q:e(c.time,this._config.cacheDuration)?this._config.returnPreviousOnExpire?(f.call(this,b,arguments),a.when(c.value)):f.call(this,b,arguments):c.q||a.when(c.value):f.call(this,b,arguments)},b.prototype.contains=function(){return!!this._cache[d(arguments)]},b.prototype.refresh=function(){var a=d(arguments);return f.call(this,a,arguments)},b.prototype.age=function(){var a=d(arguments);return a&&this._cache[a]&&h()-this._cache[a].time},b.prototype.isExpired=function(){var a=d(arguments),b=a&&this._cache[a];return b&&e(b.time,this._config.cacheDuration)},b.prototype.expire=function(){var a=d(arguments),b=this._cache[a];return delete this._cache[a],b},b.prototype.expireAll=function(){this._cache={}},b}();return d}]),angular.module("kifi.dragService",[]).factory("dragService",["$document",function(a){var b,c;return a.on("dragover",function(a){a=a.originalEvent,b=a.clientX||a.pageX,c=a.clientY||a.pageY}),{getDragPosition:function(){return{pageX:b,pageY:c}}}}]),angular.module("kifi.installService",[]).factory("installService",["$window","$log","$rootScope","$timeout",function(a,b,c,d){function e(){return angular.element(document.documentElement).attr("data-kifi-ext")}var f=a.chrome&&a.chrome.webstore&&a.chrome.webstore.install,g=!f&&"MozBoxSizing"in a.document.documentElement.style||a.navigator.userAgent.indexOf("Firefox")>-1,h=+(a.navigator.userAgent.match(/(?:Chrome|Firefox)\/(\d+)/)||[null,999])[1],i=f&&h>=26||g&&h>=20;if(f&&i){var j=a.document.createElement("link");j.rel="chrome-webstore-item",j.href="https://chrome.google.com/webstore/detail/fpjooibalklfinmkiodaamcckfbcjhin";var k=a.document.getElementsByTagName("link")[0];k.parentNode.insertBefore(j,k)}var l={triggerInstall:function(e){f&&i?(l.installInProgress=!0,a.chrome.webstore.install("https://chrome.google.com/webstore/detail/fpjooibalklfinmkiodaamcckfbcjhin",function(){l.installed=!0,l.installInProgress=!1,l.error=!1,c.$digest()},function(a){b.log(a),l.installed=!1,l.installInProgress=!1,l.error=!0,e&&e(),c.$digest(),d(function(){l.error=!1,c.$digest()},1e4)})):a.location.href=g&&i?"//www.kifi.com/assets/plugins/kifi.xpi":"//www.kifi.com/unsupported"},canInstall:i,installInProgress:!1,installed:!1,error:!1,installedVersion:e,hasMinimumVersion:function(a,b){var c=e();if(!c)return!1;for(var d=c.split("."),f=(d.length>3&&b||a).split("."),g=0;g<f.length;g++)if(g>=d.length||+d[g]<+f[g])return!1;return!0}};return l}]),angular.module("kifi.keepWhoService",[]).factory("keepWhoService",[function(){var a={getPicUrl:function(a){return a&&a.id&&a.pictureName?"//djty7jcqog9qu.cloudfront.net/users/"+a.id+"/pics/100/"+a.pictureName:""},getName:function(a){return a?a.firstName&&a.lastName?a.firstName+" "+a.lastName:a.firstName||a.lastName||"":""}};return a}]),angular.module("kifi.me",[]).service("me",function(){return{replace:!0,restrict:"A",templateUrl:"profileCard/profileCard.tpl.html",link:function(a){a.firstName="Joon Ho",a.lastName="Cho",a.description="Porting to Angular.js"}}}),function(a){var b,c,d;a.module("kifi.mixpanel",["angulartics"]).config(["$analyticsProvider",function(a){function e(a){for(var b in k)if(k[b].test(a))return b;return a}function f(){var a="standard";if(d&&d.me&&d.me.experiments){var b=d.me.experiments;b.indexOf("fake")>-1?a="fake":b.indexOf("admin")>-1&&(a="admin")}return a}function g(a,h,k){if(j){var l=a.get_distinct_id&&a.get_distinct_id();try{k||(k=b.location.origin),a.identify(j),c.log("mixpanelService.pageTrackForUser("+h+"):"+k),a.track("user_viewed_page",{type:e(h),origin:k,siteVersion:2,userStatus:f()})}finally{l||a.identify(l)}}else if(i.push(h),d&&d.me&&d.me.id){j=d.me.id;var m=i.slice();i.length=0,m.forEach(function(b){g(a,b,k)})}}function h(a,b,d){c.log("mixpanelService.pageTrackForVisitor("+b+"):"+d),a.track("visitor_viewed_page",{type:e(b),origin:d,siteVersion:2})}var i=[],j=null,k={yourKeeps:/^\/$/,yourFriends:/^\/friends$/,tagResults:/^\/tag\//,searchResults:/^\/find\b/,addFriends:/^\/invite$/,requests:/^\/friends\/requests$/,helpRankClicks:/^\/helprank\/clicks?$/,helpRankReKeeps:/^\/helprank\/rekeeps?$/};angulartics.waitForVendorApi("mixpanel",5e3,function(){a.registerPageTrack(function(a){if(d&&b){var c=b.mixpanel,e=b.location.origin;h(c,a,e),g(c,a,e)}})}),angulartics.waitForVendorApi("mixpanel",5e3,function(){a.registerEventTrack(function(a,d){b&&("path"in d&&!d.type&&(d.type=e(d.path),delete d.path),c.log("mixpanelService.eventTrack("+a+")",d),b.mixpanel.track(a,d))})})}]).run(["profileService","$window","$log",function(a,e,f){b=e,d=a,c=f}])}(angular),angular.module("kifi.routeService",[]).factory("routeService",["$location","env",function(a,b){function c(a){return b.xhrBase+a}function d(a){return b.xhrBaseSearch+a}function e(a,c,d){return b.picBase+"/users/"+a+"/pics/"+(d||200)+"/"+c}return{disconnectNetwork:function(a){return b.origin+"/disconnect/"+a},linkNetwork:function(a){return b.origin+"/link/"+a},uploadBookmarkFile:function(a){var b="/keeps/file-import";return a&&(b+="?public=1"),c(b)},refreshNetworks:b.origin+"/friends/invite/refresh",importStatus:c("/user/import-status"),prefs:c("/user/prefs"),importGmail:function(){return b.origin+"/contacts/import?redirectUrl="+a.url()},networks:c("/user/networks"),profileUrl:c("/user/me"),logout:"https://www.kifi.com/logout",emailInfoUrl:c("/user/email"),abooksUrl:c("/user/abooks"),resendVerificationUrl:c("/user/resend-verification"),userPasswordUrl:c("/user/password"),formatPicUrl:e,removeSingleKeep:function(a){return b.xhrBase+"/keeps/"+a+"/delete"},getKeep:function(a){return c("/keeps/"+a)},removeKeeps:c("/keeps/remove"),tagOrdering:c("/collections/ordering"),whoToInvite:c("/friends/wti"),blockWtiConnection:c("/friends/wti/block"),friends:function(a,b){return c("/user/friends")+"?page="+a+"&pageSize="+b},friendRequest:function(a){return b.xhrBase+"/user/"+a+"/friend"},incomingFriendRequests:c("/user/incomingFriendRequests"),invite:c("/user/invite"),search:d("/site/search"),searchResultClicked:d("/site/search/events/resultClicked"),searchedAnalytics:d("/site/search/events/searched"),searchResultClickedAnalytics:d("/site/search/events/resultClicked"),socialSearch:function(a,b){return b=b||6,c("/user/connections/all/search?query="+a+"&limit="+b+"&pictureUrl=true")},exportKeeps:c("/keeps/export")}}]),angular.module("kifi.scrollbar",[]).factory("scrollbar",["$document",function(a){function b(){var b=a[0],c=b.createElement("p");c.style.width="100%",c.style.height="200px";var d=b.createElement("div");d.style.position="absolute",d.style.top="0px",d.style.left="0px",d.style.visibility="hidden",d.style.width="200px",d.style.height="150px",d.style.overflow="hidden",d.appendChild(c),b.body.appendChild(d);var e=c.offsetWidth;d.style.overflow="scroll";var f=c.offsetWidth;return e===f&&(f=d.clientWidth),b.body.removeChild(d),e-f}function c(){return 30}var d=null,e=null;return{getWidth:function(){return null==d&&(d=b()),d},getAntiscrollWidth:function(){return null==e&&(e=c()),e}}}]),angular.module("kifi.undo",[]).factory("undoService",["$timeout",function(a){var b=3e4,c={isSet:function(){return!!c.callback},add:function(d,e,f){c.message=d,c.callback=e,c.promise&&a.cancel(c.promise),c.promise=a(function(){c.promise=null,c.clear()},null==f?b:f)},clear:function(){c.promise&&a.cancel(c.promise),c.message=c.callback=c.promise=null},undo:function(){var a=null;return c.callback&&(a=c.callback.call()),c.clear(),a}};return c}]),angular.module("util",[]).factory("util",["$document","$window",function(a,b){return{startsWith:function(a,b){return a===b||0===a.lastIndexOf(b,0)},endsWith:function(a,b){return a===b||-1!==a.indexOf(b,a.length-b.length)},trimInput:function(a){return a?a.trim().replace(/\s+/g," "):""},validateEmail:function(a){var b=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;return b.test(a)},replaceArrayInPlace:function(a,b){return a=a||[],a.length=0,Array.prototype.push.apply(a,b),a},completeObjectInPlace:function(a,b){_.forOwn(b||{},function(c,d){a[d]=b[d]})},replaceObjectInPlace:function(a,b){_.forOwn(a||{},function(b,c){delete a[c]}),_.forOwn(b||{},function(c,d){a[d]=b[d]})},offset:function(c){try{return c.offset()}catch(d){}var e=c[0],f=a.documentElement||a.body,g=b.pageXOffset||f.scrollLeft,h=b.pageYOffset||f.scrollTop,i=e.getBoundingClientRect().left+g,j=e.getBoundingClientRect().top+h;return{left:i,top:j}},isIE:function(){return"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!=/Trident/.exec(navigator.userAgent)}}}]).directive("postRepeatDirective",["$timeout","$window",function(a,b){return function(c){c.$first&&b.console&&b.console.time&&b.console.time("postRepeatDirective"),c.$last&&a(function(){b.console&&b.console.time&&(b.console.time("postRepeatDirective"),b.console.timeEnd("postRepeatDirective"))})}}]).constant("keyIndices",{KEY_UP:38,KEY_DOWN:40,KEY_ENTER:13,KEY_ESC:27,KEY_TAB:9,KEY_DEL:46,KEY_F2:113,KEY_SPACE:32}),angular.module("kifi.friends.compactFriendsView",[]).directive("kfCompactFriendsView",["$log","friendService",function(a,b){return{replace:!0,restrict:"A",templateUrl:"friends/compactFriendsView.tpl.html",link:function(a){a.friendCount=b.totalFriends,b.getKifiFriends().then(function(c){var d=_.filter(c,function(a){return a.pictureUrl=b.getPictureUrlForUser(a),!a.unfriended}),e=[],f=[];d.forEach(function(a){"0.jpg"===a.pictureName||"0.jpg.jpg"===a.pictureName?f.push(a):e.push(a)}),d=e.concat(f),a.friendGroups=[d.slice(0,5),d.slice(5,10)]}),a.friendsLink=function(){return a.friendCount()>0?"/friends":"/invite"}}}}]),angular.module("kifi.friends.friendCard",[]).directive("kfFriendCard",["$log","friendService",function(a,b){return{scope:{friend:"&"},replace:!0,restrict:"A",templateUrl:"friends/friendCard.tpl.html",link:function(a){var c=a.friend();a.name=c.firstName+" "+c.lastName,a.possesive="s"===c.firstName[c.firstName.length-1]?c.firstName+"'":c.firstName+"s",a.mainImage=b.getPictureUrlForUser(c),a.friendCount=c.friendCount,a.unfriended=c.unfriended,a.searchFriend=c.searchFriend,a.unfriend=function(){a.showUnfriendConfirm=!0},a.reallyUnfriend=function(){b.unfriend(c.id)},a.unsearchfriend=function(){b.unSearchFriend(c.id)},a.researchfriend=function(){b.reSearchFriend(c.id)}}}}]),angular.module("kifi.friends.friendRequestCard",[]).directive("kfFriendRequestCard",["$log","friendService",function(a,b){return{scope:{request:"&"},replace:!0,restrict:"A",templateUrl:"friends/friendRequestCard.tpl.html",link:function(a){var c=a.request();a.name=c.firstName+" "+c.lastName,a.mainImage="//djty7jcqog9qu.cloudfront.net/users/"+c.id+"/pics/200/"+c.pictureName,a.accept=function(){b.acceptRequest(c.id)},a.ignore=function(){b.ignoreRequest(c.id)}}}}]),angular.module("kifi.friendService",["angulartics","util"]).factory("friendService",["$http","env","$q","routeService","$analytics","$location","Clutch","util",function(a,b,c,d,e,f,g,h){var i=[],j=[],k=!1,l=!0,m=20,n=0,o=0,p={cacheDuration:2e4},q=new g(function(b){return a.get(d.friends(b,m)).then(function(a){return 0===b&&(i.length=0),l=a.data.friends.length>=m,i.push.apply(i,_.filter(a.data.friends,function(a){return!a.unfriended})),k=!0,o=a.data.total,i})},p),r=new g(function(){return a.get(d.incomingFriendRequests).then(function(a){return h.replaceArrayInPlace(j,a.data),j})},p),s={getMore:function(){return s.getKifiFriends(++n)},getKifiFriends:function(a){return q.get(a||0)},getRequests:function(){return r.get()},friends:i,totalFriends:function(){return o},hasMore:function(){return l},friendsHasRequested:k,requests:j,unSearchFriend:function(c){return a.post(b.xhrBase+"/user/"+c+"/exclude",{}).then(function(){q.expireAll(),s.getKifiFriends(),e.eventTrack("user_clicked_page",{action:"hideFriendInSearch",path:f.path()})})},reSearchFriend:function(c){return a.post(b.xhrBase+"/user/"+c+"/include",{}).then(function(){q.expireAll(),s.getKifiFriends(),e.eventTrack("user_clicked_page",{action:"unHideFriendInSearch",path:f.path()})})},acceptRequest:function(c){return a.post(b.xhrBase+"/user/"+c+"/friend",{}).then(function(){q.expireAll(),r.expireAll(),s.getRequests(),s.getKifiFriends(),e.eventTrack("user_clicked_page",{action:"acceptRequest",path:f.path()})})},ignoreRequest:function(c){return a.post(b.xhrBase+"/user/"+c+"/ignoreRequest",{}).then(function(){q.expireAll(),s.getRequests(),e.eventTrack("user_clicked_page",{action:"ignoreRequest",path:f.path()})})},unfriend:function(c){return a.post(b.xhrBase+"/user/"+c+"/unfriend",{}).then(function(){q.expireAll(),s.getKifiFriends(),e.eventTrack("user_clicked_page",{action:"unFriend",path:f.path()})})},getPictureUrlForUser:function(a){return"//djty7jcqog9qu.cloudfront.net/users/"+a.id+"/pics/200/"+a.pictureName}};return s}]),angular.module("kifi.friends",["util","kifi.social","kifi.profileService","kifi.routeService","kifi.invite"]).config(["$routeProvider",function(a){a.when("/friends",{templateUrl:"friends/friends.tpl.html"}).when("/friends/requests",{redirectTo:"/friends"}).when("/friends/requests/:network",{redirectTo:"/friends"})}]).controller("FriendsCtrl",["$scope","$window","friendService","socialService",function(a,b,c,d){b.document.title="Kifi • Your Friends on Kifi",a.$watch(d.checkIfRefreshingSocialGraph,function(b){a.isRefreshingSocialGraph=b}),d.checkIfUpdatingGraphs(1),a.requests=c.requests;var e=!0;a.requestsToShow=2,a.requestsToggleText="See all requests",a.toggleRequestExpansion=function(){e=!e,e?(a.requestsToShow=2,a.requestsToggleText="See all requests"):(a.requestsToShow=a.requests.length,a.requestsToggleText="See fewer requests")},a.totalFriends=c.totalFriends,a.friendsScrollDistance="100%",a.isFriendsScrollDisabled=function(){return!c.hasMore()},a.friendsScrollNext=_.throttle(c.getMore,1e3),a.friends=c.friends,a.friendsHasRequested=c.friendsHasRequested,c.getKifiFriends(),c.getRequests()}]),angular.module("kifi.helprank",["util","kifi.keepService"]).config(["$routeProvider",function(a){a.when("/helprank/:helprank",{templateUrl:"helprank/helprank.tpl.html",controller:"HelpRankCtrl"})}]).controller("HelpRankCtrl",["$scope","keepService","$routeParams",function(a,b,c){function d(){a.scrollDisabled=!1,a.getNextKeeps()}b.reset(),a.keepService=b,a.keeps=b.list;var e=c.helprank||"";a.hasMore=function(){return!b.isEnd()},a.getSubtitle=function(){if(a.loading)return"Loading...";var c=b.getSubtitle(a.mouseoverCheckAll);if(c)return c;var d=a.keeps.length;switch(d){case 0:return"No Keeps";case 1:return"Showing the only Keep";case 2:return"Showing both Keeps"}return b.isEnd()?"Showing all "+d+" Keeps":"Showing the "+d+" latest Keeps"},a.scrollDistance="100%",a.scrollDisabled=!1,a.getNextKeeps=function(){return a.loading?void 0:(a.loading=!0,b.getKeepsByHelpRank(e).then(function(c){return a.loading=!1,b.isEnd()&&(a.scrollDisabled=!0),c}))},a.$watch("keepService.seqReset()",function(){d()})}]),angular.module("kifi.home",["util","kifi.keepService","kifi.modal"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"home/home.tpl.html",controller:"HomeCtrl"})}]).controller("HomeCtrl",["$scope","tagService","keepService","$q","$timeout","$window",function(a,b,c,d,e,f){function g(){a.scrollDisabled=!1,a.getNextKeeps().then(function(){return a.getNextKeeps()})}c.reset(),f.document.title="Kifi • Your Keeps",a.keepService=c,a.keeps=c.list,a.enableSearch(),a.hasMore=function(){return!c.isEnd()},a.getSubtitle=function(){if(a.loading)return"Loading...";var b=c.getSubtitle(a.mouseoverCheckAll);if(b)return b;var d=a.keeps.length;switch(d){case 0:return"You have no keeps";case 1:return"Showing your only keep";case 2:return"Showing both of your keeps";default:return c.isEnd()?"Showing all "+d+" of your keeps":"Showing your "+d+" latest keeps"}},a.getNextKeeps=function(){return a.loading?d.when([]):(a.loading=!0,c.getList().then(function(b){return a.loading=!1,c.isEnd()&&(a.scrollDisabled=!0),b}))},a.$watch("keepService.seqReset()",function(){g()})}]),angular.module("kifi.invite.connectionCard",["angularMoment"]).directive("kfConnectionCard",["$window","$http","routeService","inviteService",function(a,b,c,d){return{scope:{friend:"&",refreshScroll:"=",showGenericInviteError:"=",showLinkedinTokenExpiredModal:"=",showLinkedinHitRateLimitModal:"="},replace:!0,restrict:"A",templateUrl:"invite/connectionCard.tpl.html",link:function(e){var f=e.friend(),g=f.fullSocialId.split("/")[0],h=f.fullSocialId.split("/")[1],i=null!=f.lastInvitedAt;if(e.mainImage=null!=f.pictureUrl?f.pictureUrl:"email"===g?"/img/email-icon.png":"https://www.kifi.com/assets/img/ghost.100.png",e.mainLabel=f.name,e.hidden=!1,e.facebook="facebook"===g,e.linkedin="linkedin"===g,e.email="email"===g,e.action=function(){d.invite(g,h).then(function(){e.invited=!0,e.actionText="Resend";var a="Invited just now";"email"===g?(e.byline=h,e.byline2=a):e.byline=a},function(a){"token_expired"===a?e.showLinkedinTokenExpiredModal=!0:"hit_rate_limit_reached"===a?e.showLinkedinHitRateLimitModal=!0:e.showGenericInviteError=!0})},e.closeAction=function(){e.hidden=!0;var a={fullSocialId:f.fullSocialId};b.post(c.blockWtiConnection,a)},i){e.invited=!0,e.actionText="Resend";var j="Invited "+a.moment(new Date(f.lastInvitedAt)).fromNow();"email"===g?(e.byline=h,e.byline2=j):e.byline=j}else e.invited=!1,e.byline="email"===g?h:g.charAt(0).toUpperCase()+g.slice(1),e.actionText="Invite"}}}]),angular.module("kifi.invite",["util","kifi.profileService","kifi.routeService","jun.facebook","kifi.inviteService","kifi.social","kifi.modal"]).config(["$routeProvider",function(a){a.when("/invite",{templateUrl:"invite/invite.tpl.html"}).when("/friends/invite",{redirectTo:"/invite"})}]).controller("InviteCtrl",["$scope","$rootScope","$http","profileService","routeService","$window","wtiService","socialService",function(a,b,c,d,e,f,g,h){f.document.title="Kifi • Invite your friends",a.$watch(h.checkIfRefreshingSocialGraph,function(b){a.isRefreshingSocialGraph=b}),h.checkIfUpdatingGraphs(2),a.whoToInvite=g.list,a.wtiLoaded=!1,a.$watch(function(){return g.list.length||!g.hasMore()
},function(b){b&&(a.wtiLoaded=!0)}),a.wtiScrollDistance="100%",a.isWTIScrollDisabled=function(){return!g.hasMore()},a.wtiScrollNext=g.getMore,a.showAddNetworksModal=function(){b.$emit("showGlobalModal","addNetworks")}}]).directive("kfSocialInviteWell",[function(){return{scope:{showFindFriends:"="},replace:!0,restrict:"A",templateUrl:"invite/inviteWell.tpl.html",link:function(){}}}]).directive("kfSocialNetworksStatus",["socialService","$rootScope",function(a,b){return{scope:{},replace:!0,restrict:"A",templateUrl:"invite/socialNetworkStatus.tpl.html",link:function(c){c.numNetworks=a.networks.length,c.$watch(function(){return a.networks.length},function(a){c.numNetworks=a}),c.data=c.data||{},c.showAddNetworks=function(){b.$emit("showGlobalModal","addNetworks")},a.refresh()}}}]).directive("kfSocialInviteSearch",["inviteService","$document","$log","socialService","$timeout","$rootScope",function(a,b,c,d,e,f){return{scope:{},replace:!0,restrict:"A",templateUrl:"invite/inviteSearch.tpl.html",link:function(g,h){function i(a){g.search.showDropdown&&!h.find(a.target)[0]&&g.$apply(function(){g.search.name="",g.search.showDropdown=!1})}g.search={},g.search.showDropdown=!1,g.data=g.data||{},g.results=[],g.selected=a.socialSelected,g.change=_.debounce(function(){a.socialSearch(g.search.name).then(function(a){var b=_.clone(a),c=_.filter(a,function(a){return a.network&&-1===a.network.indexOf("fortytwo")}).length;g.search.name.length>2&&(a.length<3||3>c)&&b.push({custom:"cant_find"}),g.results=b,g.search.showDropdown=b&&0!==b.length?!0:!1})},200);var j={};g.invite=function(b,d){if(c.log("this person:",b),!j[b.socialId]){j[b.socialId]=!0;var f=angular.element(d.target);f.text("Sending"),f.parent().removeClass("clickable"),"fortytwo"===b.networkType||"fortytwoNF"===b.networkType?a.friendRequest(b.socialId).then(function(){f.text("Sent!"),e(function(){delete j[b.socialId],f.text("Resend"),f.parent().addClass("clickable")},4e3),a.expireSocialSearch()},function(d){c.log("err:",d,b),delete j[b.socialId],f.text("Error. Retry?"),f.parent().addClass("clickable"),a.expireSocialSearch()}):a.invite(b.networkType,b.socialId).then(function(){f.text("Sent!"),e(function(){delete j[b.socialId],f.text("Resend"),f.parent().addClass("clickable")},4e3),a.expireSocialSearch()},function(d){c.log("err:",d,b),delete j[b.socialId],f.text("Error. Retry?"),f.parent().addClass("clickable"),a.expireSocialSearch()})}},g.$on("$destroy",function(){b.off("click",i)}),b.on("click",i),g.refreshFriends=function(){g.data.showCantFindModal=!1,d.refreshSocialGraph()},g.connectNetworks=function(){g.data.showCantFindModal=!1,f.$emit("showGlobalModal","addNetworks")},g.hasNetworks=function(){return!!d.networks.length}}}}]),angular.module("kifi.inviteService",["util","kifi.clutch","angulartics"]).factory("inviteService",["$http","env","$q","routeService","util","Clutch","$window","$log","$analytics","$location","$FB",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){a.socialId=a.value.split("/").splice(1).join("");var b=a.label.trim();if(a.label=b?b:a.socialId,a.network="email"===a.networkType?a.socialId:q[a.networkType]||a.networkType,a.iconStyle="kf-"+a.networkType+"-icon-micro",("fortytwo"===a.networkType||"fortytwoNF"===a.networkType)&&(a.image=d.formatPicUrl(a.socialId,a.image)),"invited"===a.status){var c=g.moment(new Date(a.inviteLastSentAt)).fromNow();a.inviteText=c}return a}function m(a,b){if(/^[^@\s]+@[^@\s]+$/.test(a)){var c=b[b.length-1];if(c&&c.custom){if(c.label===a)return;b.pop()}var d=_.find(b,function(b){return"email"===b.networkType&&b.value.split("/").splice(1).join("")===a});d||(s.socialId=a,s.label=a,s.network=a,s.value="email/"+a,b.push(l(s)))}}k.getLoginStatus();var n,o,p=[],q={facebook:"Facebook",linkedin:"LinkedIn"},r=new f(function(b){return b&&b.trim()?a.get(d.socialSearch(b)).then(function(a){var b=a.data;return _.forEach(b,l),i.eventTrack("user_clicked_page",{action:"searchContacts",path:j.path()}),b}):c.when([])}),s={custom:"email",iconStyle:"kf-email-icon-micro",networkType:"email",status:""},t={socialSearch:function(a){return o=a,m(a,p),r.get(a).then(function(a){return m(o,a),e.replaceArrayInPlace(p,a),n=0===a.length?null:a[0].value,a})},expireSocialSearch:function(){r.expireAll()},inviteList:p,socialSelected:n,invite:function(b,e){function f(){a.post(d.invite,{id:b+"/"+e}).then(function(a){i.eventTrack("user_clicked_page",{action:"inviteFriend",platform:b,path:j.path()}),a.data.url&&"facebook"===b?(k.ui({method:"send",link:g.unescape(a.data.url),to:e}),l.resolve("")):a.data.error?(h.log(a.data.error),l.reject("linkedin_error_{401}"===a.data.error.code?"token_expired":"linkedin_error_{403}"===a.data.error.code?"hit_rate_limit_reached":"generic_error")):l.resolve("")},function(a){throw h.log(a),a})}r.expireAll();var l=c.defer();return"facebook"===b?k.FB.getAuthResponse()?f():k.FB.login(function(a){a.authResponse&&f()}):("fortytwoNF"===b&&(b="fortytwo"),f()),l.promise},friendRequest:function(b){return a.post(d.friendRequest(b)).then(function(a){return a.data})}};return t}]),angular.module("kifi.invite.wtiService",["kifi.clutch"]).factory("wtiService",["$http","routeService","Clutch","$q",function(a,b,c,d){var e=[],f=!0,g=0,h=new c(function(c){return a.get(b.whoToInvite+"?page="+c).then(function(a){return 0===a.data.length?f=!1:(g++,e.push.apply(e,a.data)),a.data})}),i={getMore:function(){return h.get(g)},hasMore:function(){return f},loadInitial:function(){e.length=0,g=0,f=!0,h.expireAll();var a=i.getMore();return a.then(function(){return i.getMore()}),e.length>0?d.when(e):a},list:e};return i}]),angular.module("kifi.addKeep",[]).directive("kfAddKeep",["$document","$rootScope","$location","keyIndices","keepService",function(a,b,c,d,e){return{restrict:"A",scope:{shown:"="},require:"^kfModal",templateUrl:"keep/addKeep.tpl.html",link:function(f,g,h,i){function j(a){f.$apply(function(){switch(a.which){case d.KEY_ENTER:f.keepUrl();break;case d.KEY_TAB:l=(l+1)%3,0===l&&(a.preventDefault(),a.stopPropagation(),k())}})}function k(){setTimeout(function(){m.focus()})}var l=0,m=g.find(".kf-add-keep-input"),n=g.find(".kf-add-keep-private-container");f.state={};var o=function(){f.state.checkedPrivate=!1,f.state.invalidUrl=!1,f.state.input=""};o(),f.resetFocusState=function(){l=0},n.on("keydown",function(a){f.$apply(function(){a.which===d.KEY_SPACE&&(a.stopPropagation(),a.preventDefault(),f.togglePrivate())})}),f.$on("$destroy",function(){a.off("keydown",j)}),f.togglePrivate=function(){f.state.checkedPrivate=!f.state.checkedPrivate},f.keepUrl=function(){var a=f.state.input||"";return a&&e.validateUrl(a)?(c.path("/"),e.keepUrl([a],f.state.checkedPrivate).then(function(a){f.resetAndHide(),a.failures&&a.failures.length?b.$emit("showGlobalModal","genericError"):a.alreadyKept&&a.alreadyKept.length?c.path("/keep/"+a.alreadyKept[0].id):e.fetchFullKeepInfo(a.keeps[0])})):void(f.state.invalidUrl=!0)},f.$watch("shown",function(b){b?(a.on("keydown",j),k()):a.off("keydown",j)}),f.resetAndHide=function(){o(),i.hideModal()}}}}]),angular.module("kifi.keep",["kifi.keepWhoPics","kifi.keepWhoText","kifi.tagService"]).controller("KeepCtrl",["$scope",function(a){function b(b){if(b&&b.length)for(var c=0,d=b.length;d>c;c++)if(a.isExampleTag(b[c]))return!0;return!1}a.isMyBookmark=function(a){return a&&a.isMyBookmark||!1},a.isExampleTag=function(a){return"example keep"===(a&&a.name&&a.name.toLowerCase())},a.isExample=function(c){return c&&null==c.isExample?(c.isExample=b(a.getTags()),c.isExample):void 0}}]).directive("kfKeep",["$document","$rootScope","$rootElement","$timeout","tagService","keepService","installService","util",function(a,b,c,d,e,f,g,h){return{restrict:"A",scope:{keep:"=",me:"=",toggleSelect:"&",isSelected:"&",clickAction:"&",dragKeeps:"&",stopDraggingKeeps:"&",editMode:"="},controller:"KeepCtrl",replace:!0,templateUrl:"keep/keep.tpl.html",link:function(d,i){function j(a,b){v.href=a;var c=v.hostname,d=a.indexOf(c),e=c.match(w);e&&(d+=e.index,c=e[0]);var f=v.pathname,g=a.indexOf(f,d+c.length),h=f.match(x);h&&(g+=h.index,f=h[0]),f=f.replace(y," ").trimRight();for(var i=b&&b.length;i--;){var j=b[i],l=j[0],m=j[1];l>=g&&l<g+f.length?f=k(f,l-g,m):l>=d&&l<d+c.length&&(c=k(c,l-d,m))}return f=f.trimLeft(),c+(f?" · "+f:"")}function k(a,b,c){return a.substr(0,b)+"<b>"+a.substr(b,c)+"</b>"+a.substr(b+c)}function l(a){return a&&(a.title||j(a.url))}function m(a,b){if(a){var c=(a.match(A)||[""])[0].length;a=a.substr(c).replace(B,"$1");for(var d=b&&b.length;d--;)b[d][0]-=c;return n(a,b)}}function n(a,b){for(var c=b&&b.length;c--;){var d=b[c],e=d[0];e>=0&&(a=k(a,e,d[1]))}return a}function o(){var a=d.keep;return a?a.siteName||a.url:void 0}function p(){d.keep&&(d.keep.titleHtml=l(d.keep))}function q(){d.keep&&(d.keep.descHtml=m(o()))}function r(a){return a.imageWidth&&a.imageWidth<z||a.description}function s(a){var b=a.imageWidth&&a.imageHeight&&a.imageWidth/a.imageHeight,c=b>.5&&3>b,d=a.imageWidth+a.imageHeight>200;return d&&c}function t(){function a(a){c.text(a);var b=c[0].offsetWidth*(c[0].offsetHeight/23);if(a.length>150){if(b>5e3){var d=5e3/b;return a.substr(0,Math.floor(d*a.length))}}else if(f>b&&e.w>.75*f)return!1;return a}function b(a){function b(a){c[0].style.width=a+"px";var b=c[0].offsetHeight+25;return b}var d=f-a,h=d/(e.w/e.h),i=b(a),j=i-h,k=Math.abs(j)+.5*Math.abs(g-d);return h>e.h&&(k+=h-e.h),d>e.w&&(k+=d-e.w),{guess:a,delta:j,score:k,ht:Math.ceil(i),hi:h}}if(d.keep&&d.keep.summary&&d.keep.summary.description){var c=angular.element(".kf-keep-description-sizer"),e={w:d.keep.summary.imageWidth,h:d.keep.summary.imageHeight},f=i.find(".kf-keep-contents")[0].offsetWidth,g=Math.floor(.5*f);if(c[0].style.width="",!d.keep.summary.trimmedDesc){var h=a(d.keep.summary.description);if(h===!1)return void(d.keep.summary.useBigLayout=!0);d.keep.summary.trimmedDesc=h}c.text(d.keep.summary.trimmedDesc);for(var j=0,k=200,l=f-80,m=(l-k)/2+k,n=b(m),o=n;l>k+j&&o.score>20;)n=b(k+j),o.score>n.score&&(o=n),j+=40;var p=Math.floor((f-o.guess)/f*100),q=Math.floor(o.hi/23),r=23*q+22;d.keep.sizeCard=function(){var a=i.find(".kf-keep-content-line");a.find(".kf-keep-small-image").width(p+"%"),i.find(".kf-keep-info").css({height:r+"px"}).addClass("kf-dyn-positioned"),a.find(".kf-keep-image").on("error",function(){a.find(".kf-keep-small-image").hide()})}}}function u(){if(d.keep&&d.keep.summary){var a=d.keep.summary.imageWidth>50&&d.keep.summary.imageHeight>50;a&&d.keep.summary.description&&d.hasSmallImage()&&(d.keep.sizeCard=null,d.keep.calcSizeCard=t)}}var v=a[0].createElement("a"),w=/[^.\/]+(?:\.[^.\/]{1,3})?\.[^.\/]+$/,x=/[^\/]+?(?=(?:\.[a-zA-Z0-9]{1,6}|\/|)$)/,y=/[\/._-]/g,z=200;d.addingTag={enabled:!1},d.getTags=function(){return d.keep&&d.keep.tagList},d.hasTag=function(){var a=d.getTags();return a?!!a.length:!1},d.unkeep=function(){f.unkeep([d.keep])},d.keepPublic=function(){f.keep([d.keep],!1)},d.keepPrivate=function(){f.keep([d.keep],!0)},d.isPrivate=function(){return d.keep&&d.keep.isPrivate||!1},d.isMine=function(){return d.isMyBookmark(d.keep)},d.togglePrivate=function(){f.togglePrivate([d.keep])},d.getSingleSelectedKeep=function(){return d.keep?[d.keep]:[]},d.canSend=function(){return g.hasMinimumVersion("3.0.7")},d.triggerInstall=function(){b.$emit("showGlobalModal","installExtension")};var A=/^https?:\/\//,B=/^([^\/]*)\/$/;p(),q(),d.$watchCollection(function(){return{mine:d.isMyBookmark(d.keep),example:d.isExample(d.keep),"private":d.isPrivate(d.keep),selected:!!d.isSelected({keep:d.keep})}},function(a){_.forOwn(a,function(a,b){a&&!i.hasClass(b)?i.addClass(b):!a&&i.hasClass(b)&&i.removeClass(b)})}),d.$watch("keep.title",function(){p()}),d.$watch("keep.url",function(){p(),q()}),d.getTitle=function(){var a=d.keep;return a&&(a.title||a.url)},d.getSite=o,d.getName=function(a){return[a.firstName,a.firstName].filter(function(a){return!!a}).join(" ")},d.hasBigImage=function(){var a=d.keep&&d.keep.summary,b=a&&a.useBigLayout;return d.keep&&a&&(b||!r(a)&&s(a))},d.hasSmallImage=function(){var a=d.keep;return a&&a.summary&&!a.summary.useBigLayout&&r(a.summary)&&s(a.summary)},d.hasKeepers=function(){var a=d.keep;return a&&!(!a.keepers||!a.keepers.length)},d.showOthers=function(){return!d.hasKeepers()&&!(!d.keep||!d.keep.others)},d.showSocial=function(){return d.keep&&(d.keep.others||d.keep.keepers&&d.keep.keepers.length>0)},d.showTags=function(){return d.isMyBookmark(d.keep)&&(d.hasTag()||d.addingTag.enabled)},d.showAddTag=function(){d.addingTag.enabled=!0},d.onCheck=function(a){return a.stopPropagation(),d.toggleSelect()};var C=i.find(".kf-tag-drag-mask");d.isDragTarget=!1,d.onTagDrop=function(a){e.addKeepToTag(a,d.keep),d.isDragTarget=!1},d.$on("resizeImage",u),d.$watch("keep",function(){d.keep&&d.keep.summary&&(u(),d.keep.calcSizeCard&&(d.keep.calcSizeCard(),d.keep.calcSizeCard=null,d.keep.sizeCard&&d.keep.sizeCard()))}),C.on("dragenter",function(){d.$apply(function(){d.isDragTarget=!0})}),C.on("dragleave",function(){d.$apply(function(){d.isDragTarget=!1})}),d.isDragging=!1;var D,E;i.on("mousemove",function(a){D=a.pageX-h.offset(i).left,E=a.pageY-h.offset(i).top}).on("dragstart",function(a){d.$apply(function(){b.DRAGGING_KEEP=!0,c.addClass("kf-dragging-keep"),i.addClass("kf-dragged"),d.dragKeeps({keep:d.keep,event:a,mouseX:20,mouseY:50}),d.isDragging=!0})}).on("dragend",function(){d.$apply(function(){b.DRAGGING_KEEP=!1,c.removeClass("kf-dragging-keep"),i.removeClass("kf-dragged"),d.stopDraggingKeeps(),d.isDragging=!1})}).on("drop",function(a){a.preventDefault()}),d.$watch("editMode.enabled",function(){i.attr("draggable",!0)})}}}]),angular.module("kifi.keepView",[]).config(["$routeProvider",function(a){a.when("/keep/:keepId",{templateUrl:"keep/keepView.tpl.html",controller:"KeepViewCtrl"})}]).controller("KeepViewCtrl",["$scope","$routeParams","keepService",function(a,b,c){function d(){c.getSingleKeep(e).then(function(){a.keeps=c.list,a.loading=!1})}a.keeps=[],a.loading=!0,a.keepService=c;var e=b.keepId||"";a.getSubtitle=function(){return a.loading?"Loading...":"Showing 1 keep"},a.$watch("keepService.seqReset()",function(){d()})}]),angular.module("kifi.keepService",["kifi.undo","kifi.clutch","kifi.tagService","angulartics","util"]).factory("keepService",["$http","env","$q","$timeout","$document","$rootScope","undoService","$log","Clutch","$analytics","routeService","$location","tagService","util",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(){return Math.random().toString(16).slice(2)}function p(a){_.extend(a,a.bookmark),a.keepers=a.users,a.others=a.count-a.users.length-(a.isMyBookmark&&!a.isPrivate?1:0),a.summary=a.uriSummary,a.isProtected=!a.isMyBookmark,t(a,a.isMyBookmark)}function q(a){if(!a)return-1;for(var b=a.id,c=0,d=D.length;d>c;c++){if(b&&D[c].id===b)return c;if(!b&&D[c]===a)return c}return-1}function r(a){if(!a.conversationUpdatedAt)return!0;var b=(new Date).getTime()-a.conversationUpdatedAt.getTime();return b/1e3>15}function s(a,b){var d=c.defer();if(a){var e=new XMLHttpRequest;e.withCredentials=!0,e.upload.addEventListener("progress",function(a){d.notify({name:"progress",event:a})}),e.addEventListener("load",function(){d.resolve(JSON.parse(e.responseText))}),e.addEventListener("error",function(a){d.reject(a)}),e.addEventListener("loadend",function(a){d.notify({name:"loadend",event:a})}),e.open("POST",k.uploadBookmarkFile(b),!0),e.send(a)}else d.reject({error:"no file"});return d.promise}function t(a,b){a.isMyBookmark=b,"boolean"!=typeof a.isMyBookmark&&(a.isMyBookmark=!0),a.tagList=a.tagList||[],a.collections=a.collections||[],a.addTag=function(a){this.tagList.push(a),this.collections.push(a.id)},a.removeTag=function(a){var b=_.findIndex(this.tagList,function(b){return b.id===a});b>-1&&this.tagList.splice(b,1);var c=this.collections.indexOf(a);return c>-1?(this.collections.splice(c,1),!0):!1}}function u(c,d){h.log("keepService.keep()",c);var e=b.xhrBase+"/keeps/add",f={params:{separateExisting:!0}};return a.post(e,c,f).then(function(a){var b=(d||[]).concat(a.data.keeps||[]);return b=_.uniq(b,function(a){return a.url}),_.forEach(b,t),j.eventTrack("user_clicked_page",{action:"keep",path:l.path()}),m.addToKeepCount(a.data.keeps.length),y(b),a.data})}function v(b){var c=k.getKeep(b),d={params:{withFullInfo:!0}};return a.get(c,d).then(function(a){var b=a.data;return J=!0,D.length=0,t(b),z([b]),b})}function w(b){b.isLoading=!0;var c=k.getKeep(b.id),d={params:{withFullInfo:!0}};return a.get(c,d).then(function(a){return n.completeObjectInPlace(b,a.data),t(b),b.isLoading=!1,b})}function x(a,b){var c=[],d=[];a.forEach(function(a){var b=_.find(D,function(b){return a.url===b.url});b?c.push(b):d.push(a)}),b.apply(D,d),Q++,c.forEach(B),I=D.length?D[D.length-1].id:null}function y(a){x(a,D.unshift)}function z(a){x(a,D.push)}function A(a){var b=/^[a-zA-Z]+:\/\//;return b.test(a)?a:"http://"+a}function B(a){a.unkept=!1,a.isMyBookmark=!0,a.tagList&&a.tagList.forEach(function(a){var b=m.getById(a.id);b&&b.keeps++})}function C(a){a.unkept=!0,a.isMyBookmark=!1,a.tagList&&a.tagList.forEach(function(a){var b=m.getById(a.id);b&&b.keeps--})}var D=[],E=null,F=o(),G=-1,H={},I=null,J=!1,K=0,L=10,M=4,N={},O=e[0],P=0,Q=0;f.$on("tags.remove",function(a){var b=_.filter(D,function(b){return b.removeTag(a)});m.setRemovedKeepsForTag(a,b)}),f.$on("tags.unremove",function(a){_.forEach(m.getRemovedKeepsForTag(a),function(b){b.addTag(a)})});var R=new i(function(b,c){return h.log("keepService.getList()",c&&c.params),a.get(b,c).then(function(a){var b=a.data,c=b.keeps||[];return _.forEach(c,t),{keeps:c,before:b.before}})}),S={list:D,seqReset:function(){return P},seqResult:function(){return Q},buildKeep:t,lastSearchContext:function(){return E},getHighlighted:function(){return D[K]},isSelected:function(a){return a&&a.id&&!!H[a.id]},select:function(a){var b=a.id;return b?(H[b]=a,K=q(a),!0):!1},unselect:function(a){var b=a.id;return b?(delete H[b],K=q(a),!0):!1},toggleSelect:function(a){return void 0===a?S.toggleSelect(D[K]):S.isSelected(a)?S.unselect(a):a?S.select(a):void 0},getFirstSelected:function(){return _.values(H)[0]},getSelectedLength:function(){return _.keys(H).length},getSelected:function(){return D.filter(function(a){return a.id in H})},selectAll:function(){H=_.reduce(D,function(a,b){return a[b.id]=!0,a},{})},unselectAll:function(){H={}},isSelectedAll:function(){return D.length&&D.length===S.getSelectedLength()},toggleSelectAll:function(){return S.isSelectedAll()?S.unselectAll():S.selectAll()},reset:function(){h.log("keepService.reset()"),F=o(),E=null,G=-1,I=null,J=!1,D.length=0,H={},S.unselectAll(),R.expireAll(),P++},getList:function(a){if(J)return c.when([]);var d=b.xhrBase+"/keeps/all";a=a||{},a.count=I?a.count||L:M,a.before=I||void 0,a.withPageInfo=!0;var e={params:a};return R.get(d,e).then(function(b){var c=b.keeps,d=b.before;return(!c.length||c.length<a.count-1)&&(J=!0),d||(D.length=0),z(c),c})},joinTags:function(a,b){var c=_.reduce(b,function(a,b){return b&&b.id&&(a[b.id]=b),a},{});_.forEach(a,function(a){var b=_.map(_.union(a.collections,a.tags),function(a){return c[a]||null}).filter(function(a){return null!=a});a.tagList=n.replaceArrayInPlace(a.tagList,b)})},getChatter:function(d){if(d&&d.url&&r(d)){var e=b.xhrBaseEliza+"/chatter",f={url:d.url};return h.log("keepService.getChatter()",f),a.post(e,f).then(function(a){var b=a.data;return d.conversationCount=b.threads,d.conversationUpdatedAt=new Date,b})}return c.when({threads:0})},prefetchImages:function(a){_.forEach(a,function(a,b){b in N||!a||(N[b]=a,O.createElement("img").src=a)})},validateUrl:function(a){return-1!==a.indexOf(".")},keepUrl:function(a,b){var c={keeps:a.map(function(a){return{url:A(a),isPrivate:!!b}})};return u(c)},keep:function(a,b){if(!a||!a.length)return c.when(a||[]);var d=null==b,e={keeps:a.map(function(a){return d||(a.isPrivate=!!b),{title:a.title,url:a.url,isPrivate:!!a.isPrivate}})},f=u(e,a);return f.keeps},unkeep:function(b){if(!b||!b.length)return c.when(b||[]);var d,e;return 1===b.length&&b[0].id?(d=k.removeSingleKeep(b[0].id),e={}):(d=k.removeKeeps,e=_.map(b,function(a){return{url:a.url}})),h.log("keepService.unkeep()",d,e),a.post(d,e).then(function(){_.forEach(b,function(a){C(a),S.isSelected(a)&&S.unselect(a)});var a=b.length>1?b.length+" Keeps deleted.":"Keep deleted.";return(b.length>1||b.some(function(a){return!a.isProtected}))&&g.add(a,function(){S.keep(b)}),m.addToKeepCount(-1*b.length),j.eventTrack("user_clicked_page",{action:"unkeep",path:l.path()}),b})},toggleKeep:function(a,b){var c=_.every(a,"isMyBookmark");return b=null==b?_.some(a,"isPrivate"):!!b,c?S.unkeep(a):S.keep(a,b)},togglePrivate:function(a){return S.keep(a,!_.every(a,"isPrivate"))},getSingleKeep:v,fetchFullKeepInfo:w,isEnd:function(){return!!J},getSubtitle:function(a){var b=S.getSelectedLength(),c=D.length;if(a)return b===c?"Deselect all "+c+" Keeps below":"Select all "+c+" Keeps below";switch(b){case 0:return null;case 1:return b+" Keep selected";default:return b+" Keeps selected"}},uploadBookmarkFile:s,find:function(b,d,e){if(J)return c.when([]);var f=k.search,g={params:{q:b||void 0,f:d||"m",maxHits:30,context:e||void 0,withUriSummary:!0}};return h.log("keepService.find() req",g),a.get(f,g).then(function(a){var b=a.data,c=b.hits||[];return h.log("keepService.find() res",b),b.mayHaveMore||(J=!0),j.eventTrack("user_clicked_page",{action:"searchKifi",hits:c.size,mayHaveMore:b.mayHaveMore,path:l.path()}),_.forEach(c,p),z(c),G++,E={origin:l.origin,uuid:a.data.uuid,experimentId:a.data.experimentId,query:g.params.q,filter:g.params.f,maxResults:g.params.maxHits,kifiTime:null,kifiShownTime:null,kifiResultsClicked:null,refinements:G,pageSession:F},b})},getKeepsByTagId:function(a,b){return b=b||{},b.collection=a,S.getList(b)},getKeepsByHelpRank:function(a,b){return b=b||{},b.helprank=a,S.getList(b)}};return S}]),angular.module("kifi.keeps",["kifi.profileService","kifi.keepService"]).controller("KeepsCtrl",["$scope","profileService","keepService","tagService",function(a,b,c,d){a.me=b.me,a.data={draggedKeeps:[]},a.$watch(function(){return c.seqResult()+","+d.allTags.length},function(){a.keeps&&a.keeps.length&&d.allTags.length&&c.joinTags(a.keeps,d.allTags)}),a.dragKeeps=function(b,d,e,f){var g=c.getSelected();0===g.length&&(g=[b]),a.data.draggedKeeps=g;var h=angular.toJson(a.data.draggedKeeps);d.dataTransfer.setData("Text",h);var i=a.getDraggedKeepsElement();i.find(".kf-keep").css("background","rgba(255,255,255,.7)"),d.dataTransfer.setDragImage(i[0],e,f)},a.stopDraggingKeeps=function(){a.data.draggedKeeps=null}}]).directive("kfKeeps",["keepService","$window","$timeout",function(a,b,c){return{restrict:"A",scope:{keeps:"=",keepsLoading:"=",keepsHasMore:"=",keepClick:"=",scrollDisabled:"=",scrollNext:"&",editMode:"=",toggleEdit:"="},controller:"KeepsCtrl",templateUrl:"keeps/keeps.tpl.html",link:function(d,e){function f(){Math.abs(b.innerWidth-h)>250&&(h=b.innerWidth,g())}function g(){d.$broadcast("resizeImage"),c(function(){d.keeps.forEach(function(a){a.calcSizeCard&&a.calcSizeCard()}),d.keeps.forEach(function(a){a.sizeCard&&a.sizeCard()})})}d.toggleSelect=a.toggleSelect,d.getSelected=a.getSelected,d.isSelected=a.isSelected,d.toggleSelectAll=a.toggleSelectAll,d.isSelectedAll=a.isSelectedAll,d.editingTags=!1,d.addingTag={enabled:!1},d.keepClickAction=function(a,b){a.metaKey&&"A"!==a.target.tagName&&"IMG"!==a.target.tagName?(d.editMode.enabled||d.toggleEdit(!0),d.editMode.enabled=!0,d.toggleSelect(b)):a.target.href&&d.keepClick&&d.keepClick(b,a)},d.isMultiChecked=function(){return a.getSelectedLength()>0&&!a.isSelectedAll()},d.isUnchecked=function(){return!d.isSelectedAll()&&!d.isMultiChecked()},d.isShowMore=function(){return!d.keepsLoading&&d.keepsHasMore},d.getDraggedKeepsElement=function(){if(d.data.draggedKeeps.length>=4){var a=e.find(".kf-shadow-keep-ellipsis"),b=e.find(".kf-shadow-keep-ellipsis-counter"),c=e.find(".kf-shadow-keep-ellipsis-counter-hidden");b.css({left:(parseInt(a.width(),10)-parseInt(c.width(),10))/2})}return e.find(".kf-shadow-dragged-keeps")},d.draggedTwo=function(){return d.data.draggedKeeps&&2===d.data.draggedKeeps.length},d.draggedThree=function(){return d.data.draggedKeeps&&3===d.data.draggedKeeps.length},d.draggedMore=function(){return d.data.draggedKeeps&&d.data.draggedKeeps.length>3},d.isScrollDisabled=function(){return d.scrollDisabled},d.scrollDistance="100%",d.unkeep=function(){a.unkeep(a.getSelected())},d.togglePrivate=function(){a.togglePrivate(a.getSelected())},d.selectionPrivacyState=function(){return _.every(a.getSelected(),"isPrivate")?"Public":"Private"},d.enableEditTags=function(){d.editingTags=!0},d.disableEditTags=function(){d.editingTags=!1},d.$watch(function(){return d.getSelected().length},function(){d.disableEditTags()});var h=b.innerWidth,i=_.debounce(f,250);b.addEventListener("resize",i),d.$on("$destroy",function(){b.removeEventListener("resize",i),d.editMode.enabled=!1})}}}]),angular.module("kifi.layout.header",["kifi.profileService"]).controller("HeaderCtrl",["$scope","$window","$rootElement","$rootScope","$document","profileService","friendService","$location","util","keyIndices",function(a,b,c,d,e,f,g,h,i,j){function k(b){a.$apply(function(){b.metaKey&&b.which===j.KEY_ENTER&&a.addKeeps()})}a.toggleMenu=function(){c.toggleClass("kf-sidebar-active")},b.addEventListener("message",function(b){"show_left_column"===b.data&&a.$apply(function(){c.addClass("kf-sidebar-active")})}),a.me=f.me,f.getMe(),a.isActive=function(a){var b=h.path();return b===a||i.startsWith(b,a+"/")},a.logout=function(){f.logout()},a.addKeeps=function(){d.$emit("showGlobalModal","addKeeps")},e.on("keydown",k),a.$on("$destroy",function(){e.off("keydown",k)}),g.getRequests(),a.friendRequests=g.requests,a.navigateToFriends=function(){h.path("/friends")},a.navigateToInvite=function(){h.path("/invite")}}]),angular.module("kifi.layout.main",["kifi.undo","angulartics"]).controller("MainCtrl",["$scope","$element","$window","$location","$timeout","$rootElement","undoService","keyIndices","injectedState","$rootScope","$analytics","keepService","installService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(){var b=a.search.text||"";b=_.str.trim(b),b?d.path("/find").search("q",b):d.path("/").search(""),e(function(){a.$apply()})}function o(b){if(b)if(b.m&&"1"===b.m)a.data.showEmailModal=!0,a.modal="email";else if(b.m){var c=s[b.m];a.tooltipMessage=c,e(function(){delete a.tooltipMessage},5e3)}}function p(b,c){a.modal="import_bookmarks",a.data.showImportModal=!0,a.msgEvent=c&&c.origin&&c.source&&c||!1}function q(){a.modal="import_bookmark_file",a.data.showBookmarkFileModal1=!0;var b=f.find(".bookmark-file-upload");b.replaceWith(b=b.clone(!0))}function r(){a.modal="add_keeps",a.data.initAddKeeps=!0,a.data.showAddKeeps=!0}a.search={},a.searchEnabled=!1,a.data=a.data||{},a.editMode={enabled:!1},a.enableSearch=function(){a.searchEnabled=!0,this.$on("$destroy",function(){a.searchEnabled=!1})},a.isEmpty=function(){return!a.search.text},a.onKeydown=function(b){b.keyCode===h.KEY_ESC?a.clear():b.keyCode===h.KEY_ENTER&&n()},a.clear=function(){a.search.text="",n()},a.clearable=function(){return!!a.search.text},a.onChange=_.debounce(n,350),a.$on("$routeChangeSuccess",function(b,c,d){d&&c&&"SearchCtrl"===d.controller&&"SearchCtrl"!==c.controller&&(a.search.text="")}),a.undo=g;var s={0:"Welcome back!",2:"Bookmark import in progress. Reload the page to update."};o(i.state),j.$on("showGlobalModal",function(b,c){switch(c){case"addNetworks":a.modal="add_networks",a.data.showAddNetworks=!0;break;case"importBookmarks":p.apply(null,Array.prototype.slice(arguments,2));break;case"importBookmarkFile":q();break;case"addKeeps":r();break;case"genericError":a.modal="generic_error",a.data.showGenericErrorModal=!0;break;case"installExtension":a.modal="install_extension",a.data.showInstallExtension=!0;break;case"installExtensionError":a.modal="install_extension_error",a.data.showInstallErrorModal=!0}}),a.importBookmarks=function(b){a.data.showImportModal=!1;var d=c.document.getElementsByTagName("html")[0].getAttribute("data-kifi-ext");if(!d)return a.modal="import_bookmarks_error",void(a.data.showImportError=!0);k.eventTrack("user_clicked_page",{type:"bookmarkImport",action:b?"ImportPublic":"ImportPrivate"});var e=a.msgEvent&&a.msgEvent.origin&&a.msgEvent.source&&a.msgEvent,f="import_bookmarks";b&&(f="import_bookmarks_public"),e?e.source.postMessage(f,a.msgEvent.origin):c.postMessage(f,"*"),a.modal="import_bookmarks",a.data.showImportModal2=!0},a.cancelImport=function(){c.postMessage("import_bookmarks_declined","*"),a.data.showImportModal=!1},a.disableBookmarkImport=!0,a.allowUpload=function(b){a.$apply(function(){var c=b&&b.files&&b.files[0];c&&-1!==c.name.indexOf(".html",c.name.length-5)?(a.importFilename=c.name,a.disableBookmarkImport=!1,a.importFileStatus=""):(a.importFilename="",a.disableBookmarkImport=!0,a.importFileStatus="Invalid bookmark file (*.html). Try picking it again.")})},a.openExportPopup=function(a){var b=a.target.href;return c.open(b,"","menubar=no,location=yes,resizable=yes,scrollbars=yes,status=no,width=1000,height=500"),a.preventDefault(),!1},a.uploadBookmarkFile=function(b,c){if(!a.disableBookmarkImport){var d=f.find(".bookmark-file-upload"),g=d&&d[0]&&d[0].files&&d[0].files[0];if(g){a.disableBookmarkImport=!0,k.eventTrack("user_clicked_page",{type:"3rdPartyImport",action:c?"ImportPublic":"ImportPrivate"});var h=e(function(){a.importFileStatus="Your bookmarks are still uploading... Hang tight.",a.disableBookmarkImport=!1},2e4);a.importFileStatus="Uploading! May take a bit, especially if you have a lot of links.",a.importFilename="",l.uploadBookmarkFile(g,c).then(function(b){e.cancel(h),a.importFileStatus="",b.error?(a.modal="import_bookmarks_error",a.data.showBookmarkFileModal1=!1,a.data.showBookmarkFileError=!0,a.modal="import_bookmark_error"):(a.data.showBookmarkFileModal1=!1,a.data.showBookmarkFileModal2=!0,a.modal="import_bookmark_file")},function(){e.cancel(h),a.disableBookmarkImport=!1,a.importFileStatus="We may have had problems with your links. Reload the page to see if they’re coming in. If not, please contact support so we can fix it."})}else a.importFileStatus="Hm, couldn’t upload your file. Try picking it again."}},a.cancelBookmarkUpload=function(){a.disableBookmarkImport=!0,a.modal="",a.importFilename="",a.importFileStatus=""},a.openBookmarkFileSelector=function(){var a=f.find(".bookmark-file-upload");a.click()},a.editKeepsLabel=function(){return a.editMode.enabled?"Done editing":"Edit keeps"},a.toggleEdit=function(b){a.editMode.enabled?l.unselectAll():b&&c.scrollBy(0,118),a.editMode.enabled=!a.editMode.enabled},/^Mac/.test(c.navigator.platform)&&f.find("body").addClass("mac"),a.triggerInstall=function(){m.triggerInstall(function(){j.$emit("showGlobalModal","installExtensionError")})};var t=angular.element(document.getElementsByTagName("html")[0]);t.css({marginRight:0}),j.$watch(function(){return null!==t[0].getAttribute("kifi-pane-parent")},function(a){var b=f.find(".kf-main"),c=f.find(".kf-col-right"),d=f.find(".kf-header-inner");if(a){var e=angular.element(document.createElement("html"));e.attr({"kifi-pane-parent":"","kifi-with-pane":""}),e.hide().appendTo("html");var g=e.css("margin-right");e.remove();var h=c.width();Math.abs(parseInt(g,10)-h)<15&&(g=h+"px"),b.css("width","calc(100% - "+g+")"),c.css("width",e.css("margin-right")),d.css("padding-right",g)}else b.css("width",""),c.css("width",""),d.css("padding-right","")})}]),angular.module("kifi.layout.nav",["util"]).directive("kfNav",["$location","util","keepService","friendService","tagService",function(a,b,c,d,e){return{restrict:"A",templateUrl:"layout/nav/nav.tpl.html",link:function(f){f.counts={keepCount:c.totalKeepCount,friendsCount:d.totalFriends(),friendsNotifCount:d.requests.length},f.$watch(function(){return d.requests.length},function(a){f.counts.friendsNotifCount=a}),f.$watch(d.totalFriends,function(a){f.counts.friendsCount=a}),f.$watch(e.getTotalKeepCount,function(a){f.counts.keepCount=a}),f.isActive=function(c){var d=a.path();return d===c||b.startsWith(d,c+"/")}}}}]),angular.module("kifi.layout.rightCol",["kifi.modal"]).controller("RightColCtrl",["$scope","$element","$window","profileService","$q","$http","env","$timeout","installService","$rootScope","$analytics","friendService","$location","keepService","tagService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){a.data=a.data||{},a.me=d.me;
var p=!1;l.getKifiFriends().then(function(){p=!0}),h(function(){p=!0},1200),a.readyToDraw=function(){return d.me.seqNum>0&&p},a.openHelpRankHelp=function(){a.data.showHelpRankHelp=!0,k.eventTrack("user_viewed_page",{type:"HelpRankHelp"})},a.yesLikeHelpRank=function(){a.data.showHelpRankHelp=!1,k.eventTrack("user_clicked_page",{type:"HelpRankHelp",action:"yesLikeHelpRank"})},a.noLikeHelpRank=function(){a.data.showHelpRankHelp=!1,k.eventTrack("user_clicked_page",{type:"HelpRankHelp",action:"noLikeHelpRank"})},a.trackClickOnClicks=function(){k.eventTrack("user_clicked_page",{action:"helpRankClicks",path:m.path()})},a.trackClickOnReKeeps=function(){k.eventTrack("user_clicked_page",{action:"helpRankReKeeps",path:m.path()})},a.installInProgress=function(){return i.installInProgress},a.installed=function(){return i.installed},a.installError=function(){return i.error},a.triggerInstall=function(){i.triggerInstall(function(){j.$emit("showGlobalModal","installExtensionError")})},a.triggerGuide=function(a){c.postMessage({type:"start_guide",pages:[{url:"http://realhealthyrecipes.com/2013/09/25/frosted-watermelon-cake/",name:["Frosted","Watermelon","Cake"],site:"realhealthyrecipes.com",thumb:"/img/guide/watermelon_cake.jpg",noun:"recipe",tag:"Recipe",query:"watermelon",title:"Frosted Watermelon Cake | Real Healthy Recipes",matches:{title:[[8,10]],url:[[49,10]]},track:"watermelonCake"},{url:"https://www.etsy.com/listing/163215077/large-leather-tote-everyday-tote-bag",name:["Large","Leather","Tote"],site:"etsy.com",thumb:"/img/guide/leather_tote.jpg",noun:"tote",tag:"Wishlist",query:"large+bag",title:"Large Leather Tote - Everyday tote bag",matches:{title:[[0,5],[35,3]],url:[[39,5],[72,3]]},track:"leatherTote"},{url:"http://www.theverge.com/2014/6/26/5845996/watch-google-io-2014-keynote-on-demand",name:["Google I/O","2014","Keynote"],site:"theverge.com",thumb:"/img/guide/google_io.jpg",noun:"article",tag:"Watch Later",query:"google+io",title:"You can now watch Google’s entire two-and-a-half-hour I/O keynote",matches:{title:[[18,6],[54,3]],url:[[48,6],[55,2]]},track:"googleIoKeynote"},{url:"http://www.ted.com/talks/steve_jobs_how_to_live_before_you_die",name:["Steve Jobs:","How to Live","Before You Die"],site:"ted.com",thumb:"/img/guide/before_you_die.jpg",noun:"video",tag:"Inspiration",query:"steve+jobs",title:"Steve Jobs: How to live before you die | Talk Video | TED.com",matches:{title:[[0,5],[6,4]],url:[[25,5],[31,4]]},track:"steveJobsSpeech"}]},"*"),a&&k.eventTrack("user_clicked_page",{action:"startGuide",path:m.path()}),delete c.document.documentElement.dataset.guide},"guide"in c.document.documentElement.dataset&&a.triggerGuide(),a.importBookmarks=function(){var a=c.document.documentElement.dataset.kifiExt;return a?void j.$emit("showGlobalModal","importBookmarks"):void j.$emit("showGlobalModal","installExtension")},a.importBookmarkFile=function(){j.$emit("showGlobalModal","importBookmarkFile")};var q;c.addEventListener("message",function(b){a.$apply(function(){switch(b.data){case"get_guide":a.triggerGuide();break;case"import_bookmarks":b.data.bookmarkCount>0&&j.$emit("showGlobalModal","importBookmarks",b.data.bookmarkCount,b);break;case"update_keeps":case"update_tags":h.cancel(q),q=h(function(){o.fetchAll(!0),n.reset()},1e3)}})}),a.logout=function(){d.logout()}}]),angular.module("kifi.profile",["util","kifi.profileService","kifi.profileInput","kifi.routeService","kifi.profileEmailAddresses","kifi.profileChangePassword","kifi.profileImage","jun.facebook","angulartics"]).config(["$routeProvider",function(a){a.when("/profile",{templateUrl:"profile/profile.tpl.html",controller:"ProfileCtrl"})}]).controller("ProfileCtrl",["$scope","$http","profileService","routeService","$window","socialService",function(a,b,c,d,e,f){function g(b){a.emailForVerification=b,a.showResendVerificationEmailDialog.value=!0}function h(a){return b({url:d.emailInfoUrl,method:"GET",params:{email:a}})}function i(b,d){return d.isPrimary||d.isPendingPrimary?void c.fetchMe():d.isVerified?c.setNewPrimaryEmail(a.me,d.address):(k=b,a.showEmailChangeDialog.value=!0,c.successInputActionResult())}function j(a,b){return"available"!==b.status?c.failureInputActionResult("This email address is already added","Please use another email address."):(c.addEmailAccount(a),void g(a))}e.document.title="Kifi • Your Profile",f.refresh(),a.showEmailChangeDialog={value:!1},a.showResendVerificationEmailDialog={value:!1},c.getMe().then(function(b){a.me=b}),a.descInput={},a.$watch("me.description",function(b){a.descInput.value=b||""}),a.emailInput={},a.$watch("me.primaryEmail.address",function(b){a.emailInput.value=b||""}),a.addEmailInput={},a.logout=function(){c.logout()},a.saveDescription=function(a){c.postMe({description:a})},a.validateEmail=function(a){return c.validateEmailFormat(a)},a.saveEmail=function(b){return a.me&&a.me.primaryEmail.address===b?c.successInputActionResult():h(b).then(function(a){return i(b,a.data)},function(a){return c.getEmailValidationError(a.status)})},a.addEmail=function(a){return h(a).then(function(b){return j(a,b.data)},function(a){return c.getEmailValidationError(a.status)})},a.isUnverified=function(a){return a.value&&!a.value.isPendingPrimary&&a.value.isPrimary&&!a.value.isVerified},a.resendVerificationEmail=function(b){!b&&a.me&&a.me.primaryEmail&&(b=a.me.primaryEmail.address),g(b),c.resendVerificationEmail(b)},a.cancelPendingPrimary=function(){c.cancelPendingPrimary()};var k;a.cancelSaveEmail=function(){a.emailInput.value=a.me.primaryEmail.address},a.confirmSaveEmail=function(){c.setNewPrimaryEmail(k)},a.exportKeeps=function(){a.exported=!0},a.getExportUrl=function(){return d.exportKeeps},a.getExportButtonText=function(){return a.exported?"Export Again":"Export Keeps"}}]).directive("kfLinkedinConnectButton",["socialService",function(a){return{restrict:"A",link:function(b){b.isLinkedInConnected=a.linkedin&&!!a.linkedin.profileUrl,b.linkedin=a.linkedin,b.$watch(function(){return a.linkedin&&a.linkedin.profileUrl},function(){var c=a.linkedin;c&&c.profileUrl?(b.isLinkedInConnected=!0,b.liProfileUrl=c.profileUrl):(b.isLinkedInConnected=!1,b.liProfileUrl="")}),b.connectLinkedIn=a.connectLinkedIn,b.disconnectLinkedIn=a.disconnectLinkedIn}}}]).directive("kfFacebookConnectButton",["socialService",function(a){return{restrict:"A",link:function(b){b.isFacebookConnected=a.facebook&&!!a.facebook.profileUrl,b.facebook=a.facebook,b.$watch(function(){return a.facebook&&a.facebook.profileUrl},function(){var c=a.facebook;c&&c.profileUrl?(b.isFacebookConnected=!0,b.fbProfileUrl=c.profileUrl):(b.isFacebookConnected=!1,b.fbProfileUrl="")}),b.connectFacebook=a.connectFacebook,b.disconnectFacebook=a.disconnectFacebook}}}]).directive("kfEmailImport",["profileService","$window","env","socialService",function(a,b,c,d){return{restrict:"A",replace:!0,scope:{},templateUrl:"profile/emailImport.tpl.html",link:function(a){a.addressBookImportText="Import a Gmail account",d.refresh().then(function(){a.addressBooks=d.addressBooks,d.addressBooks&&d.addressBooks.length>0&&(a.addressBookImportText="Import another Gmail account")}),a.importGmailContacts=d.importGmail}}}]),angular.module("kifi.profileChangePassword",["util","kifi.profileService"]).directive("kfProfileChangePassword",["profileService","keyIndices",function(a,b){return{restrict:"A",scope:{},templateUrl:"profile/profileChangePassword.tpl.html",link:function(c,d){c.isOpen=!1,c.inputs={oldPassword:"",newPassword1:"",newPassword2:""},c.toggle=function(){c.isOpen=!c.isOpen,c.isOpen&&(c.successMessage="")},d.find("input").on("keydown",function(a){switch(a.which){case b.KEY_ESC:this.blur();break;case b.KEY_ENTER:c.$apply(c.updatePassword)}}),c.updatePassword=function(){c.successMessage="",c.inputs.oldPassword.length<7?c.errorMessage="Your current password is not correct.":c.inputs.newPassword1!==c.inputs.newPassword2?c.errorMessage="Your new passwords do not match.":c.inputs.newPassword1.length<7?c.errorMessage="Your password needs to be longer than 7 characters.":c.inputs.oldPassword===c.inputs.newPassword1?c.errorMessage="Your new password needs to be different from your current one.":(c.errorMessage="",a.sendChangePassword(c.inputs.oldPassword,c.inputs.newPassword1).then(function(){c.successMessage="Your password was successfully updated!",c.inputs={},c.toggle()},function(a){c.errorMessage="bad_old_password"===a.data.error?"Your current password is not correct.":"bad_new_password"===a.data.error?"Your password needs to be longer than 7 characters.":"An error occured. Try again?"}))}}}}]),angular.module("kifi.profileEmailAddresses",["util","kifi.profileService"]).directive("kfProfileEmailAddresses",["$document","keyIndices","profileService",function(a,b,c){return{restrict:"A",scope:{state:"=inputState",emailList:"=",validateEmailAction:"&",addEmailAction:"&",resendVerificationEmailAction:"&"},templateUrl:"profile/profileEmailAddresses.tpl.html",link:function(d,e){function f(){d.$apply(function(){d.emailWithActiveDropdown=null}),a.unbind("click",f)}d.isOpen=!1,d.emailWithActiveDropdown=null,d.showEmailDeleteDialog={},d.emailToBeDeleted=null,d.toggle=function(){d.isOpen=!d.isOpen},d.enableAddEmail=function(){d.state.editing=!0},d.validateEmail=function(a){return d.validateEmailAction({value:a})},d.addEmail=function(a){return d.addEmailAction({value:a})},d.resendVerificationEmail=function(a){return d.resendVerificationEmailAction({value:a})},d.openDropdownForEmail=function(b,c){d.emailWithActiveDropdown!==c&&(d.emailWithActiveDropdown=c,b.stopPropagation(),a.bind("click",f))},d.deleteEmail=function(a){d.emailToBeDeleted=a,d.showEmailDeleteDialog.value=!0},d.confirmDeleteEmail=function(){c.deleteEmailAccount(d.emailToBeDeleted)},d.makePrimary=function(a){c.makePrimary(a)},e.find("input").on("keydown",function(a){switch(a.which){case b.KEY_ESC:d.$apply(d.cancelAddEmail);break;case b.KEY_ENTER:d.$apply(d.addEmail)}})}}}]),angular.module("kifi.profileImage",["angulartics"]).directive("kfProfileImage",["$document","$timeout","$compile","$templateCache","$window","$q","$http","env","profileService","$analytics","$location",function(a,b,c,d,e,f,g,h,i,j,k){return{restrict:"A",replace:!0,scope:{picUrl:"="},templateUrl:"profile/profileImage.tpl.html",link:function(c,d){function l(){if(E){var a=Math.pow(c.zoomSlider.value/c.zoomSlider.max,2);C.currentWidth=C.minimumWidth+a*(C.maximumWidth-C.minimumWidth),C.currentHeight=C.minimumHeight+a*(C.maximumHeight-C.minimumHeight),H.css({backgroundSize:C.currentWidth+"px "+C.currentHeight+"px"}),p(),n()}}function m(a,b,c){return a>b?b:c>a?c:a}function n(){H.css({backgroundPosition:C.currentLeft+"px "+C.currentTop+"px"})}function o(a,b){C.currentLeft=m(a,B,H.width()-B-C.currentWidth),C.currentTop=m(b,B,H.height()-B-C.currentHeight)}function p(){var a=H.width()/2-C.currentWidth*C.centerXRatio,b=H.height()/2-C.currentHeight*C.centerYRatio;o(a,b)}function q(){C.centerXRatio=(H.width()/2-C.currentLeft)/C.currentWidth,C.centerYRatio=(H.height()/2-C.currentTop)/C.currentHeight}function r(b){D.initialMouseX=b.pageX,D.initialMouseY=b.pageY,D.initialLeft=C.currentLeft,D.initialTop=C.currentTop,a.on("mousemove",s),a.on("mouseup",t)}function s(a){var b=D.initialLeft+a.pageX-D.initialMouseX,c=D.initialTop+a.pageY-D.initialMouseY;o(b,c),n()}function t(){a.off("mousemove",s),a.off("mousemove",t),q()}function u(){I.on("mousedown",r)}function v(a){var b=Array.prototype.filter.call(a,w)[0];if(b){A&&A.abort();var c=new e.XMLHttpRequest;A=c;var d=f.defer();return c.withCredentials=!0,c.upload.addEventListener("progress",function(a){a.lengthComputable&&d.notify(a.loaded/a.total)}),c.addEventListener("load",function(){d.resolve(JSON.parse(c.responseText))}),c.addEventListener("loadend",function(){A===c&&(A=null)}),c.open("POST",F,!0),c.send(b),{file:b,promise:d.promise}}}function w(a){return 0===a.type.search(/^image\/(?:bmp|jpg|jpeg|png|gif)$/)}function x(a){c.$apply(function(){H.css({background:"url("+a+") no-repeat"}),z=H.width()-2*B;var b=new Image;b.onload=function(){var a=this;c.$apply(function(){C.imageWidth=a.width||1,C.imageHeight=a.height||1;var b=C.imageWidth/C.imageHeight,d=1.5;1>b?(C.minimumWidth=z,C.minimumHeight=C.minimumWidth/b,C.maximumWidth=d*Math.max(C.imageWidth,z),C.maximumHeight=C.maximumWidth/b):(C.minimumHeight=z,C.minimumWidth=C.minimumHeight*b,C.maximumHeight=d*Math.max(C.imageHeight,z),C.maximumWidth=C.maximumHeight*b),c.zoomSlider.value=50,C.centerXRatio=.5,C.centerYRatio=.5,c.showImageEditDialog.value=!0,E=!0,l()})},b.src=a})}function y(){c.showImageUploadingModal.value=!1,c.showImageUploadFailedDialog.value=!0,c.resetChooseImage()}c.showImageEditDialog={value:!1},c.showImageUploadingModal={value:!1},c.showImageUploadFailedDialog={value:!1};var z,A,B=40,C={},D={},E=!1,F=h.xhrBase+"/user/pic/upload",G=h.xhrBase+"/user/pic";c.zoomSlider={orientation:"horizontal",min:0,max:100,range:"min",change:l,slide:l};var H,I,J=d.find(".profile-image-file");b(function(){H=d.find(".kf-profile-image-dialog-image"),I=d.find(".kf-profile-image-dialog-mask"),u()}),c.selectFile=function(){J.click()},c.fileChosen=function(a){c.$apply(function(){if(E=!1,c.files=a,0!==c.files.length){var b=new FileReader;b.onload=function(a){x(a.target.result)},b.readAsDataURL(c.files[0])}})},c.resetChooseImage=function(){J.val(null)},c.uploadImage=function(){c.showImageUploadingModal.value=!0;var a=v(c.files);a?a.promise.then(function(a){var b=C.imageWidth/C.currentWidth,d={picToken:a&&a.token,picWidth:C.imageWidth,picHeight:C.imageHeight,cropX:Math.floor(b*(B-C.currentLeft)),cropY:Math.floor(b*(B-C.currentTop)),cropSize:Math.floor(Math.min(b*z,b*z))};g.post(G,d).then(function(){i.fetchMe(),c.showImageUploadingModal.value=!1,c.resetChooseImage(),j.eventTrack("user_clicked_page",{action:"uploadImage",path:k.path()})},y)},y):y()}}}}]),angular.module("kifi.profileInput",["util","kifi.profileService"]).directive("kfProfileInput",["$timeout","$q","keyIndices","util",function(a,b,c,d){return{restrict:"A",scope:{state:"=inputState",validateAction:"&inputValidateAction",saveAction:"&inputSaveAction",explicitEnabling:"=",actionLabel:"@"},transclude:!0,templateUrl:"profile/profileInput.tpl.html",link:function(e,f){function g(){k&&(a.cancel(k),k=null)}function h(a){e.state.value=e.state.currentValue=a}function i(a){e.state.invalid=!0,e.errorHeader=a.header||"",e.errorBody=a.body||""}function j(){g(),e.state.editing=!0,e.state.invalid=!1}e.state.editing=e.state.invalid=!1;var k;f.find("input").on("keydown",function(a){switch(a.which){case c.KEY_ESC:e.$apply(e.cancel);break;case c.KEY_ENTER:e.$apply(e.save)}}).on("blur",function(){k=a(e.cancel,100)}).on("focus",function(){a(function(){j()})}),e.edit=function(){e.state.currentValue=e.state.value,j()},e.cancel=function(){e.state.value=e.state.currentValue,e.state.editing=!1},e.save=function(){var a=d.trimInput(e.state.value),c=e.validateAction({value:a});return c&&!c.isSuccess&&c.error?void i(c.error):(e.state.prevValue=e.state.currentValue,h(a),e.state.editing=!1,void b.when(e.saveAction({value:a})).then(function(a){a&&!a.isSuccess&&(a.error&&i(a.error),h(e.state.prevValue))}))}}}}]),angular.module("kifi.profileService",["kifi.routeService","angulartics","kifi.clutch"]).factory("profileService",["$http","env","$q","util","routeService","socialService","$analytics","$location","$window","$rootScope","Clutch",function(a,b,c,d,e,f,g,h,i,j,k){function l(a){return angular.forEach(a,function(a,b){H[b]=a}),H.picUrl=e.formatPicUrl(H.id,H.pictureName),H.primaryEmail=p(H.emails),H.seqNum++,f.setExpiredTokens(H.notAuthed),H}function m(){return J.expireAll(),J.get()}function n(){return J.get()}function o(b){return a.post(e.profileUrl,b).then(function(a){return g.eventTrack("user_clicked_page",{action:"updateProfile",path:h.path()}),l(a.data)})}function p(a){var b=_.find(a,"isPrimary");if(b)return b;var c=_.find(a,"isVerified")||a[0]||null;return c&&_.map(a,function(a){a===c&&(a.isPlaceholderPrimary=!0)}),c}function q(a,b){a=a||H.emails;for(var c=a.length-1;c>=0;c--)a[c].address===b&&a.splice(c,1)}function r(a){var b=p(a);b&&(b.isPrimary=!1)}function s(a){return{emails:_.clone(a.emails,!0)}}function t(a){n().then(function(b){var c=s(b);return q(c.emails,a),r(c.emails),c.emails.unshift({address:a,isPrimary:!0}),o(c)})}function u(a){var b=s(H);return r(b.emails),_.find(b.emails,function(b){b.address===a&&(b.isPrimary=!0)}),o(b)}function v(b){return a({url:e.resendVerificationUrl,method:"POST",params:{email:b}})}function w(){n().then(function(a){return a.primaryEmail&&a.primaryEmail.isPendingPrimary?y(a.primaryEmail.address):void 0})}function x(a){var b=s(H);return b.emails.push({address:a,isPrimary:!1}),o(b)}function y(a){var b=s(H);return q(b.emails,a),o(b)}function z(a){return a?d.validateEmail(a)?B():D():A("This field is required")}function A(a,b){return{isSuccess:!1,error:{header:a,body:b}}}function B(){return{isSuccess:!0}}function C(a){switch(a){case 400:return D();case 403:return A("This email address is already taken","This email address belongs to another user.<br>Please enter another email address.")}}function D(){return A("Invalid email address","Please enter a valid email address")}function E(b,c){return a.post(e.userPasswordUrl,{oldPassword:b,newPassword:c}).then(function(){g.eventTrack("user_clicked_page",{action:"changePassword",path:h.path()})})}function F(){return a.get(e.prefs).then(function(a){return d.replaceObjectInPlace(I,a.data),a.data})}function G(){i.location=e.logout}var H={seqNum:0},I={};j.$on("social.updated",function(){m()});var J=new k(function(){return a.get(e.profileUrl).then(function(a){return l(a.data)})},{cacheDuration:5e3});return{me:H,fetchMe:m,getMe:n,postMe:o,logout:G,fetchPrefs:F,prefs:I,setNewPrimaryEmail:t,makePrimary:u,resendVerificationEmail:v,cancelPendingPrimary:w,addEmailAccount:x,deleteEmailAccount:y,validateEmailFormat:z,failureInputActionResult:A,successInputActionResult:B,getEmailValidationError:C,sendChangePassword:E}}]),angular.module("kifi.search",["util","kifi.keepService"]).config(["$routeProvider",function(a){a.when("/find",{templateUrl:"search/search.tpl.html",controller:"SearchCtrl"})}]).controller("SearchCtrl",["$http","$scope","keepService","$routeParams","$location","$window","routeService","$log",function(a,b,c,d,e,f,g,h){function i(a){switch(a){case"m":return b.results.myTotal;case"f":return b.results.friendsTotal;case"a":return b.results.othersTotal}}function j(){b.scrollDisabled=!1,p=null,b.getNextKeeps()}c.reset(),b.search&&(b.search.text=d.q),b.enableSearch();var k=function(){l("unload")},l=function(b){var d=g.searchedAnalytics,f=c.lastSearchContext();if(f&&f.query){var i=e.$$protocol+"://"+e.$$host;e.$$port&&(i=i+":"+e.$$port);var j={origin:i,uuid:f.uuid,experimentId:f.experimentId,query:f.query,filter:f.filter,maxResults:f.maxResults,kifiExpanded:!0,kifiResults:c.list.length,kifiTime:f.kifiTime,kifiShownTime:f.kifiShownTime,kifiResultsClicked:f.clicks,refinements:c.refinements,pageSession:f.pageSession,endedWith:b};a.post(d,j)["catch"](function(a){h.log("res: ",a)})}else h.log("no search context to log")},m=function(b){var d=g.searchResultClicked,f=c.lastSearchContext();if(f&&f.query){var i=e.$$protocol+"://"+e.$$host;e.$$port&&(i=i+":"+e.$$port);var j=c.list,k=j.indexOf(b),l=b.bookmark.matches||(b.bookmark.matches={}),m={isMyBookmark:b.isMyBookmark,isPrivate:b.isPrivate,count:j.length,keepers:b.keepers,tags:b.tags,title:b.bookmark.title,titleMatches:(l.title||[]).length,urlMatches:(l.url||[]).length},n={origin:i,uuid:f.uuid,experimentId:f.experimentId,query:f.query,filter:f.filter,maxResults:f.maxResults,kifiExpanded:!0,kifiResults:j.length,kifiTime:f.kifiTime,kifiShownTime:f.kifiShownTime,kifiResultsClicked:f.clicks,refinements:c.refinements,pageSession:f.pageSession,resultPosition:k,resultUrl:b.url,hit:m};a.post(d,n)["catch"](function(a){h.log("res: ",a)})}else h.log("no search context to log")};b.$on("$destroy",function(){k(),f.removeEventListener("beforeunload",k)}),f.addEventListener("beforeunload",k),d.q||e.path("/");var n=d.q||"",o=d.f||"m",p=null;f.document.title=""===n?"Kifi • Search":"Kifi • "+n,b.keepService=c,b.keeps=c.list,b.results={myTotal:0,friendsTotal:0,othersTotal:0},b.isFilterSelected=function(a){return o===a},b.isEnabled=function(a){return b.isFilterSelected(a)?!1:!!i(a)},b.getFilterUrl=function(a){if(b.isEnabled(a)){var c=i(a);if(c)return"/find?q="+n+"&f="+a}return""},b.hasMore=function(){return!c.isEnd()},b.getSubtitle=function(){if(b.loading)return"Searching…";var a=c.getSubtitle(b.mouseoverCheckAll);if(a)return a;var d=b.keeps.length;switch(d){case 0:return"Sorry, no results found for “"+n+"”";case 1:return"1 result found";default:return"Top "+d+" results"}},b.scrollDistance="100%",b.scrollDisabled=!1,b.analyticsTrack=function(a,b){return m(a),[a,b]},b.getNextKeeps=function(){b.loading||(l("refinement"),b.loading=!0,c.find(n,o,p&&p.context).then(function(a){b.loading=!1,b.results.myTotal=b.results.myTotal||a.myTotal,b.results.friendsTotal=b.results.friendsTotal||a.friendsTotal,b.results.othersTotal=b.results.othersTotal||a.othersTotal,c.isEnd()&&(b.scrollDisabled=!0),p=a}))},b.$watch("keepService.seqReset()",function(){j()}),b.allowEdit=function(){return!b.isFilterSelected("f")&&!b.isFilterSelected("a")}}]),angular.module("kifi.social.networksNeedAttention",[]).directive("kfNetworksNeedAttention",["socialService","$rootScope",function(a,b){return{replace:!0,restrict:"A",templateUrl:"social/networksNeedAttention.tpl.html",link:function(c){c.networksNeedAttention=function(){return Object.keys(a.expiredTokens).length>0},c.data={},c.doShow=function(){b.$emit("showGlobalModal","addNetworks")}}}}]),angular.module("kifi.social",["kifi.socialService"]).directive("kfSocialConnectNetworks",["socialService",function(a){return{scope:{},replace:!0,restrict:"A",templateUrl:"social/connectNetworks.tpl.html",link:function(b){b.data=b.data||{},b.data.show=!0,b.facebook=a.facebook,b.linkedin=a.linkedin,b.gmail=a.gmail,b.expiredTokens=a.expiredTokens,b.connectFacebook=a.connectFacebook,b.connectLinkedIn=a.connectLinkedIn,b.importGmail=a.importGmail,b.isRefreshingSocialGraph=a.isRefreshingSocialGraph,b.refreshingGraphs=a.refreshingGraphs,b.facebookStatus=function(){return b.refreshingGraphs.network.facebook?"refreshing":b.expiredTokens.facebook?"expired":"good"},b.linkedinStatus=function(){return b.refreshingGraphs.network.linkedin?"refreshing":b.expiredTokens.linkedin?"expired":"good"},a.refresh()}}}]),angular.module("kifi.socialService",["angulartics"]).factory("socialService",["routeService","$http","util","$rootScope","Clutch","$window","$q","$analytics","$location","$timeout",function(a,b,c,d,e,f,g,h,i,j){var k=[],l={},m={},n=[],o=[],p={},q=!1,r=!1,s={network:{},abook:{}},t=!1,u={cacheDuration:5e3},v=function(e){return t?void 0:(t=!0,e=void 0===e?10:e,0>e?(r=!1,c.replaceObjectInPlace(s,{network:{},abook:{}}),void(t=!1)):void b.get(a.importStatus).then(function(a){return c.replaceObjectInPlace(s,a.data),_.size(a.data.network)>0||_.size(a.data.abook)>0?(q=!0,r||(r=!0,e=20),void j(function(){t=!1,v(--e)},2e3)):r?(q=r=!1,t=!1,void d.$emit("social.updated")):void j(function(){t=!1,v(--e)},3e3)}))},w=new e(function(){return b.get(a.networks).then(function(a){return _.remove(a.data,function(a){return"fortytwo"===a.network}),c.replaceArrayInPlace(k,a.data),c.replaceObjectInPlace(l,_.find(k,function(a){return"facebook"===a.network})),c.replaceObjectInPlace(m,_.find(k,function(a){return"linkedin"===a.network})),a.data})},u),x=new e(function(){return b.get(a.abooksUrl).then(function(a){return c.replaceArrayInPlace(o,a.data),c.replaceArrayInPlace(n,_.filter(o,function(a){return"gmail"===a.origin})),a.data})},u),y={networks:k,addressBooks:o,refresh:function(){return v(1),g.all([x.get(),w.get()])},facebook:l,linkedin:m,gmail:n,refreshSocialGraph:function(){return q=!0,v(),b.post(a.refreshNetworks)},checkIfUpdatingGraphs:v,checkIfRefreshingSocialGraph:function(){return q},refreshingGraphs:s,connectFacebook:function(){h.eventTrack("user_clicked_page",{action:"connectFacebook",path:i.path()}),f.location.href=a.linkNetwork("facebook")},connectLinkedIn:function(){h.eventTrack("user_clicked_page",{action:"connectLinkedIn",path:i.path()}),f.location.href=a.linkNetwork("linkedin")},importGmail:function(){h.eventTrack("user_clicked_page",{action:"importGmail",path:i.path()}),f.location.href=a.importGmail()},disconnectFacebook:function(){return b.post(a.disconnectNetwork("facebook")).then(function(a){return c.replaceObjectInPlace(l,{}),h.eventTrack("user_clicked_page",{action:"disconnectFacebook",path:i.path()}),a})},disconnectLinkedIn:function(){return b.post(a.disconnectNetwork("linkedin")).then(function(a){return c.replaceObjectInPlace(m,{}),h.eventTrack("user_clicked_page",{action:"disconnectLinkedin",path:i.path()}),a})},setExpiredTokens:function(a){var b={};a.forEach(function(a){b[a]=!0}),c.replaceObjectInPlace(p,b)},expiredTokens:p};return y}]),angular.module("kifi.tagKeeps",["util","kifi.keepService"]).config(["$routeProvider",function(a){a.when("/tag/:tagId",{templateUrl:"tagKeeps/tagKeeps.tpl.html",controller:"TagKeepsCtrl"})}]).controller("TagKeepsCtrl",["$scope","keepService","tagService","$routeParams","$window",function(a,b,c,d,e){function f(){a.scrollDisabled=!1,a.getNextKeeps()}b.reset(),a.keepService=b,a.keeps=b.list;var g=d.tagId||"";a.hasMore=function(){return!b.isEnd()},a.getSubtitle=function(){if(a.loading)return"Loading...";var c=b.getSubtitle(a.mouseoverCheckAll);if(c)return c;var d=a.keeps.length;switch(d){case 0:return"No Keeps in this tag";case 1:return"Showing the only Keep in this tag";case 2:return"Showing both Keeps in this tag"}return b.isEnd()?"Showing all "+d+" Keeps in this tag":"Showing the "+d+" latest Keeps in this tag"},a.scrollDistance="100%",a.scrollDisabled=!1,a.getNextKeeps=function(){return a.loading?void 0:(a.loading=!0,b.getKeepsByTagId(g).then(function(c){return a.loading=!1,b.isEnd()&&(a.scrollDisabled=!0),c}))},a.$watch("keepService.seqReset()",function(){f()}),c.promiseById(g).then(function(b){e.document.title="Kifi • "+b.name,a.tag=b||null})}]),angular.module("kifi.tagItem",["kifi.tagService","kifi.dragService"]).directive("kfTagItem",["$timeout","$document","$rootScope","tagService","keepService","keyIndices","dragService",function(a,b,c,d,e,f,g){return{restrict:"A",scope:{tag:"=",watchTagReorder:"&",viewTag:"&",removeTag:"&",tagDragSource:"=",targetIdx:"=",index:"@"},replace:!0,templateUrl:"tags/tagItem.tpl.html",link:function(b,h,i){function j(){document.documentElement.removeEventListener("click",k,!0)}function k(a){a.stopPropagation(),a.preventDefault(),j(),b.$apply(function(){b.isDropdownOpen=!1})}function l(){c.DRAGGING_KEEP&&h.addClass("kf-keep-dragover-tag")}function m(){c.DRAGGING_KEEP&&h.removeClass("kf-keep-dragover-tag")}function n(){function a(){h.removeClass("animate"),h.off("animationend webkitAnimationEnd oanimationend MSAnimationEnd",a)}h.on("animationend webkitAnimationEnd oanimationend MSAnimationEnd",a),h.addClass("animate")}b.tag||h.addClass("kf-fake-tag-item"),b.isFake=void 0!==i.fake,b.isHovering=!1,b.isRenaming=!1,b.isWaiting=!1,b.isDropdownOpen=!1,b.renameTag={};var o,p,q=h.find("input"),r=h.parent();window.jQuery&&!window.jQuery.event.props.dataTransfer&&window.jQuery.event.props.push("dataTransfer"),b.$watch("watchTagReorder()",function(a){a?h.attr("draggable","true"):h.attr("draggable","false")}),b.navigateToTag=function(a){b.isRenaming||!b.tag?a.stopPropagation():b.viewTag({tagId:b.tag.id})},b.setRenaming=function(){b.isRenaming=!0,b.renameTag.value=b.tag.name,a(function(){q.focus(),q.select()})},b.onRenameKeydown=function(a){switch(a.keyCode){case f.KEY_ENTER:b.submitRename();break;case f.KEY_ESC:b.cancelRename()}},b.submitRename=function(){var a=b.renameTag.value;return a&&b.tag&&a!==b.tag.name?(n(),d.rename(b.tag.id,a).then(function(){b.cancelRename()})):void b.cancelRename()},b.cancelRename=function(){b.isRenaming=!1},b.toggleDropdown=function(a){a.stopPropagation(),a.preventDefault(),b.isDropdownOpen=!0,document.documentElement.addEventListener("click",k,!0)},b.cancelNavigation=function(a){a.stopPropagation()},b.$on("$destroy",function(){j()}),q.on("blur",function(){b.$apply(function(){b.cancelRename()})});var s=h.find(".kf-keep-drag-mask");b.isDragTarget=!1,s.on("dragenter",l).on("dragleave",m).on("drop",m),h.on("dragstart",function(a){a.dataTransfer.setData("text",""),b.$apply(function(){if(b.watchTagReorder()){b.tagDragSource=b.tag,r.addClass("kf-tag-list-reordering");var c={position:"fixed",left:0,top:0,width:h.css("width"),height:h.css("height"),zIndex:-1};o=h.clone().css(c).addClass("kf-dragged-clone"),p=angular.element("<li></li>").css(c).addClass("kf-dragged-clone-mask"),h.addClass("kf-dragged").after(o,p),"function"==typeof a.dataTransfer.setDragImage&&a.dataTransfer.setDragImage(o[0],0,0)}})}).on("dragend",function(a){a.preventDefault(),r.removeClass("kf-tag-list-reordering"),n(),h.removeClass("kf-dragged"),o&&o.remove(),p&&p.remove()}).on("drag",function(){var a=g.getDragPosition(),b=a.pageX,c=a.pageY,d=r.offset().left-window.pageXOffset,e=r.offset().top-window.pageYOffset,f=d+r.width(),i=e+r.height();(d>b||b>f||e>c||c>i)&&o.after(h)}).on("dragover",function(a){a.preventDefault()}).on("drop",function(a){a.preventDefault();var c=a.dataTransfer.getData("Text");if(b.tag&&c.length>0){var f=angular.fromJson(c);f.forEach(e.buildKeep),d.addKeepsToTag(b.tag,f),n()}else null!==b.targetIdx&&(d.reorderTag(b.tagDragSource,b.targetIdx),b.targetIdx=null)}).on("mouseenter",function(){b.$apply(function(){b.isHovering=!0})}).on("mouseleave",function(){b.$apply(function(){b.isHovering=!1})}),h.find(".kf-tag-drag-mask").on("dragenter",function(){b.$apply(function(){var a=h.parent().find(".kf-dragged");h.before(a),b.tag&&b.tag.id===b.tagDragSource.id||(b.targetIdx=parseInt(b.index,10))})})}}}]),angular.module("kifi.tagList",["kifi.keepService","kifi.tagService"]).directive("kfTagList",["keepService","tagService","$filter","$sce","$document",function(a,b,c,d,e){var f=38,g=40,h=13,i=27,j=46,k=113,l=5;return{scope:{getSelectedKeeps:"&",addingTag:"=",isShown:"&"},replace:!0,restrict:"A",templateUrl:"tags/tagList.tpl.html",link:function(a,c){function m(b){return b?a.tagTypeAheadResults.indexOf(b):-1}function n(b){function f(b){return a.allTags&&a.commonTags&&!!_.find(a.commonTags,function(a){return a.id===b})}function g(){return a.allTags.filter(function(a){return!f(a.id)}).slice(0,l)}function h(){var a=c.find(".kf-tag-list");return a&&a.offset().top?Math.min(10,Math.max(3,(e.height()-a.offset().top)/24-1)):l}var i=b&&b.split(/[\W]+/);if(l=h(),a.allTags&&b){var j=a.allTags.filter(function(a){return!f(a.id)&&i.every(function(b){return _.find(a.name.split(/[\W]+/),function(a){return 0===a.toLowerCase().indexOf(b.toLowerCase())})})});a.tagTypeAheadResults=j.slice(0,l)}else a.allTags&&!b&&(a.tagTypeAheadResults=g());a.tagTypeAheadResults.length>0&&a.highlightFirst(),a.tagTypeAheadResults.forEach(function(a){var b=a.name.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");a.prettyHtml=d.trustAsHtml(b)})}a.data={},a.data.isClickingInList=!1,a.newTagLabel="NEW",a.tagFilter={name:""},a.tagTypeAheadResults=[],a.shouldGiveFocus=!1,b.fetchAll().then(function(){a.allTags=b.allTags,n(null)}),a.$watch("getSelectedKeeps",function(){a.tagFilter.name="",n(null),a.hideAddTagDropdown()}),a.$watch("addingTag.enabled",function(){a.addingTag&&a.addingTag.enabled&&(a.shouldGiveFocus=!0)}),a.getCommonTags=function(){var b=_.pluck(a.getSelectedKeeps(),"tagList"),c=_.map(b,function(a){return _.pluck(a,"id")}),d=_.union.apply(this,c),e=_.indexBy(_.flatten(b,!0),"id");return _.map(d,function(a){return e[a]})},a.$watchCollection(function(){return _.flatten(_.pluck(a.getSelectedKeeps(),"tagList"))},function(){a.commonTags=a.getCommonTags()}),a.addTag=function(c){return b.addKeepsToTag(c,a.getSelectedKeeps()),a.tagFilter.name="",a.hideAddTagDropdown()},a.createAndAddTag=function(){b.create(a.tagFilter.name).then(function(b){a.addTag(b)})},a.isTagHighlighted=function(b){return a.highlightedTag===b
},a.checkHighlight=function(){_.find(a.tagTypeAheadResults,function(b){return a.highlightedTag===b})||a.highlightTag(null)},a.$watch("tagFilter.name",function(b){n(b),a.checkHighlight()}),a.highlightTag=function(b){return a.highlightedTag=b},a.highlightNext=function(){var b=m(a.highlightedTag);return-1===b?a.highlightFirst():b===a.tagTypeAheadResults.length-1?a.isAddTagShown()?a.highlightNewSuggestion():a.highlightFirst():a.highlightAt(b+1)},a.highlightPrev=function(){var b=m(a.highlightedTag);return-1===b?a.highlightLast():0===b?a.isAddTagShown()?a.highlightNewSuggestion():a.highlightLast():a.highlightAt(b-1)},a.isAddTagShown=function(){return a.tagFilter.name.length>0&&void 0===_.find(a.tagTypeAheadResults,function(b){return b.name===a.tagFilter.name})},a.highlightAt=function(b){if(null==b)return a.highlightNewSuggestion();var c=a.tagTypeAheadResults,d=c.length;if(!d)return a.highlightNewSuggestion();b=(b%d+d)%d;var e=c[b];return a.highlightTag(e),e},a.highlightFirst=function(){a.highlightAt(0)},a.highlightLast=function(){return a.highlightAt(-1)},a.highlightNewSuggestion=function(){return a.isAddTagShown()?a.highlightedTag=null:a.highlightFirst()},a.selectTag=function(){return a.highlightedTag?a.addTag(a.highlightedTag):a.createAndAddTag()},a.hasTags=function(){return a.commonTags&&a.commonTags.length>0},a.showAddTagDropdown=function(){return a.tagFilter.name="",n(null),a.shouldGiveFocus=!0,a.addingTag.enabled=!0},a.hideAddTagDropdown=function(){return a.addingTag.enabled=!1},a.$watch("isShown()",function(){n(null)}),a.onKeydown=function(b){switch(b.keyCode){case f:a.highlightPrev();break;case g:a.highlightNext();break;case h:a.selectTag();break;case i:a.hideAddTagDropdown();break;case j:a.hideAddTagDropdown();break;case k:}},a.removeTag=function(c){var d=a.getSelectedKeeps().filter(function(a){var b=_.pluck(a.tagList,"id");return _.contains(b,c.id)});b.removeKeepsFromTag(c.id,d).then(function(){})},c.on("mousedown",".kf-keep-tag-opt",function(){a.data.isClickingInList=!0}).on("mouseup",".kf-keep-tag-opt",function(){a.data.isClickingInList=!1}),a.blurTagFilter=function(){a.data.isClickingInList||a.hideAddTagDropdown()},a.addTagLabel=function(){return 1===a.getSelectedKeeps().length?"Add a tag to this keep":"Add a tag to these keeps"},a.highlightTag(null)}}}]).directive("kfTagSuggestions",["$timeout",function(a){return function(b,c){function d(){var a=f.outerWidth();e.outerWidth(a)}var e=c.find("input"),f=c.find(".kf-keep-tag-opts");d(),b.$watch("tagFilter.name",function(){a(d)})}}]),angular.module("kifi.tagService",["kifi.undo","kifi.routeService","angulartics"]).factory("tagService",["$http","env","$q","$rootScope","undoService","routeService","$analytics","$location","util",function(a,b,c,d,e,f,g,h,i){function j(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c].id===b)return c;return-1}function k(a,b){var c=j(p,a);if(-1!==c){var d=p[c];return d.keeps=(d.keeps||0)+b,d}return null}function l(c,d){var e=b.xhrBase+"/keeps/add",f={collectionId:c.id,keeps:d},i=a.post(e,f).then(function(a){return a.data&&a.data.addedToCollection&&(d.forEach(function(a){_.contains(_.pluck(a.tagList,"id"),c.id)||a.addTag(c)}),k(c.id,a.data.addedToCollection)),a});return g.eventTrack("user_clicked_page",{action:"addKeepsToTag",path:h.path()}),i}function m(){a.post(f.tagOrdering,_.pluck(p,"id")).then(function(){}),x.fetchAll()}function n(a,b){var c=_.clone(a),d=a.id;c.id=-1,p.splice(b,0,c),_.remove(p,function(a){return a.id===d}),x.refreshList(),c.id=d,m(),g.eventTrack("user_clicked_page",{action:"reorderTag",path:h.path()})}var o,p=[],q=[],r={},s="",t=null,u={},v={keys:["name"],threshold:.3},w=new Fuse(p,v),x={allTags:p,list:q,getById:function(a){return r[a]||null},promiseById:function(a){return x.fetchAll().then(function(){return x.getById(a)})},filterList:function(a){var b=p;return a.length&&(b=w.search(a)),i.replaceArrayInPlace(q,b),q},refreshList:function(){x.filterList(s)},fetchAll:function(c){if(!c&&t)return t.then(function(){return q});var d=b.xhrBase+"/collections/all",e={params:{sort:"user",_:Date.now().toString(36)}};return t=a.get(d,e).then(function(a){var b=a.data&&a.data.collections||[];return p.length=0,p.push.apply(p,b),q.length=0,q.push.apply(q,p),p.forEach(function(a){a.lowerName=a.name.toLowerCase(),r[a.id]=a}),x.refreshList(),o=a.data.keeps,p}),t.then(function(){return q})},create:function(c){var d=b.xhrBase+"/collections/create",e=a.post(d,{name:c}).then(function(a){var b=a.data;return b.keeps=b.keeps||0,b.lowerName=b.name.toLowerCase(),r[b.id]=b,p.unshift(b),x.refreshList(),x.filterList(""),b});return g.eventTrack("user_clicked_page",{action:"createTag",path:h.path()}),e},remove:function(c){var f=b.xhrBase+"/collections/"+c.id+"/delete",i=a.post(f).then(function(){var a=j(p,c.id);if(-1!==a){p.splice(a,1),x.refreshList();var b=j(q,c.id);-1!==b&&q.splice(b,1)}return d.$emit("tags.remove",c.id),e.add("Tag deleted.",function(){x.unremove(c,a)}),c});return g.eventTrack("user_clicked_page",{action:"removeTag",path:h.path()}),i},unremove:function(c,e){var f=b.xhrBase+"/collections/"+c.id+"/undelete",i=a.post(f).then(function(){return-1!==e&&(p.splice(e,0,c),x.refreshList()),d.$emit("tags.unremove",c.id),m(),c});return g.eventTrack("user_clicked_page",{action:"unremoveTag",path:h.path()}),i},getRemovedKeepsForTag:function(a){return u[a]},setRemovedKeepsForTag:function(a,b){u[a]=b},getTotalKeepCount:function(){return o},addToKeepCount:function(a){o+=a,0>o&&(o=0)},rename:function(c,d){function e(a,b){var c=j(p,a);if(-1!==c){var d=p[c];return d.name=b,d}return null}var f=b.xhrBase+"/collections/"+c+"/update",i=a.post(f,{name:d}).then(function(a){var b=a.data;return e(b.id,b.name)});return g.eventTrack("user_clicked_page",{action:"renameTag",path:h.path()}),i},removeKeepsFromTag:function(c,d){var e=b.xhrBase+"/collections/"+c+"/removeKeeps",f=a.post(e,_.pluck(d,"id")).then(function(a){return k(c,-d.length),d.forEach(function(a){a.removeTag(c)}),a});return g.eventTrack("user_clicked_page",{action:"removeKeepsFromTag",path:h.path()}),f},addKeepsToTag:l,addKeepToTag:function(a,b){return l(a,[b])},reorderTag:n};return x}]),angular.module("kifi.tags",["util","dom","kifi.tagService","kifi.tagItem"]).controller("TagsCtrl",["$scope","$timeout","tagService",function(a,b,c){a.create=function(d){return d?c.create(d).then(function(c){return c.isNew=!0,a.clearFilter(),b(function(){delete c.isNew},2600),c}):void 0}}]).directive("kfTags",["$timeout","$window","$rootScope","$location","util","dom","tagService",function(a,b,c,d,e,f,g){var h=38,i=40,j=13,k=27,l=46,m=113;return{restrict:"A",templateUrl:"tags/tags.tpl.html",scope:{},controller:"TagsCtrl",link:function(c,n){function o(){v.height(u.height()-(v.offset().top-u[0].pageYOffset))}function p(){return c.filter&&c.filter.name||""}function q(a){return a?c.getShownTags().indexOf(a):-1}function r(){c.tagLimit=40}function s(){c.tagLimit+=30}c.tags=g.list,c.viewedTagId=null,c.isFilterFocused=!1,c.data={tagDragSource:null,targetIdx:null},c.filter={};var t=!1,u=angular.element(b),v=n.find(".kf-scrollable-tags"),w=n.find(".kf-sidebar-tag-list"),x=n.find(".antiscroll-inner");w.on("mousewheel",function(a){var b=a.originalEvent.deltaY,c=v.innerHeight(),d=w.innerHeight(),e=d-c,f=x.scrollTop();(0>b&&0>=f||b>0&&f>=e)&&a.preventDefault()}),u.bind("resize",function(){c.$apply(function(){o()})}),a(o),c.clearFilter=function(){c.filter.name="",c.onFilterChange()},c.showAddTag=function(){var a=p(),b=!1;return a&&(a=a.toLowerCase(),b=c.isFilterFocused&&!c.tags.some(function(b){return b.name.toLowerCase()===a})),c.isAddTagShown=b,b},c.isActiveTag=function(a){return a&&e.startsWith(d.path(),"/tag/"+a.id)},c.getShownTags=function(){return c.tags||[]},c.viewTag=function(a){return a?(c.viewedTagId=a,c.dehighlight(),d.path("/tag/"+a)):void 0},c.select=function(){return c.highlight?c.viewTag(c.highlight.id):c.createTag().then(function(a){c.viewTag(a.id)})},c.onKeydown=function(a){switch(a.keyCode){case h:c.highlightPrev();break;case i:c.highlightNext();break;case j:c.select();break;case k:setTimeout(function(){n.find(".kf-tag-filter-input").blur()});break;case l:c.remove(c.highlight);break;case m:c.rename(c.highlight)}},c.onFilterChange=function(){r(),g.filterList(c.filter.name)},c.refreshHighlight=function(){var a=c.getShownTags(),b=c.highlight;if(b){var d=a.indexOf(b);if(-1!==d)return c.highlightAt(d)}return p()&&a.length?c.highlightFirst():c.dehighlight()},c.isHighlight=function(a){return a&&c.highlight===a},c.isHighlightNew=function(){return!c.highlight&&!!p()},c.dehighlight=function(){return c.highlight=null,c.isAddTagShown&&f.scrollIntoViewLazy(n.find(".kf-tag-new")[0]),null},c.highlightAt=function(a){if(null==a)return c.dehighlight();var b=c.getShownTags(),d=b.length;if(!d)return c.dehighlight();a=(a%d+d)%d;var e=b[a];return c.highlight=e,f.scrollIntoViewLazy(n.find(".kf-tag")[a]),e},c.highlightFirst=function(){return c.highlightAt(0)},c.highlightLast=function(){return c.highlightAt(-1)},c.highlightNext=function(){if(c.isHighlightNew())return c.highlightFirst();var a=q(c.highlight);return-1===a?c.highlightFirst():a===c.getShownTags().length-1?c.isAddTagShown?c.dehighlight():c.highlightFirst():c.highlightAt(a+1)},c.highlightPrev=function(){if(c.isHighlightNew())return c.highlightLast();var a=q(c.highlight);return-1===a?c.highlightLast():0===a?c.isAddTagShown?c.dehighlight():c.highlightLast():c.highlightAt(a-1)},angular.element(b).resize(_.throttle(function(){c.refreshScroll()},150)),c.$watch("filter.name",function(){a(c.refreshHighlight),c.refreshScroll()}),g.fetchAll(),c.watchTagReorder=function(){return!p()},c.removeTag=function(a){return g.remove(a).then(function(){c.viewedTagId===a.id&&(c.viewedTagId=null,d.path("/"))})},c.focusFilter=function(){c.isFilterFocused=!0},c.disableClearFilter=function(){t=!0},c.enableClearFilter=function(){t=!1},c.blurFilter=function(){c.isFilterFocused=!1,t||(c.dehighlight(),c.clearFilter())},c.createTag=function(){var a=c.create(p());return c.blurFilter(),a},r(),c.scrollNext=function(){c.$root.$$phase?s():c.$apply(s)},c.isScrollDisabled=function(){return c.tagLimit>c.tags.length+1},c.scrollDistance="100%"}}}]),angular.module("kifi.templates",["common/directives/alertBanner/alertBanner.tpl.html","common/directives/keepWho/friendCard.tpl.html","common/directives/keepWho/keepWhoPic.tpl.html","common/directives/keepWho/keepWhoPics.tpl.html","common/directives/keepWho/keepWhoText.tpl.html","common/modal/basicModalContent.tpl.html","common/modal/genericErrorModal.tpl.html","common/modal/installExtensionErrorModal.tpl.html","common/modal/installExtensionModal.tpl.html","common/modal/modal.tpl.html","friends/compactFriendsView.tpl.html","friends/friendCard.tpl.html","friends/friendRequestCard.tpl.html","friends/friends.tpl.html","helprank/helprank.tpl.html","home/emailModal.tpl.html","home/home.tpl.html","invite/connectionCard.tpl.html","invite/invite.tpl.html","invite/inviteSearch.tpl.html","invite/inviteWell.tpl.html","invite/socialNetworkStatus.tpl.html","keep/addKeep.tpl.html","keep/bookmarkFileModal.tpl.html","keep/importModal.tpl.html","keep/keep.tpl.html","keep/keepView.tpl.html","keeps/addKeepsModal.tpl.html","keeps/keeps.tpl.html","layout/header/header.tpl.html","layout/main/main.tpl.html","layout/nav/nav.tpl.html","layout/rightCol/rightCol.tpl.html","layout/sidebar/sidebar.tpl.html","profile/emailImport.tpl.html","profile/profile.tpl.html","profile/profileChangePassword.tpl.html","profile/profileEmailAddresses.tpl.html","profile/profileImage.tpl.html","profile/profileInput.tpl.html","search/mainSearchBar.tpl.html","search/search.tpl.html","social/addNetworksModal.tpl.html","social/connectNetworks.tpl.html","social/networksNeedAttention.tpl.html","tagKeeps/tagKeeps.tpl.html","tags/tagItem.tpl.html","tags/tagList.tpl.html","tags/tags.tpl.html"]),angular.module("common/directives/alertBanner/alertBanner.tpl.html",[]).run(["$templateCache",function(a){a.put("common/directives/alertBanner/alertBanner.tpl.html",'<div class="kf-alert-banner"><span class="kf-alert-banner-body"><span class="kf-alert-banner-head">Important -</span> <span ng-transclude></span></span> <span class="kf-alert-banner-button" ng-if="actionText" ng-click="action()">{{actionText}}</span></div>')}]),angular.module("common/directives/keepWho/friendCard.tpl.html",[]).run(["$templateCache",function(a){a.put("common/directives/keepWho/friendCard.tpl.html",'<div class="kifi-fr-kcard tooltip-show-hide" ng-show="tooltipEnabled"><div class="kifi-fr-kcard-top"><img class="kifi-fr-kcard-pic" ng-src="{{getPicUrl(keeper)}}"><div class="kifi-fr-kcard-info"><div class="kifi-fr-kcard-name">{{getName(keeper)}}</div><div class="kifi-fr-kcard-desc">Your kifi friend</div></div></div><div class="kifi-fr-kcard-tri"></div></div>')}]),angular.module("common/directives/keepWho/keepWhoPic.tpl.html",[]).run(["$templateCache",function(a){a.put("common/directives/keepWho/keepWhoPic.tpl.html",'<a class="kf-keep-who-pic" href="javascript:" ng-attr-style="background-image: url({{getPicUrl(keeper)}})" ng-mouseenter="showTooltip()" ng-mouseleave="hideTooltip()" ng-click="hideTooltip()"></a>')}]),angular.module("common/directives/keepWho/keepWhoPics.tpl.html",[]).run(["$templateCache",function(a){a.put("common/directives/keepWho/keepWhoPics.tpl.html",'<span class="kf-keep-who-pics"><a class="kf-keep-who-pic me" title="You! You look great!" ng-attr-style="background-image: url({{getPicUrl(me)}})" ng-if="keep.isMyBookmark"></a><a kf-keep-who-pic keeper="keeper" ng-repeat="keeper in keepers | limitTo: 9"></a></span>')}]),angular.module("common/directives/keepWho/keepWhoText.tpl.html",[]).run(["$templateCache",function(a){a.put("common/directives/keepWho/keepWhoText.tpl.html",'<span class="kf-keep-who-text"><span class="kf-keep-you" ng-if="keep.isMyBookmark">You</span> <span class="kf-keep-friends" ng-show="hasKeepers()">{{getFriendText()}}</span> <span></span> <span class="kf-keep-others" ng-show="hasOthers()">{{getOthersText()}}</span> <span class="kf-keep-kept-this">kept this</span></span>')}]),angular.module("common/modal/basicModalContent.tpl.html",[]).run(["$templateCache",function(a){a.put("common/modal/basicModalContent.tpl.html",'<div class="dialog-content"><a class="dialog-x sprite-close-x-icon" ng-click="hideAndCancel()"></a><div class="dialog-body-wrap"><h1 class="dialog-header" ng-if="title.length" ng-bind-html="title"></h1><div class="dialog-body" ng-transclude ng-class="{\'dialog-centered\': centered}"></div></div><div class="dialog-buttons" ng-if="singleAction"><button class="dialog-cancel" ng-click="hideAndCancel()" ng-if="withCancel" tabindex="0">{{cancelText || \'Cancel\'}}</button> <button class="kf-action-button" ng-class="{\'dialog-warn\': withWarning}" ng-click="hideAndAction()" tabindex="0">{{actionText || \'Ok\'}}</button></div></div>')}]),angular.module("common/modal/genericErrorModal.tpl.html",[]).run(["$templateCache",function(a){a.put("common/modal/genericErrorModal.tpl.html",'<div kf-modal ng-if="data.showGenericErrorModal" show="data.showGenericErrorModal"><div kf-basic-modal-content><div>Sorry, something went wrong :(</div><div>Please try again later, or <a href="http://support.kifi.com/customer/portal/emails/new">contact us</a>.</div></div></div>')}]),angular.module("common/modal/installExtensionErrorModal.tpl.html",[]).run(["$templateCache",function(a){a.put("common/modal/installExtensionErrorModal.tpl.html",'<div kf-modal ng-if="data.showInstallErrorModal" show="data.showInstallErrorModal"><div kf-basic-modal-content><div>Looks like something went wrong when installing the browser extension.</div><div>Please try again later, or <a href="http://support.kifi.com/customer/portal/emails/new">contact us</a>.</div></div></div>')}]),angular.module("common/modal/installExtensionModal.tpl.html",[]).run(["$templateCache",function(a){a.put("common/modal/installExtensionModal.tpl.html",'<div kf-modal ng-if="data.showInstallExtension" show="data.showInstallExtension" kf-width="550px"><div kf-basic-modal-content title="Install the Kifi extension" centered="true" action-text="Install" with-cancel cancel-text="No, thanks" action="triggerInstall()"><div>You need to install the kifi extension to proceed.</div><div>Don\'t worry, it only takes a few seconds!</div></div></div>')}]),angular.module("common/modal/modal.tpl.html",[]).run(["$templateCache",function(a){a.put("common/modal/modal.tpl.html",'<div ng-show="show"><div class="modal-backdrop fade in" ng-click="hideModal()" ng-style="backdropStyle"></div><div tabindex="-1" index="0" class="modal-dialog" ng-style="dialogStyle"><div class="modal-content" ng-transclude></div></div></div>')}]),angular.module("friends/compactFriendsView.tpl.html",[]).run(["$templateCache",function(a){a.put("friends/compactFriendsView.tpl.html",'<div><div class="kf-compact-friends-image-row" ng-if="friendGroup.length > 0" ng-repeat="friendGroup in friendGroups"><a href="/friends" ng-repeat="friend in friendGroup"><img class="kf-compact-friend-image" title="{{friend.firstName}}" ng-src="{{friend.pictureUrl}}"></a></div><div class="kf-footer-friends-links"><a ng-href="{{friendsLink()}}"><ng-pluralize count="friendCount()" when="{\'one\': \'1 friend\', \'other\': \'{} friends\'}"></ng-pluralize></a> <span class="kf-friends-links-divider">|</span> <a href="/invite">Invite more friends...</a></div></div>')}]),angular.module("friends/friendCard.tpl.html",[]).run(["$templateCache",function(a){a.put("friends/friendCard.tpl.html",'<div class="kf-friend-card"><img class="kf-friend-card-image" onerror="this.src=\'https://www.kifi.com/assets/img/ghost.100.png\'" ng-src="{{mainImage}}"> <span class="kf-friend-card-who"><div class="kf-friend-card-name" title="{{name}}">{{name}}</div><div class="kf-friend-card-count" title="{{friendCount}}"><ng-pluralize count="friendCount" when="{\'one\': \'1 friend \', \'other\': \'{} friends \'}"></ng-pluralize>on Kifi</div></span> <span class="kf-friend-card-button">Friends</span><ul class="kf-dropdown-menu kf-friend-card-menu"><li ng-show="searchFriend"><a href="javascript:" ng-click="unsearchfriend()">Hide {{possesive}} keeps in my search results</a></li><li ng-show="!searchFriend"><a href="javascript:" ng-click="researchfriend()">Show {{possesive}} keeps in my search results</a></li><li><a href="javascript:" ng-click="unfriend()">Unfriend</a></li></ul><div kf-modal show="showUnfriendConfirm" class="kf-unfriend-confirm-modal"><div kf-basic-modal-content with-cancel="true" title="Unfriend {{name}}?" with-warning action="reallyUnfriend()" ng-if="showUnfriendConfirm">Are you sure you want to unfriend this user?<ul><li>You will not see each other\'s results</li><li>You will not be able to send messages to each other</li></ul></div></div></div>')}]),angular.module("friends/friendRequestCard.tpl.html",[]).run(["$templateCache",function(a){a.put("friends/friendRequestCard.tpl.html",'<div class="kf-friend-card kf-friend-request-card"><img class="kf-friend-card-image" onerror="this.src=\'https://www.kifi.com/assets/img/ghost.100.png\'" ng-src="{{mainImage}}"> <span class="kf-friend-card-who"><div class="kf-friend-card-name" title="{{name}}">{{name}}</div><div>Accept as your Kifi friend?</div></span> <span class="kf-friend-request-card-buttons"><span class="kf-accept" ng-click="accept()">Accept</span> <span class="kf-ignore" ng-click="ignore()">Ignore<span></span></span></span></div>')}]),angular.module("friends/friends.tpl.html",[]).run(["$templateCache",function(a){a.put("friends/friends.tpl.html",'<div ng-controller="FriendsCtrl"><div class="friends-wrapper"><div class="friends"><h2>Kifi Friends <span ng-show="totalFriends() > 0">({{totalFriends()}})</span></h2><div class="friends-networks-status"><div kf-social-networks-status ng-if="!isRefreshingSocialGraph"></div><div class="import-wrapper" ng-if="isRefreshingSocialGraph"><div class="bouncy-ball"><div class="pace pace-active"><div class="pace-progress"></div><div class="pace-activity"></div></div></div>Importing your contacts</div></div><div kf-social-invite-well show-find-friends="true"></div><div kf-networks-need-attention></div><div class="friend-requests" ng-show="requests.length > 0" ng-class="\'unfold\'"><div class="friends-list-header"><span class="friend-requests-badge">{{requests.length || 0}}</span> Pending Friend <span ng-pluralize count="requests.length" when="{\'one\': \'Request\', \'other\': \'Requests\'}"></span> <span ng-show="requests.length>2">| <a href="javascript:" ng-click="toggleRequestExpansion()">{{requestsToggleText}}</a></span></div><div kf-friend-request-card ng-repeat="request in requests | limitTo: requestsToShow" request="request"></div></div><div class="friends-list" ng-show="friends.length > 0" smart-scroll scroll-distance="friendsScrollDistance" scroll-disabled="isFriendsScrollDisabled()" scroll-next="friendsScrollNext()"><div class="friends-list-header">{{totalFriends()}} Kifi friends</div><div kf-friend-card ng-repeat="friend in friends" friend="friend"></div><span ng-click="friendsScrollNext()" ng-hide="isFriendsScrollDisabled()" class="kf-show-more">Show more</span></div><div ng-if="friends.length <= 10 && friendsHasRequested" class="social-connect-friends"><div kf-social-connect-networks></div></div></div></div></div>')}]),angular.module("helprank/helprank.tpl.html",[]).run(["$templateCache",function(a){a.put("helprank/helprank.tpl.html",'<div class="kf-main-helprank-keeps"><div class="kf-main-head"><h1 class="kf-main-title">Help Rank</h1><div class="kf-subtitle"><div class="kf-edit-keeps" ng-click="toggleEdit()"><span class="sprite sprite-edit-pencil-icon"></span> <span class="kf-edit-keeps-label">{{editKeepsLabel()}}</span></div><span class="kf-subtitle-text">{{getSubtitle()}}</span></div></div><div kf-keeps keeps="keeps" keeps-loading="loading" keeps-has-more="hasMore()" scroll-distance="scrollDistance" scroll-disabled="scrollDisabled" scroll-next="getNextKeeps()" edit-mode="editMode" toggle-edit="toggleEdit"></div></div>')}]),angular.module("home/emailModal.tpl.html",[]).run(["$templateCache",function(a){a.put("home/emailModal.tpl.html",'<div kf-modal show="data.showEmailModal"><div kf-basic-modal-content centered="true" title="Email verified" action-text="Continue">Thanks for verifying your email address.</div></div>')}]),angular.module("home/home.tpl.html",[]).run(["$templateCache",function(a){a.put("home/home.tpl.html",'<div><div ng-if="modal"><div ng-if="data.showEmailModal" ng-include="\'home/emailModal.tpl.html\'"></div></div><div class="kf-main-head"><h1 class="kf-main-title">Your keeps library</h1><div class="kf-subtitle"><div class="kf-edit-keeps" ng-click="toggleEdit()"><span class="sprite sprite-edit-pencil-icon"></span> <span class="kf-edit-keeps-label">{{editKeepsLabel()}}</span></div><div class="kf-subtitle-text">{{getSubtitle()}}</div></div></div><div kf-keeps keeps="keeps" keeps-loading="loading" keeps-has-more="hasMore()" scroll-disabled="scrollDisabled" scroll-next="getNextKeeps()" edit-mode="editMode" toggle-edit="toggleEdit"></div></div>')}]),angular.module("invite/connectionCard.tpl.html",[]).run(["$templateCache",function(a){a.put("invite/connectionCard.tpl.html",'<div class="kf-connection-card" ng-class="{\'kf-connection-invited\': invited}" ng-hide="hidden"><img class="kf-connection-card-image" onerror="this.src=\'https://www.kifi.com/assets/img/ghost.100.png\'" ng-src="{{mainImage}}" ng-class="{\'kf-connection-card-email-image\': email}"> <span class="kf-connection-card-who"><span class="kf-main-label" title="{{mainLabel}}">{{mainLabel}}</span> <span class="kf-byline-icon kf-icon-micro" ng-hide="email" ng-class="{\'kf-facebook-icon-micro\': facebook, \'kf-linkedin-icon-micro\': linkedin}"></span> <span class="kf-byline" title="{{byline}}">{{byline}}</span> <span class="kf-byline">{{byline2}}</span></span> <span class="kf-connection-card-action" ng-class="{\'kf-connection-invited\': invited}" ng-click="action()"><span class="sprite sprite-tag-new-plus-icon" ng-if="actionText==\'Invite\'"></span> {{actionText}}</span> <span class="kf-connection-card-close" ng-click="closeAction()">✕</span></div>')}]),angular.module("invite/invite.tpl.html",[]).run(["$templateCache",function(a){a.put("invite/invite.tpl.html",'<div ng-controller="InviteCtrl"><div class="invite-wrapper" smart-scroll scroll-distance="wtiScrollDistance" scroll-disabled="isWTIScrollDisabled()" scroll-next="wtiScrollNext()"><div class="invite"><h2 class="invite-title">Find people to invite</h2><div class="import-wrapper" ng-if="isRefreshingSocialGraph"><div class="bouncy-ball"><div class="pace pace-active"><div class="pace-progress"></div><div class="pace-activity"></div></div></div>Importing your contacts</div><div kf-social-networks-status></div><div kf-social-invite-well></div><div kf-networks-need-attention></div><div class="invite-list-header" ng-show="whoToInvite.length > 0">Recommended people to invite</div><div class="kf-connection-card-container"><div kf-connection-card ng-repeat="friend in whoToInvite" friend="friend" show-generic-invite-error="data.showGenericInviteError" show-linkedin-token-expired-modal="data.showLinkedinTokenExpiredModal" show-linkedin-hit-rate-limit-modal="data.showLinkedinHitRateLimitModal"></div><span ng-click="wtiScrollNext()" ng-hide="isWTIScrollDisabled()" class="kf-show-more">Show more</span></div><div ng-if="whoToInvite.length < 6 && wtiLoaded" class="social-connect-friends"><div kf-social-connect-networks></div></div><div kf-modal show="data.showGenericInviteError"><div kf-basic-modal-content action-text="Ok" title="Sorry, an error occurred, please try again later."></div></div><div kf-modal show="data.showLinkedinHitRateLimitModal"><div kf-basic-modal-content action-text="Ok"><h3>LinkedIn limits the number of messages users can send through Kifi each day.</h3><h3>Please retry inviting this connection again, tomorrow.</h3></div></div><div kf-modal show="data.showLinkedinTokenExpiredModal"><div kf-basic-modal-content with-cancel action-text="Ok" action="showAddNetworksModal()" title="Your session has expired, you need to reconnect to LinkedIn."></div></div></div></div></div>')}]),angular.module("invite/inviteSearch.tpl.html",[]).run(["$templateCache",function(a){a.put("invite/inviteSearch.tpl.html",'<div class="social-invite-search"><input type="text" ng-model="search.name" placeholder="Search for friends" ng-change="change($event)"><ul class="social-invite-dropdown" ng-show="search.showDropdown"><li class="social-invite-element" ng-repeat="result in results" ng-class="\'social-invite-{{result.status === \'joined\' && result.network === \'fortytwoNF\' ? \'\' : result.status}}\'"><div ng-if="!result.custom"><div ng-if="result.networkType !== \'email\'"><img ng-src="{{result.image || \'https://www.kifi.com/assets/img/ghost.200.png\'}}" class="social-invite-image"></div><div ng-if="!result.status"><div class="social-invite-summary"><div class="social-invite-name">{{result.label}}</div><div class="social-invite-network"><span class="social-network-icon kf-icon-micro" ng-class="result.iconStyle"></span>{{result.network}}</div></div><div class="social-invite-action clickable"><div class="social-invite-button" ng-click="invite(result, $event)"><span class="sprite sprite-tag-new-plus-icon"></span>Invite</div></div></div><div ng-if="result.status === \'joined\' && result.networkType === \'fortytwo\'"><div class="social-invite-summary"><div class="social-invite-name">{{result.label}}</div><div class="social-invite-network">Your friend on Kifi</div></div></div><div ng-if="result.status === \'requested\' && result.networkType === \'fortytwoNF\'"><div class="social-invite-summary"><div class="social-invite-name">{{result.label}}</div><div class="social-invite-network">Kifi user — request sent</div></div></div><div ng-if="result.status === \'joined\' && result.networkType === \'fortytwoNF\'"><div class="social-invite-summary"><div class="social-invite-name">{{result.label}}</div><div class="social-invite-network">Kifi user</div></div><div class="social-invite-action clickable"><div class="social-invite-button user-add-button" ng-click="invite(result, $event)"><span class="sprite sprite-tag-new-plus-icon"></span> Add</div></div></div><div ng-if="result.status === \'invited\'"><div class="social-invite-summary"><div class="social-invite-name-long">{{result.label}}</div><div class="social-invite-network"><span class="social-network-icon kf-icon-micro" ng-class="result.iconStyle"></span>{{result.inviteText}}</div></div><div class="social-invite-action clickable"><div class="social-invite-button" ng-click="invite(result, $event)">Resend</div></div></div></div><div ng-if="result.custom === \'email\'"><img src="/img/email-icon.png" class="social-invite-image cant-find"><div class="social-invite-summary"><div class="social-invite-name">Email to</div><div class="social-invite-network">{{result.label}}</div></div><div class="social-invite-action clickable"><div class="social-invite-button" ng-click="invite(result, $event)"><span class="sprite sprite-tag-new-plus-icon"></span> Invite</div></div></div><div ng-if="result.custom === \'cant_find\'" class="fill-parent clickable" ng-click="data.showCantFindModal = true"><img src="/img/friend-missing@2x.png" class="social-invite-image cant-find"><div class="social-invite-summary"><div class="social-invite-name social-invite-custom-email">Can\'t find your friend?</div></div></div><div class="clearfix"></div></li></ul><div class="social-invite-search-explain">Search by name or email address</div><div kf-modal show="data.showCantFindModal" kf-width="670px"><div kf-basic-modal-content single-action="false"><div class="friend-not-found-modal"><div class="friend-not-found-heading">We couldn\'t find any friends matching</div><div class="friend-not-found-name">\'{{search.name}}\'</div><div class="friend-not-found-sub-heading">How to fix it</div><ul><li ng-if="!hasNetworks()" class="friend-not-found-suggestion">You don\'t have any networks connected to Kifi yet. <a class="friend-not-found-link" href="javascript:" ng-click="connectNetworks()">Get started by connecting.</a></li><li ng-if="hasNetworks()" class="friend-not-found-suggestion">Your friends list might not be up to date. <a class="friend-not-found-link" href="javascript:" ng-click="refreshFriends()">Try refreshing it.</a></li><li ng-if="hasNetworks()" class="friend-not-found-suggestion">Some of your friends may have privacy settings that prevent us from showing them.<br>Tell them to go to kifi.com and sign up.</li><li class="friend-not-found-suggestion">Or just <a class="friend-not-found-link" href="http://support.kifi.com/customer/portal/emails/new">contact us.</a></li></ul><div class="dialog-buttons"><button class="friend-not-found-modal-done" ng-click="data.showCantFindModal = false">Done</button></div></div></div></div></div>')}]),angular.module("invite/inviteWell.tpl.html",[]).run(["$templateCache",function(a){a.put("invite/inviteWell.tpl.html",'<div class="social-invite-well"><span kf-social-invite-search></span> <a class="invite-well-find-friends-button" ng-if="showFindFriends" href="/invite">Find Friends <span class="sprite sprite-find-friends-icon"></span></a></div>')}]),angular.module("invite/socialNetworkStatus.tpl.html",[]).run(["$templateCache",function(a){a.put("invite/socialNetworkStatus.tpl.html",'<div class="social-networks-status"><span ng-click="showAddNetworks()">Connect social networks ({{numNetworks}} connected)</span></div>')}]),angular.module("keep/addKeep.tpl.html",[]).run(["$templateCache",function(a){a.put("keep/addKeep.tpl.html",'<div class="dialog-content"><a class="dialog-x sprite-close-x-icon" ng-click="resetAndHide()"></a><div class="dialog-body-wrap"><h1>Add a keep</h1><div class="dialog-body dialog-centered"><div class="kf-add-keep-body"><div class="kf-add-keep-hint" ng-show="!state.invalidUrl">Did you know: You can easily keep any page using the kifi keeper</div><div class="kf-add-keep-error" ng-show="state.invalidUrl">Please enter a valid URL</div><input class="kf-add-keep-input" placeholder="http://..." ng-model="state.input" ng-focus="resetFocusState()"><div class="kf-add-keep-private-container" tabindex="0"><span class="kf-add-keep-private-checkbox sprite" ng-class="{ \'sprite-checkbox-icon\': !state.checkedPrivate, \'sprite-checkbox-icon-active\': state.checkedPrivate }" ng-click="togglePrivate()"></span><span class="kf-add-keep-private-label">Private</span></div></div></div></div><div class="dialog-buttons"><button class="kf-action-button" ng-click="keepUrl()" tabindex="0">Keep it</button></div></div>')
}]),angular.module("keep/bookmarkFileModal.tpl.html",[]).run(["$templateCache",function(a){a.put("keep/bookmarkFileModal.tpl.html",'<div ng-if="modal == \'import_bookmark_file\'" kf-modal show="data.showBookmarkFileModal1" kf-width="590px" class="import-file-modal"><div kf-basic-modal-content title="Import your links to Kifi" single-action="false" cancel="cancelBookmarkUpload()"><div class="file-import-inner"><img src="/img/bookmark-to-kifi@2x.png" class="import-kippt-to-kifi"><ul><li>The "keep engine" indexes each word of each page so that you can easily find it later when searching on Google or kifi.com</li><li><b>Public Keeps</b> are only discoverable by friends when searching and never displayed anywhere else</li></ul><div class="file-import-well"><p class="import-how-to">How to import your content into Kifi:</p><div class="import-inset"><p>Step 1: Export your links from <a href="https://getpocket.com/export" ng-click="openExportPopup($event)">Pocket</a>, <a href="http://export.delicious.com/settings/bookmarks/export" ng-click="openExportPopup($event)">Delicious</a>, <a href="https://kippt.com/export/" ng-click="openExportPopup($event)">Kippt</a>, <a href="https://www.instapaper.com/user/export" ng-click="openExportPopup($event)">Instapaper</a>, or <a href="https://pinboard.in/export/" ng-click="openExportPopup($event)">Pinboard</a> (the format should be HTML).</p><p class="import-file-link">Step 2: <a ng-click="openBookmarkFileSelector($event)" href="javascript:">Click here to select the file you downloaded</a>. <input class="bookmark-file-upload" type="file" name="bookmark-file" accept=".html,text/html" onchange="angular.element(this).scope().allowUpload(this)"></p><div ng-show="importFilename">Step 3: Upload your bookmarks<div class="dialog-buttons"><button ng-click="uploadBookmarkFile($event)" ng-class="{\'disabled\': disableBookmarkImport }"><span class="sprite sprite-white-lock-private"></span>Import privately</button> <button ng-click="uploadBookmarkFile($event, true)" ng-class="{\'disabled\': disableBookmarkImport }">Import publicly</button></div></div><div ng-click="openBookmarkFileSelector($event)" class="import-file-status"><div ng-if="importFilename"><i>{{importFilename}}</i> selected.</div><div ng-if="!importFilename && !importFileStatus">Please select a file to get started.</div><div ng-if="importFileStatus">{{importFileStatus}}</div></div></div></div></div></div></div><div kf-modal show="data.showBookmarkFileModal2" kf-width="590px" class="import-file-modal"><div kf-basic-modal-content centered="true" title="Importing your bookmarks to Kifi" action-text="Awesome"><img src="/img/bookmark-to-kifi@2x.png" class="import-kippt-to-kifi"><p>This might take a few minutes (especially if you have a lot of bookmarks). Feel free to browse around — we’re syncing in the background.</p></div></div><div kf-modal show="data.showBookmarkFileError" kf-width="590px" class="import-file-modal"><div kf-basic-modal-content title="Whoops! We\'re having a problem." action-text="Done"><p>We\'re having trouble importing your bookmark upload. It could be that we\'re overloaded, or that the file is invalid.</p><p>If you think this is an error, <a href="http://support.kifi.com/customer/portal/emails/new">contact support</a> and we\'ll sort things out. Thanks!</p></div></div>')}]),angular.module("keep/importModal.tpl.html",[]).run(["$templateCache",function(a){a.put("keep/importModal.tpl.html",'<div kf-modal show="data.showImportModal" kf-width="620px" class="import-modal"><div kf-basic-modal-content centered="true" title="Import your browser bookmarks as keeps" single-action="false" cancel="cancelImport()"><img src="/img/bookmark-to-kifi@2x.png" class="import-star-to-kifi"><div class="dialog-text">Get pages you bookmarked in your browser into your personal Kifi library. Public imports mean that your keeps can be discovered by friends, but will never automatically be displayed as a list anywhere.</div><div class="dialog-buttons"><button ng-click="importBookmarks()"><span class="sprite sprite-white-lock-private"></span>Import Privately</button> <button ng-click="importBookmarks(true)">Import Publicly</button></div></div></div><div kf-modal show="data.showImportModal2" kf-width="540px" class="import-modal"><div kf-basic-modal-content centered="true" title="Importing your bookmarks to Kifi" action-text="Awesome"><img src="/img/bookmark-to-kifi@2x.png" class="import-star-to-kifi"><p>This might take a few minutes (especially if you have a lot of bookmarks). Feel free to browse around — we’re syncing in the background.</p></div></div><div kf-modal show="data.showImportError" kf-width="540px" class="import-modal"><div kf-basic-modal-content title="Whoops! We\'re having a problem." action-text="Done"><p>We\'re having trouble importing your bookmarks because it seems that you aren\'t running an up-to-date Kifi extension.</p><p>If you think this is an error, <a href="http://support.kifi.com/customer/portal/emails/new">contact support</a> and we\'ll sort things out. Thanks!</p></div></div>')}]),angular.module("keep/keep.tpl.html",[]).run(["$templateCache",function(a){a.put("keep/keep.tpl.html",'<li class="kf-keep" ng-click="clickAction({keep: keep, event: $event})" ng-hide="keep.unkept && !keep.isProtected" ng-class="{ \'kf-dragged\': isDragging, \'kf-drag-target\': isDragTarget , \'editing\': editMode.enabled }"><div class="kf-keep-edit-tools"><div class="kf-keep-checkbox-icon sprite sprite-checkbox-icon" ng-if="!isSelected()" ng-click="toggleSelect({keep: keep})"></div><div class="kf-keep-checkbox-icon sprite sprite-checkbox-icon-active" ng-if="isSelected()" ng-click="toggleSelect({keep: keep})"></div><div class="kf-keep-handle sprite sprite-grabbericon"><div class="kf-keep-checkbox" ng-click="onCheck($event)"></div></div></div><div class="kf-keep-body"><div class="kf-keep-contents"><div class="kf-keep-title"><div class="kf-keep-loader" ng-show="keep.isLoading"></div><a class="kf-keep-title-link" ng-href="{{keep.url}}" target="_blank" ng-attr-title="{{getTitle()}}" ng-bind-html="keep.titleHtml"></a></div><div class="kf-keep-content-line"><div class="kf-keep-small-image" ng-if="hasSmallImage()"><a ng-href="{{keep.url}}" target="_blank"><img class="kf-keep-image" ng-src="{{keep.summary.imageUrl}}"></a></div><div class="kf-keep-info-wrap"><div class="kf-keep-info"><div class="kf-keep-subtitle"><div class="kf-keep-url" ng-attr-title="{{keep.url}}" ng-bind-html="keep.descHtml"></div><time class="kf-keep-time" ng-attr-datetime="{{keep.createdAt}}" ng-show="keep.createdAt" am-time-ago="keep.createdAt"></time></div><div class="kf-keep-description">{{keep.summary.description}}</div></div></div></div><a ng-href="{{keep.url}}" target="_blank"><img class="kf-keep-big-image" ng-if="hasBigImage()" ng-src="{{keep.summary.imageUrl}}"></a></div><div class="kf-keep-who" ng-if="showSocial()"><span kf-keep-who-pics me="me" keepers="keep.keepers" keep="keep"></span> <span class="kf-keep-who-others" ng-if="showOthers()"></span> <span kf-keep-who-text keep="keep"></span></div><div kf-tag-list class="kf-keep-tag-list" get-selected-keeps="getSingleSelectedKeep()" adding-tag="addingTag" is-shown="showTags()" ng-show="showTags()"></div></div><div class="kf-keep-footer"><span class="kf-keep-footer-link"><a ng-if="canSend()" ng-href="{{keep.url}}" data-locator="/messages:all#compose">Send</a> <a ng-if="!canSend()" href="javascript:" ng-click="triggerInstall()">Send</a></span> <span class="kf-keep-footer-link" ng-if="!hasTag() && isMyBookmark(keep)"><a ng-click="showAddTag()" href="javascript:">Tag</a></span> <span class="kf-keep-footer-link" ng-if="isMine() && !isPrivate()"><a ng-click="togglePrivate()" href="javascript:">Make Private</a></span> <span class="kf-keep-footer-link" ng-if="isMine() && isPrivate()"><a ng-click="togglePrivate()" href="javascript:">Make Public</a></span> <span class="kf-keep-footer-link" ng-if="isMine()"><a ng-click="unkeep()" href="javascript:">Unkeep</a></span> <span class="kf-keep-footer-link" ng-if="!isMine()"><a ng-click="keepPublic()" href="javascript:">Keep</a></span> <span class="kf-keep-footer-link" ng-if="!isMine()"><a ng-click="keepPrivate()" href="javascript:">Keep Privately</a></span><div class="kf-keep-private" ng-if="isMine() && isPrivate()"><span class="kf-keep-private-label">Private</span><span class="sprite sprite-lock-private-icon"></span></div></div><div class="kf-keep-drag-mask"></div></li>')}]),angular.module("keep/keepView.tpl.html",[]).run(["$templateCache",function(a){a.put("keep/keepView.tpl.html",'<div class="kf-main-keeps"><div class="kf-main-head"><h1 class="kf-main-title">Your keep</h1><div class="kf-subtitle"><div class="kf-edit-keeps" ng-click="toggleEdit()"><span class="sprite sprite-edit-pencil-icon"></span> <span class="kf-edit-keeps-label">{{editKeepsLabel()}}</span></div><span class="kf-subtitle-text">{{getSubtitle()}}</span></div></div><div kf-keeps keeps="keeps" keeps-loading="loading" edit-mode="editMode" toggle-edit="toggleEdit"></div></div>')}]),angular.module("keeps/addKeepsModal.tpl.html",[]).run(["$templateCache",function(a){a.put("keeps/addKeepsModal.tpl.html",'<div kf-modal class="kf-add-keep-modal" ng-if="data.initAddKeeps" show="data.showAddKeeps" action="resetAddKeep()"><div kf-add-keep shown="data.showAddKeeps"></div></div>')}]),angular.module("keeps/keeps.tpl.html",[]).run(["$templateCache",function(a){a.put("keeps/keeps.tpl.html",'<div class="kf-main-keeps"><div kf-sticky max-top="52" class="kf-keep-selection-tools" ng-if="editMode.enabled"><div class="kf-keep-checkbox-icon sprite" ng-class="{ \'sprite-checkbox-icon\': isUnchecked(), \'sprite-checkbox-icon-partial\': isMultiChecked(), \'sprite-checkbox-icon-active\': isSelectedAll() }" ng-click="toggleSelectAll()"></div><div class="kf-keep-selection-tools-body"><div class="kf-keep-selected-count"><span class="kf-keep-selected-count-number">{{getSelected().length}}</span> <span class="kf-keep-selected-count-text" ng-pluralize count="getSelected().length" when="{\'1\': \'keep selected\', \'other\': \'keeps selected\'}"></span></div><div class="kf-keep-selection-options" ng-class="{disabled: editingTags || getSelected().length === 0}"><div class="kf-keep-selection-option"><span ng-click="togglePrivate()">Make {{selectionPrivacyState()}}</span></div><div class="kf-keep-selection-option"><span ng-click="unkeep()">Unkeep</span></div><div class="kf-keep-selection-option" ng-click="enableEditTags()"><span>Edit Tags</span></div><div class="kf-keep-selection-options-mask"></div></div><div class="kf-keep-selection-tags" ng-if="editingTags"><div class="kf-keep-selection-tags-done" ng-click="disableEditTags()">Done tagging</div><div kf-tag-list class="kf-keep-selection-tags-list" adding-tag="addingTag" get-selected-keeps="getSelected()"></div></div></div></div><ol class="kf-my-keeps" smart-scroll scroll-distance="scrollDistance" scroll-disabled="isScrollDisabled()" scroll-next="scrollNext()"><div ng-repeat="keep in keeps" kf-keep is-selected="!!isSelected(keep)" keep="keep" me="me" toggle-select="toggleSelect(keep)" click-action="keepClickAction(event, keep)" drag-keeps="dragKeeps(keep, event, mouseX, mouseY)" stop-dragging-keeps="stopDraggingKeeps()" edit-mode="editMode"></div><div class="kf-shadow-dragged-keeps" ng-class="{ two: draggedTwo(), three: draggedThree(), more: draggedMore() }"><span class="kf-shadow-keep-first" ng-show="data.draggedKeeps.length >= 1"><div kf-keep is-selected="!!isSelected(data.draggedKeeps[0])" keep="data.draggedKeeps[0]" me="me" edit-mode="editMode"></div></span> <span class="kf-shadow-keep-second" ng-show="data.draggedKeeps.length === 3"><div kf-keep is-selected="!!isSelected(data.draggedKeeps[1])" keep="data.draggedKeeps[1]" me="me" edit-mode="editMode"></div></span> <span class="kf-shadow-keep-ellipsis" ng-class="{\'active\': data.draggedKeeps.length >= 4}"><div class="kf-shadow-keep-ellipsis-line"></div><div class="kf-shadow-keep-ellipsis-counter">{{data.draggedKeeps.length - 2}} other keeps selected</div></span><div class="kf-shadow-keep-ellipsis-counter-hidden">{{data.draggedKeeps.length - 2}} other keeps selected</div><span class="kf-shadow-keep-last" ng-show="data.draggedKeeps.length >= 2"><div kf-keep is-selected="!!isSelected(data.draggedKeeps[data.draggedKeeps.length-1])" keep="data.draggedKeeps[data.draggedKeeps.length-1]" me="me" edit-mode="editMode"></div></span></div></ol><div class="kf-keep-group-title-fixed"></div><img class="kf-keeps-loading" ng-show="keepsLoading" src="/img/load.gif"> <a class="kf-keeps-load-more" ng-show="isShowMore()" href="javascript:" ng-click="scrollNext()">Show more</a><div class="kf-keep-description-sizer kf-keep-description"></div></div>')}]),angular.module("layout/header/header.tpl.html",[]).run(["$templateCache",function(a){a.put("layout/header/header.tpl.html",'<div class="kf-header-inner" ng-controller="HeaderCtrl"><div class="kf-header-left"><div class="kf-header-toggle-menu closed sprite sprite-burger" ng-click="toggleMenu()"></div><div class="kf-header-toggle-menu open sprite sprite-burger-open" ng-click="toggleMenu()"></div><div class="kf-header-left-separator"></div><a href="/profile"><div class="kf-header-profile-picture" ng-style="{\'background-image\': \'url(\' + me.picUrl + \')\'}"></div></a> <a href="/"><img class="kf-header-logo" src="/img/kifi-logo.png"></a></div><div class="kf-header-right"><div class="sprite sprite-add-link" ng-click="addKeeps()">Add a link</div><div class="kf-header-icon-hover-container"><div class="kf-header-icon-friends sprite sprite-friends">Friends </div><ul class="kf-dropdown-menu"><li class="kf-dropdown-menu-item" ng-click="navigateToFriends()"><a class="kf-your-friends-header-link" href="javascript:" ng-class="{\'active\': isActive(\'/friends\') }">Your Kifi Friends</a></li><li class="kf-dropdown-menu-item" ng-click="navigateToInvite()"><a href="javascript:" ng-class="{\'active\': isActive(\'/invite\') }">Invite a friend to Kifi</a></li></ul></div><a href="/profile" class="sprite sprite-settings">Settings</a></div></div>')}]),angular.module("layout/main/main.tpl.html",[]).run(["$templateCache",function(a){a.put("layout/main/main.tpl.html",'<div class="kf-col-inner" ng-controller="MainCtrl"><div ng-show="searchEnabled" ng-include="\'search/mainSearchBar.tpl.html\'"></div><div ng-view></div><div class="kf-small-tooltip" ng-if="undo.isSet() || tooltipMessage"><span class="kf-small-tooltip-box"><span class="kf-small-tooltip-message">{{undo.message || tooltipMessage}}</span> <a class="kf-small-tooltip-link" href="javascript:" ng-click="undo.undo()" ng-if="undo.isSet()">Undo</a> <span></span></span></div><div ng-if="modal"><div ng-include="\'keep/importModal.tpl.html\'" ng-if="modal == \'import_bookmarks\'"></div><div ng-include="\'keep/bookmarkFileModal.tpl.html\'" ng-if="modal == \'import_bookmark_file\'"></div><div ng-include="\'social/addNetworksModal.tpl.html\'" ng-if="modal == \'add_networks\'"></div><div ng-include="\'keeps/addKeepsModal.tpl.html\'" ng-if="modal == \'add_keeps\'"></div><div ng-include="\'common/modal/genericErrorModal.tpl.html\'" ng-if="modal == \'generic_error\'"></div><div ng-include="\'common/modal/installExtensionModal.tpl.html\'" ng-if="modal == \'install_extension\'"></div><div ng-include="\'common/modal/installExtensionErrorModal.tpl.html\'" ng-if="modal == \'install_extension_error\'"></div></div></div>')}]),angular.module("layout/nav/nav.tpl.html",[]).run(["$templateCache",function(a){a.put("layout/nav/nav.tpl.html",'<ul class="kf-nav-group"><li class="kf-nav-item kf-nav-keeps" ng-class="{ active: isActive(\'/\') }"><a class="kf-nav-link" href="/"><span class="sprite sprite-my-keeps-library"></span> <span class="kf-nav-name">Keeps Library</span> <span class="kf-nav-count" ng-class="{ empty: !counts.keepCount }">{{counts.keepCount}}</span></a></li></ul>')}]),angular.module("layout/rightCol/rightCol.tpl.html",[]).run(["$templateCache",function(a){a.put("layout/rightCol/rightCol.tpl.html",'<footer class="kf-col-inner" ng-controller="RightColCtrl"><div class="kf-footer" ng-show="readyToDraw()"><div class="kf-helprank" ng-if="me.clickCount > 0 || me.rekeepTotalCount > 0"><h2 class="kf-footer-header"><span class="sprite sprite-heart-icon"></span><span class="kf-footer-help-rank-header">Your most helpful keeps</span></h2><div class="kf-footer-help-rank-wrapper" ng-if="me.clickCount > 0"><div class="kf-footer-help-rank-item"><span class="kf-footer-help-rank-number">{{me.clickCount}}</span> <span class="kf-footer-help-rank-description">You\'ve helped friends discover keeps <a class="kifi-footer-item-link" href="/helprank/click" ng-click="trackClickOnClicks()">{{me.clickCount}} times</a> this month</span></div><div class="kf-footer-help-rank-item" ng-if="me.rekeepTotalCount > 0"><span class="kf-footer-help-rank-number">{{me.rekeepTotalCount}}</span> <span class="kf-footer-help-rank-description">Your keeps have been rekept by others <a class="kifi-footer-item-link" href="/helprank/rekeep" ng-click="trackClickOnReKeeps()">{{me.rekeepTotalCount}} times</a></span></div></div><div class="kf-horizontal-separator"></div></div><h2 class="kf-footer-header">Friends on Kifi</h2><div kf-compact-friends-view></div><div class="kf-horizontal-separator"></div><h2 class="kf-footer-header">Essentials</h2><ul class="kf-footer-essentials-list about-kifi"><li kf-min-version="3.0.13" min-canary="3.0.8" class="start-guide"><a class="kf-footer-item-link kifi-tutorial" href="javascript:" ng-click="triggerGuide(true)"><span class="sprite sprite-guide-icon"></span>Kifi Step-by-step guide</a></li><li class="install-kifi"><a class="kf-footer-item-link" href="javascript:" ng-click="triggerInstall()"><span class="sprite sprite-install-extension-icon"></span><span ng-show="!installInProgress()">Install the extension</span><span ng-show="installInProgress()">Installing...</span><span ng-show="installed()">Installed!</span></a></li><li class="import-bookmarks"><a class="kf-footer-item-link" href="javascript:" ng-click="importBookmarks()"><span class="sprite sprite-import-bookmarks-icon"></span>Import your bookmarks</a></li><li class="import-bookmark-file"><a class="kf-footer-item-link" href="javascript:" ng-click="importBookmarkFile()"><span class="sprite sprite-import-from-other-services-icon"></span>Import Delicious/Kippt/Pocket/...</a></li></ul><div class="kf-horizontal-separator"></div><h2 class="kf-footer-header">Info and support</h2><ul class="kf-footer-more-list about-us"><li><a class="kf-footer-item-link support-center" href="https://support.kifi.com">Support center</a></li><li><a class="kf-footer-item-link contact-us" href="https://support.kifi.com/customer/portal/emails/new">Contact us</a></li><li><a class="kf-footer-item-link updates-features" href="https://blog.kifi.com">Kifi blog</a></li><li><a class="kf-footer-item-link updates-features" href="https://www.kifi.com/privacy">Privacy</a></li><li><a class="kf-footer-item-link updates-features" href="https://www.kifi.com/terms">Terms</a></li><li><a class="kf-footer-item-link updates-features" href="https://www.kifi.com/about/mission.html">About us</a></li></ul></div></footer>')}]),angular.module("layout/sidebar/sidebar.tpl.html",[]).run(["$templateCache",function(a){a.put("layout/sidebar/sidebar.tpl.html",'<div kf-sidebar class="kf-col-inner kf-sidebar-inner"><div kf-nav class="kf-sidebar-nav"></div><div kf-tags></div></div>')}]),angular.module("profile/emailImport.tpl.html",[]).run(["$templateCache",function(a){a.put("profile/emailImport.tpl.html",'<div><h3>Import your email contacts to Kifi</h3><h5>Message your email contacts directly from Kifi</h5><a class="profile-nw nw-email import-gmail" href="javascript:" ng-click="importGmailContacts()" ng-bind="addressBookImportText"></a><div ng-if="addressBooks"><div class="profile-email-accounts-wrapper"><div class="profile-email-accounts-overview"><span>Your imported accounts:</span><table class="profile-email-accounts"><tbody><tr ng-repeat="addressBook in addressBooks" class="profile-email-account {{addressBook.state}}" data-id="{{addressBook.id}}"><td class="profile-email-status"></td><td class="profile-email-address">{{addressBook.ownerEmail}}</td><td class="profile-email-separator">|</td><td class="profile-email-contact-count">{{addressBook.numContacts}} contacts imported</td></tr></tbody></table></div></div></div></div>')}]),angular.module("profile/profile.tpl.html",[]).run(["$templateCache",function(a){a.put("profile/profile.tpl.html",'<div ng-controller="ProfileCtrl"><div class="profile-wrapper"><div class="profile"><h2>Settings</h2><a href="javascript:" class="profile-logout" ng-click="logout()">LOG OUT</a><div class="profile-container"><div kf-profile-image pic-url="me.picUrl"></div><div class="profile-input-wrapper"><div class="profile-input-title">Name</div><div class="profile-input-box profile-input-box-name"><span class="profile-input-placeholder"><span class="profile-placeholder-first-name">{{me.firstName}}</span> <span class="profile-placeholder-last-name">{{me.lastName}}</span></span> <input class="profile-input-input profile-first-name" disabled type="text" name="firstName" placeholder="First name" value="{{me.firstName}}" novalidate> <input class="profile-input-input profile-last-name" disabled type="text" name="lastName" placeholder="Last name" value="{{me.lastName}}" novalidate></div></div><div class="profile-input-wrapper profile-email"><div class="profile-input-title">Contact email</div><div kf-profile-input input-state="emailInput" input-validate-action="validateEmail(value)" input-save-action="saveEmail(value)" explicit-enabling="true"><input class="profile-input-input profile-email-input" ng-disabled="!emailInput.editing" kf-focus-if focus-cond="emailInput.editing" ng-model="emailInput.value" type="text" name="email" placeholder="Enter your email address" novalidate></div><div kf-modal show="showEmailChangeDialog.value"><div kf-basic-modal-content with-cancel action-text="Continue" action="confirmSaveEmail()" cancel="cancelSaveEmail()"><p>You are about to change your primary email to <span class="email-address">{{me.primaryEmail.address}}</span>.</p><p>We will send a verification email to this email address to prove that you own it. To verify, please click on a verification link on the email.</p></div></div></div><div class="profile-email-address-unverified" ng-if="isUnverified({value: me.primaryEmail})">Your email is pending your verification (<a class="profile-email-pending-resend" href="javascript:" ng-click="resendVerificationEmail()">Resend verification</a>).</div><div class="profile-email-address-pending" ng-if="me.primaryEmail.isPendingPrimary">Your new primary email, <span class="profile-email-address-pending-email">{{me.primaryEmail.address}}</span>, is pending your verification (<a class="profile-email-pending-resend" href="javascript:" ng-click="resendVerificationEmail()">Resend verification</a>, <a class="profile-email-pending-cancel" href="javascript:" ng-click="cancelPendingPrimary()">Cancel</a>).</div><div kf-profile-email-addresses input-state="addEmailInput" email-list="me.emails" validate-email-action="validateEmail(value)" add-email-action="addEmail(value)" resend-verification-email-action="resendVerificationEmail(value)"></div><div kf-modal show="showResendVerificationEmailDialog.value"><div kf-basic-modal-content title="{{emailForVerificationModalTitle}}"><p>You will shortly receive a verification email from us at the following address: <span class="email-address">{{emailForVerification}}</span>.</p><p>To verify, please click on a verification link on the email.</p></div></div><div kf-profile-change-password></div></div><div class="profile-section"><h3>Connect your social networks to Kifi</h3><h5>Find which of your friends are using Kifi</h5><ul class="profile-networks"><li kf-facebook-connect-button data-network="facebook" ng-class="{ \'connected\': isFacebookConnected }"><a class="profile-nw nw-facebook" href="https://www.kifi.com/link/facebook" target="_self" ng-click="connectFacebook()" ng-show="!isFacebookConnected">Facebook</a> <a class="profile-nw nw-facebook" ng-href="{{fbProfileUrl}}" target="_blank" ng-show="isFacebookConnected">Facebook</a> <span class="profile-nw-connected"><span class="profile-placeholder">&nbsp;</span> <span class="profile-connected">Connected</span> <a class="profile-disconnect" href="javascript:" ng-click="disconnectFacebook()">Disconnect?</a></span></li><li kf-linkedin-connect-button data-network="linkedin" ng-class="{ \'connected\': isLinkedInConnected }"><a class="profile-nw nw-linkedin" href="https://www.kifi.com/link/linkedin" target="_self" ng-click="connectFacebook()" ng-show="!isLinkedInConnected">LinkedIn</a> <a class="profile-nw nw-linkedin" ng-href="{{liProfileUrl}}" target="_blank" ng-show="isLinkedInConnected">LinkedIn</a> <span class="profile-nw-connected"><span class="profile-placeholder">&nbsp;</span> <span class="profile-connected">Connected</span> <a class="profile-disconnect" href="javascript:" ng-click="disconnectLinkedIn()">Disconnect?</a></span></li></ul></div><div class="profile-section" kf-email-import></div><div class="profile-section"><h3>Export Your Keeps</h3><h5>For all of your Keeps, the URL, date kept, and tags<br>will be included in a HTML netscape format file</h5><a class="profile-export" ng-href="{{getExportUrl()}}" ng-click="exportKeeps()" target="_self" ng-class="{\'export-first\':!exported, \'export-again\':exported}">{{getExportButtonText()}}</a><p><span class="profile-export-status" ng-show="exported"><span class="profile-placeholder">&nbsp;</span> <span>You can find the file in your Downloads folder</span></span></p></div></div></div></div>')}]),angular.module("profile/profileChangePassword.tpl.html",[]).run(["$templateCache",function(a){a.put("profile/profileChangePassword.tpl.html",'<div class="profile-change-password"><a class="profile-change-password-title-wrapper" href="javascript:" ng-click="toggle()"><div class="profile-setting-arrow" ng-class="{\'active\':isOpen}"></div><div class="profile-change-password-title" ng-class="{\'active\':isOpen}">Change your password</div></a><div class="profile-change-password-change" ng-show="isOpen"><input class="profile-input-password" ng-model="inputs.oldPassword" type="password" name="old-password" placeholder="Enter your current password" value="" novalidate> <input class="profile-input-password" ng-model="inputs.newPassword1" type="password" name="new-password1" placeholder="Choose a new password" value="" novalidate> <input class="profile-input-password" ng-model="inputs.newPassword2" type="password" name="new-password2" placeholder="Confirm new password" value="" novalidate><div class="profile-change-password-error">{{errorMessage}}</div><div><a class="profile-change-password-save" href="javascript:" ng-click="updatePassword()">Update password</a></div></div><div class="profile-change-password-success">{{successMessage}}</div></div>')}]),angular.module("profile/profileEmailAddresses.tpl.html",[]).run(["$templateCache",function(a){a.put("profile/profileEmailAddresses.tpl.html",'<div class="profile-email-addresses"><a class="profile-email-addresses-title-wrapper" href="javascript:" ng-click="toggle()"><div class="profile-setting-arrow" ng-class="{\'active\':isOpen}"></div><div class="profile-email-addresses-title" ng-class="{\'active\':isOpen}">Manage your email addresses</div></a><div class="profile-email-address-manage" ng-show="isOpen"><div class="profile-email-address-manage-description" ng-show="emailList.length > 0">NOTE: These are the email addresses associated with your Kifi account. You may log in with them and Kifi members can find you using these email addresses via search.</div><ul class="profile-email-address-list"><li ng-repeat="email in emailList" class="profile-email-address-item"><span class="profile-email-address-item-email" ng-class="{\'profile-email-address-item-email-important\': email.isPrimary || email.isPendingPrimary || email.isPlaceholderPrimary}">{{email.address}}</span> <span class="profile-email-address-item-primary" ng-if="email.isPrimary || email.isPlaceholderPrimary">(primary)</span> <span class="profile-email-address-item-pending-primary" ng-if="email.isPendingPrimary && !email.isPrimary && !email.isPlaceholderPrimary">(pending primary)</span> <span class="profile-email-address-item-unverified" ng-if="!email.isVerified">(<a class="profile-email-pending-resend" href="javascript:" ng-click="resendVerificationEmail(email.address)">unverified</a>)</span><div class="profile-email-address-item-arrow" href="javascript:" ng-if="!(email.isPrimary || email.isPendingPrimary || email.isPlaceholderPrimary)" ng-click="openDropdownForEmail($event, email.address)"><img class="profile-email-address-item-arrow-image" src="../img/placeholder-icon.png"><ul class="profile-email-address-item-dropdown" ng-show="emailWithActiveDropdown === email.address"><li><a class="profile-email-address-item-make-primary" href="javascript:" ng-if="email.isVerified" ng-click="makePrimary(email.address)">Make primary</a></li><li><a class="profile-email-address-item-delete" href="javascript:" ng-click="deleteEmail(email.address)">Delete</a></li></ul></div></li></ul><a class="profile-email-address-add" href="javascript:" ng-click="enableAddEmail()" ng-show="!(state.editing || state.invalid)">+ add a new email address</a><div class="profile-email-address-add-box" ng-show="state.editing || state.invalid"><div kf-profile-input input-state="state" input-validate-action="validateEmail(value)" input-save-action="addEmail(value)" action-label="Add"><input class="profile-email-address-add-input" kf-focus-if focus-cond="state.editing" ng-model="state.value" type="text" name="new_email" placeholder="Type a new email address"></div></div><div kf-modal show="showEmailDeleteDialog.value"><div kf-basic-modal-content with-cancel with-warning title="Delete {{emailToBeDeleted}}?" action-text="Delete" action="confirmDeleteEmail()"><p>Are you sure you want to delete this email address?</p><ul><li>You will not be able to login with this email address</li><li>Your friends will not be able to find you by this email address</li></ul></div></div><div class="profile-email-address-manage-footer"></div></div></div>')}]),angular.module("profile/profileImage.tpl.html",[]).run(["$templateCache",function(a){a.put("profile/profileImage.tpl.html",'<div class="profile-image-wrapper"><div class="profile-image" ng-click="selectFile()" ng-style="{\'background-image\': \'url(\' + picUrl + \')\'}"></div><label class="profile-image-label"><input class="profile-image-file" type="file" name="photo" accept="image/*" onchange="angular.element(this).scope().fileChosen(this.files)"></label><div kf-modal show="showImageEditDialog.value"><div kf-basic-modal-content with-cancel title="Position and size of your photo" action-text="Submit" action="uploadImage()" cancel="resetChooseImage()"><div class="kf-profile-image-dialog-image"><div class="kf-profile-image-dialog-mask"></div></div><div class="kf-profile-image-dialog-slider" ui-slider="zoomSlider" ng-model="zoomSlider.value"></div></div></div><div kf-modal no-user-hide show="showImageUploadingModal.value"><div class="dialog-body-wrap"><div class="dialog-header">Uploading image...</div></div></div><div kf-modal show="showImageUploadFailedDialog.value"><div kf-basic-modal-content with-warning><div class="dialog-header dialog-warning">Sorry, we could not upload your image. Please try again later.</div></div></div></div>')}]),angular.module("profile/profileInput.tpl.html",[]).run(["$templateCache",function(a){a.put("profile/profileInput.tpl.html",'<div class="profile-input-box"><div class="profile-input-container" ng-class="{ error: state.invalid }"><div ng-transclude></div><div class="input-error" ng-show="state.invalid"><div class="error-header" ng-bind-html="errorHeader"></div><div class="error-body" ng-bind-html="errorBody"></div></div></div><a class="profile-input-edit" href="javascript:" ng-hide="state.editing" ng-click="edit()" ng-if="explicitEnabling">Edit</a> <a class="profile-input-save" href="javascript:" ng-show="!explicitEnabling || state.editing" ng-click="save()">{{actionLabel || \'Save\'}}</a></div>')
}]),angular.module("search/mainSearchBar.tpl.html",[]).run(["$templateCache",function(a){a.put("search/mainSearchBar.tpl.html",'<div class="kf-query-wrap" ng-class="{empty: isEmpty()}"><input kf-no-drag-input class="kf-query" type="text" placeholder="Search Kifi…" ng-model="search.text" ng-keydown="onKeydown($event)" ng-focus="onFocus()" ng-blur="onBlur()" ng-change="onChange()"><div class="kf-query-icon"></div><span class="kf-search-clear-wrapper" ng-if="clearable()"><a href="javascript:" ng-click="clear()">Clear</a></span></div>')}]),angular.module("search/search.tpl.html",[]).run(["$templateCache",function(a){a.put("search/search.tpl.html",'<div class="kf-main-search"><div class="kf-main-head"><div class="kf-search-filters"><a class="kf-search-filter" ng-class="{ selected: isFilterSelected(\'m\'), enabled: isEnabled(\'m\') }" ng-href="{{getFilterUrl(\'m\')}}">Your keeps ({{results.myTotal}})</a> <a class="kf-search-filter" ng-class="{ selected: isFilterSelected(\'f\'), enabled: isEnabled(\'f\') }" ng-href="{{getFilterUrl(\'f\')}}">Friends keeps ({{results.friendsTotal}})</a> <a class="kf-search-filter" ng-class="{ selected: isFilterSelected(\'a\'), enabled: isEnabled(\'a\') }" ng-href="{{getFilterUrl(\'a\')}}">All keeps</a></div><div class="kf-subtitle"><span class="kf-subtitle-text">{{getSubtitle()}}</span><div class="kf-edit-keeps" ng-click="toggleEdit()" ng-show="allowEdit()"><span class="sprite sprite-edit-pencil-icon"></span> <span class="kf-edit-keeps-label">{{editKeepsLabel()}}</span></div></div></div><div kf-keeps keeps="keeps" keeps-loading="loading" keeps-has-more="hasMore()" scroll-disabled="scrollDisabled" scroll-next="getNextKeeps()" keep-click="analyticsTrack" edit-mode="editMode" toggle-edit="toggleEdit"></div></div>')}]),angular.module("social/addNetworksModal.tpl.html",[]).run(["$templateCache",function(a){a.put("social/addNetworksModal.tpl.html",'<div kf-modal ng-if="data.showAddNetworks" show="data.showAddNetworks" kf-width="750px"><div kf-basic-modal-content centered="true" action-text="Done!"><div kf-social-connect-networks></div></div></div>')}]),angular.module("social/connectNetworks.tpl.html",[]).run(["$templateCache",function(a){a.put("social/connectNetworks.tpl.html",'<div class="social-connect" ng-show="data.show"><div class="social-connect-title">Connect your social networks to Kifi</div><p class="social-connect-desc">Connect your networks to quickly find people you may know already using Kifi.</p><div class="social-connect-buttons"><div class="social-connect-row"><div ng-if="facebook.profileUrl"><div class="social-connected-button facebook">Facebook Connected</div><span class="social-notice-badge" ng-if="facebookStatus() === \'good\'"><span class="notice-button good"></span></span> <span class="social-notice-badge" ng-if="facebookStatus() === \'refreshing\'"><span class="notice-message import"><div class="bouncy-ball"><div class="pace pace-active"><div class="pace-progress"></div><div class="pace-activity"></div></div></div>Importing your contacts</span></span> <span class="social-notice-badge" ng-if="facebookStatus() === \'expired\'" ng-click="connectFacebook()"><span class="notice-button warn">×</span> <span class="notice-message refresh">Refresh connection</span></span></div><div ng-if="!facebook.profileUrl"><div class="social-connect-button facebook" ng-click="connectFacebook()">Connect Facebook</div></div></div><div class="social-connect-row"><div ng-if="linkedin.profileUrl"><div class="social-connected-button linkedin">LinkedIn Connected</div><span class="social-notice-badge" ng-if="linkedinStatus() === \'good\'"><span class="notice-button good"></span></span> <span class="social-notice-badge" ng-if="linkedinStatus() === \'refreshing\'"><span class="notice-message import"><div class="bouncy-ball"><div class="pace pace-active"><div class="pace-progress"></div><div class="pace-activity"></div></div></div>Importing your contacts</span></span> <span class="social-notice-badge" ng-if="linkedinStatus() === \'expired\'" ng-click="connectLinkedIn()"><span class="notice-button warn">×</span> <span class="notice-message refresh">Refresh connection</span></span></div><div ng-if="!linkedin.profileUrl"><div class="social-connect-button linkedin" ng-click="connectLinkedIn()">Connect LinkedIn</div></div></div><div class="social-connect-row" ng-if="gmail.length === 0"><div class="social-connect-button gmail" ng-click="importGmail()">Connect Gmail</div></div><div ng-repeat="account in gmail" ng-if="gmail.length > 0"><div class="social-connect-row social-extended"><div class="social-connected-button gmail">Gmail Connected<div class="social-account-name">{{account.ownerEmail}}</div></div><span class="social-notice-badge"><span class="notice-button good"></span></span></div></div><div class="social-more-accounts" ng-if="gmail.length > 0" ng-click="importGmail()">Refresh/Add more Gmail accounts</div></div></div>')}]),angular.module("social/networksNeedAttention.tpl.html",[]).run(["$templateCache",function(a){a.put("social/networksNeedAttention.tpl.html",'<div class="kf-networks-need-attention" ng-if="networksNeedAttention()"><div kf-alert-banner action-text="Fix it" action="doShow">One or more of your connected social networks needs your attention</div></div>')}]),angular.module("tagKeeps/tagKeeps.tpl.html",[]).run(["$templateCache",function(a){a.put("tagKeeps/tagKeeps.tpl.html",'<div class="kf-main-tag-keeps"><div class="kf-main-head"><h1 class="kf-main-title">Tags / {{tag.name}}</h1><div class="kf-subtitle"><div class="kf-edit-keeps" ng-click="toggleEdit()"><span class="sprite sprite-edit-pencil-icon"></span> <span class="kf-edit-keeps-label">{{editKeepsLabel()}}</span></div><span class="kf-subtitle-text">{{getSubtitle()}}</span></div></div><div kf-keeps keeps="keeps" keeps-loading="loading" keeps-has-more="hasMore()" scroll-distance="scrollDistance" scroll-disabled="scrollDisabled" scroll-next="getNextKeeps()" edit-mode="editMode" toggle-edit="toggleEdit"></div></div>')}]),angular.module("tags/tagItem.tpl.html",[]).run(["$templateCache",function(a){a.put("tags/tagItem.tpl.html",'<li class="kf-tag"><div class="kf-tag-container"><div class="kf-tag-inner-container" class="kf-tag-container" ng-class="{ renaming: isRenaming, hover: isHovering, \'kf-drag-target\': isDragTarget }" ng-show="!isFake"><div class="kf-tag-info" ng-click="navigateToTag($event)"><div class="kf-tag-count" ng-show="!isWaiting">{{tag.keeps}}</div><div class="kf-tag-name-holder"><div class="kf-tag-icon"></div><div class="kf-tag-name" ng-show="!isRenaming">{{tag.name}}</div><div class="kf-tag-rename-container"><input class="kf-tag-rename" type="text" placeholder="Type new tag name" ng-model="renameTag.value" ng-keydown="onRenameKeydown($event)" ng-show="isRenaming"></div></div><div class="kf-tag-waiting" ng-show="isWaiting"></div></div><div class="kf-tag-tool kf-tag-dropdown-toggle" ng-click="toggleDropdown($event)"></div><div class="kf-tag-tool kf-tag-handle" ng-if="watchTagReorder()"></div><ul class="kf-dropdown-menu" ng-show="isDropdownOpen" ng-click="cancelNavigation($event)"><li><a href="javascript:" ng-mousedown="setRenaming()">Rename</a></li><li><a href="javascript:" ng-mousedown="removeTag(tag)">Remove</a></li></ul></div><div class="kf-keep-drag-mask"></div></div><div class="kf-tag-drag-mask"></div></li>')}]),angular.module("tags/tagList.tpl.html",[]).run(["$templateCache",function(a){a.put("tags/tagList.tpl.html",'<div class="kf-keep-tags"><ul class="kf-tag-list"><li class="kf-keep-tag" data-id="{{tag.id}}" ng-repeat="tag in getCommonTags()"><div class="kf-keep-tag-link"><a href="/tag/{{tag.id}}">{{tag.name}}</a></div><div class="kf-keep-tag-x" ng-click="removeTag(tag)">×</div></li><li class="kf-keep-tag-new"><span class="kf-keep-add-tag-button sprite sprite-add-a-tag-button" ng-click="showAddTagDropdown()" ng-if="!addingTag.enabled"></span> <span kf-tag-suggestions ng-if="addingTag.enabled"><input focus-when="shouldGiveFocus" class="kf-keep-tag-input" type="text" placeholder="Tag name…" ng-model="tagFilter.name" ng-keydown="onKeydown($event)" ng-blur="hideAddTagDropdown()"><div class="kf-keep-tag-opts-container"><ul class="kf-keep-tag-opts"><li class="kf-keep-tag-opt" ng-repeat="tag in tagTypeAheadResults" ng-class="{ current: isTagHighlighted(tag) }" ng-mousedown="addTag(tag)" ng-bind-html="tag.prettyHtml" ng-mouseover="highlightTag(tag)"></li><li class="kf-keep-tag-opt kf-keep-tag-opt-new" ng-if="isAddTagShown()" ng-mousedown="createAndAddTag()" ng-class="{ current: isTagHighlighted(null) }" ng-mouseover="highlightTag(null)"><div class="kf-keep-tag-opt-new-label">{{newTagLabel}}</div><div class="kf-keep-tag-opt-new-text">{{tagFilter.name}}</div></li></ul><span class="kf-keep-tag-hidden"></span></div></span></li></ul></div>')}]),angular.module("tags/tags.tpl.html",[]).run(["$templateCache",function(a){a.put("tags/tags.tpl.html",'<div class="kf-tags"><div class="kf-nav-group-name">TAGS</div><div class="kf-tag-input-box" ng-class="{\'focused\': isFilterFocused}"><a class="kf-tag-input-clear" href="javascript:" ng-click="clearFilter(true)" ng-show="filter.name">&times;</a> <input class="kf-tag-filter-input" kf-no-drag-input name="filterName" placeholder="Find or add a tag..." maxlength="32" ng-model="filter.name" ng-change="onFilterChange()" ng-keydown="onKeydown($event)" ng-focus="focusFilter()" ng-blur="blurFilter()"></div><div class="kf-tag-list-hidden"></div><div class="kf-scrollable-tags" antiscroll="{ autoHide: false }" ng-class="{\'kf-add-tag-shown\': showAddTag()}"><ul class="kf-sidebar-tag-list" smart-scroll scroll-distance="scrollDistance" scroll-disabled="isScrollDisabled()" scroll-next="scrollNext()"><li kf-tag-item tag="tag" watch-tag-reorder="watchTagReorder()" view-tag="viewTag(tagId)" remove-tag="removeTag(tag)" ng-class="{ active: isActiveTag(tag), highlight: isHighlight(tag), new: tag.isNew }" index="{{$index}}" ng-repeat="tag in tags.concat([null]) | limitTo: tagLimit track by tag.id" tag-drag-source="data.tagDragSource" target-idx="data.targetIdx" ng-mousedown="disableClearFilter()" ng-mouseup="enableClearFilter()"></li></ul><div class="kf-tag-new" ng-show="showAddTag()" ng-mousedown="createTag()"><div class="kf-tag-new-inner" ng-class="{ highlight: isHighlightNew() }"><div class="kf-tag-new-icon"><div class="sprite sprite-tag-add-plus"></div></div><div class="kf-tag-new-contents"><div class="kf-tag-caption">Add as a new tag:</div><div class="kf-tag-name">{{filter.name}}</div></div></div></div></div></div>')}]);