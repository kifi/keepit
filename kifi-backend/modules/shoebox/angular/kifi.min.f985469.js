"use strict";angular.module("kifi",["ngCookies","ngResource","ngSanitize","ngAnimate","ui.router","util","antiscroll","nodraginput","jun.smartScroll","angularMoment","jun.facebook","ui.slider","angulartics","kifi.templates"]).run(["$state",angular.noop]).constant("env",function(){var e=window.location,i=e.hostname,t=e.port,r="www.kifi.com"===i,n=!r&&"9000"===t,a=e.protocol+"//"+i+(t?":"+t:""),o=n?a:"https://www.kifi.com";return{local:n,dev:!r,production:r,origin:a,navBase:o,xhrBase:o+"/site",xhrBaseSearch:o.replace("www","search")+"/site",picBase:(n?"//d1scct5mnc9d9m":"//djty7jcqog9qu")+".cloudfront.net"}}()).config(["$compileProvider","$FBProvider","env",function(e,i,t){e.debugInfoEnabled(t.dev),i.appId(t.dev?"530357056981814":"104629159695560").scope("public_profile,user_friends,email").cookie(!0).logging(!1)}]).factory("initParams",["$location",function(e){var i=["m","o","install","intent"],t=["kcid","utm_campaign","utm_content","utm_medium","utm_source","utm_term","dat","kma"],r=e.search(),n=_.pick(r,i);return _.isEmpty(n)&&_.isEmpty(_.pick(r,t))||e.search(_.omit(r,i,t)).replace(),{getAndClear:function(e){var i;return e in n&&(i=n[e],delete n[e]),i}}}]).factory("$exceptionHandler",["$injector","$window","$log",function(e,i,t){function r(e,r){i.Airbrake?i.Airbrake.push({error:{message:e.toString(),stack:e.stack},params:{cause:r}}):t.error(e)}return _.debounce(r,5e3,!0)}]).factory("errorResponseReporter",["$q","$exceptionHandler",function(e,i){var t=[403],r={responseError:function(r){return r=r||{},_.contains(t,r.status)||i(new Error("Client received HTTP status "+r.status),r),e.reject(r)}};return r}]).config(["$httpProvider",function(e){e.interceptors.push("errorResponseReporter")}]).controller("AppCtrl",["$scope","$rootScope","$rootElement","$window","$timeout","$log","$analytics","$location","$state","profileService","platformService","libraryService",function(e,i,t,r,n,a,o,l,s,c,u,d){function f(){t.find("#kf-authenticated").removeAttr("id").length?n(function(){c.fetchMe().then(function(){i.userLoggedIn&&(c.fetchPrefs(),d.fetchLibraryInfos(!0))})}):c.initLoggedOut(),i.$on("$stateChangeSuccess",function(i,t,n,a,s){e.errorStatus=e.errorParams=null;var c=t.name.split(".");if(a.name&&(c[0]!==a.name.split(".")[0]||p(c[0],s,n))&&(r.document.body.scrollTop=0),!o.settings.pageTracking.autoTrackVirtualPages&&"library"!==c[0]&&"userProfile"!==c[0]){var u=o.settings.pageTracking.basePath+l.url();o.pageTrack(u)}}),i.$on("$stateChangeError",function(i,t,r,n,a,o){o&&_.contains([403,404],o.status)&&(i.preventDefault(),e.errorStatus=o.status,e.errorParams=r)})}function p(e,i,t){var r=(s.get(e).url.match(/[:?&]\w+/g)||[]).map(function(e){return e.slice(1)});return!_.isEqual(_.pick(i,r),_.pick(t,r))}a.log("\n   █   ● ▟▛ ●        made with ❤\n   █▟▛ █ █■ █    kifi.com/about/team\n   █▜▙ █ █  █         join us!\n"),f(),i.$on("appStart",f)}]),angular.module("kifi").directive("kfAlertBanner",[function(){return{scope:{action:"=",actionText:"@"},replace:!0,restrict:"A",transclude:!0,templateUrl:"common/directives/alertBanner/alertBanner.tpl.html",link:function(){}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/directives/alertBanner/alertBanner.tpl.html",'<div class="kf-alert-banner"><span class="kf-alert-banner-body"><span class="kf-alert-banner-head">Important -</span> <span ng-transclude=""></span></span> <span class="kf-alert-banner-button" ng-if="actionText" ng-click="action()">{{actionText}}</span></div>')}])}(),angular.module("antiscroll",["kifi"]).directive("antiscroll",["$timeout",function(e){return{restrict:"A",transclude:!0,link:function(i,t,r){var n=r.antiscroll?i.$eval(r.antiscroll):void 0,a=t.antiscroll(n).data("antiscroll"),o=a.refresh.bind(a);e(o),i.$on("refreshScroll",function(){e(o)})},template:'<div class="antiscroll-inner" ng-transclude></div>'}}]),angular.module("kifi").directive("kfClickMenu",["$window",function(e){var i=jQuery;return{restrict:"A",link:function(t,r){function n(){r.addClass("kf-open")}function a(){r.removeClass("kf-open")}function o(){return r.hasClass("kf-open")}function l(e){var t;1===e.which&&(t=i(e.target),t.closest(r).length&&!t.hasClass("kf-dropdown-menu-item")&&r.find("menu").children().length?o()||n():a())}r.on("$destroy",function(){e.document.removeEventListener("click",l)}),e.document.addEventListener("click",l)}}}]),angular.module("kifi").directive("kfEllipsis",["$timeout","$window",function(e,i){return{restrict:"A",scope:{fullText:"=",ellipsisAppend:"@",maxNumLines:"=",numReloads:"="},compile:function(){return function(t,r){function n(){if("string"==typeof t.fullText){a.css("width",r.width()),a.text("x");var e=a.height();a.text(t.fullText);var i=a.height(),n=i/e,o=t.fullText.length,l=t.maxNumLines||n;if(0===i)return void r.text(t.fullText);if(l>=n)return void r.text(t.fullText);for(var s="string"==typeof t.ellipsisAppend&&t.ellipsisAppend||"…",c=t.fullText.length,u=0;c-u>1;)o=u+Math.floor((c-u)/2),a.text(t.fullText.substr(0,o)+s),i=a.height(),n=i/e,n>l?c=o:u=o;o=u,r.text(t.fullText.substr(0,o)+s)}}var a=r.clone().css({display:"block",position:"absolute",top:"-99999px",left:"-99999px",visibility:"hidden"}).appendTo(r.parent()),o=0,l=0,s=0,c=t.numReloads||0;e(function u(){n(),s++,c>s&&e(u,1e3)},200),t.$watch("fullText",n),t.$watch("maxNumLines",n),t.$watch("maxNumLines",function(){e(n)}),angular.element(i).bind("resize",_.debounce(function(){(i.innerWidth!==l||i.innerHeight!==o)&&n(),l=i.innerWidth,o=i.innerHeight},200))}}}}]),angular.module("kifi").directive("kfFileChange",function(){return{restrict:"A",scope:{kfFileChange:"&"},link:function(e,i){i.on("change",function(){var i=this;e.$apply(function(){e.kfFileChange()(i.files)})})}}}),angular.module("kifi").directive("focusWhen",["$timeout",function(e){return{restrict:"A",scope:{focusWhen:"="},link:function(i,t){function r(){t.focus(),i.focusWhen=!1}i.$watch("focusWhen",function(i){i&&e(r)})}}}]).directive("kfFocusIf",[function(){return{restrict:"A",scope:{focusCond:"="},link:function(e,i){e.$watch("focusCond",function(e){e&&i.focus()})}}}]).directive("kfAutofocus",[function(){return{restrict:"A",link:function(e,i){i.focus()}}}]),angular.module("kifi").directive("kfHover",function(){return{restrict:"A",link:function(e,i){var t;i.on("mouseover",function(){t||(t=!0,i.addClass("kf-hover"))}).on("mouseout",function(e){var r=e.relatedTarget;!t||r&&(this===r||jQuery.contains(this,r))||(t=!1,i.removeClass("kf-hover"))})}}}),angular.module("kifi").directive("kfHoverMenu",["$timeout",function(e){return{restrict:"A",link:function(i,t){function r(){e.cancel(a),t.addClass("kf-open"),o=Date.now()}function n(){t.removeClass("kf-open"),o=null}var a,o;t.on("mouseenter",function(){e.cancel(a),a=e(r,120)}),t.on("mouseleave",function(){e.cancel(a),n()}),t.on("click",function(i){1===i.which&&(e.cancel(a),o?(Date.now()-o>500||angular.element(i.target).is("a[href],a[href] *,menu *"))&&n():r())})}}}]),angular.module("kifi").directive("kfMinVersion",["installService","$rootScope",function(e,i){return{restrict:"A",link:function(t,r,n){t.$on("$destroy",i.$on("kifiExt",function(){r.css("display",e.hasMinimumVersion(n.kfMinVersion,n.minCanary)?"":"none")}))}}}]),angular.module("nodraginput",[]).directive("kfNoDragInput",[function(){return{restrict:"A",link:function(e,i){function t(e){e.dataTransfer&&(e.dataTransfer.dropEffect="none"),e.stopPropagation(),e.preventDefault()}i.attr("draggable","false"),i.on("dragstart",function(){return!1}),i.on("dragenter",t),i.on("dragover",t),i.on("drop",t)}}}]),angular.module("kifi").directive("kfPageBottomCta",["$rootScope","$window","signupService",function(e,i,t){return{restrict:"A",replace:!0,templateUrl:"common/directives/pageBottomCTA/pageBottomCta.tpl.html",scope:{library:"="},link:function(r){function n(){window.pageYOffset>400&&r.$apply(function(){e.$emit("trackLibraryEvent","view",{type:"libraryLandingPopup"}),r.visible=!0,angular.element(".kf-lib-footer").css("padding-bottom","300px"),i.removeEventListener("scroll",n)})}r.visible=!1,r.twitterHandle=r.library.attr&&r.library.attr.twitter.screenName,r.join=function(i){e.$emit("trackLibraryEvent","click",{action:"clickedSignupPopup"}),r.twitterHandle||(i.preventDefault(),r.visible=!1,t.register({libraryId:r.library.id}))},r.login=function(){e.$emit("trackLibraryEvent","click",{action:"clickedLoginPopup"})},i.addEventListener("scroll",n),r.$on("$destroy",function(){i.removeEventListener("scroll",n)})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/directives/pageBottomCTA/pageBottomCta.tpl.html",'<div class="kf-pbc" ng-if="&& visible"><div class="kf-pbc-content"><div class="kf-pbc-title">{{twitterHandle ? \'Create a library of your tweeted links\' : \'There’s more...\'}}</div><div class="kf-pbc-subtitle">{{twitterHandle ? \'Sign up for the Twitter Deep Search Beta\' : \'Sign up to see the rest!\'}}</div><div ng-if="twitterHandle"><a class="kf-pbc-continue" ng-click="join($event)" href="/twitter/request" target="_self">Join Now</a></div><div ng-if="!twitterHandle"><a class="kf-pbc-continue" ng-click="join($event)" href="/signup" target="_self">Continue</a></div></div></div>')}])}(),angular.module("kifi").directive("kfSticky",["$window","$timeout",function(e,i){return{restrict:"A",scope:{stickyTop:"=",stickyToggle:"&",stickyNear:"&",stickyNearPx:"=",stickyIf:"&"},link:function(t,r){function n(e){if(!c){var i=r[0].getBoundingClientRect().top;u=i+e}}function a(e){var i=u-e-t.stickyTop;if(0>=i)c||(m&&(m(r,0,g),f=0),p(r,!0),c=!0);else if(c&&(p(r,!1),c=!1),m&&(g>=i||g>f)){var n=Math.min(i,g);m(r,n,g),f=n}}function o(){var e=h.scrollTop();v(e),a(e)}function l(){clearInterval(d),a(h.scrollTop())}function s(){var e=h.scrollTop(),i=0;clearInterval(d),d=setInterval(function(){var t=h.scrollTop();t===e?++i>=5&&clearInterval(d):(a(t),e=t,i=0)},1e3/60)}if(!t.stickyIf||t.stickyIf()){var c,u,d,f,p=t.stickyToggle(),m=t.stickyNear&&t.stickyNear(),g=t.stickyNearPx||10,h=angular.element(e),v=_.throttle(n,200,{leading:!0});i(function(){h.on("scroll",o),h.on("touchmove",l),h.on("touchend",s),t.$on("$destroy",function(){h.off("scroll",o),h.off("touchmove",l),h.off("touchend",s)})})}}}}]),angular.module("kifi").directive("kfSymbolSprite",[function(){return{restrict:"A",compile:function(){return function(e,i,t){var r="//d1dwdv9wd966qu.cloudfront.net/img/symbol-sprites/dist/symbol-sprite.8d9d841.svg";i[0].innerHTML='<use xlink:href="'+r+"#"+t.icon+'" />',i[0].classList.add("symbol-sprite")}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/directives/userTooltip/userLibTooltip.tpl.html",'<div class="kf-ult" ng-if="tipping"><div class="kf-ult-card" kf-small-library-card="" library="library" action="clickedLibraryTooltip" origin="libraryTooltip"></div></div>')}])}(),angular.module("kifi").directive("kfUserTooltip",["$timeout","$compile","$templateCache","libraryService",function(e,i,t,r){return{restrict:"A",scope:{user:"=kfUserTooltip",library:"=",desc:"@"},link:function(n,a){var o,l,s;n.tipping=!1,a.on("mouseenter",function(c){if(!(Date.now()-s<1e3||angular.element(c.target).is(".kf-utt,.kf-utt *"))){o||(o=angular.element(t.get(n.library?"common/directives/userTooltip/userLibTooltip.tpl.html":"common/directives/userTooltip/userTooltip.tpl.html")),a.append(o),i(o)(n)),l=e(function(){n.tipping=null,u.then(function(){n.tipping=null===n.tipping})},50);var u=n.library?r.getLibraryInfoById(n.library.id).then(function(e){n.library=e.library,n.library.path=e.library.url}):l}}).on("touchstart touchend",function(){s=Date.now()}).on("mouseleave mousedown",function(i){"mousedown"===i.type&&angular.element(i.target).is(".kf-ult,.kf-ult *")||(e.cancel(l),n.$apply(function(){n.tipping=!1}))}),n.$on("$destroy",function(){e.cancel(l),n.tipping=!1,o&&o.remove()})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/directives/userTooltip/userTooltip.tpl.html",'<div class="kf-utt" ng-if="tipping"><div class="kf-utt-top"><img class="kf-utt-pic" ng-src="{{user|pic:200}}"><div class="kf-utt-info"><div class="kf-utt-name">{{user|name}}</div><div class="kf-utt-desc">{{desc}}</div></div></div></div>')}])}(),angular.module("kifi").directive("kfWheelStop",function(){return{restrict:"A",link:function(e,i){i.on("wheel",function(e){"false"===i.attr("kf-wheel-stop")||e.originalEvent.kfAllow||e.preventDefault()})}}}).directive("kfWheelAllow",function(){return{restrict:"A",link:function(e,i){i.on("wheel",function(e){var i=e.originalEvent.deltaY;if(i){var t=this.scrollTop;if(i>0){var r=this.scrollHeight-this.clientHeight;t+i>r?this.scrollTop=r:e.originalEvent.kfAllow=!0}else 0>t+i?t>0&&(this.scrollTop=0):e.originalEvent.kfAllow=!0}})}}}),angular.module("kifi").directive("kfYoutube",[function(){function e(e){return['<div class="kf-youtube-img" style="background-image:url(//img.youtube.com/vi/',e,'/hqdefault.jpg)" click-action="playedYoutubeVideo"></div>','<div class="kf-youtube-play" click-action="playedYoutubeVideo"></div>'].join("")}function i(e){return['<iframe class="kf-youtube-iframe" width="100%" height="100%" src="//www.youtube.com/embed/',e,'?rel=0&theme=light&showinfo=0&disablekb=1&modestbranding=1&controls=1&hd=1&autoplay=1&autohide=1&color=white&iv_load_policy=3" ','frameborder="0" allowfullscreen="true" allowscriptaccess="always"></iframe>'].join("")}return{restrict:"A",replace:!0,scope:{videoId:"="},template:'<div class="kf-youtube" ng-click="insertVideo()"></div>',link:function(t,r){t.insertVideo=function(){r.html(i(t.videoId)).addClass("kf-with-video")},t.$watch("videoId",function(i){i&&r.html(e(i)).removeClass("kf-with-video")})}}}]),angular.module("kifi").filter("titlecase",function(){return function(e){return e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()}}).filter("name",function(){return function(e){return e?(e.firstName||"")+" "+(e.lastName||""):""}}).filter("pic",["routeService",function(e){return function(i,t){return i?e.formatPicUrl(i.id,i.pictureName,t>100?200:100):"//www.kifi.com/assets/img/ghost.200.png"}}]).filter("tagUrl",function(){return function(e){return"/find?q=tag:"+encodeURIComponent(e.indexOf(" ")>=0?'"'+e+'"':e)}}).filter("profileUrl",function(){return function(e,i){return e?"/"+e.username+(i&&"libraries"!==i?"/"+i:""):void 0}}).filter("absProfileUrl",["env",function(e){return function(i){return i?e.origin+"/"+i.username:null}}]).filter("libPath",function(){return function(e){return"/"+encodeURIComponent(e.owner.username)+"/"+encodeURIComponent(e.slug)}}).filter("libImageUrl",["env",function(e){return function(i){return e.picBase+"/"+i.path}}]).filter("bgImageAndPos",["env",function(e){return function(i){return i?["background-image:url(",e.picBase,"/",i.path,");background-position:",i.x,"% ",i.y,"%"].join(""):""}}]).filter("shadedBackgroundImage",["env",function(e){return function(i,t,r){return i?["background-image:","linear-gradient(rgba(0,0,0,",t,"),rgba(0,0,0,",r,")),","url(",i.url||e.picBase+"/"+i.path,");","background-position:0,",i.x,"% ",i.y,"%"].join(""):""}}]).filter("num",function(){return function(e){if(1e3>e)return null==e?"":String(e);var i=String(e).slice(0,-2);return"0"===i.slice(-1)?i.slice(0,-1)+"K":i.replace(/(\d)$/,".$1")+"K"}}).filter("timeToRead",function(){var e=[1,2,3,4,5,6,7,8,9,10,15,20,30,60];return function(i){var t=i/250;return t=_.find(e,function(e){return e>t}),t?t+" min":"1h"}}).filter("preventOrphans",["util",function(e){return e.preventOrphans}]).filter("domain",function(){var e=/^\w+:\/\/(?:www\.)?([^\/]+)/;return function(i){var t=e.exec(i);return t&&t[1]}}).filter("localTime",function(){return Date}).filter("noteHtml",["HTML","$filter",function(e,i){var t=/\n(?:\s*\n)+/g,r=/\[#((?:\\.|[^\]])*)\]/g,n=/\[\\([#@])/g,a=/\\(.)/g,o=i("tagUrl");return function(i){if(!i)return"";for(var l=i.replace(t,"\n\n").split(r),s=1;s<l.length;s+=2){var c=l[s].replace(a,"$1");l[s]='<a class="kf-keep-note-hashtag" href="'+e.escapeDoubleQuotedAttr(o(c))+'">#'+e.escapeElementContent(c)+"</a>"}for(s=0;s<l.length;s+=2)l[s]=e.escapeElementContent(l[s].replace(n,"[$1"));return l.join("")}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/basicModalContent.tpl.html",'<div class="dialog-content"><a class="dialog-x" ng-click="closeAndCancel()"></a><div class="dialog-body-wrap"><h1 class="dialog-header" ng-if="title.length" ng-bind-html="title"></h1><div class="dialog-body" ng-transclude="" ng-class="{\'dialog-centered\': centered}"></div></div><div class="dialog-buttons" ng-if="!withoutButtons"><button class="dialog-cancel" ng-click="closeAndCancel()" ng-if="withCancel" tabindex="0">{{cancelText || \'Cancel\'}}</button> <button class="kf-action-button" ng-class="{\'dialog-warn\': withWarning}" ng-click="closeAndAction()" tabindex="0">{{actionText || \'Ok\'}}</button></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/genericErrorModal.tpl.html",'<div kf-modal=""><div kf-basic-modal-content=""><div>{{modalData.genericErrorMessage || \'Sorry, something went wrong :(\'}}</div><div ng-show="!modalData.genericErrorMessage">Please try again later, or <a href="http://support.kifi.com/hc/en-us/requests/new">contact us</a>.</div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/importBookmarkFileErrorModal.tpl.html",'<div kf-modal="" kf-width="590px" class="import-file-modal"><div kf-basic-modal-content="" title="Whoops! We\'re having a problem." action-text="Done"><p class="import-file-progress">We\'re having trouble importing your bookmark upload. It could be that we\'re overloaded, or that the file is invalid.</p><p class="import-file-progress">If you think this is an error, <a href="http://support.kifi.com/hc/en-us/requests/new">contact support</a> and we\'ll sort things out. Thanks!</p></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/importBookmarkFileInProgressModal.tpl.html",'<div kf-modal="" kf-width="560px" class="import-file-modal"><div kf-basic-modal-content="" centered="true" title="Importing your bookmarks to Kifi" action-text="Awesome"><div class="import-library-explanation"><img src="//d1dwdv9wd966qu.cloudfront.net/img/others.a7f52a0.png" class="import-file-others-icon"><div class="arrow-right-icon svg-arrow-right"></div><div class="kifi-clover-icon svg-kifi-clover"></div><div class="dialog-text">This might take a few minutes to see all your links, and then we’ll start crawling them so you can search the content of the pages. Feel free to browse around — we’re syncing in the background.</div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/importBookmarkFileModal.tpl.html",'<div kf-modal="" kf-width="560px" class="import-file-modal" force-close="forceClose"><div kf-basic-modal-content="" title="Import your links to Kifi" without-buttons="" cancel="cancelBookmarkUpload()"><div class="import-library-explanation"><img src="//d1dwdv9wd966qu.cloudfront.net/img/others.a7f52a0.png" class="import-file-others-icon"><div class="arrow-right-icon svg-arrow-right"></div><div class="kifi-clover-icon svg-kifi-clover-logo"></div><div class="dialog-text">Import your links from other sites into your Kifi library. Choose a public or private library as needed.</div></div><div class="import-library-how-to"><p class="import-library-how-to-heading">3 easy steps to import your content into Kifi:</p><table><tr class="import-library-how-to-row"><td class="import-library-how-to-row-heading">Step 1</td><td class="import-library-how-to-row-content">Export your links from <a href="https://getpocket.com/export" ng-click="openExportPopup($event)">Pocket</a>, <a href="http://export.delicious.com/settings/bookmarks/export" ng-click="openExportPopup($event)">Delicious</a>, <a href="https://kippt.com/export/" ng-click="openExportPopup($event)">Kippt</a>, <a href="https://www.instapaper.com/user/export" ng-click="openExportPopup($event)">Instapaper</a>, or <a href="https://pinboard.in/export/" ng-click="openExportPopup($event)">Pinboard</a> (the format should be HTML).</td></tr><tr class="import-library-how-to-row"><td class="import-library-how-to-row-heading">Step 2</td><td class="import-library-how-to-row-content">Select <a ng-click="openBookmarkFileSelector($event)" href="javascript:">the file you downloaded</a>. <input class="bookmark-file-upload" type="file" name="bookmark-file" accept=".html,text/html,.zip" kf-file-change="allowUpload"> <span ng-if="importFilename" class="bookmark-file-upload-name"><i>{{importFilename}}</i> selected.</span></td></tr><tr class="import-library-how-to-row"><td class="import-library-how-to-row-heading">Step 3</td><td class="import-library-how-to-row-content">Choose a library to import to</td></tr></table></div><div class="import-library-selection"><div class="add-keep-to-library-dropdown" kf-keep-to-library-widget="" widget-action-text="Import keeps" library-select-action="onImportLibrarySelected(selectedLibrary)" lib-select-down-offset="0" lib-select-max-up-offset="220" lib-select-left-offset="0"><span ng-switch="importLibrary.kind" class="keep-to-library-lib-icon-container"><div class="kf-klw-library-card" ng-style="{\'background-color\': importLibrary.color}"><div ng-if="importLibrary.kind === \'system_main\'" class="kf-klw-star-icon svg-card-star"></div><div ng-if="importLibrary.visibility === \'secret\'" class="kf-klw-lock-icon svg-card-lock"></div></div></span> {{importLibrary.name}} <span class="add-keep-to-library-dropdown-arrow"></span></div></div><div ng-if="importFileStatus" class="bookmark-file-upload-status">{{importFileStatus}}</div><div class="dialog-buttons"><button class="import-button" ng-class="{\'disabled\': disableBookmarkImport || !importFilename}" ng-click="importBookmarkFileToLibrary(importLibrary)">Import</button></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/importBookmarksErrorModal.tpl.html",'<div kf-modal="" kf-width="540px" class="import-modal"><div kf-basic-modal-content="" title="Whoops! We\'re having a problem." action-text="Done"><p class="import-error-text">We\'re having trouble importing your bookmarks because it seems that you aren\'t running an up-to-date Kifi extension.</p><p class="import-error-text">If you think this is an error, <a href="http://support.kifi.com/hc/en-us/requests/new">contact support</a> and we\'ll sort things out. Thanks!</p></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/importBookmarksInProgressModal.tpl.html",'<div kf-modal="" kf-width="540px" class="import-modal"><div kf-basic-modal-content="" centered="true" title="Importing your bookmarks to Kifi" action-text="Awesome"><div class="import-library-explanation"><div class="import-bookmarks-icon svg-import-bookmarks"></div><div class="dialog-text">This might take a few minutes (especially if you have a lot of bookmarks). Feel free to browse around — we’re syncing in the background.</div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/importBookmarksModal.tpl.html",'<div kf-modal="" kf-width="560px" class="import-modal" force-close="forceClose"><div kf-basic-modal-content="" centered="true" title="Import your browser bookmarks as keeps" without-buttons="" cancel="cancelImport()"><div class="import-library-explanation"><div class="import-bookmarks-icon svg-import-bookmarks"></div><div class="kifi-clover-icon svg-kifi-clover-logo"></div><div class="dialog-text">Import pages you bookmarked in your browser into your Kifi library. Choose a public or private library as needed.</div></div><div class="import-library-selection">Choose a library to import to<div class="add-keep-to-library-dropdown" kf-keep-to-library-widget="" widget-action-text="Import keeps" library-select-action="onImportLibrarySelected(selectedLibrary)" lib-select-down-offset="0" lib-select-max-up-offset="220" lib-select-left-offset="0"><span ng-switch="importLibrary.kind" class="keep-to-library-lib-icon-container"><div class="kf-klw-library-card" ng-style="{\'background-color\': importLibrary.color}"><div ng-if="importLibrary.kind === \'system_main\'" class="kf-klw-star-icon svg-card-star"></div><div ng-if="importLibrary.visibility === \'secret\'" class="kf-klw-lock-icon svg-card-lock"></div></div></span> {{importLibrary.name}} <span class="add-keep-to-library-dropdown-arrow"></span></div></div><div class="dialog-buttons"><button class="import-button" ng-click="importBookmarksToLibrary(importLibrary)">Import</button></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/installExtensionErrorModal.tpl.html",'<div kf-modal="" class="install-extension-error"><div kf-basic-modal-content=""><div>Looks like something went wrong when installing the browser extension.</div><div>Please try again later, or <a href="http://support.kifi.com/hc/en-us/requests/new">contact us</a>.</div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/installExtensionModal.tpl.html",'<div kf-modal="" kf-width="550px"><div kf-basic-modal-content="" title="Install Kifi Knowledge Keeper" centered="true" action-text="Install" with-cancel="" cancel-text="No, thanks" action="triggerInstall()"><div>You need to install the Kifi Knowledge Keeper extension to proceed.</div><div>Don’t worry, it only takes a few seconds!</div></div></div>')}])}(),angular.module("kifi").directive("kfModal",["$document","modalService",function(e,i){return{restrict:"A",replace:!0,scope:{forceClose:"=",disableScroll:"="},templateUrl:"common/modal/modal.tpl.html",transclude:!0,controller:["$scope",function(t){function r(e){27===e.which&&t.close()}function n(){e.on("keydown",r)}function a(){e.off("keydown",r)}t.close=this.close=function(e){a(),i.close(),angular.isFunction(e)&&e()},t.$on("$destroy",a),n()}],link:function(e,i,t){e.dialogStyle={},e.backdropStyle={},e.noUserHide=void 0!==t.noUserHide||!1,t.kfWidth&&(e.dialogStyle.width=t.kfWidth),t.kfHeight&&(e.dialogStyle.height=t.kfHeight),e.backdropStyle.opacity=t.kfOpacity||.3,e.backdropStyle.backgroundColor=t.kfBackdropColor||"rgba(0, 40, 90, 1)",e.$watch("forceClose",function(i,t){!t&&i&&e.close()}),e.disableScroll||i.find(".dialog-body").css({"overflow-y":"auto","overflow-x":"hidden"})}}}]).directive("kfBasicModalContent",[function(){return{restrict:"A",replace:!0,scope:{action:"&",cancel:"&",title:"@"},templateUrl:"common/modal/basicModalContent.tpl.html",transclude:!0,require:"^kfModal",link:function(e,i,t,r){i.removeAttr("title"),e.title=t.title||"",e.actionText=t.actionText,e.cancelText=t.cancelText,e.withCancel=void 0!==t.withCancel||!1,e.withWarning=void 0!==t.withWarning||!1,e.withoutButtons="withoutButtons"in t,e.centered=t.centered,e.closeAndCancel=function(){r.close(e.cancel)},e.closeAndAction=function(){r.close(e.action)},e.close=function(){r.close()}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/modal.tpl.html",'<div id="kf-modal" kf-wheel-stop=""><div class="modal-backdrop fade in" ng-click="close()" ng-style="backdropStyle"></div><div tabindex="-1" index="0" class="modal-dialog" ng-style="dialogStyle"><div class="modal-content" ng-transclude=""></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/sendMobileAppSMS.tpl.html",'<div kf-modal="" kf-width="550px"><div kf-basic-modal-content="" title="Install Kifi Knowledge Keeper App" centered="true" action-text="Send" with-cancel="" cancel-text="No, thanks" action="triggerSendSMS();"><div>We\'ll send you a link to download the Kifi app.</div><div>Just enter your phone number below!</div><input placeholder="(555) 555-5555" type="tel" class="kf-send-mobile-app-sms-number" ng-keypress="$event.keyCode === 13 && $parent.closeAndAction();" ng-model="sms.phoneNumber"></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("common/modal/sendMobileAppSMSError.tpl.html",'<div kf-modal="" kf-width="590px"><div kf-basic-modal-content="" title="Whoops! We\'re having a problem." action-text="Done"><p>We\'re having trouble sending messages to your phone. It could be that we\'re overloaded, or that the phone number is invalid.</p><p>If you think this is an error, <a href="http://support.kifi.com/hc/en-us/requests/new">contact support</a> and we\'ll sort things out. Thanks!</p></div></div>')}])}(),angular.module("kifi").factory("originTrackingService",["initParams",function(e){var i="",t={xmp:"extension/messagePane",xsr:"extension/searchResult",xst:"extension/socialTooltip"};return{set:function(e){i=e||""},applyAndClear:function(r){if(i||(i=t[e.getAndClear("o")]),i){var n=i.split("/");r.origin=n[0],n[1]&&(r.subOrigin=n[1]),i=""}return r}}}]).directive("kfTrackOrigin",["originTrackingService",function(e){return{restrict:"A",link:function(i,t){t.on("click",function(){e.set(t.attr("kf-track-origin"))})}}}]),angular.module("kifi").factory("platformService",["$window","$q","env","$timeout",function(e,i,t,r){var n,a=function(){return/Android/.test(navigator.userAgent)},o=function(){return/iPhone|iPod/.test(navigator.userAgent)},l=function(){return/bot|googlebot|crawler|spider|robot|crawling/i.test(e.navigator.userAgent)},s=function(i){var t;if(d())if(o()){t="kifi:"+(i||"//kifi.com").replace(/https?:/,"");var n=(i||"").indexOf("branch");-1!==n&&n>i.indexOf("?")?u({url:t}).then(function(i){e.location=i}):(r(function(){e.location=t},200),r(function(){e.location="itms://itunes.apple.com/us/app/kifi/id740232575"},225))}else a()&&(i=i||"kifi.com",t=i.replace(/https?:\/\/((www.)?kifi.com)?\/?/,""),e.location="intent://"+t+"#Intent;package=com.kifi;scheme=kifi;action=com.kifi.intent.action.APP_EVENT;end;")},c=function(){if(n)return i.when(n);var e=i.defer(),r=t.dev;return function(e,i,t,r,n,a,o,l,s,c){if(!e[r]||!e[r]._q){for(;l<o.length;)n(a,o[l++]);s=i.createElement(t),s.async=1,s.src="https://cdn.branch.io/branch-v1.5.4.min.js",c=i.getElementsByTagName(t)[0],c.parentNode.insertBefore(s,c),e[r]=a}}(window,document,"script","branch",function(e,i){e[i]=function(){e._q.push([i,arguments])}},{_q:[],_v:1},"init data setIdentity logout track link sendSMS referrals credits redeem banner closeBanner".split(" "),0),window.branch.setDebug(r),window.branch.init("58363010934112339",function(i,t){t&&(n=window.branch,e.resolve(window.branch))}),e.promise},u=function(e){var t=i.defer();return c().then(function(i){i.link({data:e},function(e){t.resolve(e)})}),t.promise},d=function(){return o()||a()},f={isSupportedMobilePlatform:d,isIPhone:o,isAndroid:a,goToAppOrStore:s,isBot:l};return f}]),angular.module("jun.facebook",[]).provider("$FB",function(){function e(e,i){return void 0===i?n[e]:(n[e]=i,r)}function i(e){
!e||e.error?this.reject(e&&e.error||!1):this.resolve(e)}function t(e,i){var t=e.promise;return"function"==typeof i&&t.then(i),t}var r=this,n={appId:null,cookie:!1,logging:!0,status:!0,xfbml:!1,authResponse:void 0,frictionlessRequests:!1,hideFlashCallback:null,scope:"",enable_profile_selector:!1,profile_selector_ids:""};angular.forEach(["appId","cookie","logging","status","xfbml","authResponse","frictionlessRequests","hideFlashCallback","scope","enable_profile_selector","profile_selector_ids"],function(i){r[i]=angular.bind(r,e,i)}),this.option=function(i,t){return"object"==typeof i?(angular.extend(n,i),r):e(i,t)};var a,o,l,s,c,u;this.$get=["$window","$timeout","$q",function(e,i,t){return u=t,s=e,c=i,r}],this.loading=!1,this.loaded=!1,this.FB=null,this.failedToLoad=!1,this.load=function(){if(!o){var e=s,i=u.defer();e.fbAsyncInit=function(){a=r.FB=e.FB,r.loading=!1,r.loaded=!0,c(function(){i.resolve(a)})};var t=function(){r.FB||!r.loading||r.loaded||(r.loading=!1,r.failedToLoad=!0,document.getElementById("facebook-jssdk").remove(),i.reject({error:"no_FB_on_page"}),o=null)};!function(e,i,r){var n,a=e.getElementsByTagName(i)[0];e.getElementById(r)||(n=e.createElement(i),n.id=r,n.src="//connect.facebook.net/en_US/sdk.js",n.addEventListener("error",t),a.parentNode.insertBefore(n,a))}(e.document,"script","facebook-jssdk"),r.loading=!0,o=i.promise}return o},this.initialized=!1,this.init=function(e){return l&&(r.loading||r.loaded)||(l=r.load().then(function(i){if(e=angular.extend({appId:n.appId,cookie:n.cookie,logging:n.logging,status:n.status,xfbml:n.xfbml,authResponse:n.authResponse,frictionlessRequests:n.frictionlessRequests,hideFlashCallback:n.hideFlashCallback,version:"v2.0"},e),!e.appId)throw new Error("$FB: appId is not set!");return i.init(e),r.initialized=!0,i})),l},this.getLoginStatus=function(e){var n=r.init();return n.then(function(n){var a=u.defer(),l=!1;return a.promise.then(function(){l=!0}),c(function(){l||(r.loading=!1,r.failedToLoad=!0,document.getElementById("facebook-jssdk").remove(),o=null,a.reject({error:"no_FB_on_page"}))},1500),n.getLoginStatus(angular.bind(a,i)),t(a,e)})},this.api=function(){var e=arguments;return r.init().then(function(r){var n,a=u.defer(),o=Array.prototype.slice.call(e);return"function"==typeof o[o.length-1]&&(n=o.pop()),o.push(angular.bind(a,i)),r.api.apply(r,o),t(a,n)})},this.ui=function(){var e=arguments;return r.init().then(function(r){var n,a=u.defer(),o=Array.prototype.slice.call(e);return"function"==typeof o[o.length-1]&&(n=o.pop()),o.push(angular.bind(a,i)),r.ui.apply(r,o),t(a,n)})},this.login=function(e,a){return r.init().then(function(r){function o(e){var i=a&&a[e];return i||n[e]}var l=u.defer();"function"!=typeof e&&(a=e,e=null);var s={scope:o("scope"),enable_profile_selector:o("enable_profile_selector"),profile_selector_ids:o("profile_selector_ids"),return_scopes:o("return_scopes")};return r.login(angular.bind(l,i),s),t(l,e)})},this.logout=function(e){return r.getLoginStatus().then(function(r){var n=u.defer();return r.authResponse?a.logout(angular.bind(n,i)):n.reject(r),t(n,e)})},this.disconnect=function(e){return r.init().then(function(r){var n=u.defer();return r.api("/me/permissions","DELETE",angular.bind(n,i)),t(n,e)})}}),angular.module("kifi").factory("Clutch",["$q","$timeout","util","$window",function(e,i,t,r){function n(e,i){this._config=_.defaults({},i,s),this._getter=e,this._cache={}}function a(e){return r.JSON.stringify(Array.prototype.slice.call(e))}function o(e,i){return c()-e>i}function l(i,r){var n=e.defer(),a=this._getter.apply(this,r),o=this._cache[i]||{};o.q=n.promise,o.activeRequest=!0,this._cache[i]=o;var l=this;return a.then(function(e){if(o.time=c(),o.activeRequest=!1,o.value){if(o.value===e)return n.resolve(o.value);if(angular.isArray(e))t.replaceArrayInPlace(o.value,e);else{if(!angular.isObject(e))throw new TypeError("Supplied function must return an array/object");t.replaceObjectInPlace(o.value,e)}}else o.value=e,l._cache[i]=o;n.resolve(o.value)})["catch"](function(e){o.activeRequest=!1,o.value&&"ignore"===l._config.remoteError?n.resolve(o.value):n.reject(e)}),n.promise}var s={remoteError:"ignore",cacheDuration:3e4,returnPreviousOnExpire:!1},c=Date.now||function(){return(new Date).getTime()};return n.prototype.get=function(){var i=a(arguments),t=this._cache[i];return t&&(t.value||t.activeRequest)?t.activeRequest?t.q:o(t.time,this._config.cacheDuration)?this._config.returnPreviousOnExpire?(l.call(this,i,arguments),e.when(t.value)):l.call(this,i,arguments):t.q||e.when(t.value):l.call(this,i,arguments)},n.prototype.contains=function(){return!!this._cache[a(arguments)]},n.prototype.refresh=function(){var e=a(arguments);return l.call(this,e,arguments)},n.prototype.age=function(){var e=a(arguments);return e&&this._cache[e]&&c()-this._cache[e].time},n.prototype.isExpired=function(){var e=a(arguments),i=e&&this._cache[e];return i&&o(i.time,this._config.cacheDuration)},n.prototype.expire=function(){var e=a(arguments),i=this._cache[e];return this._cache[e]&&(this._cache[e].time=0),i},n.prototype.expireAll=function(){_.forEach(this._cache,function(e){e.time=0})},n}]),angular.module("kifi").factory("dragService",["$document",function(e){var i,t;return e.on("dragover",function(e){e=e.originalEvent,i=e.clientX||e.pageX,t=e.clientY||e.pageY}),{getDragPosition:function(){return{pageX:i,pageY:t}}}}]),angular.module("kifi").factory("createExpiringCache",["$cacheFactory",function(e){function i(i,n){var a=e(i);return a.put=angular.bind(a,t,a.put),a.get=angular.bind(a,r,a.get,1e3*n),a}function t(e,i,t){e.call(this,i,{value:t,time:Date.now()})}function r(e,i,t){var r=e.call(this,t);if(r){if(!(Date.now()-r.time>i))return r.value;this.remove(t)}}return i}]),angular.module("kifi").factory("extensionLiaison",["$window","$rootScope",function(e,i){function t(){e.postMessage({type:"start_guide",pages:[{url:"http://www.ted.com/talks/steve_jobs_how_to_live_before_you_die",image:["//d1dwdv9wd966qu.cloudfront.net/img/guide/ted_jobs.7878954.jpg",480,425],noun:"video",query:"steve+jobs",title:"Steve Jobs: How to live before you die | Talk Video | TED.com",matches:{title:[[0,5],[6,4]],url:[[25,5],[31,4]]},track:"steveJobsSpeech"}]},"*")}function r(i,t){t&&t.source&&t.origin?t.source.postMessage(i,t.origin):e.postMessage(i,"*")}return e.addEventListener("message",function(e){i.$apply(function(){var r=e.data||"";switch(r.type||r){case"get_guide":t();break;case"import_bookmarks":r.count>0&&i.$emit("showGlobalModal","importBookmarks",{msgEvent:e});break;case"update_keeps":case"update_tags":}})}),{triggerGuide:t,openDeepLink:function(i,t){e.postMessage({type:"open_deep_link",url:i,locator:t},"*")},importBookmarksTo:function(e,i){r({type:"import_bookmarks",libraryId:e},i)},declineBookmarkImport:function(e){r("import_bookmarks_declined",e)}}}]),angular.module("kifi").factory("installService",["$window","$log","$rootScope",function(e,i,t){var r=e.chrome&&e.chrome.webstore&&e.chrome.webstore.install,n=!r&&"MozBoxSizing"in e.document.documentElement.style||e.navigator.userAgent.indexOf("Firefox")>-1,a=+(e.navigator.userAgent.match(/(?:Chrome|Firefox)\/(\d+)/)||[null,999])[1],o=r&&a>=32||n&&a>=20;o&&(r&&e.document.head.insertAdjacentHTML("beforeend",'<link rel="chrome-webstore-item" href="https://chrome.google.com/webstore/detail/fpjooibalklfinmkiodaamcckfbcjhin">'),e.addEventListener("message",function(e){var i=e.data||{};"kifi_ext_listening"===i.type&&t.$apply(function(){l.installedVersion=i.version,t.$emit("kifiExt")})}));var l={triggerInstall:function(a){r&&o?(l.installState="installing",e.chrome.webstore.install("https://chrome.google.com/webstore/detail/fpjooibalklfinmkiodaamcckfbcjhin",function(){t.$apply(function(){l.installState="done"})},function(e){t.$apply(function(){i.log(e),l.installState=null,a&&a()})})):n&&o?e.InstallTrigger.install({Kifi:{URL:"/extensions/firefox/kifi.xpi",IconURL:"/extensions/firefox/kifi.png"}}):e.location.href="/unsupported"},canInstall:o,installState:null,installedVersion:angular.element(document.documentElement).attr("data-kifi-ext"),hasMinimumVersion:function(e,i){var t=l.installedVersion;if(!t)return!1;if(!e)return!0;for(var r=t.split("."),n=(r.length>3&&i||e).split("."),a=0;a<r.length;a++){if(a>=n.length||+r[a]>+n[a])return!0;if(+r[a]<+n[a])return!1}return!1},isValidChrome:r&&o,isValidFirefox:n&&o,getPlatformName:function(){var e;return l.canInstall&&(l.isValidChrome?e="Chrome":l.isValidFirefox&&(e="Firefox")),e}};return l}]),angular.module("kifi").service("me",function(){return{replace:!0,restrict:"A",templateUrl:"profileCard/profileCard.tpl.html",link:function(e){e.firstName="Joon Ho",e.lastName="Cho",e.description="Porting to Angular.js"}}}),function(){function e(e,i){return d.event([{event:e,properties:i}])}function i(e,i){var t=s.mixpanel;if(t){i=i||{};var r=i.origin||s.location.origin;l(t,e,r,i),o(t,e,r,i)}}function t(i,t){var o=s.mixpanel;o&&("path"in t&&!t.type&&(t.type=r(t.path),delete t.path),_.extend(t,{userStatus:a(),experiments:n()}),c.log("mixpanelService.eventTrack("+i+")",t),u.me&&u.me.id?e(i,t):o.track(i,t))}function r(e){for(var i in m)if(m[i].test(e))return i;return e}function n(){return _.without(u.me&&u.me.experiments||[],"fake","admin")}function a(){var e=u.me&&u.me.experiments||[];return e.indexOf("fake")>=0?"fake":e.indexOf("admin")>=0?"admin":"standard"}function o(i,t,l,d){if(f){var m=i.get_distinct_id&&i.get_distinct_id();try{l=l||s.location.origin,i.identify(f),c.log("mixpanelService.pageTrackForUser("+t+"):"+l),d=_.extend({type:d.type||r(t),origin:l,siteVersion:2,userStatus:a(),experiments:n()},d),e("user_viewed_page",d)}finally{m||i.identify(m)}}else{p.push(t);var g=function(e){if(e=e||u.me,e&&e.id){f=e;var t=p.slice();p.length=0,t.forEach(function(e){o(i,e,l,d)})}};u.me&&u.me.id?g():u.getMe().then(g)}}function l(e,i,t,n){c.log("mixpanelService.pageTrackForVisitor("+i+"):"+t),n=_.extend({type:n.type||r(i),origin:t,siteVersion:2},n),e.track("visitor_viewed_page",n)}angular.module("kifi").config(["$analyticsProvider",function(e){e.firstPageview(!1),e.registerPageTrack(i),e.registerEventTrack(t),e.settings.pageTracking.autoTrackVirtualPages=!1}]).run(["$window","$log","profileService","net",function(e,i,t,r){s=e,c=i,u=t,d=r}]);var s,c,u,d,f,p=[],m={yourKeeps:/^\/$/,yourFriends:/^\/connections$/,searchResults:/^\/find\b/,addFriends:/^\/invite$/}}(),angular.module("kifi").factory("modalService",["$compile","$rootScope","$templateCache","$timeout",function(e,i,t,r){function n(r){r=r||{};var n=r.template;if(n){var a=angular.element(t.get(n)),o=r.scope&&r.scope.$new()||i.$new();return r.modalData&&(o.modalData=r.modalData),e(a)(o),angular.element(".kf-app").append(a),l.push([a,o]),o}}function a(){var e=l.pop();if(e&&e.length>0&&e[0].length){var i=e[0],t=e[1];r(function(){t.$destroy()}),i.remove()}}function o(e){e=e||{},e.template="common/modal/genericErrorModal.tpl.html",n(e)}var l=[];return{open:n,close:a,openGenericErrorModal:o}}]),angular.module("kifi").factory("net",["env","$http","createExpiringCache",function(e,i,t){function r(e,r,n){function o(){return i({method:"GET",url:e+a(l,arguments),params:arguments[(l.length-1)/2],cache:c})}var l=r.split(s),c=n&&t(r,n);return c&&(o.clearCache=angular.bind(c,c.removeAll)),o}function n(e,t,r){var n=r.split(s);return function(){var r=a(n,arguments),o=(n.length-1)/2,l="POST"===e?arguments[o++]:void 0,s=arguments[o++];return i({method:e,url:t+r,params:s,data:l})}}function a(e,i){if(1===e.length)return e[0];for(var t=e.slice(),r=1;r<e.length;r+=2)t[r]=i[(r-1)/2];return t.join("")}var o=e.xhrBase,l=e.xhrBaseSearch,s=/(:\w+)/,c=angular.bind(null,n,"POST"),u=angular.bind(null,n,"DELETE");return{event:c(o,"/events"),getLibraryInfos:r(o,"/libraries",30),getLibraryInfoById:r(o,"/libraries/:id/summary",30),getLibraryByUserSlug:r(o,"/users/:username/libraries/:slug?showPublishedLibraries=1",30),getLibraryById:r(o,"/libraries/:id",30),getKeep:r(o,"/keeps/:id"),getKeepsInLibrary:r(o,"/libraries/:id/keeps",30),addKeepsToLibrary:c(o,"/libraries/:id/keeps"),copyKeepsToLibrary:c(o,"/libraries/copy"),moveKeepsToLibrary:c(o,"/libraries/move"),removeKeepFromLibrary:u(o,"/libraries/:id/keeps/:keepId"),removeManyKeepsFromLibrary:c(o,"/libraries/:id/keeps/delete"),getLibraryShareSuggest:r(o,"/libraries/:id/members/suggest?n=30",30),updateLibraryMembership:c(o,"/libraries/:id/members/:uid/access"),search:{search:r(l,"/search"),searched:c(l,"/search/events/searched"),resultClicked:c(l,"/search/events/resultClicked")},sendMobileAppSMS:c(o,"/sms")}}]),angular.module("kifi").factory("registrationService",["$http","$q","routeService",function(e,i,t){var r=["facebook"],n=function(n,a){return-1===r.indexOf(n)?i.reject("invalid_provider"):e.post(t.socialSignupWithToken(n),a).then(function(e){return e.data})},a=function(i){return e.post(t.socialFinalize,i).then(function(e){return e.data})},o=function(i){return e.post(t.emailSignup,i).then(function(e){return e.data})};return{socialRegister:n,socialFinalize:a,emailFinalize:o}}]),angular.module("kifi").factory("routeService",["env","URI",function(e,i){function t(t,r){return e.xhrBase+t+(r?i.formatQueryString(r):"")}function r(t,r){return e.navBase+t+(r?i.formatQueryString(r):"")}return{disconnectNetwork:function(i){return e.navBase+"/disconnect/"+i},linkNetwork:function(i){return e.navBase+"/link/"+i},uploadBookmarkFileToLibrary:function(e){return t("/libraries/"+e+"/import-file")},refreshNetworks:e.navBase+"/friends/invite/refresh",importStatus:t("/user/import-status"),prefs:t("/user/prefs"),importGmail:function(e){return r("/contacts/import",{redirectUrl:e||[]})},networks:t("/user/networks"),profileUrl:t("/user/me"),profileSettings:t("/user/settings"),emailInfoUrl:t("/user/email"),abooksUrl:t("/user/abooks"),resendVerificationUrl:t("/user/resend-verification"),userPasswordUrl:t("/user/password"),userBiography:t("/user/me/biography"),formatPicUrl:function(i,t,r){return e.picBase+"/users/"+i+"/pics/"+(r||200)+"/"+t},pageTags:function(e,i,r){return t("/collections/page",{sort:e,offset:i,pageSize:r})},searchTags:function(e,i){return t("/collections/search",{query:e,limit:i})},suggestTags:function(e,i,r){return t("/libraries/"+e+"/keeps/"+i+"/tags/suggest",{q:r})},deleteTag:function(e){return t("/collections/"+e+"/delete")},undeleteTag:function(e){return t("/collections/"+e+"/undelete")},followingLibraries:"http://support.kifi.com/hc/en-us/articles/202657599-Following-Libraries",whoToInvite:t("/user/invite/recommended"),blockWtiConnection:t("/user/invite/hide"),friendRequest:function(i){return e.xhrBase+"/user/"+i+"/friend"},socialInvite:"/invite",connectTwitter:"/twitter/request",invite:t("/user/invite"),peopleYouMayKnow:function(e,i){return t("/user/friends/recommended",{offset:e,limit:i})},hideUserRecommendation:function(e){return t("/user/"+e+"/hide")},socialSearch:function(e,i){return t("/user/connections/all/search",{query:e,limit:i||6,pictureUrl:"true"})},exportKeeps:t("/keeps/export"),postDelightedAnswer:t("/user/delighted/answer"),cancelDelightedSurvey:t("/user/delighted/cancel"),userCloseAccount:t("/user/close"),adHocRecos:function(e){return t("/recos/adHoc",{n:e})},recos:function(e){return t("/recos/topV2",{recency:e.recency,uriContext:e.uriContext||[],libContext:e.libContext||[],trackLibDelivery:_.isBoolean(e.trackLibDelivery)?e.trackLibDelivery:[]})},recosPublic:function(){return t("/recos/public")},recoFeedback:function(e){return t("/recos/feedback",{id:e})},libraryRecos:function(){return t("/libraries/recos/top")},libraryRecoFeedback:function(e){return t("/libraries/recos/feedback",{id:e})},basicUserInfo:function(e,i){return t("/user/"+e,{friendCount:i?1:[]})},saveKeepNote:function(e,i){return t("/libraries/"+e+"/keeps/"+i+"/note")},socialSignup:function(e,i){var t={publicLibraryId:i.libraryId||[],intent:i.intent||[],libAuthToken:i.libAuthToken||[]};return r("/signup/"+e,t)},socialSignupWithToken:function(e){return r("/auth/token-signup/"+e)},socialFinalize:e.navBase+"/auth/token-finalize",emailSignup:e.navBase+"/auth/email-signup",createLibrary:t("/libraries/add"),modifyLibrary:function(e){return t("/libraries/"+e+"/modify")},shareLibrary:function(e){return t("/libraries/"+e+"/invite")},joinLibrary:function(e,i,r){return t("/libraries/"+e+"/join",{authToken:i||[],subscribed:null!=r?r?1:0:[]})},leaveLibrary:function(e){return t("/libraries/"+e+"/leave")},declineToJoinLibrary:function(e){return t("/libraries/"+e+"/decline")},deleteLibrary:function(e){return t("/libraries/"+e+"/delete")},updateSubscriptionToLibrary:function(e,i){return t("/libraries/"+e+"/subscription",{subscribed:i?1:0})},uploadLibraryCoverImage:function(e,i,r,n){return t("/libraries/"+e+"/image/upload",{x:i,y:r,is:n||[]})},positionLibraryCoverImage:function(e){return t("/libraries/"+e+"/image/position")},removeLibraryCoverImage:function(e){return t("/libraries/"+e+"/image")},getLibraryCoverImages:function(e,i,r){return t("/libraries/"+e.join(".")+"/images",{is:i&&r?i+"x"+r:[]})},authIntoLibrary:function(e,i,r){return t("/users/"+e+"/libraries/"+i+"/auth",{authToken:r||[]})},copyKeepsFromTagToLibrary:function(e,i){return t("/libraries/"+e+"/importTag",{tag:i})},moveKeepsFromTagToLibrary:function(e,i){return t("/libraries/"+e+"/moveTag",{tag:i})},getMoreLibraryMembers:function(e,i,r){return t("/libraries/"+e+"/members",{limit:i,offset:r*i})},getRelatedLibraries:function(e){return t("/libraries/"+e+"/related")},getUserProfile:function(e){return t("/user/"+e+"/profile")},getUserLibraries:function(e,i,r,n){return t("/user/"+e+"/libraries",{filter:i,page:_.isUndefined(r)?[]:r,size:_.isUndefined(n)?[]:n})},getProfileConnections:function(e,i){return t("/users/"+e+"/connections",{n:i||[]})},getProfileFollowers:function(e,i){return t("/users/"+e+"/followers",{n:i||[]})},getProfileUsers:function(e){return t("/users/"+e.join("."))},getMutualConnections:function(e){return t("/users/"+e+"/connections/mutual")},getPersonas:function(){return t("/user/personas")},addPersona:function(e){return t("/user/personas/"+e)},removePersona:function(e){return t("/user/personas/"+e)}}}]),angular.module("kifi").factory("scrollbar",["$document",function(e){function i(){var i=e[0],t=i.createElement("p");t.style.width="100%",t.style.height="200px";var r=i.createElement("div");r.style.position="absolute",r.style.top="0px",r.style.left="0px",r.style.visibility="hidden",r.style.width="200px",r.style.height="150px",r.style.overflow="hidden",r.appendChild(t),i.body.appendChild(r);var n=t.offsetWidth;r.style.overflow="scroll";var a=t.offsetWidth;return n===a&&(a=r.clientWidth),i.body.removeChild(r),n-a}var t=null;return{getWidth:function(){return null==t&&(t=i()),t}}}]),angular.module("kifi").provider("$twitter",function(){function e(e,r){return void 0===r?t[e]:(t[e]=r,i)}var i=this,t={};this.option=function(r,n){return"object"==typeof r?(angular.extend(t,r),i):e(r,n)};var r,n,a,o,l;this.$get=["$window","$timeout","$q",function(e,t,r){return l=r,a=e,o=t,i}],this.loading=!1,this.loaded=!1,this.twttr=null,this.failedToLoad=!1,this.load=function(){if(!n){var e=a,t=l.defer(),s=function(){i.twttr||!i.loading||i.loaded||(i.loading=!1,i.failedToLoad=!0,document.getElementById("twitter-wjs").remove(),t.reject({error:"no_twitter_on_page"}),n=null)};e.twttr=function(i,t,r){var n,a,o=i.getElementsByTagName(t)[0];if(!i.getElementById(r))return a=i.createElement(t),a.id=r,a.src="https://platform.twitter.com/widgets.js",a.addEventListener("error",s),o.parentNode.insertBefore(a,o),e.twttr||(n={_e:[],ready:function(e){n._e.push(e)}})}(document,"script","twitter-wjs"),e.twttr.ready=function(){r=i.twttr=e.twttr,i.loading=!1,i.loaded=!0,o(function(){t.resolve(r)})},i.loading=!0,n=t.promise}return n},this.refreshWidgets=function(){return r.widgets.load()},this.initialized=!1}),angular.module("kifi").factory("undoService",["$timeout",function(e){function i(){r&&e.cancel(r),n=t=r=null}var t,r,n=null;return{add:function(a,o,l){i(),n=a,t=o,r=e(function(){r=null,i()},l||3e4)},clear:i,getMessage:function(){return n},undo:function(){var e=t&&t.call();return i(),e}}}]),angular.module("kifi").factory("userService",["$http","$q","$rootScope","$stateParams","routeService",function(e,i,t,r,n){return{getBasicUserInfo:function(t,r){var a=i.defer();return e.get(n.basicUserInfo(t,r)).then(function(e){a.resolve(e)},function(e){a.reject(e)}),a.promise}}}]),angular.module("util",[]).constant("util",function(){var e=/^(?:https?:\/\/)?(?:youtu\.be|(?:www\.)?youtube(?:-nocookie)?\.com)\/(?:|user\/[^\/?#]+)?(?:|.*?[\/=])([a-zA-Z0-9_-]{11})\b/,i=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+$/,t=/(?: \s+|[\t\r\n\f]\s*)/g,r=/( \S{1,10})-(?=\S{1,10} )/g,n=/[!-\/:-@[-`{-~]/,a=["libraries","connections","followers","keeps","tags"],o={startsWith:function(e,i){return e===i||0===e.lastIndexOf(i,0)},startsWithCaseInsensitive:function(e,i){return o.startsWith(e.toLowerCase(),i.toLowerCase())},endsWith:function(e,i){return e===i||-1!==e.indexOf(i,e.length-i.length)},trimInput:function(e){return e?e.trim().replace(/\s+/g," "):""},validateEmail:function(e){return i.test(e)},replaceArrayInPlace:function(e,i){e.length=0,e.push.apply(e,i)},replaceObjectInPlace:function(e,i){_.forOwn(e,function(i,t){delete e[t]}),_.forOwn(i,function(t,r){e[r]=i[r]})},$debounce:function(e,i,t,r){return _.debounce(function(){var t=e.$root.$$phase;"$apply"===t||"$digest"===t?i():e.$apply(i)},t,r)},getYoutubeIdFromUrl:function(i){var t=i.match(e);return t&&t[1]},formatTitleFromUrl:function(e){var i=document.createElement("a"),t=/[^.\/]+(?:\.[^.\/]{1,3})?\.[^.\/]+$/,r=/[^\/]+?(?=(?:\.[a-zA-Z0-9]{1,6}|\/|)$)/,n=/[\/._-]/g;i.href=e;var a=i.hostname,o=e.indexOf(a),l=a.match(t);l&&(o+=l.index,a=l[0]);var s=i.pathname,c=e.indexOf(s,o+a.length),u=s.match(r);return u&&(c+=u.index,s=u[0]),s=s.replace(n," ").trim(),a+(s?" · "+s:"")},validateUrl:function(e){return-1!==e.indexOf(".")},toCamelCase:function(e){for(var i="",t=0;t<e.length;t++)i+=0===t?e[t].toLowerCase():e[t].charAt(0).toUpperCase()+e[t].substr(1).toLowerCase();return i},preventOrphans:function(e,i,a){e=e.trim().replace(t," ").replace(r,"$1‑");var o=e.length,l=e.indexOf(" ",o-Math.floor(o*a)-1);if(l>=0)for(l=e.indexOf(" ",Math.max(l+2,o-i)),l>0&&" "===e.charAt(l-2)&&n.test(e.charAt(l-1))&&(l=e.indexOf(" ",l+2));l>0;)e=e.substr(0,l)+" "+e.substr(l+1),l=e.indexOf(" ",l+2);return e},generateSlug:function(e){var i=e.toLowerCase().replace(/[^\w\s-]|_/g,"").replace(/(\s|--)+/g,"-").replace(/^-/,"").substr(0,50).replace(/-$/,"");return a.indexOf(i)>=0?i+"-":i}};return o}()).constant("HTML",function(){function e(e){return a[e]}function i(i){return null==i?"":String(i).replace(n,e)}function t(e){return null==e?"":String(e).replace(o,"&quot;")}function r(e){return e.replace(l,"\n").replace(s,"")}var n=/[&<]/g,a={"&":"&amp;","<":"&lt;"},o=/"/g,l=/<(?:div[^>]*>(?:<br[^>]*><\/div>)?|br[^>]*>|\/div><div[^>]*>)/gi,s=/<\/div>/gi;return{escapeElementContent:i,escapeDoubleQuotedAttr:t,replaceLineBreakTagsWithChars:r}}()).factory("URI",["$location",function(){return _.once(function(e){var i={$$path:"",$$compose:e.$$compose};return{formatQueryString:function(e){return i.$$search=e,i.$$compose(),i.$$url}}})}()]).factory("linkify",["HTML",function(){return _.once(function(e){function i(i,t){if(t.indexOf("@",1)){for(var n=t.split(r),a=1;a<n.length;a+=2){var o=n[a];n[a]='<a href="mailto:'+e.escapeDoubleQuotedAttr(o)+'">'+e.escapeElementContent(o)+"</a>"}for(var l=0;l<n.length;l+=2)n[l]=i(n[l]);return n.join("")}return i(t)}function t(i,t){for(var r=t.split(n),a=1;a<r.length;a+=3){var o=r[a],l=r[a+1];if(!l&&o.indexOf("/")<0||"@"===r[a-1].slice(-1)){var s=r[a-1]+o,c=i(s);if(c.indexOf("</a>",c.length-4)>0){r[a]=c,r[a-1]=r[a+1]="";continue}}r[a]='<a target="_blank" rel="nofollow" href="'+(l?"":"http://")+e.escapeDoubleQuotedAttr(o)+'">'+e.escapeElementContent(o),r[a+1]="</a>"}for(a=0;a<r.length;a+=3)r[a]=i(r[a]);return r.join("")}var r=/(?:\b|^)([a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+)(?:\b|$)/,n=/(?:\b|^)((?:(https?|ftp):\/\/[^\s!"#%&'()*,\/:;?@[\\\]_{}\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]{4,}|(?:(?:[a-z0-9](?:[-a-z0-9]*[a-z0-9])?\.)+(?:a[c-gil-oq-uwxz]|b[abd-jmnoq-tvwyz]|c[acdf-ik-orsu-z]|d[dejkmoz]|e[ceghr-u]|f[ijkmor]|g[abd-ilmnp-uwy]|h[kmnrtu]|i[del-oq-t]|j[emop]|k[eghimnprwyz]|l[abcikr-vy]|m[acdeghk-z]|n[acefgilopruz]|om|p[ae-hk-nrstwy]|qa|r[eosuw]|s[a-eg-or-vxyz]|t[cdfghj-prtvwz]|u[agksyz]|v[aceginu]|w[fs]|y[etu]|z[amrw]|app|bi[doz]|boo|cab|ceo|com|da[dy]|eat|edu|esq|fly|foo|go[pv]|hiv|how|in[gkt]|kim|mil|mo[ev]|ne[tw]|ngo|on[gl]|ooo|org|pro|pub|re[dn]|rip|tax|tel|soy|top|uno|vet|wed|wtf|xxx|xyz|[a-z]{4,20})))(?::[0-9]{1,5})?(?:\/(?:[^\s()<>]*[^\s`!\[\]{};:.'",<>?«»()“”‘’]|\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\))*|\b|$))(?=[\s`!()\[\]{};:.'",<>?«»“”‘’]|$)/;return angular.bind(null,t,angular.bind(null,i,e.escapeElementContent))})}()]).factory("AB",["$window",function(){return _.once(function(e){return{chooseTreatment:function(i,t){try{var r=e.mixpanel.cookie.props.distinct_id,n=(r.id||r).replace(/[^\da-f]/gi,""),a=i.split("").map(function(e){return n[parseInt(e,32)]}).join(""),o=parseInt(a,16);return t[o%t.length]}catch(l){return null}}}})}()]).constant("KEY",{UP:38,DOWN:40,ENTER:13,ESC:27,TAB:9,DEL:46,F2:113,SPACE:32}),angular.module("kifi").directive("kfDelightedSurvey",["$timeout","$analytics","profileService",function(e,i,t){return{restrict:"A",replace:!0,scope:{hide:"="},templateUrl:"delighted/delightedSurvey.tpl.html",link:function(r,n){function a(){return{score:"npsScore",comment:"npsComment",end:"npsThanks"}[r.surveyStage]}function o(){r.hide()}function l(){t.postDelightedAnswer(+r.delighted.score||null,r.delighted.comment||null,s).then(function(e){s=e})}r.delighted={};var s=null;r.surveyStage="score",i.eventTrack("user_viewed_notification",{source:"site",type:a()}),r.$watch("delighted.score",function(){r.delighted.score&&(l(),r.surveyStage="comment",i.eventTrack("user_viewed_notification",{source:"site",type:a()}),e(function(){n.find(".kf-delighted-comment-area-input").focus()}))}),r.goBack=function(){r.delighted.score=null,r.surveyStage="score"},r.submitComment=function(){l(),r.surveyStage="end",i.eventTrack("user_viewed_notification",{source:"site",type:a()}),e(o,3e3)},r.cancelSurvey=function(){i.eventTrack("user_clicked_notification",{source:"site",action:"closed",type:a()}),t.cancelDelightedSurvey(),o()}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("delighted/delightedSurvey.tpl.html",'<div class="kf-delighted-wrap"><div class="kf-delighted-body"><div ng-switch="surveyStage"><div class="kf-delighted-score-chooser" ng-switch-when="score"><div class="kf-delighted-title">How likely are you to recommend Kifi to a friend?</div><div class="kf-delighted-options"><div class="kf-delighted-option-left-wrapper"><div class="kf-delighted-label">Not likely</div><label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="0">0</label></div><label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="1">1</label> <label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="2">2</label> <label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="3">3</label> <label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="4">4</label> <label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="5">5</label> <label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="6">6</label> <label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="7">7</label> <label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="8">8</label> <label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="9">9</label><div class="kf-delighted-option-right-wrapper"><label class="kf-delighted-option"><input type="radio" ng-model="delighted.score" name="delighted-score" value="10">10</label><div class="kf-delighted-label">Very likely</div></div></div></div><div class="kf-delighted-comment-area" ng-switch-when="comment"><div class="kf-delighted-title">Tell us why you chose {{delighted.score}}</div><textarea class="kf-delighted-comment-area-input" ng-model="delighted.comment" name="delighted-comment" placeholder="Enter a comment (optional)"></textarea><div class="kf-delighted-comment-actions"><button class="kf-delighted-comment-back dialog-cancel" ng-click="goBack()">Change score</button> <button class="kf-delighted-comment-submit" ng-click="submitComment()">Submit</button></div></div><div class="kf-delighted-end" ng-switch-when="end"><div class="kf-delighted-title">Thank you for your feedback!</div></div></div><div class="sprite sprite-close-x-icon kf-delighted-cancel" ng-click="cancelSurvey()"></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("errors/badToken.tpl.html",'<div class="kf-error-body-wrap"><div class="kf-error-header">This is a private library, and your invitation has expired.</div><p class="kf-error-para">To protect the privacy of the library creator, we expire invitations after&nbsp;7&nbsp;days or once they have been used.</p><p class="kf-error-para">Please ask the library owner to invite you again.</p></div>')}])}(),angular.module("kifi").directive("kfErrorNotFound",[function(){return{restrict:"A",templateUrl:"errors/notFound.tpl.html"}}]).directive("kfErrorBadToken",[function(){return{restrict:"A",templateUrl:"errors/badToken.tpl.html"}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("errors/notFound.tpl.html",'<div class="kf-error-body-wrap"><div class="kf-error-header">Whomp. We can’t find the page you’re looking for.</div><p class="kf-error-para">It may have been removed or had its name changed. In the meantime, check out our <a href="http://support.kifi.com/" class="kf-error-link">support center</a> or head back to our <a href="https://www.kifi.com/" class="kf-error-link">homepage</a>.</p><footer><a href="http://support.kifi.com/hc/en-us/requests/new" class="kf-error-link">Contact support</a> — <a href="https://www.kifi.com/" class="kf-error-link" target="_self">Homepage</a> — <a href="https://twitter.com/kifi" class="kf-error-link">@kifi</a></footer></div>')}])}(),
angular.module("kifi").factory("friendService",["$analytics","$http","$location","$q","$timeout","env","Clutch","routeService",function(e,i,t,r,n,a,o,l){function s(e){return e.data}var c={cacheDuration:2e4},u=new o(function(e,t){return i.get(l.peopleYouMayKnow(e,t)).then(function(e){return e&&e.data&&e.data.users?e.data.users:[]})},c),d={unSearchFriend:function(r){return i.post(a.xhrBase+"/user/"+r+"/exclude",{}).then(function(){e.eventTrack("user_clicked_page",{action:"hideFriendInSearch",path:t.path()})})},reSearchFriend:function(r){return i.post(a.xhrBase+"/user/"+r+"/include",{}).then(function(){e.eventTrack("user_clicked_page",{action:"unHideFriendInSearch",path:t.path()})})},acceptRequest:function(r){return i.post(a.xhrBase+"/user/"+r+"/friend",{}).then(function(){e.eventTrack("user_clicked_page",{action:"acceptRequest",path:t.path()})})},ignoreRequest:function(r){return i.post(a.xhrBase+"/user/"+r+"/ignoreRequest",{}).then(function(){e.eventTrack("user_clicked_page",{action:"ignoreRequest",path:t.path()})})},unfriend:function(r){return i.post(a.xhrBase+"/user/"+r+"/unfriend",{}).then(function(){e.eventTrack("user_clicked_page",{action:"unFriend",path:t.path()})})},getMutualConnections:function(e){return i.get(l.getMutualConnections(e)).then(s)},getPeopleYouMayKnow:function(e,i){function t(){u.get(e||0,i||10).then(function(e){e.length>0?a.resolve(e):0===o.length?a.resolve([]):n(function(){t()},o.shift())})}var a=r.defer(),o=[5e3,1e4];return t(),a.promise},hidePeopleYouMayKnow:function(e){return i.post(l.hideUserRecommendation(e))}};return d}]),angular.module("kifi").directive("kfPeopleYouMayKnow",["$log","$q","$rootScope","$timeout","friendService","socialService","inviteService","modalService","routeService","wtiService",function(e,i,t,r,n,a,o,l,s,c){return{replace:!0,restrict:"A",templateUrl:"friends/peopleYouMayKnow.tpl.html",link:function(e){function t(){return _.compact([a.facebook&&a.facebook.profileUrl?null:"fb",a.twitter&&a.twitter.profileUrl?null:"tw",a.gmail&&a.gmail.length?null:"gm"]).join(",")}var u={facebook:"Facebook",twitter:"Twitter",email:"email"};n.getPeopleYouMayKnow().then(function(t){e.people=t.map(function(e){var i=e.mutualFriends.length||0;return{id:e.id,fullName:e.firstName+" "+e.lastName,pictureUrl:s.formatPicUrl(e.id,e.pictureName,100),pictureName:e.pictureName,username:e.username,actionText:"Connect",clickable:!0,isKifiUser:!0,via:i>0?"":"Kifi",numMutualFriends:i,mutualFriends:e.mutualFriends}}),e.people.length<3&&(c.list.length>0?i.when(c.list):c.getMore()).then(function(){Array.prototype.push.apply(e.people,c.list.map(function(e){return{networkType:e.network,id:e.identifier,fullName:e.name,pictureUrl:e.pictureUrl||"https://www.kifi.com/assets/img/ghost.100.png",actionText:"Invite",clickable:!0,isKifiUser:!1,via:"email"===e.network&&e.identifier||u[e.network]}}))})}),e.action=function(e){e.clickable&&(e.clickable=!1,e.isKifiUser?o.friendRequest(e.id).then(function(){e.actionText="Sent!",r(function(){e.actionText="Resend",e.clickable=!0},4e3),o.expireSocialSearch()},function(){e.actionText="Error. Retry?",e.clickable=!0,o.expireSocialSearch()}):o.invite(e.networkType,e.id).then(function(){e.actionText="Sent!",r(function(){e.actionText="Resend",e.clickable=!0},4e3),o.expireSocialSearch()},function(){e.actionText="Error. Retry?",e.clickable=!0,o.expireSocialSearch()}))},e.remove=function(i){i.isKifiUser&&n.hidePeopleYouMayKnow(i.id),_.remove(e.people,function(e){return e===i})},e.showMutualFriends=function(e){e.mutualFriends.forEach(function(e){e.connections=e.numFriends}),l.open({template:"friends/seeMutualFriendsModal.tpl.html",modalData:e})},e.connect=function(e){a[{fb:"connectFacebook",tw:"connectTwitter",gm:"importGmail"}[e]]()},a.refresh().then(function(){e.$watch(t,function(i){e.network=i?_.sample(i.split(",")):null})})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("friends/peopleYouMayKnow.tpl.html",'<div class="kf-pymk"><div class="kf-pymk-top clearfix"><h2 class="kf-pymk-title">People you might find interesting</h2><div class="kf-pymk-person" ng-repeat="person in people | limitTo: 3"><a class="kf-pymk-image-a" href="{{person|profileUrl}}" kf-track-origin="pymk/pymk"><img class="kf-pymk-image" ng-src="{{person.pictureUrl}}" onerror="this.src=\'https://www.kifi.com/assets/img/ghost.100.png\'"></a><div class="kf-pymk-name">{{person.fullName}}</div><div class="kf-pymk-via">{{person.via}} <button class="kf-pymk-mutual" ng-if="person.numMutualFriends > 0" ng-click="showMutualFriends(person)"><ng-pluralize count="person.numMutualFriends" when="{\'one\': \'1 mutual connection\', \'other\': \'{} mutual connections\'}"></ng-pluralize></button></div><button class="kf-pymk-action" ng-click="action(person)" ng-class="{clickable: person.clickable}">{{person.actionText}}</button> <button class="kf-pymk-x" ng-click="remove(person)"></button></div></div><div class="kf-pymk-bottom"><button class="kf-pymk-network-btn" ng-click="connect(network)" ng-if="network"><span class="kf-pymk-network-icon svg-facebook-f" ng-if="network === \'fb\'"></span> <span class="kf-pymk-network-icon svg-twitter-white" ng-if="network === \'tw\'"></span> <span class="kf-pymk-network-icon svg-gmail-envelope" ng-if="network === \'gm\'"></span> <span class="kf-pymk-network-1">Find people you already know</span> <span class="kf-pymk-network-2" ng-switch="network"><span ng-switch-when="fb">Check my Facebook friends</span> <span ng-switch-when="tw">Check my Twitter contacts</span> <span ng-switch-when="gm">Check my Gmail contacts</span></span></button><div class="kf-pymk-network-other"><a class="kf-pymk-network-other-a" href="/invite" ng-if="network">Connect other address books</a> <a class="kf-pymk-network-other-a" href="/invite" ng-if="!network">See more &raquo;</a></div></div></div>')}])}(),angular.module("kifi").directive("kfSeeMutualFriends",["inviteService",function(e){return{replace:!0,restrict:"A",templateUrl:"friends/seeMutualFriends.tpl.html",require:"^kfModal",link:function(i,t,r,n){var a=i.modalData;_.assign(i,_.pick(a,"id","fullName","numMutualFriends","pictureName","username")),i.actionText=a.isFriend?"":"Connect",i.clickable=!0;var o=[],l=[];a.mutualFriends.forEach(function(e,i){l.push(e),i%2!==0&&(o.push(l),l=[]),i===a.mutualFriends.length-1&&l.length>0&&o.push(l)}),i.mutualFriendsPairs=o,i.addFriend=function(t){i.clickable&&(i.clickable=!1,e.friendRequest(t).then(function(){i.actionText="Sent!",e.expireSocialSearch()},function(){i.actionText="Error. Retry?",i.clickable=!0,e.expireSocialSearch()}))},i.close=function(){n.close()}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("friends/seeMutualFriends.tpl.html",'<div class="kf-mutual-friends"><div class="kf-mutual-friends-pymk"><a href="{{this|profileUrl}}" ng-click="close()" kf-track-origin="pymk/mutualFriends"><img class="kf-mutual-friends-image" title="{{fullName}}" ng-src="{{this|pic:200}}" onerror="this.src=\'https://www.kifi.com/assets/img/ghost.200.png\'"></a> <a href="javascript:" class="kf-mutual-friends-action" ng-click="addFriend(id)" ng-class="{clickable: clickable}" ng-if="actionText"><span class="sprite sprite-tag-new-plus-icon"></span>{{actionText}}</a><div class="kf-mutual-friends-pymk-info"><div class="kf-mutual-friends-pymk-number"><ng-pluralize count="numMutualFriends" when="{\'one\': \'1 mutual connection \', \'other\': \'{} mutual connections \'}"></ng-pluralize>with</div><div class="kf-mutual-friends-pymk-name">{{fullName}}</div></div></div><div class="kf-mutual-friends-friends" kf-wheel-allow=""><div ng-repeat="mutualFriendPair in mutualFriendsPairs" class="kf-mutual-friend-pair"><div ng-repeat="mutualFriend in mutualFriendPair" class="kf-mutual-friend-card"><a href="{{mutualFriend|profileUrl}}" ng-click="close()" kf-track-origin="pymk/mutualFriends"><img class="kf-mutual-friends-image" title="{{mutualFriend|name}}" ng-src="{{mutualFriend|pic:200}}" onerror="this.src=\'https://www.kifi.com/assets/img/ghost.200.png\'"></a><div class="kf-mutual-friend-card-info"><a class="kf-mutual-friend-card-name" href="{{mutualFriend|profileUrl}}" ng-click="close()" kf-track-origin="pymk/mutualFriends">{{mutualFriend|name}}</a><div><ng-pluralize count="mutualFriend.connections" when="{\'one\': \'1 connection \', \'other\': \'{} connections \'}"></ng-pluralize>on Kifi</div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("friends/seeMutualFriendsModal.tpl.html",'<div kf-modal="" class="kf-see-mutual-friends-modal" kf-width="600px"><div kf-basic-modal-content="" without-buttons=""><div kf-see-mutual-friends=""></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("friends/unfriendConfirmModal.tpl.html",'<div kf-modal=""><div kf-basic-modal-content="" with-cancel="true" title="Remove connection?" with-warning="" action="reallyUnfriend()">If you remove this connection with {{friend.firstName}}:<ul class="kf-unfriend-confirm-ul"><li>You’ll no longer see each other’s keeps in search results.</li><li>You’ll no longer be able to send messages to each other.</li></ul></div></div>')}])}(),angular.module("kifi").directive("kfBannerMessage",["$timeout","undoService",function(e,i){return{restrict:"A",scope:{message:"=kfBannerMessage"},templateUrl:"header/bannerMessage.tpl.html",link:function(t){t.message&&e(function(){t.message=null},5e3),t.$watch(function(){return i.getMessage()},function(e){t.undoMessage=e}),t.undo=i.undo}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("header/bannerMessage.tpl.html",'<div class="kf-bm" ng-if="undoMessage || message"><span class="kf-bm-box">{{undoMessage || message}} <a class="kf-bm-undo" href="javascript:" ng-click="undo()" ng-if="undoMessage">Undo</a></span></div>')}])}(),angular.module("kifi").controller("LoggedInHeaderCtrl",["$scope","$rootElement","$rootScope","$document","profileService","libraryService","$location","util","KEY","modalService","$timeout","$state",function(e,i,t,r,n,a,o,l,s,c,u,d){function f(){e.search.transitionOff=!1}function p(){e.search.libraryChip=!1}function m(){e.search.libraryChip=!!e.library}function g(i){if(!i.isDefaultPrevented())switch(i.which){case s.ENTER:!i.metaKey||i.shiftKey||i.altKey||i.ctrlKey||(i.preventDefault(),e.$apply(function(){e.addKeeps()}));break;case 191:i.metaKey||i.shiftKey||i.altKey||i.ctrlKey||angular.element(document.activeElement).is("input,textarea,[contenteditable],[contenteditable] *")||(i.preventDefault(),angular.element(".kf-lih-search-input").focus())}}e.search={text:d.params.q||"",focused:!1,suggesting:!1,libraryChip:!1},e.me=n.me,u(function(){e.calloutVisible=n.prefs.site_notify_libraries_in_search&&!e.search.text&&!e.search.suggesting},2400),e.closeCallout=function(){e.calloutVisible=!1,n.prefs.site_notify_libraries_in_search=!1,n.savePrefs({site_notify_libraries_in_search:!1})},[t.$on("libraryOnPage",function(i,t){e.library=t,e.search.libraryChip=!!t}),t.$on("$stateChangeStart",function(){e.search.transitionOff=!0,e.calloutVisible=!1}),t.$on("$stateChangeSuccess",function(i,t,r){e.search.text="library.search"===t.name||"search"===t.name?r.q:"",u(f,300)}),t.$on("$stateChangeError",function(){u(f,300)}),t.$on("triggerAddKeep",function(){e.addKeeps()})].forEach(function(i){e.$on("$destroy",i)}),e.onInputFocus=function(){e.search.suggesting||e.search.focused||(e.calloutVisible&&e.closeCallout(),e.search.suggesting=!0),e.search.focused=!0},e.onInputBlur=function(i){var t=document.activeElement===i.target;e.search.focused=t,e.search.suggesting=t,t||e.search.text||m()},e.onMouseDownLibX=function(e){angular.element(document.activeElement).hasClass("kf-lih-search-input")&&(e.preventDefault(),p())},e.onClickLibX=function(){p(),u(function(){angular.element(".kf-lih-search-input").focus()})},e.onQueryChange=function(){e.search.suggesting=!0},e.$on("$destroy",t.$on("newQueryFromLocation",function(i,t){e.search.text=t})),e.onSearchBarClicked=function(){e.library&&t.$emit("trackLibraryEvent","click",{action:"clickedSearchBar"})},e.clearInput=function(i){e.search.text="",e.search.suggesting=!1,d.is("search")?d.go("home"):d.is("library.search")&&d.go("^.keeps"),m(),i&&i.preventDefault()},e.onKeydown=function(i){switch(i.which){case 8:""===e.search.text&&p();break;case 27:!e.search.suggesting||"search"!==d.current.name&&"library.search"!==d.current.name?(e.clearInput(),u(function(){angular.element(document.activeElement).filter(".kf-lih-search-input").blur()})):(e.search.suggesting=!1,e.search.text=d.params.q,m())}},e.addKeeps=function(){var i=e.library;c.open({template:"keeps/addKeepModal.tpl.html",modalData:{selectedLibId:i&&a.isMyLibrary(i)&&i.id}})},r.on("keydown",g),e.$on("$destroy",function(){r.off("keydown",g)})}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("header/loggedInHeader.tpl.html",'<div class="kf-lih" ng-controller="LoggedInHeaderCtrl"><div class="kf-lih-inner"><div class="kf-lih-left"><a class="kf-lih-logo svg-kifi-clover-white-text" ui-sref="home"></a><div class="kifi-guide-target-1"></div></div><div class="kf-lih-center"><label class="kf-lih-search kifi-guide-target-2 kifi-guide-1" ng-class="{\'kf-lit\': search.focused || search.text, \'kf-instant\': search.transitionOff}"><span class="kf-lih-search-left"><span class="kf-lih-search-icon svg-search-icon-gray"></span> <span class="kf-lih-search-icon-lit svg-search-icon-blue"></span> <a class="kf-lih-search-lib-owner-img" ng-if="search.libraryChip" style="background-image:url({{library.owner|pic:100}})" href="{{library.owner|profileUrl}}" title="{{library.owner|name}}"></a> <span class="kf-lih-search-lib-name" ng-if="search.libraryChip" style="background-color:{{library.color}}">{{library.name}}</span> <a class="kf-lih-search-lib-x" ng-if="search.libraryChip" style="background-color:{{library.color}}" ng-mousedown="onMouseDownLibX($event)" ng-click="onClickLibX()" href="javascript:">&times;</a></span> <span class="kf-lih-search-center"><input class="kf-lih-search-input" type="text" placeholder="Search" ng-model="search.text" ng-focus="onInputFocus()" ng-blur="onInputBlur($event)" ng-change="onQueryChange()" ng-keydown="onKeydown($event)" ng-click="onSearchBarClicked()"></span> <span class="kf-lih-search-right" ng-if="search.text"><button class="kf-lih-search-clear" ng-click="clearInput($event)">Clear</button></span></label><div class="kf-lih-search-suggestions" kf-search-suggest="search" library-id="library.id" ng-if="search.suggesting"></div><div class="kf-callout-search kf-callout-bubble kf-callout-bubble-bottom" ng-if="calloutVisible"><p>We’ve tidied up a bit.</p><p>You can now click the search bar or<br>press <span class="kf-callout-key">/</span> to access your libraries.<div class="kf-callout-bubble-action"><button class="kf-callout-bubble-button" ng-click="closeCallout()">Got it</button></div></p></div></div><div class="kf-lih-right kifi-guide-target-3 kifi-guide-2"><button class="kf-lih-add-link sprite sprite-add-link" ng-click="addKeeps()">Add a link</button> <a href="/tags/manage" class="kf-lih-tags"><span class="svg-tag-white"></span>Manage tags</a><div class="kf-lih-dropdown-parent" kf-click-menu=""><button class="kf-lih-friends"><span class="svg-friends-white"></span>Connections</button><menu class="kf-dropdown-menu"><a class="kf-dropdown-menu-item" href="{{me|profileUrl:\'connections\'}}">Your Kifi connections</a> <a class="kf-dropdown-menu-item" href="/invite">Invite someone to Kifi</a></menu></div><a class="kf-lih-settings" ui-sref="settings"><span class="svg-settings-gear-filled-white"></span>Settings</a><div class="kf-lih-dropdown-parent" kf-click-menu=""><button class="kf-lih-profile" style="background-image:url({{me|pic:100}})">Profile actions</button><menu class="kf-dropdown-menu"><a class="kf-dropdown-menu-item" href="{{me|profileUrl}}">Your Profile</a> <a class="kf-dropdown-menu-item" ui-sref="settings">Settings</a> <a class="kf-dropdown-menu-item" href="/logout" target="_top">Log out</a></menu></div></div></div><span style="position: fixed; top: 10px; left: 5px; font-size:20px; color:white;">{{orgName}}</span></div>')}])}(),angular.module("kifi").controller("LoggedOutHeaderCtrl",["$scope","$rootScope","$state","$timeout","$location","$document","signupService","platformService","libraryService","util",function(e,i,t,r,n,a,o,l,s,c){function u(){t.is("library.search")?i.$emit("searchTextUpdated",e.search.text,e.library.url):t.go("library.search",{q:e.search.text})}function d(e){191===e.which&&(e.metaKey||e.shiftKey||e.altKey||e.ctrlKey||e.isDefaultPrevented()||angular.element(document.activeElement).is("input,textarea,[contenteditable],[contenteditable] *")||(e.preventDefault(),angular.element(".kf-loh-search-input").focus()))}e.library=null,e.search={text:"",focused:!1},e.clickLogo=function(){c.startsWith(t.current.name,"library")?e.$emit("getCurrentLibrary",{callback:function(e){e&&e.id&&s.trackEvent("visitor_clicked_page",e,{type:"libraryLanding",action:"clickedLogo"})}}):c.startsWith(t.current.name,"userProfile")&&i.$emit("trackUserProfileEvent","click",{action:"clickedLogo"})},[i.$on("libraryOnPage",function(i,r){e.library=r,t.params&&t.params.q&&c.startsWith(t.params.q,"tag:")&&(e.search.text=t.params.q)}),i.$on("$stateChangeSuccess",function(i,t,r){e.search.text="library.search"===t.name?r.q:""})].forEach(function(i){e.$on("$destroy",i)}),e.onInputFocus=function(){e.search.focused=!0},e.onInputBlur=function(i){e.search.focused=document.activeElement===i.target},e.search.text=t.params.q||"",e.onQueryChange=c.$debounce(e,u,250),e.$on("$destroy",i.$on("newQueryFromLocation",function(i,t){e.search.text=t})),e.onSearchBarClicked=function(){e.library&&e.library.id&&i.$emit("trackLibraryEvent","click",{action:"clickedSearchBar"})},e.clearInput=function(){e.search.text="",u()},e.onKeydown=function(i){switch(i.keyCode){case 27:e.clearInput(),r(function(){angular.element(document.activeElement).filter(".kf-loh-search-input").blur()})}},e.join=function(r){r.preventDefault();var n=l.isSupportedMobilePlatform();c.startsWith(t.current.name,"library")?e.$emit("getCurrentLibrary",{callback:function(e){var i;e&&e.id&&(i={libraryId:e.id},s.trackEvent("visitor_clicked_page",e,{type:"libraryLanding",action:"clickedSignupHeader"})),n?l.goToAppOrStore():o.register(i)}}):c.startsWith(t.current.name,"userProfile")&&(i.$emit("trackUserProfileEvent","click",{action:"clickedSignupHeader"}),n?l.goToAppOrStore():o.register())},e.login=function(r){var n=l.isSupportedMobilePlatform();n&&r.preventDefault(),c.startsWith(t.current.name,"library")?e.$emit("getCurrentLibrary",{callback:function(e){e&&e.id&&s.trackEvent("visitor_clicked_page",e,{type:"libraryLanding",action:"clickedLoginHeader"}),n&&l.goToAppOrStore()}}):c.startsWith(t.current.name,"userProfile")&&(i.$emit("trackUserProfileEvent","click",{action:"clickedLoginHeader"}),n&&l.goToAppOrStore())},a.on("keydown",d),e.$on("$destroy",function(){a.off("keydown",d)})}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("header/loggedOutHeader.tpl.html",'<div class="kf-loh" ng-controller="LoggedOutHeaderCtrl"><div class="kf-loh-inner" ng-class="{\'kf-lit\': search.focused || search.text}"><div class="kf-loh-left"><a class="kf-loh-logo svg-kifi-clover-dark-text" href="/" target="_self" ng-click="clickLogo()"></a> <span class="kf-loh-tagline">Connecting people<br>with knowledge</span></div><div class="kf-loh-center" ng-if="library"><label class="kf-loh-search"><span class="kf-loh-search-left" style="background-color:{{library.color}}"><span class="kf-loh-search-icon svg-search-icon-gray"></span> <span class="kf-loh-search-lib-icon svg-search-icon-white"></span> <span class="kf-loh-search-lib"><a class="kf-loh-search-lib-owner-img" style="background-image:url({{library.owner | pic:100}})" href="{{library.owner|profileUrl}}" title="{{library.owner|name}}"></a> {{library.name}}</span></span> <span class="kf-loh-search-center"><input class="kf-loh-search-input" type="text" placeholder="Search this library…" ng-model="search.text" ng-focus="onInputFocus()" ng-blur="onInputBlur($event)" ng-change="onQueryChange()" ng-keydown="onKeydown($event)" ng-click="onSearchBarClicked()"></span> <span class="kf-loh-search-right" ng-if="search.text"><button class="kf-loh-search-clear" ng-click="clearInput()">Clear</button></span></label></div><div class="kf-loh-right"><div class="kf-loh-links"><a class="kf-loh-link" ng-click="join($event)" href="/signup" target="_self">Join Kifi</a> <span class="kf-loh-dot">&middot;</span> <a class="kf-loh-link" ng-click="login($event)" href="/login" target="_self" rel="nofollow">Log in</a></div></div></div></div>')}])}(),angular.module("kifi").directive("kfSearchSuggest",["$state","$document","$location","$timeout","searchSuggestService","libraryService","profileService","KEY",function(e,i,t,r,n,a,o,l){return{restrict:"A",scope:{search:"=kfSearchSuggest",libraryId:"="},templateUrl:"header/searchSuggest.tpl.html",link:function(r,s){function c(e){s.off("mousemove",c);var i=angular.element(e.target).closest(".kf-ssg-a:not(.kf-selected)");i.length&&(i.siblings(".kf-ssg-a.kf-selected").removeClass("kf-selected"),i.addClass("kf-selected"))}function u(e){if(!e.isDefaultPrevented()){var i;switch(e.which){case l.ENTER:i=s.find(".kf-ssg-a.kf-selected"),i.length&&(e.preventDefault(),h(i));break;case l.UP:case l.DOWN:e.preventDefault();var t=e.which===l.UP;i=s.find(".kf-ssg-a.kf-selected").removeClass("kf-selected"),i=i[t?"prevAll":"nextAll"](".kf-ssg-a").first(),(i.length?i:s.find(".kf-ssg-a")[t?"last":"first"]()).addClass("kf-selected"),s.on("mousemove",c)}}}function d(e,i){r.search.suggesting&&e!==i&&f()}function f(){var e=r.search.text.trimLeft();if(e){var i=r.search.libraryChip?r.libraryId:null;v&&(v=!1,r.libraries=null),r.working=!0,r.searchInLibrary=!!i,n.suggest(e,i).then(function(t){r.search.text.trimLeft()===e&&(r.search.libraryChip?r.libraryId:null)===i&&(r.resultsInLibrary=!!i,r.users=t.users&&t.users.hits,r.libraries=t.libraries&&t.libraries.hits,r.uris=t.uris&&t.uris.hits,r.$evalAsync(function(){s.find(".kf-selected").length||s.find(".kf-ssg-query").addClass("kf-selected")}))})["finally"](function(){r.search.text.trimLeft()===e&&(r.working=!1)})}else v=!0,r.working=!1,r.searchInLibrary=!1,r.resultsInLibrary=!1,r.uris=null,r.libraries=a.getOwnInfos().filter(p.bind(null,t.url())).sort(m).slice(0,7).map(g),r.users=null}function p(e,i){return i.url!==e}function m(e,i){for(var t=0;t<k.length;t++){var r=k[t],n=e[r],a=i[r];if(n)return(a||0)-n;if(a)return 1}return e.name<i.name?-1:e.name===i.name?0:1}function g(e){return _.assign({path:e.url,followerCount:e.numFollowers,keepCount:e.numKeeps},e)}function h(e){var i=e.attr("href");t.url()!==i&&("_blank"===e.prop("target")?(e[0].click(),r.search.text=""):r.$apply(function(){t.url(i)})),angular.element(document.activeElement).filter(".kf-lih-search-input").blur()}var v,k=["lastViewed","lastKept","numKeeps","numFollowers"];r.me=o.me,r.working=!1,r.searchInLibrary=!1,r.resultsInLibrary=!1,r.uris=null,r.libraries=null,r.users=null,r.href=angular.bind(e,e.href),r.$watch("search.text",d),r.libraryId&&r.$watch("search.libraryChip",d),s.on("mousemove",c),s.on("mouseenter",".kf-ssg-a",function(e){var i=angular.element(e.currentTarget);i.hasClass("kf-selected")||(i.siblings(".kf-ssg-a.kf-selected").removeClass("kf-selected"),i.addClass("kf-selected"))}),s.on("mousedown",function(e){e.preventDefault();var i=angular.element(e.target).closest(".kf-ssg-a");i.length&&h(i)}),i.on("keydown",u),r.$on("$destroy",function(){i.off("keydown",u)}),f()}}}]).factory("searchSuggestService",["Clutch","net",function(e,i){function t(e){return e.data}var r=new e(function(e,r){var n={q:e,l:r||[],maxUsers:3,maxLibraries:3,maxUris:3,is:"88x72"};return i.search.search(n).then(t)},{cacheDuration:15e3});return{suggest:r.get.bind(r)}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("header/searchSuggest.tpl.html",'<menu class="kf-ssg"><img class="kf-ssg-spinner" src="//d1dwdv9wd966qu.cloudfront.net/img/spinner_32.a3e788e.gif" ng-show="working"><div class="kf-ssg-group-title" ng-if="search.text">Keeps <span ng-if="resultsInLibrary">in this library</span></div><a class="kf-ssg-a kf-ssg-query kf-selected" ng-href="{{href(searchInLibrary ? \'library.search\' : \'search\', {q: search.text})}}" ng-if="search.text && (!uris || uris.length) || !libraries"><div class="kf-ssg-query-icon svg-search-icon-gray"></div>See all matching keeps <span ng-if="searchInLibrary">in this library</span></a> <a class="kf-ssg-a kf-ssg-uri" href="{{::uri.url}}" target="_blank" ng-repeat="uri in uris"><div class="kf-ssg-uri-thumb" ng-style="::{\'background-image\': uri.image ? \'url(\' + uri.image.url + \')\' : \'\'}"></div><div class="kf-ssg-uri-title">{{::uri.title}}</div><div class="kf-ssg-uri-domain">{{::uri.url|domain}}</div></a><div class="kf-ssg-no-results" ng-if="search.text && uris.length === 0">No matching keeps <span ng-if="resultsInLibrary">in this library</span></div><div class="kf-ssg-group-title" ng-if="libraries.length"><span ng-if="!search.text">Your</span> Libraries</div><a class="kf-ssg-a kf-ssg-lib" ng-class="::{\'kf-with-counts\': library.keepCount || library.followerCount}" href="{{::library.path}}" ng-repeat="library in libraries"><div class="kf-ssg-lib-card" ng-attr-style="background-color:{{library.color}}"></div><div class="kf-ssg-lib-icon" ng-class="::{\'svg-card-lock\': library.visibility === \'secret\', \'svg-card-star\': library.visibility === \'discoverable\'}" ng-if="::library.visibility !== \'published\'"></div><div class="kf-ssg-lib-owner-pic-wrap"><img class="kf-ssg-lib-owner-pic" ng-src="{{library.owner|pic:100}}"></div><div class="kf-ssg-lib-name">{{::library.name}}</div><div class="kf-ssg-lib-owner-name" ng-if="::!library.numCollaborators">{{::library.owner|name}}</div><div class="kf-ssg-lib-collaborators" ng-if="::library.numCollaborators"><svg class="kf-ssg-lib-collaborators-icon" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 19.3 12.3"><path ng-attr-fill="{{::library.color}}" d="M13.1,7c-0.3,0-0.5,0-0.9,0.1c1,0.7,1.7,1.7,1.7,2.9v2.1h5.2V10C19.1,8,15.1,7,13.1,7z M6.2,7c-2,0-6,1-6,3v2.1h12.1V10C12.2,8,8.2,7,6.2,7z M6.2,5.3c1.5,0,2.6-1.1,2.6-2.6c0-1.5-1.1-2.6-2.6-2.6S3.6,1.2,3.6,2.7C3.6,4.2,4.7,5.3,6.2,5.3z M13.1,5.3c1.5,0,2.6-1.1,2.6-2.6c0-1.5-1.1-2.6-2.6-2.6c-1.5,0-2.6,1.1-2.6,2.6C10.5,4.2,11.6,5.3,13.1,5.3z"></path></svg><span class="kf-ssg-lib-collaborator" ng-repeat="collab in ::[library.owner].concat(library.collaborators)">{{::collab.id === me.id ? \'Me\' : collab.firstName}}</span></div><div class="kf-ssg-lib-counts"><span ng-pluralize="" count="::library.keepCount" when="{\'one\': \'1 keep\', \'other\': \'{{::library.keepCount|number}} keeps\'}" ng-if="::library.keepCount"></span> <span ng-pluralize="" count="::library.followerCount" when="{\'one\': \'1 follower\', \'other\': \'{{::library.followerCount|number}} followers\'}" ng-if="::library.followerCount"></span></div></a> <a class="kf-ssg-a kf-ssg-my-libs kf-selected" href="{{::me|profileUrl:\'libraries\'}}" ng-if="!search.text && libraries">See all of your libraries</a><div class="kf-ssg-group-title" ng-if="users.length">People</div><a class="kf-ssg-a kf-ssg-user" ng-class="{\'kf-with-counts\': user.libraryCount || user.keepCount}" href="{{user|profileUrl}}" ng-repeat="user in users"><div class="kf-ssg-user-pic-wrap"><img class="kf-ssg-user-pic" ng-src="{{user|pic:100}}"></div><div class="kf-ssg-user-name">{{user.name}}</div><div class="kf-ssg-user-counts"><span ng-pluralize="" count="::user.libraryCount" when="{\'one\': \'1 library\', \'other\': \'{{::user.libraryCount|number}} libraries\'}" ng-if="::user.libraryCount"></span> <span ng-pluralize="" count="::user.keepCount" when="{\'one\': \'1 keep\', \'other\': \'{{::user.keepCount|number}} keeps\'}" ng-if="::user.keepCount"></span></div></a></menu>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("home/emailVerifiedModal.tpl.html",'<div kf-modal=""><div kf-basic-modal-content="" centered="true" title="Email verified" action-text="Continue">Thanks for verifying your email address.</div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("invite/cantFindFriend.tpl.html",'<div class="friend-not-found-modal"><div class="friend-not-found-heading">We couldn\'t find any connections matching</div><div class="friend-not-found-name">\'{{searchFriendName}}\'</div><div class="friend-not-found-sub-heading">How to fix it</div><ul><li ng-if="!hasNetworks()" class="friend-not-found-suggestion">You don’t have any networks connected to Kifi yet. <a class="friend-not-found-link" href="javascript:" ng-click="connectNetworks()">Get started by connecting.</a></li><li ng-if="hasNetworks()" class="friend-not-found-suggestion">Your connections list might not be up to date. <a class="friend-not-found-link" href="javascript:" ng-click="refreshFriends()">Try refreshing it.</a></li><li ng-if="hasNetworks()" class="friend-not-found-suggestion">Some of your connections may have privacy settings that prevent us from showing them.<br>Tell them to go to kifi.com and sign up.</li><li class="friend-not-found-suggestion">Or just <a class="friend-not-found-link" href="http://support.kifi.com/hc/en-us/requests/new">contact us.</a></li></ul></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("invite/cantFindFriendModal.tpl.html",'<div kf-modal="" kf-width="670px"><div kf-basic-modal-content="" action-text="Done" action="close()"><div kf-cant-find-friend=""></div></div></div>')}])}(),angular.module("kifi").directive("kfConnectionCard",["$window","$http","routeService","inviteService","modalService",function(e,i,t,r,n){return{scope:{friend:"&",showAddNetworksModal:"&"},replace:!0,restrict:"A",templateUrl:"invite/connectionCard.tpl.html",link:function(a){var o=a.friend(),l=o.network,s=o.identifier,c=null!=o.lastInvitedAt;if(o.pictureUrl?a.mainImage=o.pictureUrl:"email"===l?a.mainImage="//d1dwdv9wd966qu.cloudfront.net/img/email-icon.2f8a040.png":a.mainImage="https://www.kifi.com/assets/img/ghost.100.png",a.mainLabel=o.name,a.hidden=!1,a.facebook="facebook"===l,a.email="email"===l,a.twitter="twitter"===l,a.action=function(){r.invite(l,s).then(function(){a.invited=!0,a.actionText="Resend";var e="Invited just now";"email"===l?(a.byline=s,a.byline2=e):a.byline=e},function(){n.open({template:"invite/genericInviteErrorModal.tpl.html"})})},a.closeAction=function(){a.hidden=!0;var e={network:o.network,identifier:o.identifier};i.post(t.blockWtiConnection,e)},c){a.invited=!0,a.actionText="Resend";var u="Invited "+e.moment(new Date(o.lastInvitedAt)).fromNow();"email"===l?(a.byline=s,a.byline2=u):a.byline=u}else a.invited=!1,a.byline="email"===l?s:l.charAt(0).toUpperCase()+l.slice(1),a.actionText="Invite"}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("invite/connectionCard.tpl.html",'<div class="kf-connection-card" ng-class="{\'kf-connection-invited\': invited}" ng-hide="hidden"><img class="kf-connection-card-image" onerror="this.src=\'https://www.kifi.com/assets/img/ghost.100.png\'" ng-src="{{mainImage}}" ng-class="{\'kf-connection-card-email-image\': email}"><div class="kf-connection-card-who"><span class="kf-main-label" title="{{mainLabel}}">{{mainLabel}}</span> <span class="kf-byline-icon kf-icon-micro" ng-hide="email" ng-class="{\'kf-facebook-icon-micro\': facebook, \'kf-twitter-icon-micro\': twitter}"></span> <span class="kf-byline" title="{{byline}}">{{byline}}</span> <span class="kf-byline">{{byline2}}</span></div><span class="kf-connection-card-action" ng-class="{\'kf-connection-invited\': invited}" ng-click="action()"><span class="sprite sprite-tag-new-plus-icon" ng-if="actionText==\'Invite\'"></span> {{actionText}}</span> <span class="kf-connection-card-close" ng-click="closeAction()">✕</span></div>');
}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("invite/genericInviteErrorModal.tpl.html",'<div kf-modal="" class="generic-invite-error"><div kf-basic-modal-content="" action-text="Ok"><div>Sorry, an error occurred, please try again later.</div></div></div>')}])}(),angular.module("kifi").controller("InviteCtrl",["$scope","$http","$window","modalService","profileService","socialService","wtiService",function(e,i,t,r,n,a,o){t.document.title="Kifi • Invite your connections",e.$watch(a.checkIfRefreshingSocialGraph,function(i){e.isRefreshingSocialGraph=i}),a.checkIfUpdatingGraphs(2),e.whoToInvite=o.list,e.wtiLoaded=!1,e.$watch(function(){return o.list.length||!o.hasMore()},function(i){i&&(e.wtiLoaded=!0)}),e.wtiScrollDistance="100%",e.isWTIScrollDisabled=function(){return!o.hasMore()},e.wtiScrollNext=o.getMore,e.showAddNetworksModal=function(){r.open({template:"social/addNetworksModal.tpl.html"})}}]).directive("kfSocialInviteWell",[function(){return{scope:{showFindFriends:"="},replace:!0,restrict:"A",templateUrl:"invite/inviteWell.tpl.html",link:function(){}}}]).directive("kfSocialNetworksStatus",["modalService","socialService",function(e,i){return{scope:{},replace:!0,restrict:"A",templateUrl:"invite/socialNetworkStatus.tpl.html",link:function(t){t.numNetworks=i.networks.length,t.$watch(function(){return i.networks.length},function(e){t.numNetworks=e}),t.data=t.data||{},t.showAddNetworks=function(){e.open({template:"social/addNetworksModal.tpl.html"})},i.refresh()}}}]).directive("kfSocialInviteAction",["$log","inviteService","$timeout","$FB",function(e,i,t,r){return{restrict:"A",scope:{result:"=",onAfterInvite:"&"},replace:!0,transclude:!0,template:"<div ng-transclude></div>",link:function(n,a){var o={},l=a.find("div.clickable-target");l.click(function(e,i){n.invite(n.result,i)}),r.init(),n.invite=function(r,l){if(r=r||n.result,e.log("this person:",r),!o[r.socialId]){o[r.socialId]=!0;var s=l&&angular.element(l.target)||a.find("div.clickable-target");s.text("Sending"),s.parent().removeClass("clickable"),"fortytwo"===r.networkType||"fortytwoNF"===r.networkType?i.friendRequest(r.socialId).then(function(){s.text("Sent!"),t(function(){delete o[r.socialId],s.text("Resend"),s.parent().addClass("clickable")},4e3),i.expireSocialSearch(),"function"==typeof n.onAfterInvite&&n.onAfterInvite()},function(t){e.log("err:",t,r),delete o[r.socialId],s.text("Error. Retry?"),s.parent().addClass("clickable"),i.expireSocialSearch()}):i.invite(r.networkType,r.socialId).then(function(){s.text("Sent!"),t(function(){delete o[r.socialId],s.text("Resend"),s.parent().addClass("clickable")},4e3),i.expireSocialSearch(),"function"==typeof n.onAfterInvite&&n.onAfterInvite()},function(t){e.log("err:",t,r),delete o[r.socialId],s.text("Error. Retry?"),s.parent().addClass("clickable"),i.expireSocialSearch()})}}}}}]).directive("kfSocialInviteSearch",["$document","$log","inviteService","modalService",function(e,i,t,r){return{scope:{},replace:!0,restrict:"A",templateUrl:"invite/inviteSearch.tpl.html",link:function(i,n){function a(e){i.search.showDropdown&&!n.find(e.target)[0]&&i.$apply(function(){i.search.name="",i.search.showDropdown=!1})}i.search={},i.search.showDropdown=!1,i.data=i.data||{},i.results=[],i.selected=t.socialSelected,i.change=_.debounce(function(){t.socialSearch(i.search.name).then(function(e){var t=_.clone(e),r=_.filter(e,function(e){return e.network&&-1===e.network.indexOf("fortytwo")}).length;i.search.name.length>2&&(e.length<3||3>r)&&t.push({custom:"cant_find"}),i.results=t,t&&0!==t.length?i.search.showDropdown=!0:i.search.showDropdown=!1})},200),i.$on("$destroy",function(){e.off("click",a)}),e.on("click",a),i.showCantFindFriendModal=function(){i.search.showDropdown=!1,r.open({template:"invite/cantFindFriendModal.tpl.html",modalData:{searchFriendName:i.search.name}})}}}}]).directive("kfCantFindFriend",["modalService","socialService",function(e,i){return{replace:!0,restrict:"A",templateUrl:"invite/cantFindFriend.tpl.html",require:"^kfModal",link:function(t,r,n,a){t.close=a.close,t.hasNetworks=function(){return!!i.networks.length},t.refreshFriends=function(){t.close(),i.refreshSocialGraph()},t.connectNetworks=function(){t.close(),e.open({template:"social/addNetworksModal.tpl.html"})},t.searchFriendName=t.modalData.searchFriendName}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("invite/invite.tpl.html",'<div ng-controller="InviteCtrl"><div class="invite-wrapper kf-width-bounded" smart-scroll="" scroll-distance="wtiScrollDistance" scroll-disabled="isWTIScrollDisabled()" scroll-next="wtiScrollNext()"><div class="invite"><div kf-friend-request-banner=""></div><h2 class="invite-title">Find people to invite</h2><div class="import-wrapper" ng-if="isRefreshingSocialGraph"><div class="kf-bouncy-ball"><div class="pace pace-active"><div class="pace-progress"></div><div class="pace-activity"></div></div></div>Importing your contacts</div><div kf-social-networks-status=""></div><div kf-social-invite-well=""></div><div kf-networks-need-attention=""></div><div class="invite-list-header" ng-show="whoToInvite.length > 0">Recommended people to invite</div><div class="kf-connection-card-container"><div kf-connection-card="" ng-repeat="friend in whoToInvite" friend="friend"></div><span ng-click="wtiScrollNext()" ng-hide="isWTIScrollDisabled()" class="kf-show-more">Show more</span></div><div ng-if="whoToInvite.length < 6 && wtiLoaded" class="social-connect-friends"><div kf-social-connect-networks=""></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("invite/inviteSearch.tpl.html",'<div class="social-invite-search"><label class="social-invite-search-label"><input class="social-invite-search-input" type="text" ng-model="search.name" placeholder="Type a name or email address" ng-change="change($event)"> <span class="social-invite-search-icon svg-search-icon-gray"></span></label><ul class="social-invite-dropdown" ng-show="search.showDropdown"><li class="social-invite-element" ng-repeat="result in results" ng-class="\'social-invite-{{result.status === \'joined\' && result.network === \'fortytwoNF\' ? \'\' : result.status}}\'"><div ng-if="!result.custom"><div ng-if="result.networkType !== \'email\'"><a href="{{result|profileUrl}}"><img ng-src="{{result.image || \'https://www.kifi.com/assets/img/ghost.200.png\'}}" onerror="this.src=\'https://www.kifi.com/assets/img/ghost.200.png\'" class="social-invite-image"></a></div><div ng-if="!result.status"><div class="social-invite-summary"><div class="social-invite-name">{{result.label}}</div><div class="social-invite-network"><span class="social-network-icon kf-icon-micro" ng-class="result.iconStyle"></span>{{result.network}}</div></div><div kf-social-invite-action="" class="social-invite-action clickable" result="result"><div class="social-invite-button clickable-target" ng-click="invite(result, $event)"><span class="sprite sprite-tag-new-plus-icon"></span>Invite</div></div></div><div ng-if="result.status === \'joined\' && result.networkType === \'fortytwo\'"><div class="social-invite-summary"><div class="social-invite-name">{{result.label}}</div><div class="social-invite-network">Your connection on Kifi</div></div></div><div ng-if="result.status === \'requested\' && result.networkType === \'fortytwoNF\'"><div class="social-invite-summary"><div class="social-invite-name">{{result.label}}</div><div class="social-invite-network">Kifi user — request sent</div></div></div><div ng-if="result.status === \'joined\' && result.networkType === \'fortytwoNF\'"><div class="social-invite-summary"><div class="social-invite-name">{{result.label}}</div><div class="social-invite-network">Kifi user</div></div><div kf-social-invite-action="" class="social-invite-action clickable" result="result"><div class="social-invite-button user-add-button clickable-target" ng-click="invite(result, $event)"><span class="sprite sprite-tag-new-plus-icon"></span> Connect</div></div></div><div ng-if="result.status === \'invited\'"><div class="social-invite-summary"><div class="social-invite-name-long">{{result.label}}</div><div class="social-invite-network"><span class="social-network-icon kf-icon-micro" ng-class="result.iconStyle"></span>{{result.inviteText}}</div></div><div kf-social-invite-action="" class="social-invite-action clickable" result="result"><div class="social-invite-button clickable-target" ng-click="invite(result, $event)">Resend</div></div></div></div><div ng-if="result.custom === \'email\'"><img src="//d1dwdv9wd966qu.cloudfront.net/img/email-icon.2f8a040.png" class="social-invite-image cant-find"><div class="social-invite-summary"><div class="social-invite-name">Email to</div><div class="social-invite-network">{{result.label}}</div></div><div kf-social-invite-action="" class="social-invite-action clickable" result="result"><div class="social-invite-button clickable-target" ng-click="invite(result, $event)"><span class="sprite sprite-tag-new-plus-icon"></span> Invite</div></div></div><div ng-if="result.custom === \'cant_find\'" class="fill-parent clickable" ng-click="showCantFindFriendModal()"><img src="//d1dwdv9wd966qu.cloudfront.net/img/friend-missing@2x.7ef68c3.png" class="social-invite-image cant-find"><div class="social-invite-summary"><div class="social-invite-name social-invite-custom-email">Can\'t find your connection?</div></div></div><div class="clearfix"></div></li></ul></div>')}])}(),angular.module("kifi").factory("inviteService",["$http","$q","routeService","userService","util","Clutch","$window","$log","$analytics","$location","$FB",function(e,i,t,r,n,a,o,l,s,c,u){function d(e){e.socialId=e.value.split("/").splice(1).join("");var i=e.label.trim();if(e.label=i?i:e.socialId,e.network="email"===e.networkType?e.socialId:h[e.networkType]||e.networkType,e.iconStyle="kf-"+e.networkType+"-icon-micro",("fortytwo"===e.networkType||"fortytwoNF"===e.networkType)&&(e.image=t.formatPicUrl(e.socialId,e.image),r.getBasicUserInfo(e.socialId,!1).then(function(i){e.username=i.data.username})),"invited"===e.status){var n=o.moment(new Date(e.inviteLastSentAt)).fromNow();e.inviteText=n}return e}function f(e,i){if(/^[^@\s]+@[^@\s]+$/.test(e)){var t=i[i.length-1];if(t&&t.custom){if(t.label===e)return;i.pop()}var r=_.find(i,function(i){return"email"===i.networkType&&i.value.split("/").splice(1).join("")===e});r||(k.socialId=e,k.label=e,k.network=e,k.value="email/"+e,i.push(d(k)))}}var p,m,g=[],h={facebook:"Facebook",twitter:"Twitter"},v=new a(function(r){return r&&r.trim()?e.get(t.socialSearch(r)).then(function(e){var i=_.filter(e.data,function(e){return"twitter"!==e.networkType});return _.forEach(i,d),s.eventTrack("user_clicked_page",{action:"searchContacts",path:c.path()}),i}):i.when([])}),k={custom:"email",iconStyle:"kf-email-icon-micro",networkType:"email",status:""},b={socialSearch:function(e){return m=e,f(e,g),v.get(e).then(function(e){return f(m,e),n.replaceArrayInPlace(g,e),p=0===e.length?null:e[0].value,e})},expireSocialSearch:function(){v.expireAll()},inviteList:g,socialSelected:p,invite:function(r,n){function a(){e.post(t.invite,{id:r+"/"+n}).then(function(e){s.eventTrack("user_clicked_page",{action:"inviteFriend",platform:r,path:c.path()}),e.data.url&&"facebook"===r?(u.ui({method:"send",link:o.unescape(e.data.url),to:n}),d.resolve("")):e.data.error?(l.log(e.data.error),d.reject("generic_error")):d.resolve("")},function(e){throw l.log(e),e})}v.expireAll();var d=i.defer();return"facebook"===r&&u.FB?u.FB.getAuthResponse()?a():u.FB.login(function(e){e.authResponse&&a()}):("fortytwoNF"===r&&(r="fortytwo"),a()),d.promise},friendRequest:function(i){return s.eventTrack("user_clicked_page",{action:"addFriend",path:c.path()}),e.post(t.friendRequest(i)).then(function(e){return e.data})}};return b}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("invite/inviteWell.tpl.html",'<div class="social-invite-well"><span kf-social-invite-search=""></span> <a class="invite-well-find-friends-button" ng-if="showFindFriends" href="/invite">Find Connections <span class="invite-well-find-friends-icon sprite sprite-find-friends-icon"></span></a></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("invite/socialNetworkStatus.tpl.html",'<div class="social-networks-status"><span ng-click="showAddNetworks()">Connect social networks ({{numNetworks}} connected)</span></div>')}])}(),angular.module("kifi").factory("wtiService",["$http","routeService","Clutch","$q",function(e,i,t,r){var n=[],a=!0,o=0,l=20,s=new t(function(t){return e.get(i.whoToInvite+"?offset="+t+"&limit="+l).then(function(e){return 0===e.data.length?a=!1:(o+=l,e.data=_.filter(e.data,function(e){return"twitter"!==e.network}),n.push.apply(n,e.data)),e.data})}),c={getMore:function(){return s.get(o)},hasMore:function(){return a},loadInitial:function(){n.length=0,o=0,a=!0,s.expireAll();var e=c.getMore();return e.then(function(){return c.getMore()}),n.length>0?r.when(n):e},list:n};return c}]),angular.module("kifi").directive("kfKeepCard",["$analytics","extensionLiaison","util","installService","libraryService","modalService","keepActionService","undoService","$rootScope",function(e,i,t,r,n,a,o,l,s){function c(e,i,t){var r,n=e.imageUrl;if(n){var a=e.imageWidth,o=e.imageHeight,l=a/o;if(a>=.6*u)return{url:n,clipBottom:.8>l};if(a>=50&&o>=50){for(var s=(e.description||"").length/v,c=i.length/h,b=Math.min(a,k),y=b/l;b>=60&&y>=40;b-=20,y=b/l){y=Math.min(360,y);var w=d-f-b,C=Math.ceil(c*d/w),S=Math.ceil(s*d/w),$=g+p*C+m*S;if($>y){var L=Math.min(S-2,Math.ceil(($-y)/m));S-=L,$-=L*m}var x=y>$?(y-$)*w:($-y)*b;x<(r?r.penalty:1/0)&&(r={url:n,w:b,h:y,penalty:x,clipBottom:!0,maxDescLines:S})}return t||(r.w=r.h=null,r.maxDescLines=2),r}}}var u=496,d=u-40,f=20,p=24,m=20,g=38,h=75,v=48,k=.4*(d-f);return{restrict:"A",scope:{keep:"=kfKeepCard",galleryView:"=",boxed:"@",currentPageOrigin:"@",keepCallback:"&",clickCallback:"&"},replace:!0,templateUrl:"keep/keepCard.tpl.html",link:function(u){function d(){u.howKept=_.any(u.keep.keeps,_.identity)?_.all(u.keep.keeps,{visibility:"secret"})?"private":"public":null}!function(e){u.youtubeId=t.getYoutubeIdFromUrl(e.url),u.keepSource=e.siteName||e.url.replace(/^(?:[a-z]*:\/\/)?(?:www\.)?([^\/]*).*$/,"$1"),u.displayTitle=e.title||e.summary&&e.summary.title||t.formatTitleFromUrl(e.url),u.defaultDescLines=4;var i=function(i){u.image=u.youtubeId?null:c(e.summary,u.displayTitle,i),u.defaultDescLines=i?4:2};if(i(u.galleryView),u.$watch(function(){return u.galleryView},function(e){i(e)}),e.user&&_.remove(e.keepers,{id:e.user.id}),e.libraryId&&_.remove(e.libraries,function(i){return i[0].id===e.libraryId}),e.libraries){var r=_(e.libraries).reverse().indexBy(function(e){return e[1].id}).mapValues(0).value();_.each(e.keepers,function(e){e.library=r[e.id]});var n=_.indexBy(e.keepers,"id");_.each(e.libraries,function(i){var t=i[1];n[t.id]||(n[t.id]=t,t.library=i[0],e.keepers.push(t))})}_.remove(e.keepers,{pictureName:"0.jpg"})}(u.keep),s.$on("onWidgetLibraryClicked",function(e,i){u.onWidgetLibraryClicked(i.clickedLibrary)}),u.onWidgetLibraryClicked=function(e){if(u.keptToLibraryIds.indexOf(e.id)>=0){var i=_.find(u.keep.keeps,{libraryId:e.id});o.unkeepFromLibrary(e.id,i.id).then(function(){var i;e.id===u.keep.libraryId?u.keep.unkept=!0:i=_.remove(u.keep.keeps,{libraryId:e.id}),u.keep.keepersTotal--,n.addToLibraryCount(e.id,-1),u.$emit("keepRemoved",{url:u.keep.url},e),l.add("Keep deleted.",function(){o.keepToLibrary([{url:u.keep.url}],e.id).then(function(){i?u.keep.keeps.push(i[0]):u.keep.unkept=!1,u.keep.keepersTotal++,n.addToLibraryCount(e.id,1),u.$emit("keepAdded",[u.keep],e)})["catch"](a.openGenericErrorModal)})})["catch"](a.openGenericErrorModal)}else{var t=function(i){n.fetchLibraryInfos(!0),n.addToLibraryCount(e.id,1),u.keep.keeps=i.keeps,u.$emit("keepAdded",[i],e)};(u.keep.id?o.copyToLibrary([u.keep.id],e.id,u.galleryView).then(function(e){return e.successes.length>0?o.fetchFullKeepInfo(u.keep).then(t):void 0}):o.keepToLibrary([{title:u.keep.title,url:u.keep.url}],e.id).then(function(e){return e.failures&&e.failures.length||0!==e.alreadyKept.length?void 0:o.fetchFullKeepInfo(e.keeps[0]).then(t)}))["catch"](a.openGenericErrorModal)}},u.shareAction=function(){r.hasMinimumVersion("3.0.7")?i.openDeepLink(u.keep.url,"/messages:all#compose"):a.open({template:"common/modal/installExtensionModal.tpl.html",scope:u})},u.editKeepNote=function(e,i){s.$emit("editKeepNote",e,i)},u.trackTweet=function(){e.eventTrack("user_clicked_page",{type:"library",action:"clickedViewOriginalTweetURL"})},u.$watchCollection(function(){return _.pluck(u.keep.keeps,"visibility")},d),u.$watchCollection(function(){return _.pluck(u.keep.keeps,"libraryId")},function(e){u.keptToLibraryIds=e}),u.$watch(function(){return n.getOwnInfos().length},function(e){e&&(u.libraries=_.reject(n.getOwnInfos(),{id:u.keep.libraryId}))})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("keep/keepCard.tpl.html",'<div class="kf-keep-body" ng-class="::{\'kf-boxed\': boxed != null, \'kf-side-by-side\': image.w, \'kf-text-only\': !image && !youtubeId}"><div class="kf-keep-header" ng-if="!galleryView"><div class="kf-keep-header-l"><a class="kf-keep-keeper-pic" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}" ng-attr-style="background-image:url({{::keep.user|pic:100}})"></a> <a class="kf-keep-keeper-name" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}">{{::keep.user|name}}</a></div><div class="kf-keep-header-r"><time ng-attr-datetime="{{::keep.createdAt}}" am-time-ago="::keep.createdAt" title="{{::keep.createdAt|localTime}}" ng-if="::keep.createdAt"></time><button ng-attr-class="kf-keep-keep-btn {{howKept ? \'state-kept-\' + howKept : \'state-not-kept\'}}" kf-keep-to-library-widget="" widget-action-text="Keep" library-click-action="onWidgetLibraryClicked(clickedLibrary)" kept-to-library-ids="keptToLibraryIds" lib-select-down-offset="180" lib-select-left-offset="20"><span ng-attr-class="{{howKept ? howKept === \'private\' ? \'svg-small-lock\' : \'svg-hearts-green\' : \'svg-hearts-green-empty\'}}"></span> <span class="kf-hide-compact">{{howKept ? \'Kept\' : \'Keep\'}}</span></button> <button class="kf-keep-share-btn" ng-click="clickCallback({keep: keep, event: $event}); shareAction()" click-action="clickedShareArticle"><span class="svg-share-arrow-green"></span> <span class="kf-hide-compact">Share</span></button></div></div><div class="kf-keep-video" ng-if="::youtubeId" ng-click="clickCallback({keep: keep, event: $event})"><div kf-youtube="" video-id="youtubeId"></div><div class="kf-youtube-bottom-overlay"></div></div><a class="kf-keep-image" ng-if="::image" ng-class="::{\'kf-bottom-clip\': image.clipBottom}" ng-style="{\'background-image\': \'url(\\\'\' + image.url + \'\\\')\', width: image.w ? image.w + \'px\' : \'\', \'padding-top\': image.h ? image.h + \'px\' : \'\'}" ng-href="{{::keep.url}}" target="_blank" rel="nofollow" tabindex="-1" ng-click="clickCallback({keep: keep, event: $event})" click-action="clickedArticleImage"></a><div class="kf-keep-content"><div class="kf-keep-meta"><span class="kf-keep-source">{{::keepSource}}</span> <span class="kf-keep-length" ng-if="::keep.summary.wordCount > 0 && !youtubeId">{{::keep.summary.wordCount|timeToRead}} read</span></div><div class="kf-keep-title"><a class="kf-keep-title-link" ng-href="{{::keep.url}}" target="_blank" ng-click="clickCallback({keep: keep, event: $event})" rel="nofollow" click-action="clickedArticleTitle">{{displayTitle}}</a></div><div class="kf-keep-description" ng-hide="!galleryView && keep.note" kf-ellipsis="" full-text="keep.summary.description" max-num-lines="image.maxDescLines || defaultDescLines"></div><div class="kf-keep-note-icon" ng-if="::keep.note" ng-click="editKeepNote($event, keep)"><span class="svg-note-gray"></span></div><div class="kf-keep-note-compact" ng-bind-html="::keep.note|noteHtml" ng-if="::keep.note || keep.user.id === me.id"></div></div><div class="clearfix"></div><div class="kf-keep-footer"><div class="kf-keep-actions" ng-if="$root.userLoggedIn"><button ng-attr-class="kf-keep-keep-btn {{howKept ? \'state-kept-\' + howKept : \'state-not-kept\'}}" kf-keep-to-library-widget="" widget-action-text="Keep" library-click-action="onWidgetLibraryClicked(clickedLibrary)" kept-to-library-ids="keptToLibraryIds" lib-select-down-offset="180" lib-select-left-offset="20"><span ng-attr-class="{{howKept ? howKept === \'private\' ? \'svg-small-lock\' : \'svg-hearts-green\' : \'svg-hearts-green-empty\'}}"></span> <span class="kf-hide-compact">{{howKept ? \'Kept\' : \'Keep\'}}</span></button> <button class="kf-keep-share-btn" ng-click="clickCallback({keep: keep, event: $event}); shareAction()" click-action="clickedShareArticle"><span class="svg-share-arrow-green"></span> <span class="kf-hide-compact">Share</span></button></div><div class="kf-keep-who" ng-if="keep.keepersTotal || keep.keepers.length"><span class="kf-keep-who-pic-box" ng-repeat="keeper in keep.keepers | limitTo:6" kf-user-tooltip="::keeper" library="::keeper.library" desc="Your Kifi connection"><a class="kf-keep-who-pic" ng-attr-style="background-image:url({{::keeper|pic:100}})" ng-href="{{::keeper.library.path || \'/\' + keeper.username}}" kf-track-origin="{{::currentPageOrigin}}/alsoKeptBy"></a></span> <span class="kf-keep-who-num" ng-if="keep.keepersTotal > (keep.keepers.length || 0)">{{keep.keepersTotal - (keep.keepers.length || 0) | num}}</span></div></div></div>')}])}(),angular.module("kifi").directive("kfKeepToLibraryWidget",["$rootElement","$compile","$document","$filter","$rootScope","$templateCache","$timeout","$window","KEY","libraryService","util",function(e,i,t,r,n,a,o,l,s,c,u){return{restrict:"A",scope:{widgetActionText:"@",keptToLibraryIds:"=",librarySelectAction:"&",libraryClickAction:"&",widgetExitAction:"&",libSelectDownOffset:"=",libSelectMaxUpOffset:"=",libSelectLeftOffset:"="},link:function(r,n){function d(){n.on("click",function(){b()}),r.$on("$destroy",m)}function f(){o.cancel(F),o.cancel(T)}function p(){A.forEach(function(e){e.selected=!1})}function m(){p(),t.off("mousedown",h),f(),y&&y.remove(),_.isFunction(r.widgetExitAction)&&r.widgetExitAction()}function g(e){_.isFunction(r.librarySelectAction)&&r.librarySelectAction({selectedLibrary:e}),_.isFunction(r.libraryClickAction)&&r.libraryClickAction({clickedLibrary:e})}function h(e){return angular.element(e.target).closest(".keep-to-library-widget").length?angular.element(e.target).closest(".library-select-option").length?(F=o(m,200),void g(A[L])):void 0:void r.$apply(m)}function v(e){function i(){x=!0,T=o(function(){x=!1},200)}var t=r.widgetKeptInLibraries.length||r.widgetRecentLibraries.length?5:6,n=47*e,a=C.scrollTop(),l=a+47*t;a>n?(C.scrollTop(n),i()):n>l-47&&(C.scrollTop(n-47*(t-1)),i())}function k(e){e=e.slice();var i=c.getRecentIds();r.widgetKeptInLibraries=_.remove(e,function(e){return $.indexOf(e.id)>=0}),r.widgetRecentLibraries=_.remove(e,function(e){return i.indexOf(e.id)>=0}).sort(function(e,t){return i.indexOf(e.id)-i.indexOf(t.id)}),r.widgetOtherLibraries=e,A=r.widgetKeptInLibraries.concat(r.widgetRecentLibraries,r.widgetOtherLibraries),L=0,A.length&&(A[L].selected=!0)}function b(){y=angular.element(a.get("keep/keepToLibraryWidget.tpl.html")),e.find("html").append(y),i(y)(r),y.hide();var s=r.libSelectDownOffset||0,u=r.libSelectMaxUpOffset||1e3,d=r.libSelectLeftOffset||0,f=angular.element(l).scrollTop(),p=n.offset().top,m=l.innerHeight-p+f,g=p-f,v=angular.element(l).scrollLeft(),b=n.offset().left,x=l.innerWidth-b+v;o(function(){var e,i=y.width(),t=x-i+d>0?d:i-x,r=n.offset().left-t,a=y.height();e=u>=a-s?a-s:u,e=m-a+e>0?e:a-m,e=g-e>0?e:g;var l=n.offset().top-e;y.css({top:l+"px",left:r+"px"}),y.show(),o(function(){w.focus()},0)},0),L=0,$=r.keptToLibraryIds||[],r.search={},r.showCreate=!1,r.newLibrary={},r.$error={},C=y.find(".library-select-list"),w=y.find(".keep-to-library-search-input"),S=y.find(".keep-to-library-create-name-input"),E=c.getOwnInfos(),P=new Fuse(E,{keys:["name"],threshold:.3}),k(E),t.on("mousedown",h)}var y=null,w=null,C=null,S=null,$=[],L=0,x=!1,F=null,T=null,I=!1,E=[],A=[],P=null;r.onHover=function(e){x?x=!1:(p(),e.selected=!0,L=_.indexOf(A,e))},r.onUnhover=function(e){e.selected=!1},r.onSearchInputChange=function(e){var i=P.search(e);k(e?i:E)},r.processKeyEvent=function(e){function i(e,i){var t=e+i;return 0>t||t>A.length-1?e:t}switch(e.keyCode){case s.UP:e.preventDefault(),p(),L=i(L,-1),A[L].selected=!0,v(L);break;case s.DOWN:e.preventDefault(),p(),L=i(L,1),A[L].selected=!0,v(L);break;case s.ENTER:e.stopPropagation(),y.find(".library-select-option").length?(g(A[L]),m()):(r.newLibrary.name=r.search.name,r.showCreatePanel());break;case s.ESC:e.stopPropagation(),m()}},r.showCreatePanel=function(){r.showCreate=!0,y.find(".library-select-option").length||(r.newLibrary.name=r.search.name),o(function(){S.focus()},0)},r.hideCreatePanel=function(){r.showCreate=!1,o(function(){w.focus(),C.scrollTop(0)},0)},r.createLibrary=function(e){!I&&e.name&&(r.$error.name=c.getLibraryNameError(e.name),r.$error.name||(r.$error={},e.slug=u.generateSlug(e.name),e.visibility=e.visibility||"published",c.createLibrary(e,!0).then(function(e){c.fetchLibraryInfos(!0).then(function(){r.$evalAsync(function(){g(_.find(c.getOwnInfos(),{id:e.data.library.id}))})}),m()})["catch"](function(e){var i=e.data&&e.data.error;switch(i){case"library name already exists for user":case"library_name_exists":r.$error.general="You already have a library with this name";break;case"invalid library name":case"invalid_name":r.$error.general="You already have a library with this name";break;default:r.$error.general="Hmm, something went wrong. Try again later?"}})["finally"](function(){I=!1})))},r.$watch("newLibrary.name",function(e,i){e!==i&&(r.$error.name=null)}),d()}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("keep/keepToLibraryWidget.tpl.html",'<div class="keep-to-library-widget" kf-wheel-stop=""><div ng-hide="showCreate"><header ng-if="widgetActionText" class="keep-to-library-default-header">{{widgetActionText}} to a library</header><div class="keep-to-library-search"><span class="keep-to-library-search-input-icon svg-search-icon-gray"></span> <input class="keep-to-library-search-input" ng-model="search.name" ng-change="onSearchInputChange(search.name)" placeholder="Search your libraries" ng-keydown="processKeyEvent($event)"></div><div class="library-select-list" kf-wheel-allow=""><div ng-if="widgetKeptInLibraries.length" class="library-group-header kept-to-libraries-group-header">Kept In</div><ul ng-if="widgetKeptInLibraries.length" class="kf-kept-to"><li ng-repeat="library in widgetKeptInLibraries" class="library-select-option" ng-class="{\'selected\': library.selected}" ng-mouseenter="onHover(library)" ng-mouseleave="onUnhover(library)" ng-include="\'keep/keepToLibraryWidgetLibraryItem.tpl.html\'"></li></ul><div ng-if="widgetRecentLibraries.length" class="library-group-header my-libraries-group-header">Recent Libraries</div><ul ng-if="widgetRecentLibraries.length"><li ng-repeat="library in widgetRecentLibraries" class="library-select-option" ng-class="{\'selected\': library.selected}" ng-mouseenter="onHover(library)" ng-mouseleave="onUnhover(library)" ng-include="\'keep/keepToLibraryWidgetLibraryItem.tpl.html\'"></li></ul><div ng-if="widgetOtherLibraries.length && widgetRecentLibraries.length" class="library-group-header my-libraries-group-header">Other Libraries</div><div ng-if="widgetOtherLibraries.length && !widgetRecentLibraries.length" class="library-group-header my-libraries-group-header">My Libraries</div><ul ng-if="widgetOtherLibraries.length"><li ng-repeat="library in widgetOtherLibraries" class="library-select-option" ng-class="{\'selected\': library.selected}" ng-mouseenter="onHover(library)" ng-mouseleave="onUnhover(library)" ng-include="\'keep/keepToLibraryWidgetLibraryItem.tpl.html\'"></li></ul></div><div class="keep-to-library-create" ng-click="showCreatePanel()"><span class="keep-to-library-lib-icon-container"><span class="keep-to-library-lib-icon svg-add-a-library-icon"></span></span> Create new library</div></div><div ng-show="showCreate"><header class="keep-to-library-create-header"><span class="keep-to-library-back-arrow" ng-click="hideCreatePanel()"></span>Keep to a new library</header><div class="keep-to-library-create-heading">Name Your Library</div><div class="keep-to-library-create-name-input-container"><input class="keep-to-library-create-name-input" ng-model="newLibrary.name" placeholder="Inspiring videos, Recipes I love..."> <span ng-show="$error.name" class="keep-to-library-create-name-error">{{$error.name}}</span></div><div class="keep-to-library-create-heading">Make it private?</div><div class="keep-to-library-create-visibility"><span class="keep-to-library-create-visibility-switch" kf-library-visibility-checkbox="" library="newLibrary"></span> <span class="keep-to-library-create-visibility-explanation" ng-switch="newLibrary.visibility"><span ng-switch-default="">Anyone can see and follow this library</span> <span ng-switch-when="secret">Only people you invite can see this library</span></span></div><div ng-show="$error.general" class="keep-to-library-create-general-error">{{$error.general}}</div><div class="keep-to-library-create-button-container"><button class="keep-to-library-create-button" ng-click="createLibrary(newLibrary)">Create Library</button></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("keep/keepToLibraryWidgetLibraryItem.tpl.html",'<div class="keep-to-library-lib-icon-container"><div class="kf-klw-library-card" ng-style="{\'background-color\': library.color}"><div ng-if="library.kind === \'system_main\'" class="kf-klw-star-icon svg-card-star"></div><div ng-if="library.visibility === \'secret\'" class="kf-klw-lock-icon svg-card-lock"></div></div></div>{{library.name}} <button class="kf-button keep-to-library-unkeep-button">Unkeep</button>')}])}(),angular.module("kifi").directive("kfAddKeep",["$document","$rootScope","$location","$state","$timeout","KEY","keepActionService","libraryService","modalService","util",function(e,i,t,r,n,a,o,l,s,c){return{restrict:"A",require:"^kfModal",templateUrl:"keeps/addKeep.tpl.html",link:function(t,u,d,f){function p(e){t.$apply(function(){switch(e.which){case a.ENTER:t.keepToLibrary();break;case a.TAB:g=(g+1)%3,0===g&&(e.preventDefault(),e.stopPropagation(),m())}})}function m(){setTimeout(function(){h.focus()})}var g=0,h=u.find(".kf-add-keep-input");t.state={};var v=function(){t.state.checkedPrivate=!1,t.state.invalidUrl=!1,t.state.input="",t.keptPublic=!1,t.keptPrivate=!1};v(),t.resetFocusState=function(){g=0},t.$on("$destroy",function(){e.off("keydown",p)}),t.selectedLibrary=t.modalData.selectedLibId&&_.find(l.getOwnInfos(),{id:t.modalData.selectedLibId})||l.getSysMainInfo(),t.onLibrarySelected=function(e){t.selectedLibrary=e},t.keepToLibrary=function(){var e=t.state.input||"";e&&c.validateUrl(e)?o.keepToLibrary([{url:e}],t.selectedLibrary.id).then(function(e){if(e.failures&&e.failures.length)t.resetAndHide(),s.open({template:"common/modal/genericErrorModal.tpl.html"});else if(l.fetchLibraryInfos(!0),"secret"===t.selectedLibrary.visibility?t.keptPrivate=!0:t.keptPublic=!0,t.inAnimation=!0,n(function(){t.inAnimation=!1},200),n(t.resetAndHide,1700),0===e.alreadyKept.length&&r.href(r.current.name)===t.selectedLibrary.url)return o.fetchFullKeepInfo(e.keeps[0]).then(function(e){i.$emit("keepAdded",[e],t.selectedLibrary);
})})["catch"](s.openGenericErrorModal):t.state.invalidUrl=!0},t.resetAndHide=function(){v(),f.close(),e.off("keydown",p)},e.on("keydown",p),m()}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("keeps/addKeep.tpl.html",'<div class="dialog-content"><a class="dialog-x" ng-click="resetAndHide()"></a><div class="dialog-body-wrap"><h1 class="dialog-header">Add a keep</h1><div class="dialog-body dialog-centered"><div class="kf-add-keep-body"><div class="kf-add-keep-error" ng-show="state.invalidUrl">Please enter a valid URL</div><input class="kf-add-keep-input" placeholder="http://..." ng-model="state.input" ng-focus="resetFocusState()"><div class="add-keep-to-library-dropdown" kf-keep-to-library-widget="" widget-action-text="Add keep" library-select-action="onLibrarySelected(selectedLibrary)" lib-select-down-offset="0" lib-select-max-up-offset="110" lib-select-left-offset="0"><span ng-switch="selectedLibrary.kind" class="keep-to-library-lib-icon-container"><div class="kf-klw-library-card" ng-style="{\'background-color\': selectedLibrary.color}"><div ng-if="selectedLibrary.kind === \'system_main\'" class="kf-klw-star-icon svg-card-star"></div><div ng-if="selectedLibrary.visibility === \'secret\'" class="kf-klw-lock-icon svg-card-lock"></div></div></span> {{selectedLibrary.name}} <span class="add-keep-to-library-dropdown-arrow"></span></div></div></div></div><div class="dialog-buttons"><button class="kf-action-button kf-ak-button" ng-class="{\'kept-public\': keptPublic, \'kept-private\': keptPrivate, \'in-animation\': inAnimation}" ng-click="keepToLibrary()" ng-disabled="keptPublic || keptPrivate" tabindex="0"><span class="kf-ak-button-text">&#10084;&nbsp;&nbsp;</span></button></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("keeps/addKeepModal.tpl.html",'<div kf-modal="" class="kf-add-keep-modal"><div kf-add-keep=""></div></div>')}])}(),angular.module("kifi").factory("keepActionService",["$analytics","$location","net","libraryService",function(e,i,t,r){function n(e){var i=/^[a-zA-Z]+:\/\//;return i.test(e)?e:"http://"+e}function a(a,o){e.eventTrack("user_clicked_page",{action:"keep",path:i.path()});var l={keeps:a.map(function(e){var i={url:n(e.url)};return e.title&&(i.title=e.title),i})};return t.addKeepsToLibrary(o,l).then(function(e){return r.noteLibraryKeptTo(o),_.uniq(e.data.keeps,function(e){return e.url}),e.data})}function o(n,a,o){var l={action:"keep",path:i.path()};void 0!==o&&(l.keepView=o?"gallery":"list"),e.eventTrack("user_clicked_page",l);var s={to:a,keeps:n};return t.copyKeepsToLibrary(s).then(function(e){return r.noteLibraryKeptTo(a),_.uniq(e.data.keeps,function(e){return e.url}),e.data})}function l(n,a){e.eventTrack("user_clicked_page",{action:"keep",path:i.path()});var o={to:a,keeps:n};return t.moveKeepsToLibrary(o).then(function(e){return r.noteLibraryKeptTo(a),_.uniq(e.data.keeps,function(e){return e.url}),e.data})}function s(e){return t.getKeep(e.id,{withFullInfo:!0}).then(function(i){return _.assign(e,i.data)})}function c(e,i){return r.expireKeepsInLibraries(),t.removeKeepFromLibrary(e,i)}function u(e,i){r.expireKeepsInLibraries();var n={ids:_.pluck(i,"id")};return t.removeManyKeepsFromLibrary(e,n)}var d={keepToLibrary:a,copyToLibrary:o,moveToLibrary:l,fetchFullKeepInfo:s,unkeepFromLibrary:c,unkeepManyFromLibrary:u};return d}]),angular.module("kifi").factory("keepNoteForm",["$log","$templateCache","$filter","$http","$q","$timeout","KEY","HTML","hashtagService","routeService","modalService",function(){return _.once(function(e,i,t,r,n,a,o,l,s,c,u){function d(e){var i=l.replaceLineBreakTagsWithChars(e).replace(se,"\n\n").replace(le,function(e,i){return"["+i.replace(ce,"\\$1")+"]"});return Z("<div>").html(i).text().trim()}function f(e){return e.nodeType===ie&&e.classList.contains("kf-keep-note-hashtag")}function p(e){return f(e.parentNode)}function m(e){return Z(e.parentNode).is("b,big,em,font,i,s,small,span,strong,sub,sup,u")}function g(e){return!e||(e.nodeType===ee?!ne.test(e.data.slice(-1)):!f(e))}function h(e){return!e||(e.nodeType===ee?!ne.test(e.data[0])&&"#"!==e.data[0]:!f(e))}function v(e){return!e||(ne.exec(e)||{0:""})[0].length===e.length}function k(e,i,t){for(var r=t[e];!r;){if(t=t.parentNode,t.classList.contains("kf-knf-editor"))return null;r=t[e]}for(;r[i];)r=r[i];return r.nodeType===ee?r:k(e,i,r)}function b(e,i,t){if(e.nodeType===ee)return{node:e,idx:i};var r=i>0&&ue(e.childNodes.item(i));if(r)return{node:r,idx:r.length};for(var n=e;n.firstChild;)n=n.firstChild;if((n.nodeType!==ie||!n.classList.contains("kf-knf-editor"))&&(n.nodeType!==ee&&(n=de(n)),n))return{node:n,idx:0};if(t){var a=w("");return e.insertBefore(a,e.childNodes.item(i+1)),{node:a,idx:0}}}function y(e,i){if(0>=i){var t=ue(e);if(t)return y(t,t.length+i);i=0}else if(i>e.length){var r=de(e);if(r)return y(r,i-e.length);i=e.length}var n=document.createRange();n.setStart(e,i);var a=window.getSelection();return a.removeAllRanges(),a.addRange(n),{node:e,idx:i}}function w(e){return document.createTextNode(e)}function C(e,i){var t=e.previousSibling;t&&t.nodeType===ee?t.data+=i:e.parentNode.insertBefore(w(i),e)}function S(e,i){var t=e.nextSibling;t&&t.nodeType===ee?t.data=i+t.data:e.parentNode.insertBefore(w(i),t)}function $(e,i){var t=e.parentNode;return t.parentNode.replaceChild(e,t),L(i||e)}function L(e){for(var i=0,t=[],r=e.previousSibling;r&&r.nodeType===ee;)i+=r.length,t.push(r),r=r.previousSibling;for(r=e.nextSibling;r&&r.nodeType===ee;)t.push(r),r=r.nextSibling;return e.data=e.wholeText,t.forEach(P),i}function x(e,i,t){var r=t.data,n=ne.exec(r);if(n){var a=n[0];return e.data+=a,a===r?P(t):t.data=r.substr(a.length),a.length}return 0}function F(e,i,r,n){var a=e.parentNode,o=e.nextSibling,l=Z("<a class=kf-keep-note-hashtag/>").attr("href",t("tagUrl")(n))[0];r?(e.data=i.substr(0,r),l.textContent=n):(e.data=n,l.appendChild(e)),a.insertBefore(l,o);var s=i.substr(r+n.length);if(s){var c=w(s);return a.insertBefore(c,o),c}}function T(e){for(var i=!1,t=e.data,r=oe.exec(t);r;){var n=r[1],a=r.index+(r[0]!==n?1:0);if(0!==a||g(e.previousSibling)){if(a+n.length===t.length&&!h(e.nextSibling))break;e=F(e,t,a,n),i=!0,t=e&&e.data,r=t&&oe.exec(t)}else r=oe.exec("_"+t.substr(1))}return i}function _(e,i,t){var r=e.data,n=!1,a=oe.exec(r);if(a){var o=a[1],l=a.index+(a[0]!==o?1:0);l>0&&(C(e.parentNode,r.substr(0,l)),e.data=r=r.substr(l),i-=l,n=!0);var s=o.length;if(s<r.length&&i>s&&!ne.test(r[i-1])&&(i===r.length||t&&v(r.substr(i)))&&(S(e.parentNode,r.substr(i-1)),e.data=r=r.substr(0,i-1),n=!0),0>=i){var c=e.parentNode.previousSibling;g(c)||(f(c)&&$(c.firstChild),i+=$(e),n=!0)}else if(i>=r.length){var u=e.parentNode.nextSibling;u&&u.nodeType===ee&&x(e,r,u)&&(u=e.parentNode.nextSibling,n=!0),h(u)||(f(u)&&$(u.firstChild),i+=$(e),n=!0)}}else i+=$(e),n=!0;return n?(p(e)||T(e),y(e,i)):{node:e,idx:i}}function I(e){var i=e.previousSibling;if(i){if(i.nodeType===ee)return L(e);if(f(i)&&!h(e))return $(i.firstChild,e)}}function E(e){var i=e.nextSibling;if(i){if(i.nodeType===ee)return L(e);if(f(i)&&(!g(e)||"#"!==i.textContent[0]))return $(i.firstChild,e)}}function A(e,i){var t=!1;if(1>=i){var r=I(e);null!=r&&(i+=r,t=!0)}i>=e.data.length-1&&(t=null!=E(e)||t);var n=T(e);return n||t?y(e,i):void 0}function P(e){var i=e.parentNode;i&&i.removeChild(e)}function M(e,i,t){t&&p(t.node)?D(e,t.node):i.$suggestions&&(R(i),i.seq++)}function D(e,i){var t=Z.data(e),r=++t.seq,n=i.parentElement;s.suggestTags(t.libraryId,t.keepId,i.data.substr(1)).then(function(i){r===t.seq&&(i.length?(t.$suggestions||(t.$suggestions=Z('<div class="kf-knf-tag-suggestions"/>').data("tagEl",n).on("mouseover",".kf-knf-tag-suggestion",t,q).on("mousemove",".kf-knf-tag-suggestion",t,j).on("mousedown",".kf-knf-tag-suggestion",t,W).insertAfter(e),selectionchange.start(),Z(document).on("selectionchange",t,H)),t.$suggestions.html(i.map(K).join("")),U(t.$suggestions),B(t,t.$suggestions[0].firstChild)):t.$suggestions&&R(t))}),t.$suggestions&&U(t.$suggestions)}function U(i){var t=i.data("tagEl");t.parentElement?i.css({top:t.offsetTop+t.offsetHeight+1,left:t.offsetLeft-7}):e.log("[positionSuggestions] no parent","top:",t.offsetTop,"left:",t.offsetLeft,"height:",t.offsetHeight)}function K(e){var i=['<div class="kf-knf-tag-suggestion">'];return e.matches||e.freeTag?N(i,e.tag,e.matches||[[0,e.tag.length]]):i.push(l.escapeElementContent(e.tag)),i.push("</div>"),i.join("")}function N(e,i,t){for(var r=0,n=0;n<t.length;n++){var a=t[n],o=a[0],s=a[1];o>=r&&(e.push(l.escapeElementContent(i.substring(r,o)),"<b>",l.escapeElementContent(i.substr(o,s)),"</b>"),r=o+s)}e.push(l.escapeElementContent(i.substr(r)))}function B(e,i){(e.suggestion||i).classList.remove("kf-selected"),(e.suggestion=i).classList.add("kf-selected")}function O(e,i){var t=e.$suggestions.data("tagEl").firstChild,r="#"+(i||e.suggestion).textContent;t.data=r,R(e),y(t,r.length)}function R(e){e.$suggestions.remove(),e.$suggestions=e.suggestion=null,Z(document).off("selectionchange",H),selectionchange.stop()}function q(e){e.data.mousing&&B(e.data,this)}function j(e){e.data.mousing||(e.data.mousing=!0,B(e.data,this))}function W(e){return 1===e.which?(O(e.data,this),!1):void 0}function H(e){var i=e.data.$suggestions.data("tagEl"),t=i&&i.firstChild,r=window.getSelection(),n=r.rangeCount>0?r.getRangeAt(0):null;n&&n.startContainer===t&&n.endContainer===t||R(e.data)}function V(e){switch(e.which){case o.TAB:if(e.data.suggestion)return O(e.data),!1;break;case o.ENTER:if(e.data.suggestion)return O(e.data),!1;e.shiftKey+e.altKey+e.ctrlKey===1&&e.stopPropagation();break;case o.UP:case o.DOWN:if(e.data.$suggestions){var i=38===e.which,t=e.data.suggestion&&e.data.suggestion[i?"previousSibling":"nextSibling"]||e.data.$suggestions[0][i?"lastChild":"firstChild"];return t&&B(e.data,t),!1}break;case o.ESC:if(e.data.$suggestions)return R(e.data),!1}e.data.mousing=!1}function z(e){e.preventDefault();var i=e.originalEvent.clipboardData;if(i&&e.originalEvent.isTrusted!==!1){var t=i.getData("text/plain").replace(se,"\n\n");if(t){var r=window.getSelection(),n=r.getRangeAt(0);n.deleteContents();var a=b(n.endContainer,n.endOffset,!0),o=a.node,l=o.data,s=a.idx,c=0===s,u=s===l.length;o.data=l.substr(0,s)+t+l.substr(s),p(o)?(0===s||(ne.exec(t)||{0:""})[0].length<t.length)&&(s+=$(o),T(o)):(c&&(s+=I(o)||0),u&&E(o),T(o)),a=y(o,s+t.length),M(this,e.data,a)}}}function G(i){var t=window.getSelection(),r=t.getRangeAt(0),n=r.endContainer;if(r)if(r.collapsed){if(this.contains(n)){var a=b(n,r.endOffset);if(a){n=a.node;var o=a.idx;m(n)&&(o+=$(n),y(n,o)),a=p(n)?_(n,o,i.data.lastKeyedCharCode):A(n,o),M(this,i.data,a)}else e.log("[input]",n.tagName||n.nodeType,r.endOffset)}}else 0===r.startOffset&&m(n)&&document.execCommand("undo");else e.log("[input] no selection range");i.data.lastKeyedCharCode=null}function Y(e){X(Z(e.delegateTarget))}function J(e){var i=Z(e.delegateTarget),t=i.find(".kf-knf-editor"),n=i.find(".kf-knf-save,.kf-knf-cancel").prop("disabled",!0),o=i.find(".kf-knf-progress"),l=t.data(),s=d(t.html());Q(r.post(c.saveKeepNote(l.libraryId,l.keepId),{note:s})).then(function(){o.addClass("kf-done").css("transform","none"),l.update(s),a(function(){X(i)},800,!1)},function(){o.addClass("kf-fail").css("transform","scale(0,1)"),a(function(){o.removeClass("kf-fail"),n.prop("disabled",!1),u.openGenericErrorModal()},400,!1)},function(e){o.css("transform","scale("+e+",1)")})}function Q(e){function i(){o+=o>.88?Math.min(.004,(1-o)/4):(.95-o)/8,r.notify(o),.99>o&&(t=a(i,l,!1))}var t,r=n.defer(),o=0,l=100;return e.success(function(e){r.resolve(e)}).error(function(e){r.reject(e)}).then(function(){a.cancel(t)}),t=a(i,0,!1),r.promise}function X(e){window.getSelection().removeAllRanges(),e.addClass("kf-transition").layout().addClass("kf-small"),a(function(){e.remove()},te,!1)}var Z=jQuery,ee=document.TEXT_NODE,ie=document.ELEMENT_NODE,te=300,re='0000-"$-/:-@\\[-^`{-00A100A700AB00B600B700BB00BF037E0387055A-055F0589058A05BE05C005C305C605F305F40609060A060C060D061B061E061F066A-066D06D40700-070D07F7-07F90830-083E085E0964096509700AF00DF40E4F0E5A0E5B0F04-0F120F140F3A-0F3D0F850FD0-0FD40FD90FDA104A-104F10FB1360-13681400166D166E169B169C16EB-16ED1735173617D4-17D617D8-17DA1800-180A194419451A1E1A1F1AA0-1AA61AA8-1AAD1B5A-1B601BFC-1BFF1C3B-1C3F1C7E1C7F1CC0-1CC71CD32010-20272030-20432045-20512053-205E207D207E208D208E2329232A2768-277527C527C627E6-27EF2983-299829D8-29DB29FC29FD2CF9-2CFC2CFE2CFF2D702E00-2E2E2E30-2E3B3001-30033008-30113014-301F3030303D30A030FBA4FEA4FFA60D-A60FA673A67EA6F2-A6F7A874-A877A8CEA8CFA8F8-A8FAA92EA92FA95FA9C1-A9CDA9DEA9DFAA5C-AA5FAADEAADFAAF0AAF1ABEBFD3EFD3FFE10-FE19FE30-FE52FE54-FE61FE63FE68FE6AFE6BFF01-FF03FF05-FF0AFF0C-FF0FFF1AFF1BFF1FFF20FF3B-FF3DFF3FFF5BFF5DFF5F-FF65FFE5'.replace(/([\dA-F]{4})/g,"\\u$1"),ne=new RegExp("^[^#"+re+"]+"),ae="#[^#"+re+"]*[^_\\d#"+re+"][^#"+re+"]*",oe=new RegExp("(?:^|[#"+re+"])("+ae+")(?=["+re+"]|$)"),le=/<a(?: [\w-]+="[^"]*")*? class="[^"]*?kf-keep-note-hashtag[^"]*"(?: [\w-]+="[^"]*")*>(.*?)<\/a>/gi,se=/\n(?:\s*\n)+/g,ce=/[(\]\\)]/g,ue=k.bind(null,"previousSibling","lastChild"),de=k.bind(null,"nextSibling","firstChild");return{init:function(e,r,n,o,l){var s=angular.element(i.get("keeps/keepNoteForm.tpl.html")).insertBefore(e).on("click",".kf-knf-cancel",Y).on("click",".kf-knf-save",J),c=s.find(".kf-knf-editor").html(t("noteHtml")(r)).data({libraryId:n,keepId:o,update:function(i){l(i),e.html(t("noteHtml")(i))},seq:0});s.layout().removeClass("kf-small"),a(function(){s.removeClass("kf-transition");var e=c[0];if(e.lastChild){for(;e.lastChild;)e=e.lastChild;e.nodeType===ee&&y(e,e.length)}else e.focus()},te,!1);var u=c.data();c.on("keydown",u,V).on("keypress",u,function(e){e.data.lastKeyedCharCode=e.charCode}).on("dragenter dragover",function(e){e.originalEvent.dataTransfer.dropEffect="none",e.originalEvent.dataTransfer.effectAllowed="none",e.preventDefault()}).on("drop",function(e){e.preventDefault()}).on("paste",u,z).on("input",u,G).on("click",".kf-keep-note-hashtag",function(e){e.preventDefault()}).on("blur",function(){this.textContent.trim()||(this.textContent="")})}}})}()]),jQuery.fn.layout=function(){return this.each(function(){this.clientHeight})},function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("keeps/keepNoteForm.tpl.html",'<div class="kf-knf kf-transition kf-small"><div class="kf-knf-editor" contenteditable=""></div><div class="kf-knf-buttons"><button class="kf-knf-cancel">Cancel</button> <button class="kf-knf-save">Save</button><div class="kf-knf-progress"><div class="kf-knf-checkmark svg-checkmark-green"></div></div></div></div>')}])}(),angular.module("kifi").constant("KeepSelection",function(){function e(){this.keeps=new window.Set}function i(){this.keeps=[]}return e.prototype={selectAll:function(e){for(var i=0,t=e.length;t>i;i++)this.keeps.add(e[i])},unselectAll:function(){this.keeps.clear()},isSelected:function(e){return this.keeps.has(e)},isSelectedAll:function(e){return e&&e.length&&e.length===this.keeps.size},toggleSelect:function(e){this.keeps.has(e)?this.keeps["delete"](e):this.keeps.add(e)},toggleSelectAll:function(e){this.isSelectedAll(e)?this.unselectAll():this.selectAll(e)},getSelectedLength:function(){return this.keeps.size},getSelected:function(e){return _.filter(e,function(e){return this.has(e)},this.keeps)}},i.prototype={selectAll:function(e){this.keeps=_.union(this.keeps,e)},unselectAll:function(){this.keeps.length=0},isSelected:function(e){return this.keeps.indexOf(e)>=0},isSelectedAll:function(e){return e&&e.length&&e.length===this.keeps.length},toggleSelect:function(e){var i=this.keeps.indexOf(e);i>=0?this.keeps.splice(i,1):this.keeps.push(e)},toggleSelectAll:function(e){this.isSelectedAll(e)?this.unselectAll():this.selectAll(e)},getSelectedLength:function(){return this.keeps.length},getSelected:function(e){return _.intersection(e,this.keeps)}},"function"==typeof window.Set?e:i}()),angular.module("kifi").directive("kfKeeps",["$window","$timeout","$injector","KeepSelection","keepActionService","libraryService","modalService","undoService","profileService","$rootScope",function(e,i,t,r,n,a,o,l,s,c){return{restrict:"A",scope:{library:"=",keeps:"=",keepsLoading:"=",keepsHasMore:"=",keepClick:"=",scrollDisabled:"=",scrollNext:"&",edit:"=",galleryView:"=",currentPageOrigin:"@"},templateUrl:"keeps/keeps.tpl.html",link:function(i){function u(){d=e.innerWidth}var d=e.innerWidth,f=720;i.me=s.me,i.availableKeeps=[],i.scrollDistance="100%",i.selection=new r,i.keepClickAction=function(e,t){i.keepClick&&setTimeout(function(){i.keepClick(t,e)})},i.isMultiChecked=function(e){return i.selection.getSelectedLength()>0&&!i.selection.isSelectedAll(e)},i.isUnchecked=function(e){return!i.selection.isSelectedAll(e)&&!i.isMultiChecked(e)},i.isShowMore=function(){return!i.keepsLoading&&i.keepsHasMore},i.isScrollDisabled=function(){return i.scrollDisabled||f>d},i.unkeep=function(e){var t=i.selection.getSelected(e),r=i.library.id;n.unkeepManyFromLibrary(r,t).then(function(){_.forEach(t,function(e){e.unkept=!0,e.keepersTotal--}),a.addToLibraryCount(r,-t.length),i.selection.unselectAll(),i.availableKeeps=_.difference(i.availableKeeps,t),i.availableKeeps.length<10&&i.scrollNext()(i.availableKeeps.length),l.add(t.length>1?t.length+" keeps deleted.":"Keep deleted.",function(){n.keepToLibrary(_.map(t,function(e){return _.pick(e,"url","title")}),r).then(function(){_.forEach(t,function(e){e.unkept=!1,e.keepersTotal++}),a.addToLibraryCount(r,t.length),i.selection.selectAll(t),i.availableKeeps=_.reject(i.keeps,{unkept:!0})})["catch"](o.openGenericErrorModal)})})["catch"](o.openGenericErrorModal)},i.onWidgetKeepToLibraryClicked=function(e){var t=i.selection.getSelected(i.availableKeeps),r=t.map(function(e){return{url:e.url,title:e.title}});n.keepToLibrary(r,e.id).then(function(t){var r=t.keeps;r.length>0&&(a.fetchLibraryInfos(!0),i.$emit("keepAdded",r,e)),a.fetchLibraryInfos(!0)})["catch"](o.openGenericErrorModal)},i.onWidgetCopyLibraryClicked=function(e){var t=i.selection.getSelected(i.availableKeeps);n.copyToLibrary(_.pluck(t,"id"),e.id).then(function(t){var r=t.successes;r.length>0&&(a.fetchLibraryInfos(!0),i.$emit("keepAdded",r,e))})["catch"](o.openGenericErrorModal)},i.onWidgetMoveLibraryClicked=function(e){var t=i.selection.getSelected(i.availableKeeps);n.moveToLibrary(_.pluck(t,"id"),e.id).then(function(){_.forEach(t,function(e){e.unkept=!0}),a.fetchLibraryInfos(!0);var e=i.library.id;a.addToLibraryCount(e,-1*t.length),i.availableKeeps=_.difference(i.availableKeeps,t),i.selection.unselectAll()})["catch"](o.openGenericErrorModal)},c.$on("editKeepNote",function(e,t,r){i.editKeepNote(t,r)}),i.editKeepNote=function(e,i){if(i.user.id===s.me.id){var r=angular.element(e.target).closest(".kf-keep"),n=r.find(".kf-knf-editor");if(n.length)n.focus();else{var a=r.find(".kf-keep-note");t.get("keepNoteForm").init(a,i.note,i.libraryId,i.id,function(e){i.note=e})}}},i.deleteKeep=function(e,t){angular.element(e.target).closest(".kf-keep").find(".kf-knf").remove();var r=t.library.id;n.unkeepFromLibrary(r,t.id).then(function(){t.unkept=!0,t.keepersTotal--,a.addToLibraryCount(r,-1),i.$emit("keepRemoved",{url:t.url},t.library),l.add("Keep deleted.",function(){n.keepToLibrary([{url:t.url}],r).then(function(){t.unkept=!1,t.keepersTotal++,a.addToLibraryCount(r,1),i.$emit("keepAdded",[t],t.library)})["catch"](o.openGenericErrorModal)})})["catch"](o.openGenericErrorModal)},i.$watchCollection(function(){return i.keeps},function(e){i.availableKeeps=_.reject(e,{unkept:!0})}),i.$watch("edit.enabled",function(e,t){t&&!e&&i.selection.unselectAll()}),e.addEventListener("resize",u),i.$on("$destroy",function(){e.removeEventListener("resize",u)}),i.onWidgetLibraryClicked=function(e){c.$broadcast("onWidgetLibraryClicked",{clickedLibrary:e})}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("keeps/keeps.tpl.html",'<div class="kf-main-keeps"><div kf-quick-keep="" library="library"></div><div class="kf-keep-selection-tools" ng-if="edit.enabled" ng-show="availableKeeps.length > 0"><div class="kf-keep-checkbox-wrap"><div class="kf-keep-checkbox-icon sprite" ng-class="{\'sprite-checkbox-icon\': isUnchecked(availableKeeps), \'sprite-checkbox-icon-partial\': isMultiChecked(availableKeeps), \'sprite-checkbox-icon-active\': selection.isSelectedAll(availableKeeps)}" ng-click="selection.toggleSelectAll(availableKeeps)"></div></div><div class="kf-keep-selection-tools-body"><div class="kf-keep-selected-count"><span class="kf-keep-selected-count-number">{{selection.getSelected(keeps).length}}</span> <span class="kf-keep-selected-count-text" ng-pluralize="" count="selection.getSelected(keeps).length" when="{\'1\': \'keep selected\', \'other\': \'keeps selected\'}"></span></div><div class="kf-keep-selection-options" ng-class="{disabled: selection.getSelected(keeps).length === 0}"><div ng-if="edit.actions.copyToLibrary" class="kf-keep-selection-option copy-to-library"><span kf-keep-to-library-widget="" widget-action-text="Copy" library-click-action="onWidgetCopyLibraryClicked(clickedLibrary)" lib-select-down-offset="0" lib-select-max-up-offset="100" lib-select-left-offset="50">Copy to library</span></div><div ng-if="edit.actions.moveToLibrary" class="kf-keep-selection-option move-to-library"><span kf-keep-to-library-widget="" widget-action-text="Move" library-click-action="onWidgetMoveLibraryClicked(clickedLibrary)" lib-select-down-offset="0" lib-select-max-up-offset="100" lib-select-left-offset="50">Move to library</span></div><div ng-if="edit.actions.keepToLibrary" class="kf-keep-selection-option keep-to-library"><span kf-keep-to-library-widget="" widget-action-text="Keep" library-click-action="onWidgetKeepToLibraryClicked(clickedLibrary)" lib-select-down-offset="0" lib-select-max-up-offset="100" lib-select-left-offset="50">Keep to library</span></div><div ng-if="edit.actions.moveToLibrary" class="kf-keep-selection-option"><span ng-click="unkeep(keeps)">Unkeep</span></div><div class="kf-keep-selection-options-mask"></div></div></div></div><ol class="kf-my-keeps" smart-scroll="" scroll-distance="scrollDistance" scroll-disabled="isScrollDisabled()" scroll-next="scrollNext()(keeps.length)"><div class="kf-keep" ng-hide="keep.unkept && library" ng-class="{\'editing\': edit.enabled, \'compact\': !galleryView, \'mine\': (keep.user.id === me.id) }" ng-repeat="keep in keeps"><div class="kf-keep-checkbox-wrap"><div class="kf-keep-checkbox-icon sprite sprite-checkbox-icon" ng-if="!selection.isSelected(keep)" ng-click="selection.toggleSelect(keep)"></div><div class="kf-keep-checkbox-icon sprite sprite-checkbox-icon-active" ng-if="selection.isSelected(keep)" ng-click="selection.toggleSelect(keep)"></div></div><div class="kf-keep-top-menu-container" kf-hover-menu="" ng-if="::keep.user.id === me.id"><button class="kf-keep-top-menu-btn"></button><menu class="kf-dropdown-menu"><button class="kf-dropdown-menu-item" ng-click="editKeepNote($event, keep)">{{keep.note ? \'Edit note\' : \'Add a note\'}}</button> <button class="kf-dropdown-menu-item" ng-click="deleteKeep($event, keep)">Delete Keep</button></menu></div><div class="kf-keep-top"><section class="kf-keep-top-l"><a class="kf-keep-keeper-pic" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}" ng-attr-style="background-image:url({{::keep.user|pic:100}})"></a> <a class="kf-keep-keeper-name" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}">{{::keep.user|name}}</a></section><section class="kf-keep-top-r"><a class="kf-keep-keeper-name" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}">{{::keep.user|name}}</a><div class="kf-keep-time" ng-if="::keep.user"><time ng-attr-datetime="{{::keep.createdAt}}" am-time-ago="::keep.createdAt" title="{{::keep.createdAt|localTime}}" ng-if="::keep.createdAt"></time><span ng-if="::!keep.createdAt">kept this</span> <span ng-if="::!library && keep.library && keep.library.visibility !== \'discoverable\' && keep.library.path.slice(-7) !== \'/secret\'">in <a class="kf-keep-lib-name" href="{{::keep.library.path}}">{{::keep.library.name}}</a></span> <span ng-if="::keep.sourceAttribution.twitter.screenName"><a class="kf-keep-tweet-link" href="https://www.twitter.com/{{::keep.sourceAttribution.twitter.screenName}}/status/{{::keep.sourceAttribution.twitter.idString}}" target="_blank" ng-click="trackTweet()"><span class="kf-keep-twitter-logo svg-twitter-blue"></span>View the tweet</a></span></div></section></div><div class="kf-keep-note" ng-bind-html="::keep.note|noteHtml" ng-if="::keep.note || keep.user.id === me.id"></div><div class="kf-keep-add-note" ng-if="::keep.user.id === me.id"><button class="kf-keep-add-note-btn" ng-click="editKeepNote($event, keep)" ng-if="!keep.note">Add a note (type # to add a tag)</button></div><div kf-keep-card="keep" boxed="" gallery-view="galleryView" current-page-origin="{{currentPageOrigin}}" click-callback="keepClickAction(event, keep)"></div></div></ol><img class="kf-keeps-loading" ng-show="keepsLoading" src="//d1dwdv9wd966qu.cloudfront.net/img/load.472917b.gif"> <a class="kf-keeps-load-more" ng-show="isShowMore()" href="javascript:" ng-click="scrollNext()(keeps.length)">Show more</a></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("layout/body.tpl.html","<header ng-include=\"$root.userLoggedIn ? 'header/loggedInHeader.tpl.html' : 'header/loggedOutHeader.tpl.html'\"></header><div ng-include=\"'layout/main/main.tpl.html'\"></div>")}])}(),angular.module("kifi").controller("MainCtrl",["$scope","$rootScope","$window","$timeout","$rootElement","$q","initParams","installService","profileService","routeService","modalService","libraryService","extensionLiaison",function(e,i,t,r,n,a,o,l,s,c,u,d,f){function p(i){e.importLibrary=i&&i.library||d.getSysMainInfo(),u.open({template:"common/modal/importBookmarksModal.tpl.html",scope:e}),h=i&&i.msgEvent}function m(i){var t=n.find(".bookmark-file-upload");t.replaceWith(t=t.clone(!0)),e.importLibrary=i&&i.library||d.getSysMainInfo(),u.open({template:"common/modal/importBookmarkFileModal.tpl.html",scope:e})}function g(e,i){var r=a.defer();if(e){var n=new XMLHttpRequest;n.withCredentials=!0,n.upload.addEventListener("progress",function(e){r.notify({name:"progress",event:e})}),n.addEventListener("load",function(){r.resolve(t.JSON.parse(n.responseText))}),n.addEventListener("error",function(e){r.reject(e)}),n.addEventListener("loadend",function(e){r.notify({name:"loadend",event:e})}),n.open("POST",c.uploadBookmarkFileToLibrary(i),!0),n.send(e)}else r.reject({error:"no file"});return r.promise}var h,v={0:"Welcome back!",2:"Bookmark import in progress. Reload the page to update."};e.data=e.data||{},function(i){"1"===i?e.showEmailVerifiedModal=!0:i in v&&(e.bannerMessage=v[i])}(o.getAndClear("m")),e.onImportLibrarySelected=function(i){e.importLibrary=i};var k=i.$on("showGlobalModal",function(e,i,t){switch(i){case"importBookmarks":p(t);break;case"importBookmarkFile":m(t)}});e.$on("$destroy",k),e.importBookmarksToLibrary=function(i){e.forceClose=!0,r(function(){e.forceClose=!1;var r=t.document.documentElement.getAttribute("data-kifi-ext");return r?(f.importBookmarksTo(i.id,h),h=null,void u.open({template:"common/modal/importBookmarksInProgressModal.tpl.html"})):void u.open({template:"common/modal/importBookmarksErrorModal.tpl.html"})},0)},e.cancelImport=function(){f.declineBookmarkImport(h),h=null},e.disableBookmarkImport=!0,e.allowUpload=function(i){var t=i[0],r=t&&t.name.split(".").pop();!r||"html"!==r&&"htm"!==r&&"zip"!==r?(e.importFilename="",e.disableBookmarkImport=!0,e.importFileStatus="Invalid bookmark file (*.html). Try picking it again."):(e.importFilename=t.name,e.disableBookmarkImport=!1,e.importFileStatus="")},e.openExportPopup=function(e){var i=e.target.href;return t.open(i,"","menubar=no,location=yes,resizable=yes,scrollbars=yes,status=no,width=1000,height=500"),e.preventDefault(),!1},e.importBookmarkFileToLibrary=function(i){if(!e.disableBookmarkImport){var t=n.find(".bookmark-file-upload"),a=t&&t[0]&&t[0].files&&t[0].files[0];if(a){e.disableBookmarkImport=!0;var o=r(function(){e.importFileStatus="Uploading... Hang tight!",e.disableBookmarkImport=!1},3e3);e.importFileStatus="",e.importFilename="",g(a,i.id).then(function(i){r.cancel(o),e.importFileStatus="",e.forceClose=!0,r(function(){e.forceClose=!1,i.error?u.open({template:"common/modal/importBookmarkFileErrorModal.tpl.html"}):u.open({template:"common/modal/importBookmarkFileInProgressModal.tpl.html"})},0)},function(){r.cancel(o),e.disableBookmarkImport=!1,e.importFileStatus="We may have had problems with your links. Reload the page to see if they’re coming in. If not, please contact support so we can fix it."})}else e.importFileStatus="Hm, couldn’t upload your file. Try picking it again."}},e.cancelBookmarkUpload=function(){e.disableBookmarkImport=!0,e.importFilename="",e.importFileStatus=""},e.openBookmarkFileSelector=function(){var e=n.find(".bookmark-file-upload");e.click()},/^Mac/.test(t.navigator.platform)&&n.find("body").addClass("mac");var b=i.$watch(function(){return Boolean(l.installedVersion&&s.prefs.auto_show_guide&&!s.prefs.auto_show_persona)},function(e){e&&(f.triggerGuide(),s.savePrefs({auto_show_guide:null}),b())})}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("layout/main/main.tpl.html",'<div ng-controller="MainCtrl"><div kf-error-bad-token="" ng-if="errorStatus === 403 && errorParams.authToken"></div><div kf-error-not-found="" ng-if="(errorStatus === 403 && !errorParams.authToken) || errorStatus === 404"></div><div ng-if="errorStatus !== 403 && errorStatus !== 404"><div ui-view=""></div><div kf-banner-message="::bannerMessage"></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/deleteLibraryConfirmModal.tpl.html",'<div kf-modal="" class="kf-delete-library-confirm-modal"><div kf-basic-modal-content="" with-cancel="true" title="Are you sure?" with-warning="" action-text="Delete Library" action="deleteLibrary()"><p>Deleting your library will delete all keeps in the library and remove all of its followers.</p></div></div>')}])}(),angular.module("kifi").controller("LibraryCtrl",["$scope","$rootScope","$analytics","$location","$state","$stateParams","$timeout","$window","$FB","$twitter","env","util","URI","AB","initParams","library","libraryService","modalService","platformService","profileService","originTrackingService","installService","libraryImageLoaded",function(e,i,t,r,n,a,o,l,s,c,u,d,f,p,m,g,h,v,k,b,y,w,C){function S(){e.platformName=w.getPlatformName(),e.platformName?(e.thanksVersion="installExt",e.installExtension=function(){t.eventTrack("visitor_clicked_page",{type:"installLibrary",action:"install"}),w.triggerInstall()}):e.thanksVersion="notSupported",g.id&&i.$emit("trackLibraryEvent","view",{type:"installLibrary"}),e.close=function(){t.eventTrack("visitor_clicked_page",{type:"installLibrary",action:"close"}),v.close()},v.open({template:"signup/thanksForRegisteringModal.tpl.html",scope:e})}function $(n){var a=t.settings.pageTracking.basePath+r.url();n=_.extend(h.getCommonTrackingAttributes(g),n),n=y.applyAndClear(n),i.userLoggedIn&&(n.owner=e.userIsOwner?"Yes":"No"),t.pageTrack(a,n)}function L(e){o(function(){i.$emit("trackLibraryEvent","click",{action:e})})}function x(){e.librarySearch||(l.document.title=g.name+" by "+g.owner.firstName+" "+g.owner.lastName+" • Kifi")}function F(){n.transitionTo(n.current,a,{reload:!0,inherit:!1,notify:!0})}function T(i){e.keeps.push(E(i.shift())),i.length?o(angular.bind(null,T,i)):I()}function I(){if(e.loading=!1,e.hasMore=e.hasMore&&e.keeps.length<g.numKeeps,e.hasMore&&!k.isSupportedMobilePlatform()){
var t=e.keeps.length;(20>t||30>t&&!i.userLoggedIn)&&o(e.getNextKeeps.bind(null,t))}}function E(i){return i.library=e.library,i}e.librarySearch="library.search"===n.current.name,e.username=a.username,e.librarySlug=a.librarySlug,e.keeps=[],e.library=g,e.libraryImageLoaded=C===!0,e.scrollDistance="100%",e.loading=!0,e.hasMore=!0,e.isMobile=k.isSupportedMobilePlatform(),e.passphrase=e.passphrase||{},e.$error=e.$error||{},e.userIsOwner=i.userLoggedIn&&g.owner.id===b.me.id,e.edit={enabled:!1,actions:{bulkUnkeep:!0,copyToLibrary:!0,moveToLibrary:!0}},e.galleryView=!b.prefs.use_minimal_keep_card,i.$on("prefsChanged",function(){e.galleryView=!b.prefs.use_minimal_keep_card}),e.getNextKeeps=function(i){e.loading||0===e.keeps.length||(e.loading=!0,h.getKeepsInLibrary(g.id,i,a.authToken).then(function(i){var t=i.keeps;t.length?o(angular.bind(null,T,i.keeps.slice())):(e.hasMore=!1,I())}))},e.libraryKeepClicked=function(t,r){var n=r.currentTarget.getAttribute("click-action");i.$emit("trackLibraryEvent","click",{action:n,keepView:e.galleryView?"gallery":"list"})},e.callAddKeep=function(){i.$emit("triggerAddKeep")},e.callImportBookmarks=function(){i.$emit("showGlobalModal","importBookmarks",{library:g})},e.callImportBookmarkFile=function(){i.$emit("showGlobalModal","importBookmarkFile",{library:g})},e.triggerInstall=function(){w.triggerInstall(function(){v.open({template:"common/modal/installExtensionErrorModal.tpl.html"})})},e.preloadFB=function(){s.init()},e.shareFB=function(){L("clickedShareFacebook"),s.ui({method:"share",href:u.origin+g.url+"?utm_medium=vf_facebook&utm_source=library_share&utm_content=lid_"+g.id+"&kcid=na-vf_facebook-library_share-lid_"+g.id})},e.preloadTwitter=function(){c.load()},e.shareTwitter=function(e){L("clickedShareTwitter");var i=u.origin+g.url;e.target.href="https://twitter.com/intent/tweet"+f.formatQueryString({original_referer:i,text:"Discover this amazing @Kifi library about "+g.name+"!",tw_p:"tweetbutton",url:i+"?utm_medium=vf_twitter&utm_source=library_share&utm_content=lid_"+g.id+"&kcid=na-vf_twitter-library_share-lid_"+g.id})},e.showFeedModal=function(){h.trackEvent("user_clicked_page",e.library,{type:"rss",action:"clicked_subscribe_button"}),v.open({template:"libraries/libraryFeedModal.tpl.html",scope:e})},[i.$on("keepAdded",function(i,t,r){t.forEach(function(i){if("system_secret"===r.kind&&"main"===e.librarySlug||"system_main"===r.kind&&"secret"===e.librarySlug){var t=_.findIndex(e.keeps,{url:i.url});t>-1&&e.keeps.splice(t,1)}var n=_.find(e.keeps,{url:i.url});n||r.id!==e.library.id||(e.keeps.unshift(E(i)),n=i),n&&!_.find(e.keeps,{id:i.id})&&n.keeps.push({id:i.id,libraryId:r.id,visibility:r.visibility})})}),i.$on("getCurrentLibrary",function(i,t){t.callback(e.library)}),i.$on("trackLibraryEvent",function(t,r,n){n.libraryRecCount=e.relatedLibraries?e.relatedLibraries.length:0,"click"===r?i.userLoggedIn?(n.type=n.type||"library",h.trackEvent("user_clicked_page",e.library,n)):(n.type=n.type||"libraryLanding",h.trackEvent("visitor_clicked_page",e.library,n)):"view"===r&&$(n)}),i.$on("$stateChangeSuccess",function(i,t){e.librarySearch="library.search"===t.name,x()}),i.$on("$stateChangeStart",function(e,t){d.startsWith(t.name,"library.")||i.$emit("libraryOnPage",null)}),i.$on("userLoggedInStateChange",function(){F()})].forEach(function(i){e.$on("$destroy",i)}),x(),C.promise&&C.promise.then(function(){e.libraryImageLoaded=!0}),i.$emit("libraryOnPage",g),g.keeps.length?o(angular.bind(null,T,g.keeps.slice())):I(),h.getRelatedLibraries(g.id).then(function(i){$({libraryRecCount:i.length}),e.relatedLibraries=i,"1"!==m.getAndClear("install")||w.installedVersion||S(),"follow"!==m.getAndClear("intent")||e.library.membership||h.joinLibrary(e.library.id)}),h.noteLibraryViewed(g.id),o(function(){h.trackEvent("user_viewed_page",e.library,{type:"library",keepView:e.galleryView?"gallery":"list"})})}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/library.tpl.html",'<div kf-library-header="" library="library" username="username" library-slug="librarySlug" image-loaded="libraryImageLoaded" edit-mode="edit.enabled" library-search="librarySearch" gallery-view="galleryView"></div><div class="kf-lib-content"><div class="kf-lib-content-1" ui-view=""></div><section class="kf-lib-content-2"><a class="kf-lib-tweet" ng-focus="preloadTwitter()" ng-mouseenter="preloadTwitter()" ng-click="shareTwitter($event)" href="https://twitter.com/intent/tweet" target="_blank" ng-if="library.visibility === \'published\'"><span class="kf-lib-tweet-icon svg-twitter-white"></span></a> <button class="kf-lib-fpost" ng-focus="preloadFB()" ng-mouseenter="preloadFB()" ng-click="shareFB()" ng-if="library.visibility === \'published\'"><span class="kf-lib-fpost-icon svg-facebook-white"></span></button> <button class="kf-lib-rss" ng-click="showFeedModal()"><span class="kf-lib-rss-icon svg-rss-feed"></span></button><div kf-suggested-searches="" library="library" ng-if="library.suggestedSearches.length"></div><div kf-related-libraries="" related-libraries="::relatedLibraries" library-id="{{::library.id}}" ng-if="::relatedLibraries"></div></section></div><footer class="kf-lib-footer" ng-if="!$root.userLoggedIn"><div class="kf-lib-footer-1"><a class="kf-lib-footer-a" target="_top" href="/how_it_works">How it works</a> &middot; <a class="kf-lib-footer-a" target="_top" href="/about">About</a> &middot; <a class="kf-lib-footer-a" target="_top" href="http://blog.kifi.com">Blog</a></div><span ng-if="!isMobile">&middot;</span><div class="kf-lib-footer-2"><a class="kf-lib-footer-a" target="_top" href="/privacy">Privacy</a> &middot; <a class="kf-lib-footer-a" target="_top" href="/terms">Terms</a></div></footer><div kf-page-bottom-cta="" library="library" ng-if="!$root.userLoggedIn && !isMobile"></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryFeedModal.tpl.html",'<div kf-modal="" class="kf-feed-modal" kf-width="500px"><div class="" kf-basic-modal-content="" centered="false" title="Feeds for {{library.name}}"><div class="kf-feed-how-to"><p>Step 1: Select the Feed</p><p>Step 2: Copy the Feed</p><p>Step 3: Paste the Feed into an RSS Reader</p></div><div class="kf-feed-text"><label for="rss">RSS Feed:</label> <input onclick="this.select();" name="rss" type="text" value=\'{{"https://www.kifi.com/" + username + "/" + librarySlug + "/rss"}}\'></div><div class="kf-feed-text"><label for="atom">Atom Feed:</label> <input onclick="this.select();" name="atom" type="text" value=\'{{"https://www.kifi.com/" + username + "/" + librarySlug + "/atom"}}\'></div></div></div>')}])}(),angular.module("kifi").directive("kfLibraryFollowerPics",["$window","$filter","util",function(e,i,t){return{restrict:"A",templateUrl:"libraries/libraryFollowerPics.tpl.html",scope:{followers:"=kfLibraryFollowerPics",numFollowers:"=",followerWidths:"=",showFollowers:"&",currentPageOrigin:"@"},link:function(r,n){function a(e){for(var i=r.followerWidths,t=1;t<i.length&&e>=i[t][0];t++);var n=i[t-1];return{gap:n[2],period:n[1]+n[2]}}function o(){var e=Math.max(r.numFollowers,r.followers.length),t=n[0].clientWidth,o=a(window.innerWidth),l=Math.floor((t+o.gap)/o.period),s=Math.min(r.followers.length,l)<e,c=Math.min(r.followers.length,l-(l&&s?1:0));r.followersToShow=r.followers.slice(0,c),r.moreCount=e-c,r.moreCountText=s?i("num")(e-c):""}r.$watch("numFollowers",function(e,i){e===i?r.$evalAsync(o):o()});var l=t.$debounce(r,o,200);e.addEventListener("resize",l),r.$on("$destroy",function(){e.removeEventListener("resize",l)})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryFollowerPics.tpl.html",'<div class="kf-lfp"><span class="kf-lfp-pic-wrap" kf-user-tooltip="::follower" ng-repeat="follower in followersToShow"><a class="kf-lfp-pic-a" href="{{::follower|profileUrl}}" kf-track-origin="{{::currentPageOrigin}}/follower"><img class="kf-lfp-pic" ng-src="{{::follower|pic:100}}" alt="{{::follower|name}}"></a></span> <button class="kf-lfp-more" ng-if="moreCount" ng-click="showFollowers()"><span class="kf-lfp-more-text kf-{{moreCountText.length}}">{{moreCountText}}</span></button></div>')}])}(),angular.module("kifi").directive("kfLibraryFollowers",["libraryService",function(e){return{restrict:"A",require:"^kfModal",templateUrl:"libraries/libraryFollowers.tpl.html",link:function(i,t,r,n){function a(){l||i.library.id&&(l=!0,e.getMoreMembers(i.library.id,o,i.offset).then(function(e){var t=e.members;l=!1,0===t.length?i.moreFollowers=!1:(i.moreFollowers=!0,i.offset+=1,t=_.reject(t,function(e){return e.lastInvitedAt}),i.followerList.push.apply(i.followerList,t))}))}i.moreFollowers=!0,i.followerList=[],i.followerScrollDistance="100%",i.Math=Math,i.isFollowerScrollDisabled=function(){return!i.moreFollowers},i.followerScrollNext=function(){a()};var o=10;i.offset=0;var l=!1;i.close=function(){n.close()},i.modalData&&(i.library=i.modalData.library,i.modalTitle=i.library.name,i.currentPageOrigin=i.modalData.currentPageOrigin)}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryFollowers.tpl.html",'<div class="library-followers dialog-content"><a class="dialog-x library-followers-close-x" ng-click="close()"></a><div class="dialog-body-wrap"><h1 class="dialog-header">{{modalTitle}}</h1><div class="dialog-body"><div class="lib-followers-info"><p class="lib-followers-stats"><span ng-pluralize="" count="Math.max(library.numFollowers, followerList.length)" when="{\'0\': \'0 people are \', \'one\': \'1 person is \', \'other\': \'{{Math.max(library.numFollowers, followerList.length)|number}} people are \'}"></span> <span>following this library</span></p></div><div class="lib-followers-content"><div class="lib-followers-content-list" kf-wheel-allow="" smart-scroll="" scroll-distance="followerScrollDistance" scroll-disabled="isFollowerScrollDisabled()" scroll-next="followerScrollNext()"><ul class="lib-followers-list"><a href="{{library.owner|profileUrl}}" class="lib-follower lib-owner" ng-click="close()" kf-track-origin="{{currentPageOrigin}}/curator"><img ng-src="{{library.owner | pic:100}}" class="lib-follower-image" alt="{{library.owner|name}}"><div class="lib-follower-name">{{library.owner|name}}</div></a> <a ng-if="follower.id" ng-repeat="follower in followerList" href="{{follower|profileUrl}}" ng-click="close()" class="lib-follower" kf-track-origin="{{currentPageOrigin}}/follower"><img ng-src="{{follower | pic:100}}" class="lib-follower-image" alt="{{follower|name}}"><div class="lib-follower-name">{{follower|name}}</div></a></ul></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryFollowersModal.tpl.html",'<div kf-modal="" class="kf-library-followers" kf-width="400px"><div kf-library-followers=""></div></div>')}])}(),angular.module("kifi").directive("kfLibraryHeader",["$http","$location","$q","$rootScope","$state","$stateParams","$timeout","$window","$$rAF","$filter","env","libraryService","modalService","profileService","platformService","signupService","routeService","linkify",function(e,i,t,r,n,a,o,l,s,c,u,d,f,p,m,g,h,v){return{restrict:"A",replace:!0,scope:{library:"=",username:"=",librarySlug:"=",imageLoaded:"=",editMode:"=",galleryView:"=",librarySearch:"=",followCallback:"&",clickLibraryCallback:"&"},templateUrl:"libraries/libraryHeader.tpl.html",link:function(n,k){function b(){var e=n.library;e.descriptionHtml=v(e.description||"").replace(/\n+/g,"<br>"),e.absUrl=u.origin+e.url,e.isSystem="system_main"===e.kind||"system_secret"===e.kind,n.collabsCanInvite="collaborator"===e.whoCanInvite,o(function(){var e=parseFloat(B.css("line-height"),10);n.descFits=O[0].scrollHeight<=Math.ceil(3*e)})}function y(){var e=n.library,i=Math.max(e.numFollowers,e.followers.length),t=q?0:3,r=t>0&&Math.min(e.followers.length,t)<i,a=Math.min(e.followers.length,t);n.followersToShow=e.followers.slice(0,a),n.numMoreFollowersText=r?"+"+c("num")(i-a):"See all",n.numMoreFollowers=r?c("num")(i-a):0}function w(){var e=D;if(N)C(N.createObjectURL(e),!0);else{var i=new FileReader;i.onload=function(e){C(e.target.result)},i.readAsDataURL(e)}}function C(e,i){$(e).then(function(t){var r=k.find(".kf-lh-cover")[0];n.imagePreview={url:e,isObjectUrl:i,natural:{w:t.naturalWidth,h:t.naturalHeight},w:r.clientWidth,h:r.clientHeight,x:50,y:50}})}function S(){if(n.imagePreview.isObjectUrl){var e=_.once(angular.bind(N,N.revokeObjectURL,n.imagePreview.url));k.find(".kf-lh-cover-preview").on("transitionend",e),o(e,1e3)}}function $(e){var i=t.defer(),r=new Image;return r.onload=function(){n.$apply(function(){i.resolve(r)})},r.onerror=function(e){n.$apply(function(){i.reject(e)})},r.src=e,i.promise}function L(e,i,t,r,a,o){var l=Math.min(100,Math.max(0,i.x+a.x*(o.screenX-t))),s=Math.min(100,Math.max(0,i.y+a.y*(o.screenY-r)));(l!==n.imagePreview.x||s!==n.imagePreview.y)&&(n.imagePreview.x=l,n.imagePreview.y=s,e.style.backgroundPosition=l+"% "+s+"%")}function x(){var e=n.imagePreview.handlers;document.removeEventListener("mousemove",e.mousemove,!0),document.removeEventListener("mouseup",e.mouseup,!0),document.removeEventListener("mouseout",e.mouseout,!0),delete e.mousemove,delete e.mouseup,delete e.mouseout,angular.element(this).removeClass("kf-dragging")}function F(e){e.relatedTarget||n.imagePreview.handlers.mouseup()}function T(e,i){function r(){d+=d>.88?Math.min(.005,(1-d)/2):.1*(.9-d),u.notify(d),.9999>d&&(c=o(r,f,!1))}var a=h.uploadLibraryCoverImage(n.library.id,i.x,i.y),s=new l.XMLHttpRequest;s.withCredentials=!0;var c,u=t.defer(),d=0,f=200;return s.upload.addEventListener("progress",function(e){if(e.lengthComputable){var i=e.loaded/e.total/2;i>d&&(d=i,u.notify(d),o.cancel(c),c=o(r,f,!1))}}),s.addEventListener("load",function(){s.response&&s.response.path?u.resolve(s.response):u.reject()}),s.addEventListener("loadend",function(){u.reject(),o.cancel(c)}),s.open("POST",a,!0),s.responseType="json",s.send(e),c=o(r,f,!1),u.promise}function I(e){function i(){a+=a>.88?Math.min(.005,(1-a)/2):.06*(.9-a),n.notify(a),.9999>a&&(r=o(i,l,!1))}var r,n=t.defer(),a=0,l=40;return e.success(function(e){n.resolve(e)}).error(function(e){n.reject(e)}).then(function(){o.cancel(r)}),r=o(i,0,!1),n.promise}function E(e){return Math.max.apply(Math,e.css("transition-duration").split(/,/).map(function(e){var i=parseFloat(e,10);return"s"===e.replace(/[^a-z]/g,"")?1e3*i:i}))}function A(e,i,r,n){function a(t){o||(o=t);var n=P(Math.min(1,(t-o)*c)),d=e.scrollTop=i+Math.round(u*n);l.notify(n),d!==r?s(a):l.resolve()}var o,l=t.defer(),c=1/n,u=r-i;return s(a),l.promise}function P(e){return e*e*e}function M(){var e=l.innerWidth<=R;q!==e&&n.$apply(function(){q=e,y()})}var D,U,K=i.search().authToken||"",N=l.URL||l.webkitURL,B=k.find(".kf-lh-desc-wrap"),O=B.find(".kf-lh-desc"),R=479,q=l.innerWidth<=R;p.userLoggedIn()?m.isSupportedMobilePlatform()&&f.open({template:"signup/getTheAppModal.tpl.html"}):n.library&&n.library.invite&&"read_write"===n.library.invite.access&&g.register({libraryId:n.library.id,intent:"follow",libAuthToken:K,invite:n.library.invite}),n.Math=Math,n.search={text:a.q||""},n.isMobile=m.isSupportedMobilePlatform(),n.descExpanded=!1,n.descScrollable=!1,n.imagePreview=null,n.followBtnJustClicked=!1,n.collabsCanInvite=!1,n.quickKeep={},n.admin=p.me.experiments&&p.me.experiments.indexOf("admin")>-1,n.acceptInvitation=function(){n.followLibrary()},n.ignoreInvitation=function(){n.library&&n.library.invite&&d.declineToJoinLibrary(n.library.id).then(function(){n.library.invite=null})},n.signupFromInvitation=function(){g.register({libraryId:n.library.id,intent:"follow",libAuthToken:K,invite:n.library.invite})},n.changeSubscription=function(){var e=n.library.membership;e?d.updateSubscriptionToLibrary(n.library.id,!e.subscribed).then(function(){e.subscribed=!e.subscribed})["catch"](f.openGenericErrorModal):n.followLibrary({subscribed:!0})},n.onCameraCoverImageMouseUp=function(e){1!==e.which||n.library.image||(angular.element(".kf-lh-cover-file").click(),d.trackEvent("user_clicked_page",n.library,{action:"clickedAddCoverImage"}))},n.onCoverImageFileChosen=function(e){var i=e[0];i&&/^image\/(?:jpeg|png|gif)$/.test(i.type)?(D=i,o(w),d.trackEvent("user_clicked_page",n.library,{action:"clickedCoverImageFile"})):f.openGenericErrorModal({modalData:{genericErrorMessage:"Please choose a .jpg, .png or .gif file."}})},n.onImagePreviewMouseOver=function(e){n.imagePreview.w=e.target.offsetWidth,n.imagePreview.h=e.target.offsetHeight},n.onImagePreviewMouseDown=function(e){if(1===e.which&&"button"!==e.target.tagName&&void 0===n.imagePreview.progress){e.preventDefault();var i=e.screenX,t=e.screenY,r=n.imagePreview.w,a=n.imagePreview.natural.w,o=r/a,s=n.imagePreview.h,c=n.imagePreview.natural.h,u=s/c,f=o>u?{x:0,y:100/(s-c*o)}:u>o?{x:100/(r-a*u),y:0}:{x:0,y:0},p=e.currentTarget,m=k.find(".kf-lh-cover-preview")[0],g=n.imagePreview.handlers={mousemove:_.throttle(L.bind(p,m,_.pick(n.imagePreview,"x","y"),i,t,f),10),mouseup:x.bind(p),mouseout:F.bind(p)};document.addEventListener("mousemove",g.mousemove,!0),document.addEventListener("mouseup",g.mouseup,!0),document.addEventListener("mouseout",g.mouseout,!0),angular.element(p).addClass("kf-dragging");var h=l.getSelection();h&&h.rangeCount&&h.collapseToEnd(),U||(d.trackEvent("user_clicked_page",n.library,{action:"positionedCoverImage"}),U=!0)}},n.cancelCoverImageChange=function(){d.trackEvent("user_clicked_page",n.library,{action:D?"clickedCancelCoverImage":"clickedCancelCoverImageMove"}),S(),n.imagePreview=D=null},n.applyCoverImageChange=function(){var i=n.imagePreview,r={x:Math.round(i.x),y:Math.round(i.y)},a=k.find(".kf-lh-cover-apply,.kf-lh-cover-cancel").prop("disabled",!0);i.progress=0;var l=D?T(D,r).then(function(e){t.all([$(u.picBase+"/"+e.path),o(angular.noop,500)]).then(function(){n.library.image=e,n.imageLoaded=!0,S(),n.imagePreview=D=null,n.settingImage=!0,o(function(){n.settingImage=!1})})}):I(e.post(h.positionLibraryCoverImage(n.library.id),{path:n.library.image.path,x:r.x,y:r.y})).then(function(){n.library.image.x=r.x,n.library.image.y=r.y,o(function(){n.imagePreview=null},500)});l.then(function(){i.progress=100},function(){i.progress=0,o(function(){delete i.progress,a.prop("disabled",!1)},500)},function(e){i.progress=100*e}),d.trackEvent("user_clicked_page",n.library,{action:D?"clickedApplyCoverImage":"clickedApplyCoverImageMove"})},n.onRemoveCoverImageMouseUp=function(i){1===i.which&&(e["delete"](h.removeLibraryCoverImage(n.library.id)).then(function(){n.library.image=null},function(){f.openGenericErrorModal()}),d.trackEvent("user_clicked_page",n.library,{action:"clickedRemoveCoverImage"}))},n.onChangeCoverImageMouseUp=function(e){1===e.which&&d.trackEvent("user_clicked_page",n.library,{action:"clickedChangeCoverImage"})},n.onMoveCoverImageMouseUp=function(e){if(1===e.which){var i=u.picBase+"/"+n.library.image.path;$(i).then(function(e){var t=k.find(".kf-lh-cover")[0];n.imagePreview={url:i,natural:{w:e.naturalWidth,h:e.naturalHeight},w:t.offsetWidth,h:t.offsetHeight,x:n.library.image.x,y:n.library.image.y}}),d.trackEvent("user_clicked_page",n.library,{action:"clickedMoveCoverImage"})}},n.expandDescription=function(){"webkitLineClamp"in O[0].style&&(O[0].style.display="block");var e=O[0].offsetHeight;n.descExpanded=!0;var i=Math.max(300,Math.min(600,Math.round(100*Math.log(e-B[0].clientHeight))));B.addClass("kf-expanded-add").css({"transition-duration":i+"ms,"+.6*i+"ms","transition-delay":"0s"}),B.addClass("kf-expanded-add-active").css({height:e,"background-color":n.library.color}),o(function(){B.addClass("kf-expanded").removeClass("kf-expanded-add kf-expanded-add-active"),n.descScrollable=O[0].scrollHeight>O[0].clientHeight},i)},n.collapseDescription=function(){n.descExpanded=!1,n.descScrollable=!1;var e=function(){var e=E(B);B.addClass("kf-expanded-remove").css({"transition-duration":e+"ms,"+.8*e+"ms","transition-delay":"0s,"+.2*e+"ms"}),B.addClass("kf-expanded-remove-active").css({height:"","background-color":""}),o(function(){B.removeClass("kf-expanded-remove-active kf-expanded-remove kf-expanded"),"webkitLineClamp"in O[0].style&&(O[0].style.display="")},e)},i=O[0].scrollTop;i>0?A(O[0],i,0,Math.max(100,Math.min(500,100*Math.log(i)))).then(angular.noop,angular.noop,function(i){e&&i>=.5&&(e(),e=null)}):e()},n.isSelf=function(e){return p.me.id===e.id},n.isFollowing=function(){return n.library.membership&&"read_only"===n.library.membership.access},n.isCollaborating=function(){return n.library.membership&&"read_write"===n.library.membership.access},n.isMember=function(){return Boolean(n.library.membership)},n.isOwner=function(){return n.library.membership&&"owner"===n.library.membership.access},n.isOwnerOrCollaborator=function(){return n.library.membership&&("owner"===n.library.membership.access||"read_write"===n.library.membership.access)},n.followLibrary=function(e){if(n.followCallback(),r.$emit("trackLibraryEvent","click",{action:"clickedFollowButton"}),n.isMobile){var t=i.absUrl();return void m.goToAppOrStore(t+(t.indexOf("?")>0?"&":"?")+"follow=true")}return r.userLoggedIn?(n.followBtnJustClicked="followBtn"===(e&&e.via),void d.joinLibrary(n.library.id,K,e&&e.subscribed)["catch"](f.openGenericErrorModal)):g.register({libraryId:n.library.id,intent:"follow",libAuthToken:K})},n.unfollowLibrary=function(){d.trackEvent("user_clicked_page",n.library,{action:"unfollow"}),r.$emit("trackLibraryEvent","click",{action:"clickedUnfollowButton"}),d.leaveLibrary(n.library.id)["catch"](f.openGenericErrorModal)},n.manageLibrary=function(){r.$emit("trackLibraryEvent","click",{action:"clickedManageLibrary"}),f.open({template:"libraries/manageLibraryModal.tpl.html",modalData:{pane:"manage",library:n.library,currentPageOrigin:"libraryPage",returnAction:function(){d.getLibraryById(n.library.id,!0).then(function(e){return d.getLibraryByUserSlug(n.username,e.library.slug,K,!0).then(function(t){_.assign(n.library,t),n.library.subscriptions=e.subscriptions,b(),e.library.slug!==n.librarySlug&&i.url("/"+n.username+"/"+e.library.slug)})})["catch"](f.openGenericErrorModal)}}})},n.toggleEditKeeps=function(){r.$emit("trackLibraryEvent","click",{action:"clickedEditKeeps"}),n.editMode=!n.editMode},n.setGalleryView=function(){n.galleryView=!0,p.savePrefs({use_minimal_keep_card:!1}),d.trackEvent("user_clicked_page",n.library,{action:"clickedGalleryView"})},n.setCompactView=function(){n.galleryView=!1,p.savePrefs({use_minimal_keep_card:!0}),d.trackEvent("user_clicked_page",n.library,{action:"clickedCompactView"})},n.showFollowers=function(){r.$emit("trackLibraryEvent","click",{action:"clickedViewFollowers"}),n.openMembersModal()},n.trackTwitterProfile=function(){d.trackEvent("user_clicked_page",n.library,{action:"clickedTwitterProfileURL"})},n.openMembersModal=function(e){f.open({template:"libraries/libraryMembersModal.tpl.html",modalData:{library:n.library,canManageMembers:n.isOwner()||n.isCollaborating()&&n.collabsCanInvite,amOwner:n.isOwner(),filterType:e,currentPageOrigin:"libraryPage"}})},n.openInviteModal=function(e){f.open({template:"libraries/libraryInviteSearchModal.tpl.html",modalData:{library:n.library,inviteType:e,currentPageOrigin:"libraryPage"}})},l.addEventListener("resize",M),n.$watch("library.numFollowers",y),n.$watch("library.numCollaborators",function(e){var i=4;(n.isOwner()||n.isCollaborating()&&n.collabsCanInvite)&&i--,n.maxNumCollaboratorsToShow=e>i?i-1:i}),[r.$on("libraryKeepCountChanged",function(e,i,t){i===n.library.id&&(n.library.numKeeps=t)}),r.$on("libraryJoined",function(e,i,t){if(i===n.library.id){n.library.membership=t,n.library.invite=null;var r=p.me;"read_only"===t.access?(n.library.numFollowers++,_.contains(n.library.followers,{id:r.id})||n.library.followers.push(_.pick(r,"id","firstName","lastName","pictureName","username"))):"read_write"===t.access&&(n.library.numCollaborators++,_.contains(n.library.collaborators,{id:r.id})||n.library.collaborators.push(_.pick(r,"id","firstName","lastName","pictureName","username")))}}),r.$on("libraryLeft",function(e,i){var t=n.library;t&&i===t.id&&t.membership&&("read_only"===t.membership.access?(t.numFollowers--,_.remove(t.followers,{id:p.me.id})):"read_write"===t.membership.access&&(t.numCollaborators--,_.remove(t.collaborators,{id:p.me.id})),t.membership=void 0)})].forEach(function(e){n.$on("$destroy",e)}),b()}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryHeader.tpl.html",'<div class="kf-lh" itemscope="" itemtype="http://schema.org/CollectionPage"><div class="kf-lh-cover" ng-class="{\'kf-system-main\': library.kind === \'system_main\', \'kf-system-secret\': library.kind === \'system_secret\'}" ng-style="{\'background-color\': library.color}"><meta itemtype="image" content="{{library.image|libImageUrl}}" ng-if="library.image"><meta itemtype="url" content="{{library.absUrl}}"><div class="kf-lh-cover-image" ng-class="{\'kf-fade-in\': !settingImage}" ng-attr-style="{{library.image|shadedBackgroundImage:.2:.6}}" ng-if="library.image && imageLoaded"></div><div class="kf-lh-top"><div class="kf-lh-private svg-card-lock" ng-if="library.visibility === \'secret\'"></div><button class="kf-lh-manage-btn svg-settings-gear-filled" ng-click="manageLibrary()" ng-if="isOwner() && !library.isSystem"></button><div class="kf-lh-cover-menu-parent" kf-click-menu="" ng-if="isOwner() && !library.isSystem"><button class="kf-lh-cover-menu-btn svg-camera-filled" ng-mouseup="onCameraCoverImageMouseUp($event)"></button><menu class="kf-dropdown-menu kf-lh-cover-menu"><button class="kf-dropdown-menu-item kf-lh-cover-move" ng-if="library.image" ng-mouseup="onMoveCoverImageMouseUp($event)">Reposition cover image</button> <button class="kf-dropdown-menu-item kf-lh-cover-change" ng-if="library.image" ng-mouseup="onChangeCoverImageMouseUp($event)" onmouseup="event.button?null:angular.element(\'.kf-lh-cover-file\').click()">Change cover image</button> <button class="kf-dropdown-menu-item kf-lh-cover-remove" ng-if="library.image" ng-mouseup="onRemoveCoverImageMouseUp($event)">Remove cover image</button></menu></div><input class="kf-lh-cover-file" type="file" accept="image/jpeg,image/png,image/gif" kf-file-change="onCoverImageFileChosen" ng-if="isOwner() && !library.isSystem"><div class="kf-lh-subscribe-btn-wrap" ng-if="!isOwner() || library.numCollaborators > 0" ng-class="{\'for-owner\': isOwner()}"><button ng-attr-class="kf-lh-subscribe-btn {{library.membership.subscribed ? \'svg-notification-on-white\' : \'svg-notification-off-white\'}}" ng-click="changeSubscription()"></button><div class="kf-lh-subscribe-msg">Notifications {{library.membership.subscribed ? \'enabled\' : \'disabled\'}}</div></div><div class="kf-lh-followers"><a class="kf-lh-followers-a" ng-repeat="follower in followersToShow" href="{{::follower|profileUrl}}" kf-track-origin="libraryPage/follower"><img class="kf-lh-followers-pic" ng-src="{{::follower|pic:100}}" alt="{{::follower|name}}"> <span class="kf-lh-followers-name">{{::follower.firstName}}</span></a> <button class="kf-lh-followers-more" ng-if="numMoreFollowersText" ng-click="showFollowers()"><span class="kf-lh-followers-more-text kf-{{numMoreFollowers}}">{{numMoreFollowersText}}</span></button></div></div><div class="kf-lh-cover-preview" ng-attr-style="{{imagePreview|shadedBackgroundImage:.2:.6}}" ng-if="imagePreview"></div><div class="kf-lh-cover-glass" ng-class="{\'kf-ew\': imagePreview.progress === undefined && imagePreview.w / imagePreview.natural.w < imagePreview.h / imagePreview.natural.h, \'kf-ns\': imagePreview.progress === undefined && imagePreview.w / imagePreview.natural.w >= imagePreview.h / imagePreview.natural.h}" ng-mouseover="onImagePreviewMouseOver($event)" ng-mousedown="onImagePreviewMouseDown($event)" ng-if="imagePreview"><span class="kf-lh-cover-prompt">Drag to position image</span> <button class="kf-lh-cover-apply" ng-click="applyCoverImageChange()">Apply</button> <button class="kf-lh-cover-cancel" ng-click="cancelCoverImageChange()">Cancel</button><div class="kf-lh-cover-progress" ng-style="{width: imagePreview.progress + \'%\', \'background-color\': imagePreview.progress === 0 ? \'#b00\' : null, \'transition-timing-function\': imagePreview.progress % 100 ? null : \'ease-in\', \'transition-duration\': imagePreview.progress === 0 ? \'.6s\' : null}" ng-if="imagePreview.progress >= 0"></div></div><div class="kf-lh-mid"><div class="kf-lh-icon" ng-class="{\'svg-card-star\': library.kind === \'system_main\', \'svg-card-lock\': library.kind === \'system_secret\'}"></div><h1 class="kf-lh-name" ng-class="{\'kf-long-1\': library.name.length > 24, \'kf-long-2\': library.name.length > 36}" itemtype="name">{{library.name|preventOrphans:16:0.6}}</h1><div class="kf-lh-stats"><span class="kf-lh-stat" ng-pluralize="" count="library.numKeeps" when="{\'one\': \'1 keep\', \'other\': \'{{library.numKeeps|number}} keeps\'}" ng-if="library.numKeeps"></span> <button class="kf-lh-stat" ng-pluralize="" count="library.numFollowers" when="{\'one\': \'1 follower\', \'other\': \'{{library.numFollowers|num}} followers\'}" ng-if="library.numFollowers" ng-click="openMembersModal(\'followers_only\')"></button></div><div class="kf-lh-owner" itemprop="creator" itemscope="" itemtype="http://schema.org/Person" ng-if="library.numCollaborators === 0"><div class="kf-lh-owner-image-wrap"><a class="kf-lh-owner-image-a" href="{{library.owner|profileUrl}}" itemprop="url" kf-track-origin="libraryPage/curator"><img class="kf-lh-owner-image" ng-src="{{library.owner|pic:200}}" itemprop="image" alt="{{library.owner|name}}"></a> <button class="kf-lh-add-collab-button next-to-owner" ng-if="!library.attr.twitter.screenName && isOwner()" ng-click="openInviteModal(\'collaborate\')" ng-style="{\'background-color\': library.color}"><div class="kf-lh-add-collab-icon svg-collaborate-white"></div><span class="kf-lh-add-collab-msg">Invite a collaborator</span></button></div><div class="kf-lh-owner-name-wrap"><a class="kf-lh-owner-name" href="{{library.owner|profileUrl}}" itemprop="name" kf-track-origin="libraryPage/curator">{{library.owner|name}}</a> <a class="kf-lh-owner-twitter-a svg-twitter-blue" href="https://www.twitter.com/{{library.attr.twitter.screenName}}" target="_blank" title="@{{library.attr.twitter.screenName}}" ng-if="library.attr.twitter.screenName" ng-click="trackTwitterProfile()"></a></div></div><div class="kf-lh-collabs" ng-if="library.numCollaborators > 0"><div class="kf-lh-collab-image-wrap" itemprop="creator" itemscope="" itemtype="http://schema.org/Person"><a class="kf-lh-collab-image-a" href="{{library.owner|profileUrl}}" itemprop="url" kf-track-origin="libraryPage/collaborator"><img class="kf-lh-collab-image" ng-src="{{library.owner|pic:200}}" itemprop="image" alt="{{library.owner.firstName}}"></a> <a class="kf-lh-collab-name" href="{{library.owner|profileUrl}}" itemprop="name" kf-track-origin="libraryPage/collaborator">{{library.owner.firstName}}</a></div><div class="kf-lh-collab-image-wrap" itemprop="contributor" itemscope="" itemtype="http://schema.org/Person" ng-repeat="collab in library.collaborators | limitTo:maxNumCollaboratorsToShow"><a class="kf-lh-collab-image-a" href="{{::collab|profileUrl}}" itemprop="url" kf-track-origin="libraryPage/collaborator"><img class="kf-lh-collab-image" ng-src="{{::collab|pic:200}}" itemprop="image" alt="{{::collab|name}}"></a> <a class="kf-lh-collab-name" href="{{::collab|profileUrl}}" itemprop="name" kf-track-origin="libraryPage/collaborator">{{::collab.firstName}}</a></div><button class="kf-lh-more-collab" ng-if="library.numCollaborators > maxNumCollaboratorsToShow" ng-click="openMembersModal(\'collaborators_only\')" ng-style="{\'background-color\': library.color}">+ {{library.numCollaborators - maxNumCollaboratorsToShow|num}}</button> <button class="kf-lh-add-collab-button" ng-if="(isOwner() || (isCollaborating() && library.whoCanInvite == \'collaborator\'))" ng-click="openInviteModal(\'collaborate\')" ng-style="{\'background-color\': library.color}"><div class="kf-lh-add-collab-icon svg-collaborate-white"></div><span class="kf-lh-add-collab-msg">Invite a collaborator</span></button></div></div></div><div class="kf-lh-desc-wrap-2" ng-class="{\'kf-long\': descFits === false}" ng-attr-style="border-color:{{library.color}}"><div class="kf-lh-desc-wrap" kf-wheel-stop="{{descScrollable}}"><div class="kf-lh-desc" ng-bind-html="library.descriptionHtml" itemtype="description" kf-wheel-allow=""></div></div><button class="kf-lh-desc-toggle" ng-click="descExpanded === false ? expandDescription() : descExpanded === true ? collapseDescription() : null">{{descExpanded === false ? \'Continue reading…\' : descExpanded === true ? \'Show less\' : \'\'}}</button> <button class="kf-lh-desc-add" ng-click="manageLibrary()" ng-if="!library.description && isOwner() && !library.isSystem">Add a description</button></div><div class="kf-lh-buttons" ng-if="!isOwnerOrCollaborator()"><button class="kf-lh-view-option" ng-click="setGalleryView()" ng-if="admin"><figure ng-class="galleryView ? \'svg-view-gallery-green\' : \'svg-view-gallery\'"></figure></button> <button class="kf-lh-view-option" ng-click="setCompactView()" ng-if="admin"><figure ng-class="galleryView ? \'svg-view-list\' : \'svg-view-list-green\'"></figure></button><div class="kf-lh-invite-banner" ng-style="{\'background-color\': library.color}" ng-if="library.invite"><img class="kf-lh-invite-pic" ng-src="{{library.invite.inviter|pic:100}}" alt="{{library.invite.inviter|name}}"><div class="kf-lh-invite-banner-text">{{library.invite.inviter|name}} {{library.invite.access === \'read_only\' ? \' has invited you\' : \'would like to\'}}<span></span> {{ library.invite.access === \'read_only\' ? \' to follow\' : \' collaborate with you on\'}} this library</div><button class="kf-lh-invite-banner-button kf-ignore" ng-click="ignoreInvitation()" ng-if="$root.userLoggedIn">Ignore</button> <button class="kf-lh-invite-banner-button kf-accept" ng-click="acceptInvitation()" ng-style="{\'color\': library.color}" ng-if="$root.userLoggedIn">Accept</button> <button class="kf-lh-invite-banner-button kf-continue" ng-click="signupFromInvitation()" ng-if="!$root.userLoggedIn">Continue</button></div><div class="kf-lh-follow-btn-wrap" ng-if="!isMember()"><div kf-library-header-follow-button-cta="" library="library" ng-if="!isMobile && !$root.userLoggedIn && !library.invite"></div><button class="kf-lh-follow-btn" ng-click="followLibrary({via: \'followBtn\'})">Follow</button></div><div class="kf-lh-unfollow-btn-wrap" ng-class="{\'kf-no-unfollow\': followBtnJustClicked, \'kf-overflowing\': overSubsBtn}" ng-if="isFollowing() || isCollaborating()"><button class="kf-lh-unfollow-btn" ng-click="unfollowLibrary()" ng-mouseleave="followBtnJustClicked = false"></button> <button ng-attr-class="kf-lh-subs-btn {{library.membership.subscribed ? \'svg-notification-on-white\' : \'svg-notification-off-white\'}}" ng-click="changeSubscription()" ng-mouseenter="overSubsBtn = true" ng-mouseleave="overSubsBtn = false"></button><div class="kf-lh-subs-msg">Notifications {{library.membership.subscribed ? \'enabled\' : \'disabled\'}}</div></div><button class="kf-lh-invite-search-button" ng-click="openInviteModal(\'follow\')" ng-if="$root.userLoggedIn && (library.visibility === \'published\' || (library.visibility === \'secret\' && isCollaborating() && collabsCanInvite))"><div class="svg-share-arrow-green"></div>Share</button></div><div class="kf-lh-buttons kf-my-lib clearfix" ng-if="isOwnerOrCollaborator()"><button class="kf-lh-view-option" ng-click="setGalleryView()" ng-if="admin"><figure ng-class="galleryView ? \'svg-view-gallery-green\' : \'svg-view-gallery\'"></figure></button> <button class="kf-lh-view-option" ng-click="setCompactView()" ng-if="admin"><figure ng-class="galleryView ? \'svg-view-list\' : \'svg-view-list-green\'"></figure></button> <button class="kf-lh-edit-keeps svg-edit-keeps-green" ng-click="toggleEditKeeps()" ng-if="library.numKeeps > 0 && !librarySearch">{{editMode ? \'Done editing\' : \'Edit keeps\'}}</button> <button class="kf-lh-invite-search-button" ng-click="openInviteModal(\'follow\')" ng-if="!library.isSystem"><div class="svg-share-arrow-green"></div>Invite followers</button></div></div>');
}])}(),angular.module("kifi").directive("kfLibraryHeaderFollowButtonCta",["$rootScope","$timeout","$window","libraryService",function(e,i,t,r){return{restrict:"A",scope:{library:"="},templateUrl:"libraries/libraryHeaderFollowButtonCta.tpl.html",link:function(n,a){function o(e){a.removeClass(e.below?"kf-above":"kf-below").addClass(e.below?"kf-below":"kf-above"),n.whyShowing=e.auto?"timer":"hover",u(),t.removeEventListener("visibilitychange",v),r.trackEvent("visitor_viewed_page",n.library,{type:"libraryLanding",viewType:"hover",subtype:"hoverFollowButton",trigger:e.auto?"timer":"hover"})}function l(e){n.whyShowing=b=null,e&&r.trackEvent("visitor_clicked_page",n.library,{type:"libraryLanding",action:"clickedFollowCTAClose"})}function s(e){u(),k=i(c,e)}function c(){if(u(),!t.document.hidden){var e=d(),r=f(e);if(!r.above||w.deltaY>0&&Date.now()-w.time<100)if(r.below&&!r.above){o({auto:!0,below:!0});var n=w.top+e.bottom+y;b=function(e){return n-C>e}}else k=i(c,500);else{o({auto:!0});var a=w.top+e.top-y;b=function(e){return e>a}}}}function u(){k&&i.cancel(k),k=null}function d(){return S[0].getBoundingClientRect()}function f(e){e=e||d();var i=t.innerHeight-e.bottom;return{above:e.top>y&&i>0,below:i>y&&e.top>0}}function p(){n.whyShowing||n.$apply(function(){o({below:!f().above})})}function m(){"hover"===n.whyShowing&&n.$apply(function(){l()})}function g(){var e=t.pageYOffset;w.time=Date.now(),w.deltaY=e-w.top,w.top=e,b&&b(e)&&l()}function h(){C=t.innerHeight,b&&b(t.pageYOffset)&&l()}function v(){t.document.hidden?u():s(2e3)}n.onClickX=function(){l(!0)};var k,b,y=210,w={top:t.pageYOffset},C=t.innerHeight;t.document.hidden||s(5e3);var S=a.next(".kf-lh-follow-btn");S.on("mouseenter",p),S.on("mouseleave",m),t.addEventListener("scroll",g),t.addEventListener("resize",h),t.addEventListener("visibilitychange",v),n.$on("$destroy",function(){S.off("mouseenter",p),S.off("mouseleave",m),t.removeEventListener("scroll",g),t.removeEventListener("resize",h),t.removeEventListener("visibilitychange",v)}),n.$on("$destroy",e.$on("$stateChangeStart",function(){"timer"===n.whyShowing?l():u()}))}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryHeaderFollowButtonCta.tpl.html",'<div class="kf-lh-fbc" ng-if="whyShowing"><a class="dialog-x" href="javascript:" ng-click="onClickX()" ng-if="whyShowing === \'timer\'"></a><div class="kf-lh-fbc-content"><div class="kf-lh-fbc-main-text">Join Kifi to follow this library.<br>Discover other libraries,<br>and build your own!</div><div class="kf-lh-fbc-user-quote-container"><q class="kf-lh-fbc-user-quote">From business to personal,<br>Kifi has been instrumental<br>in my day-to-day life.</q><footer class="kf-lh-fbc-user-quote-by">Remy Weinstein, California</footer></div></div></div>')}])}(),angular.module("kifi").directive("kfLibraryInviteSearch",["libraryService","profileService","socialService","$timeout","util","KEY","net",function(e,i,t,r,n,a,o){return{restrict:"A",require:"^kfModal",templateUrl:"libraries/libraryInviteSearch.tpl.html",link:function(l,s,c,u){function d(i){return l.share.message&&(i.message=l.share.message),e.shareLibrary(l.library.id,i)}function f(i,t){var r="recommendationsPage"===l.currentPageOrigin?"recommendations":"library",n=_.extend({type:r},t||{});e.trackEvent(i,l.library,n)}function p(){l.results.forEach(function(e){e.selected=!1})}function m(e,i){return i=i||"",n.startsWithCaseInsensitive(e,i)?"<b>"+e.substr(0,i.length)+"</b>"+e.substr(i.length):e}function g(e,i){var t=e.split(/\s+/);return t.forEach(function(e,t,r){r[t]=m(e,i)}),t.join(" ")}function h(i){i&&(l.query=i,l.queryIsValidEmail=!1,n.validateEmail(i)&&(l.queryIsValidEmail=!0)),l.showSpinner=!0,e.getLibraryShareContacts(l.library.id,i).then(function(e){var t;e&&e.length?(i||_.remove(e,function(e){return e.membership&&!e.lastInvitedAt}),t=_.clone(e,!0),t.forEach(function(e){e.id&&(e.isInvited=!!e.lastInvitedAt,e.isFollowing="read_only"===e.membership&&!e.isInvited,e.isCollaborating=("read_write"===e.membership||"owner"===e.membership)&&!e.isInvited,e.name=(e.firstName||"")+(e.lastName?" "+e.lastName:"")),e.name&&(e.name=g(e.name,i)),e.email&&(e.emailFormatted=m(e.email,i))}),i?(b=0,t[b]&&(t[b].selected=!0)):b=-1,e.length<5&&t.push({custom:"email",hideButton:!0})):(t=[{custom:"email",hideButton:!0},{custom:"importGmail",actionable:!0}],i&&n.validateEmail(i)&&(b=0,t[b].selected=!0,t[b].hideButton=!1)),l.showSpinner=!1;var r=w.height(),a=53*t.length+"px";w.height(r).animate({height:a},{duration:70,start:function(){l.results=t}})})}function v(e){return f("user_clicked_page",{action:"clickedContact",subAction:"kifiFriend"}),d({invites:[{type:"user",id:e.id,access:C[l.inviteType]}]}).then(function(){e.sent=!0})}function k(e){return o.updateLibraryMembership(l.library.id,e.id,{access:"read_write"}).then(function(){e.isCollaborating=!0})}var b=-1,y=s.find(".lis-search-input"),w=s.find(".lis-contact-list"),C={collaborate:"read_write",follow:"read_only"};l.results=[],l.search={},l.share={},l.showSpinner=!1,l.query="",l.queryIsValidEmail=!0,l.inviter=i.me,l.library=l.modalData.library,l.inviteType=l.modalData.inviteType,l.currentPageOrigin=l.modalData.currentPageOrigin,l.canInviteCollabs=function(e){return"owner"===e||"read_write"===e&&"collaborator"===l.library.whoCanInvite}((l.library.membership||{}).access),l.onSearchInputChange=_.debounce(function(){h(l.search.name)},200),l.onSearchInputFocus=function(){h(l.search.name)},l.onResultHover=function(e){p(),e.selected=!0,b=_.indexOf(l.results,e)},l.onResultUnhover=function(e){e.selected=!1},l.processKeyEvent=function(e){function i(e,i){var t=e+i;return 0>t||t>l.results.length-1?e:t}switch(e.keyCode){case a.UP:e.preventDefault(),p(),b=i(b,-1),l.results[b].selected=!0;break;case a.DOWN:e.preventDefault(),p(),b=i(b,1),l.results[b].selected=!0;break;case a.ENTER:if(p(),-1!==b){var t=l.results[b];t.id?l.shareLibraryKifiFriend(t):t.email?l.shareLibraryExistingEmail(t):"email"===t.custom?l.shareLibraryNewEmail(t):"importGmail"===t.custom&&l.importGmail()}b=-1;break;case a.ESC:}},l.close=function(){u.close()},l.inviteOrPromote=function(e){return e.isFollowing?k(e):v(e)},l.shareLibraryExistingEmail=function(e){return f("user_clicked_page",{action:"clickedContact",subAction:"existingEmail"}),d({invites:[{type:"email",id:e.email,access:C[l.inviteType]}]}).then(function(){e.sent=!0})},l.shareLibraryNewEmail=function(e){return n.validateEmail(l.search.name)?(f("user_clicked_page",{action:"clickedContact",subAction:"newEmail"}),d({invites:[{type:"email",id:l.search.name,access:C[l.inviteType]}]}).then(function(){e.sent=!0})):void 0},l.importGmail=function(){t.importGmail()},l.toggleSelector=function(){"collaborate"===l.inviteType?l.inviteType="follow":l.inviteType="collaborate"},l.isCollabInvite=function(){return"collaborate"===l.inviteType},l.isFollowInvite=function(){return"follow"===l.inviteType},r(function(){y.focus(),h()},0)}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryInviteSearch.tpl.html",'<div class="library-invite-search dialog-content"><a class="dialog-x library-invites-close-x" ng-click="close()"></a><div class="dialog-body-wrap"><h1 class="dialog-header">{{::canInviteCollabs ? \'Who would you like to invite?\' : \'Share this library\'}}</h1><div class="dialog-body"><div class="lis-select-access-wrapper" ng-if="::canInviteCollabs"><span>Invite people to:</span> <button class="lis-toggle-access" ng-click="toggleSelector()"><div class="lis-toggle-selector" ng-class="{\'toggle\' : isFollowInvite()}" ng-style="{\'background-color\' : library.color}"></div><div class="lis-toggle-option collab svg-collaborate-white" ng-class="{\'on\' : isCollabInvite()}"></div><div class="lis-toggle-option follow svg-share-arrow-white" ng-class="{\'on\' : isFollowInvite()}"></div></button> <span>{{isCollabInvite() ? \'collaborate on\' : \'follow\'}} this library</span><div class="lis-select-access-description">{{isCollabInvite() ? \'Collaborators can add, edit, and remove keeps in this library\': \'Followers can only view keeps in this library\'}}</div></div><textarea rows="1" class="lis-input lis-message-input" ng-model="share.message" placeholder="Write a message (optional)"></textarea><div class="lis-search-box"><img ng-src="//d1dwdv9wd966qu.cloudfront.net/img/spinner_32.a3e788e.gif" ng-show="showSpinner" class="lis-spinner"> <input type="text" ng-model="search.name" class="lis-input lis-search-input" placeholder="Search for people or email" ng-change="onSearchInputChange()" ng-keydown="processKeyEvent($event)" ng-focus="onSearchInputFocus()"> <span class="lis-search-icon svg-search-icon-gray"></span></div><ul class="lis-contact-list" kf-wheel-allow=""><li class="lis-contact" ng-repeat="result in results" ng-mouseenter="onResultHover(result)" ng-mouseleave="onResultUnhover(result)" ng-class="{\'lis-invite-selected\': result.selected, \'lis-invite-actionable\': result.actionable}"><div ng-if="::result.id" class="lis-contact-container lis-invite-user"><a href="{{result|profileUrl}}" ng-click="close()" kf-track-origin="{{currentPageOrigin}}/invitationDropdown"><img ng-src="{{result|pic:100}}" class="lis-contact-image"></a><div class="lis-contact-summary"><div class="lis-contact-name" ng-bind-html="result.name"></div><div class="lis-contact-network">Kifi user</div></div><button ng-show="!result.sent && !((isFollowInvite() && result.isFollowing) || result.isCollaborating)" ng-click="inviteOrPromote(result)" class="lis-contact-button"><span class="lis-invite-icon collaborate svg-collaborate-gray" ng-if="isCollabInvite()"></span> <span class="lis-invite-icon follow svg-share-arrow-gray" ng-if="isFollowInvite()"></span> {{::canInviteCollabs ? \'Invite\' : \'Send\'}}</button><div ng-show="result.isFollowing && isFollowInvite()" class="lis-invite-following">Following</div><div ng-show="result.isCollaborating" class="lis-invite-collaborating">Collaborating</div><div ng-show="result.sent" class="lis-invite-sent">Sent!</div></div><div ng-if="::!result.id && !result.custom" class="lis-contact-container lis-contact-email"><div class="lis-contact-email-icon"></div><div class="lis-contact-summary"><div class="lis-contact-name" ng-bind-html="result.name || result.emailFormatted"></div><div class="lis-contact-network" ng-bind-html="result.name ? result.emailFormatted : \'An email contact\'"></div></div><button ng-show="!result.sent" ng-click="shareLibraryExistingEmail(result)" class="lis-contact-button"><span class="lis-invite-icon collaborate svg-collaborate-gray" ng-if="isCollabInvite()"></span> <span class="lis-invite-icon follow svg-share-arrow-gray" ng-if="isFollowInvite()"></span> {{::canInviteCollabs ? \'Invite\' : \'Send\'}}</button><div ng-show="result.sent" class="lis-invite-sent">Sent!</div></div><div ng-if="::result.custom === \'email\'" class="lis-contact-container lis-contact-new-email"><div class="lis-contact-new-email-icon"></div><div class="lis-contact-summary"><div class="lis-contact-name">{{query || \'Send to any email\'}}</div><div class="lis-contact-network">{{queryIsValidEmail ? \'An email address\' : query ? \'Keep typing the email address\' : \'Type the email address\'}}</div></div><button ng-show="!result.sent && !result.hideButton" ng-click="shareLibraryNewEmail(result)" class="lis-contact-button"><span class="lis-invite-icon collaborate svg-collaborate-gray" ng-if="isCollabInvite()"></span> <span class="lis-invite-icon follow svg-share-arrow-gray" ng-if="isFollowInvite()"></span> {{::canInviteCollabs ? \'Invite\' : \'Send\'}}</button><div ng-show="result.sent" class="lis-invite-sent">Sent!</div></div><div ng-if="result.custom === \'importGmail\'" ng-click="importGmail()" class="lis-contact-container lis-import-gmail"><div class="lis-contact-gmail-icon"></div><div class="lis-contact-summary"><div class="lis-contact-import-gmail">Import Gmail contacts</div></div></div></li></ul></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryInviteSearchModal.tpl.html",'<div kf-modal="" class="kf-library-invite-search" kf-width="400px"><div kf-library-invite-search=""></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryKeeps.tpl.html",'<div><div class="kf-lk-empty" ng-if="keeps.length === 0" ng-show="!loading"><div ng-if="userIsOwner">You don’t have any keeps in this library yet. You can:<ul><li><button class="kf-lk-empty-btn" ng-click="callAddKeep()"><span class="sprite sprite-add-link"></span>Add any page by pasting the URL here</button></li><li><button class="kf-lk-empty-btn" ng-click="callImportBookmarks()"><span class="sprite sprite-import-bookmarks-icon"></span>Import your bookmarks from your browser</button></li><li><button class="kf-lk-empty-btn" ng-click="callImportBookmarkFile()"><span class="sprite sprite-import-from-other-services-icon"></span>Import links from sites like Delicious, Pocket, Pinboard</button></li><li class="kf-lk-empty-install"><button class="kf-lk-empty-btn" ng-click="triggerInstall()"><span class="sprite sprite-install-extension-icon"></span>Install our browser extension on Chrome and Firefox</button></li></ul></div><div ng-if="!userIsOwner"><p>{{library.owner.firstName || \'The curator\'}} hasn’t added anything to this library yet.</p><p ng-hide="$root.userLoggedIn">Want to create and share your own libraries? <a href="/signup" target="_self">Sign up</a> to join the Kifi family.</p></div></div><div class="kf-keeps" kf-keeps="" library="library" keeps="keeps" keeps-loading="loading" keeps-has-more="hasMore" scroll-disabled="!hasMore" scroll-distance="scrollDistance" scroll-next="getNextKeeps" edit="edit" keep-click="libraryKeepClicked" current-page-origin="libraryPage" gallery-view="galleryView"></div></div>')}])}(),angular.module("kifi").directive("kfLibraryMembers",["libraryService","profileService","$timeout","net",function(e,i,t,r){return{restrict:"A",require:"^kfModal",templateUrl:"libraries/libraryMembers.tpl.html",link:function(n,a,o,l){function s(){b||n.library.id&&(b=!0,e.getMoreMembers(n.library.id,k,n.offset).then(function(e){var i=e.members;b=!1,0===i.length?n.moreMembers=!1:(n.moreMembers=!0,n.offset+=1,i=c(i,n.filterType),n.memberList.push.apply(n.memberList,i))}))}function c(e,i){return"followers_only"===i?e=_.filter(e,{membership:"read_only"}):"collaborators_only"===i&&(e=_.filter(e,{membership:"read_write"})),e}function u(e,i){return n.selectedMember=e,r.updateLibraryMembership(n.library.id,e.id,{access:i})}function d(e){var i=_.find(n.memberList,{id:n.selectedMember.id}),t=i.membership;i.membership=e,f(t,e)}function f(e,i){i!==e&&(n.selectedMember.id===n.me.id&&(i?n.library.membership.access=i:n.library.membership=null),e===m?(n.library.numCollaborators-=1,_.remove(n.library.collaborators,{id:n.selectedMember.id})):e===p&&(n.library.numFollowers-=1,_.remove(n.library.followers,{id:n.selectedMember.id})),i===m?(n.library.numCollaborators+=1,n.library.collaborators.push(n.selectedMember)):i===p&&(n.library.numFollowers+=1,n.library.followers.push(n.selectedMember)))}var p="read_only",m="read_write",g="none",h="owner",v="collaborator";n.moreMembers=!0,n.selectedMember=null,n.memberList=[],n.memberScrollDistance="100%",n.me=i.me,n.isMemberScrollDisabled=function(){return!n.moreMembers},n.memberScrollNext=function(){s()};var k=10;n.offset=0;var b=!1;n.isCollaborator=function(e){return e.membership===m},n.isFollower=function(e){return e.membership===p},n.toggleWhoCanInvite=function(){e.modifyLibrary({id:n.library.id,whoCanInvite:n.collabCanInvite?h:v},!1),n.collabCanInvite=!n.collabCanInvite,n.library.whoCanInvite=n.collabCanInvite?v:h},n.changeToFollower=function(e){u(e,p).then(function(){d(p)})},n.changeToCollaborator=function(e){u(e,m).then(function(){d(m)})},n.removeMember=function(e){u(e,g).then(function(){t(function(){_.remove(n.memberList,{id:n.selectedMember.id}),f(n.selectedMember.membership)})})},n.displayNumCollabs=function(){return n.library&&n.library.numCollaborators?n.library.numCollaborators+1:0},n.close=function(){t(function(){l.close()})},n.modalData&&(n.library=n.modalData.library,n.collabCanInvite=n.library.whoCanInvite===v,n.modalTitle=n.library.name,n.canManage=n.modalData.canManageMembers,n.currentPageOrigin=n.modalData.currentPageOrigin,n.amOwner=n.modalData.amOwner,n.filterType=n.modalData.filterType)}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryMembers.tpl.html",'<div class="library-members dialog-content"><a class="dialog-x" ng-click="close()"></a><div class="dialog-body-wrap"><h1 class="dialog-header">{{library.numFollowers > 0 || library.numCollaborators > 0 ? canManage ? \'Manage members in this library\' : \'View members in this library\' : library.name}}</h1><div class="dialog-body"><div class="lmm-stats-box" ng-if="library.numFollowers > 0 || library.numCollaborators > 0"><ng-pluralize count="displayNumCollabs()" when="{\'0\' : \'\', \'one\': \'1 collaborator\', \'other\': \'{} collaborators\'}" ng-hide="filterType === \'followers_only\'"></ng-pluralize><span ng-if="(library.numCollaborators > 0 && library.numFollowers > 0) && !filterType">&nbsp;and&nbsp;</span><ng-pluralize count="library.numFollowers" when="{\'0\' : \'\', \'one\': \'1 follower\', \'other\': \'{} followers\'}" ng-hide="filterType === \'collaborators_only\'"></ng-pluralize></div><div class="lmm-members-content"><div class="lmm-members-content-list" kf-wheel-allow="" smart-scroll="" scroll-distance="memberScrollDistance" scroll-disabled="isMemberScrollDisabled()" scroll-next="memberScrollNext()"><ul class="lmm-members-list"><li class="lmm-member-item"><a href="{{library.owner|profileUrl}}" class="lmm-member-link" kf-track-origin="{{currentPageOrigin}}/curator" ng-click="close()"><img ng-src="{{library.owner | pic:100}}" alt="{{library.owner|name}}" class="lmm-member-pic"></a><div class="lmm-member-info-wrapper"><div class="lmm-member-info-name">{{library.owner|name}}</div><span class="lmm-member-info-icon svg-collaborators-green"></span> <span class="lmm-member-info-state collab">{{library.numCollaborators > 0 ? \'Collaborator\' : \'Owner\'}}</span></div></li><li class="lmm-member-item" ng-repeat="member in memberList"><a href="{{member|profileUrl}}" class="lmm-member-link" kf-track-origin="{{currentPageOrigin}}/member" ng-click="close()"><img ng-src="{{member | pic:100}}" alt="{{member|name}}" class="lmm-member-pic" ng-if="member.id"><div class="lmm-member-email svg-envelope" ng-if="!member.id"></div></a><div class="lmm-member-info-wrapper"><div class="lmm-member-info-name">{{member.firstName ? member.firstName + \' \' + member.lastName : member.email}}</div><span class="lmm-member-info-icon svg-collaborators-green" ng-if="isCollaborator(member) && !member.lastInvitedAt"></span> <span class="lmm-member-info-state" ng-class="{\'collab\' : isCollaborator(member) && !member.lastInvitedAt}">{{isCollaborator(member) && !member.lastInvitedAt ? \'Collaborator\' : isFollower(member) && !member.lastInvitedAt ? \'Follower\' : isCollaborator(member) ? \'Invite to collaborate pending\' : \'Invite to follow pending\'}}</span></div><div class="lmm-member-dropdown-parent" kf-hover-menu="" ng-if="canManage && !member.lastInvitedAt"><div class="svg-dropdown-arrow"></div><menu class="kf-dropdown-menu"><button class="kf-dropdown-menu-item" ng-if="isFollower(member)" ng-click="changeToCollaborator(member)">Make collaborator</button> <button class="kf-dropdown-menu-item" ng-if="isCollaborator(member)" ng-click="changeToFollower(member)">Make follower</button> <button class="kf-dropdown-menu-item" ng-click="removeMember(member)">Remove</button></menu></div></li></ul></div></div><div class="lmm-set-who-can-invite" ng-if="amOwner"><input type="checkbox" ng-model="collabCanInvite" ng-change="toggleWhoCanInvite()"> Allow collaborators to invite other collaborators</div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryMembersModal.tpl.html",'<div kf-modal="" class="kf-library-members" kf-width="420px"><div kf-library-members=""></div></div>')}])}(),angular.module("kifi").factory("libraryService",["$http","$rootScope","profileService","routeService","$q","$analytics","net",function(e,i,t,r,n,a,o){function l(e){return d.isLibraryMainOrSecret(e)&&(e.color="#808080"),e}function s(e){var i=e[0],t=e[1];this.id=i.id,this.owner=i.owner,this.numFollowers=i.numFollowers,this.numKeeps=i.numKeeps,this.name=i.name,this.description=i.description,this.color=i.color,this.image=i.image,this.path="/"+i.owner.username+"/"+i.slug,this.reason=t,this.followers=i.followers}var c,u=[],d={getOwnInfos:function(){return(c||[]).slice()},getSysMainInfo:function(){return _.find(c,{kind:"system_main"})},getSysSecretInfo:function(){return _.find(c,{kind:"system_secret"})},isLibraryMainOrSecret:function(e){return"system_main"===e.kind||"system_secret"===e.kind},isLibraryIdMainOrSecret:function(e){var i=_.find(c,{id:e});return i&&d.isLibraryMainOrSecret(i)},getLibraryNameError:function(e,i){return e?e.length<3?"Please try a longer name":e.length>50?"Please try a shorter name":/['"\/\\]/.test(e)?"Please no slashes or quotes in your library name":i&&e!==i&&_.some(c,{name:e})?"You already have a library with this name":null:"Please enter a name for your library"},fetchLibraryInfos:function(e){return e&&o.getLibraryInfos.clearCache(),o.getLibraryInfos().then(function(e){c=e.data.libraries.map(l)})},getLibraryById:function(e,i){return i&&o.getLibraryById.clearCache(),o.getLibraryById(e).then(function(e){return e.data})},getLibraryInfoById:function(e){return o.getLibraryInfoById(e).then(function(e){return l(e.data)})},getLibraryByUserSlug:function(e,i,t,r){return r&&o.getLibraryByUserSlug.clearCache(),o.getLibraryByUserSlug(e,i,{authToken:t}).then(function(e){return e.data.library.suggestedSearches=e.data.suggestedSearches&&e.data.suggestedSearches.terms||[],e.data.library.subscriptions=e.data.subscriptions,l(e.data.library)})},getKeepsInLibrary:function(e,i,t){return o.getKeepsInLibrary(e,{count:10,offset:i,authToken:t||[]}).then(function(e){return e.data})},expireKeepsInLibraries:function(){o.getKeepsInLibrary.clearCache(),o.getLibraryByUserSlug.clearCache()},addToLibraryCount:function(e,t){var r=_.find(c,{id:e});r.numKeeps+=t,i.$emit("libraryKeepCountChanged",e,r.numKeeps)},createLibrary:function(i,t){if(t){var a=_.filter(["name","visibility","slug"],function(e){return!i[e]});if(a.length>0)return n.reject({error:"missing fields: "+a.join(", ")})}return e.post(r.createLibrary,i)},modifyLibrary:function(i,t){if(t){var a=["name","visibility","slug"],o=_.filter(a,function(e){return void 0===i[e]});if(o.length>0)return n.reject({error:"missing fields: "+o.join(", ")})}return e.post(r.modifyLibrary(i.id),i)},getLibraryShareContacts:function(e,i){return o.getLibraryShareSuggest(e,{q:i||[]}).then(function(e){return e.data.members})},shareLibrary:function(i,t){var a=["invites"],o=_.filter(a,function(e){return void 0===t[e]});return o.length>0?n.reject({error:"missing fields: "+o.join(", ")}):e.post(r.shareLibrary(i),t)},joinLibrary:function(t,n,a){return e.post(r.joinLibrary(t,n,a)).then(function(e){return i.$emit("libraryJoined",t,e.data.membership),o.getLibraryInfoById.clearCache(),e.data.membership})},leaveLibrary:function(t){return e.post(r.leaveLibrary(t)).then(function(){i.$emit("libraryLeft",t),o.getLibraryInfoById.clearCache()})},declineToJoinLibrary:function(i){return e.post(r.declineToJoinLibrary(i))},deleteLibrary:function(t){return e.post(r.deleteLibrary(t)).then(function(){_.remove(c,{id:t}),i.$emit("libraryDeleted",t)})},authIntoLibrary:function(i,t,n,a){return e.post(r.authIntoLibrary(i,t,n),{passPhrase:a}).then(function(e){return e})},copyKeepsFromTagToLibrary:function(i,t){return e.post(r.copyKeepsFromTagToLibrary(i,t)).then(function(e){return e.data})},moveKeepsFromTagToLibrary:function(i,t){return e.post(r.moveKeepsFromTagToLibrary(i,t)).then(function(e){return e.data})},getMoreMembers:function(i,t,n){return e.get(r.getMoreLibraryMembers(i,t,n)).then(function(e){return e.data})},updateSubscriptionToLibrary:function(i,t){return e.post(r.updateSubscriptionToLibrary(i,t)).then(function(e){return e.data})},noteLibraryViewed:function(e){(_.find(c,{id:e})||{}).lastViewed=Date.now()},noteLibraryKeptTo:function(e){_.remove(u,e),u.unshift(e),u.length>3&&(u.length=3),(_.find(c,{id:e})||{}).lastKept=Date.now()},getRecentIds:function(){return u.slice()},isMyLibrary:function(e){return e.owner&&e.owner.id===t.me.id},getCommonTrackingAttributes:function(e){var t="secret"===e.visibility?"private":e.visibility,r={type:i.userLoggedIn?"library":"libraryLanding",followerCount:e.numFollowers,followingLibrary:"read_only"===e.access,keepCount:e.numKeeps,libraryId:e.id,libraryOwnerUserId:e.owner.id,libraryOwnerUserName:e.owner.username,owner:d.isMyLibrary(e),privacySetting:t,hasCoverImage:!!e.image,source:"site"};return"published"===e.visibility&&(r.libraryName=e.name),r},getRelatedLibraries:function(i){var t=n.defer();return e.get(r.getRelatedLibraries(i)).then(function(e){var i=_.zip(e.data.libs,e.data.kinds),r=i.map(function(e){return new s(e)});t.resolve(r)}),t.promise},trackEvent:function(e,i,t){var r=d.getCommonTrackingAttributes(i);t=_.extend(r,t||{}),a.eventTrack(e,t)}};return d}]),angular.module("kifi").directive("kfLibraryShareSearch",["$document","$timeout","friendService","KEY","libraryService","socialService","profileService","util",function(e,i,t,r,n,a,o,l){return{restrict:"A",replace:!0,scope:{library:"=",manageLibInvite:"=",currentPageOrigin:"@",btnIconClass:"@",close:"&"},templateUrl:"libraries/libraryShareSearch.tpl.html",link:function(t,s){function c(){t.manageLibInvite&&(C.attr("placeholder","Type a name or email"),u())}function u(){y=-1,p(),t.search.name="",t.share.message="",t.email="Send to any email",e.on("click",f),$=!0,w.show(),S.scrollTop(0),b("user_clicked_page",{action:"clickedShareEmail"}),t.manageLibInvite||i(function(){C.focus(),h()},0)}function d(){e.off("click",f),$=!1,i.cancel(x),w.hide()}function f(e){s.find(e.target)[0]||t.$apply(function(){t.manageLibInvite?t.results.length=0:d()})}function p(){t.results.forEach(function(e){e.selected=!1})}function m(e,i){return i=i||"",l.startsWithCaseInsensitive(e,i)?"<b>"+e.substr(0,i.length)+"</b>"+e.substr(i.length):e}function g(e,i){var t=e.split(/\s+/);return t.forEach(function(e,t,r){r[t]=m(e,i)}),t.join(" ")}function h(e){e&&(t.email=e,t.emailHelp="Keep typing the email address",l.validateEmail(e)&&(t.emailHelp="An email address")),t.showSpinner=!0,n.getLibraryShareContacts(t.library.id,e).then(function(i){var r;i&&i.length?(e||_.remove(i,function(e){return e.membership&&!e.lastInvitedAt}),r=_.clone(i,!0),r.forEach(function(i){i.id&&(i.isInvited=!!i.lastInvitedAt,i.isFollowing=!!i.membership&&!i.isInvited,i.name=(i.firstName||"")+(i.lastName?" "+i.lastName:"")),i.name&&(i.name=g(i.name,e)),i.email&&(i.emailFormatted=m(i.email,e))}),e?(y=0,r[y]&&(r[y].selected=!0)):y=-1,i.length<5&&r.push({custom:"email",hideButton:!0})):(r=[{custom:"email",hideButton:!0},{custom:"importGmail",actionable:!0}],e&&l.validateEmail(e)&&(y=0,r[y].selected=!0,r[y].hideButton=!1)),t.showSpinner=!1;var n=s.find(".library-share-contact-list"),a=n.height(),o=53*r.length+"px";n.height(a).animate({height:o},{duration:70,start:function(){t.results=r}})})}function v(e){return t.share.message&&(e.message=t.share.message),n.shareLibrary(t.library.id,e)}function k(e){function t(){L=!0,x=i(function(){L=!1},200)}var r=53,n=5,a=e*r,o=S.scrollTop(),l=o+n*r;o>a?(S.scrollTop(a),t()):a>l-r&&(S.scrollTop(a-(n-1)*r),t())}function b(e,i){var r="recommendationsPage"===t.currentPageOrigin?"recommendations":"library",a=_.extend({type:r},i||{});n.trackEvent(e,t.library,a)}var y=-1,w=s.find(".library-share-menu"),C=s.find(".library-share-search-input"),S=s.find(".library-share-contact-list"),$=!1,L=!1,x=null;t.isOwn=t.library.owner.id===o.me.id,t.results=[],t.search={},t.share={},t.showSpinner=!1,t.email="Send to any email",t.emailHelp="Type the email address",t.toggleMenu=function(){$?d():u()},t.onSearchInputChange=_.debounce(function(){h(t.search.name)},200),t.onSearchInputFocus=function(){h(t.search.name)},t.onResultHover=function(e){p(),e.selected=!0,y=_.indexOf(t.results,e)},t.onResultUnhover=function(e){e.selected=!1},t.processKeyEvent=function(e){function i(e,i){var r=e+i;return 0>r||r>t.results.length-1?e:r}switch(e.keyCode){case r.UP:e.preventDefault(),p(),y=i(y,-1),t.results[y].selected=!0,k(y);break;case r.DOWN:e.preventDefault(),p(),y=i(y,1),t.results[y].selected=!0,k(y);break;case r.ENTER:if(p(),-1!==y){var n=t.results[y];n.id?t.shareLibraryKifiFriend(n):n.email?t.shareLibraryExistingEmail(n):"email"===n.custom?t.shareLibraryNewEmail(n):"importGmail"===n.custom&&t.importGmail()}y=-1;break;case r.ESC:d()}},t.shareLibraryKifiFriend=function(e){return b("user_clicked_page",{action:"clickedContact",subAction:"kifiFriend"}),v({invites:[{type:"user",id:e.id,access:"read_only"}]}).then(function(){e.sent=!0})},t.shareLibraryExistingEmail=function(e){return b("user_clicked_page",{action:"clickedContact",subAction:"existingEmail"}),v({invites:[{type:"email",id:e.email,access:"read_only"}]}).then(function(){e.sent=!0})},t.shareLibraryNewEmail=function(e){return l.validateEmail(t.search.name)?(b("user_clicked_page",{action:"clickedContact",subAction:"newEmail"}),v({invites:[{type:"email",id:t.search.name,access:"read_only"}]}).then(function(){e.sent=!0})):void 0},t.importGmail=function(){a.importGmail()},c()}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryShareSearch.tpl.html",'<div class="kf-library-share-search"><button ng-if="!manageLibInvite" class="kf-button kf-button-text-optional library-share-button" ng-click="toggleMenu()"><span class="kf-button-icon {{btnIconClass || (isOwn ? \'svg-plus-people-green\' : \'svg-share-icon\')}}"></span> {{isOwn ? \'Invite followers\' : \'Share\'}}</button><div class="library-share-menu"><header ng-if="!manageLibInvite" class="library-share-menu-header">{{isOwn ? \'Invite people to follow\' : \'Share\'}} this library</header><div class="library-share-menu-content" kf-wheel-stop=""><textarea ng-if="!manageLibInvite" class="library-share-input-box library-share-input library-share-message-input" ng-model="share.message" placeholder="Write something?"></textarea><div class="library-share-input-box"><img ng-src="//d1dwdv9wd966qu.cloudfront.net/img/spinner_32.a3e788e.gif" ng-show="showSpinner" class="library-share-search-spinner"> <input type="text" ng-model="search.name" class="library-share-input library-share-search-input" placeholder="Search people" ng-change="onSearchInputChange()" ng-keydown="processKeyEvent($event)" ng-focus="onSearchInputFocus()"> <span ng-if="manageLibInvite" class="library-share-search-icon svg-search-icon-gray"></span></div><ul class="library-share-contact-list" kf-wheel-allow=""><li class="library-share-contact" ng-repeat="result in results" ng-mouseenter="onResultHover(result)" ng-mouseleave="onResultUnhover(result)" ng-class="{\'library-share-selected\': result.selected, \'library-share-actionable\': result.actionable}"><div ng-if="result.id" class="library-share-contact-container library-share-kifi"><a href="{{result|profileUrl}}" ng-click="close()" kf-track-origin="{{currentPageOrigin}}/invitationDropdown"><img ng-src="{{result | pic:100}}" class="library-share-contact-image"></a><div class="library-share-contact-summary"><div class="library-share-contact-name" ng-bind-html="result.name"></div><div class="library-share-contact-network">Kifi user</div></div><button ng-show="!result.sent && !result.isFollowing" ng-click="shareLibraryKifiFriend(result)" class="kf-button library-share-contact-button"><span class="kf-button-icon svg-share-icon"></span>Send</button><div ng-show="result.isFollowing" class="library-share-following">Following</div><div ng-show="result.sent" class="library-share-sent">Sent!</div></div><div ng-if="!result.id && !result.custom" class="library-share-contact-container library-share-email"><div class="library-share-contact-email-icon"></div><div class="library-share-contact-summary"><div class="library-share-contact-name" ng-bind-html="result.name || result.emailFormatted"></div><div class="library-share-contact-network" ng-bind-html="result.name ? result.emailFormatted : \'An email contact\'"></div></div><button ng-show="!result.sent" ng-click="shareLibraryExistingEmail(result)" class="kf-button library-share-contact-button"><span class="kf-button-icon svg-share-icon"></span>Send</button><div ng-show="result.sent" class="library-share-sent">Sent!</div></div><div ng-if="result.custom === \'email\'" class="library-share-contact-container library-share-new-email"><div class="library-share-contact-new-email-icon"></div><div class="library-share-contact-summary"><div class="library-share-contact-name">{{email}}</div><div class="library-share-contact-network">{{emailHelp}}</div></div><button ng-show="!result.sent && !result.hideButton" ng-click="shareLibraryNewEmail(result)" class="kf-button library-share-contact-button"><span class="kf-button-icon svg-share-icon"></span>Send</button><div ng-show="result.sent" class="library-share-sent">Sent!</div></div><div ng-if="result.custom === \'importGmail\'" ng-click="importGmail()" class="library-share-contact-container library-share-import-gmail"><div class="library-share-contact-gmail-icon"></div><div class="library-share-contact-summary"><div class="library-share-contact-import-gmail">Import Gmail contacts</div></div></div></li></ul></div></div></div>');
}])}(),angular.module("kifi").directive("kfLibraryVisibilityCheckbox",["$timeout",function(e){return{restrict:"A",replace:!0,templateUrl:"libraries/libraryVisibilityCheckbox.tpl.html",scope:{library:"="},link:function(i,t){e(function(){t.find(".library-visibility-custom-input").addClass("kf-transitions")})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/libraryVisibilityCheckbox.tpl.html",'<label><input class="library-visibility-input" type="checkbox" ng-model="library.visibility" ng-false-value="\'published\'" ng-true-value="\'secret\'"><div class="library-visibility-custom-input"><div class="library-visibility-custom-input-public-background"></div><div class="library-visibility-custom-input-secret-background svg-card-lock"></div></div></label>')}])}(),angular.module("kifi").directive("kfManageLibrary",["$location","$state","friendService","libraryService","modalService","profileService","util",function(e,i,t,r,n,a,o){return{restrict:"A",require:"^kfModal",templateUrl:"libraries/manageLibrary.tpl.html",link:function(t,l,s,c){var u=null,d=!1,f={"#447ab7":"blue","#5ab7e7":"sky_blue","#4fc49e":"green","#f99457":"orange","#dd5c60":"red","#c16c9e":"magenta","#9166ac":"purple"};t.username=a.me.username,t.userHasEditedSlug=!1,t.emptySlug=!0,t.$error={},t.showFollowers=!1,t.colors=["#447ab7","#5ab7e7","#4fc49e","#f99457","#dd5c60","#c16c9e","#9166ac"],t.currentPageOrigin="",t.showSubIntegrations=!1,t.newBlankSub=function(){return{name:"",info:{kind:"slack",url:""}}},t.showError=!1,t.close=function(){c.close()},t.editSlug=function(){t.emptySlug=!t.library.slug,t.userHasEditedSlug=!0},t.toggleIntegrations=function(){t.showIntegrations=!t.showIntegrations},t.addIfEnter=function(e){13===e.keyCode&&(e.preventDefault(),t.addSubscription())},t.preventNewline=function(e){13===e.keyCode&&e.preventDefault()},t.addSubscription=function(){var e=t.library.subscriptions.slice(-1)[0];(""!==e.name||""!==e.info.url)&&t.library.subscriptions.push(t.newBlankSub())},t.removeSubscription=function(e){t.library.subscriptions.splice(e,1)},t.saveLibrary=function(){if(!d&&(t.$error={},t.library.subscriptions.forEach(function(e){(""!==e.name||""!==e.info.url)&&(e.name&&(e.name=e.name.toLowerCase()),(!e.name||e.name.indexOf(" ")>-1)&&(e.$error=e.$error||{},e.$error.name=!0,t.$error.general="Please enter a valid Slack channel name for each subscription."),(""===e.info.url||null==e.info.url.match(/https:\/\/hooks.slack.com\/services\/.*\/.*/i))&&(e.$error=e.$error||{},e.$error.url=!0,t.$error.general="Please enter a valid webhook URL for each subscription."))}),!t.$error.general&&(t.$error.name=r.getLibraryNameError(t.library.name,t.modalData&&t.modalData.library&&t.modalData.library.name),!t.$error.name))){t.userHasEditedSlug&&(t.library.slug=o.generateSlug(t.library.slug)),d=!0;var i=_.filter(t.library.subscriptions,function(e){return""!==e.name&&""!==e.info.url});r[t.modifyingExistingLibrary&&t.library.id?"modifyLibrary":"createLibrary"]({id:t.library.id,name:t.library.name,description:t.library.description,slug:t.library.slug,visibility:t.library.visibility,listed:t.library.membership.listed,color:f[t.library.color],subscriptions:i},!0).then(function(n){r.fetchLibraryInfos(!0);var a=n.data.library;a.listed=n.data.listed||n.data.library.membership&&n.data.library.membership.listed,t.$error={},d=!1,t.close(),t.library.subscriptions=i,u?u(a):e.url(a.url)})["catch"](function(e){d=!1;var i=e.data&&e.data.error;switch(i){case"invalid_name":t.$error.general="The name you picked isn’t valid. Try using only letters and numbers.";break;case"invalid_slug":t.$error.general="The URL you picked isn’t valid. Try using only letters and numbers.";break;case"library_name_exists":t.$error.general="You already have a library with this name. Pick another.";break;case"library_slug_exists":t.$error.general="You already have a library with the same URL. Pick another.";break;default:t.$error.general="Hmm, something went wrong. Try again later?"}})}},t.openDeleteLibraryModal=function(){n.open({template:"libraries/deleteLibraryConfirmModal.tpl.html",scope:t})},t.deleteLibrary=function(){d||(d=!0,r.deleteLibrary(t.library.id).then(function(){i.is("library.keeps")&&i.href("library.keeps")===t.library.url&&e.url("/")})["catch"](n.openGenericErrorModal)["finally"](function(){d=!1}),t.close())},t.showFollowersPanel=function(){t.showFollowers=!0},t.hideFollowersPanel=function(){t.viewFollowersFirst=!1,t.showFollowers=!1},t.$watch("library.name",function(e,i){e!==i&&(t.$error.name=null,!t.library.name||t.userHasEditedSlug||t.modifyingExistingLibrary||(t.library.slug=o.generateSlug(e),t.emptySlug=!1))}),t.modalData&&t.modalData.library?(t.library=_.cloneDeep(t.modalData.library),t.library.followers.forEach(function(e){e.status="Following"}),t.modifyingExistingLibrary=!0,t.emptySlug=!1,t.modalTitle=t.library.name,t.library.subscriptions=t.library.subscriptions||[],t.library.subscriptions.length<3&&t.library.subscriptions.push(t.newBlankSub())):(t.library={name:"",description:"",slug:"",visibility:"published"},t.library.membership={access:"owner",listed:!0,subscribed:!1},t.library.subscriptions=[t.newBlankSub()],t.modalTitle="Create a library"),u=t.modalData&&t.modalData.returnAction,t.currentPageOrigin=t.modalData&&t.modalData.currentPageOrigin,l.find(".manage-lib-name-input").focus()}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/manageLibrary.tpl.html",'<div class="manage-library dialog-content"><a class="dialog-x manage-library-close-x" ng-click="close()"></a><div class="dialog-body-wrap"><h1 class="dialog-header"><button ng-if="showFollowers" class="go-back-button" ng-click="hideFollowersPanel()"><span class="go-back-left-arrow"></span>Back</button> {{modalTitle}}</h1><div class="dialog-body" kf-wheel-allow=""><div class="manage-lib-content"><div ng-hide="showFollowers" ng-if="!viewFollowersFirst" class="dialog-text manage-lib-default-content"><div class="manage-lib-input-wrapper"><span class="manage-lib-heading">Name</span> <input class="manage-lib-input manage-lib-name-input ng-pristine ng-valid" ng-model="library.name" type="text" name="name" placeholder="Type a name for your library..." autocomplete="off" novalidate=""> <span ng-show="$error.name" class="manage-lib-name-error">{{$error.name}}</span> <label class="manage-lib-slug"><span class="manage-lib-slug-1">kifi.com/{{username}}/</span> <span class="manage-lib-slug-2"><input ng-change="editSlug()" class="manage-lib-slug-input ng-pristine ng-valid" ng-model="library.slug" ng-class="{ \'non-empty-slug\': !emptySlug }" type="text" name="slug" placeholder="new-library" novalidate=""></span></label></div><div class="manage-lib-input-wrapper"><span class="manage-lib-heading">Description</span><textarea class="manage-lib-input manage-lib-description-input ng-pristine ng-valid" ng-model="library.description" name="description" placeholder="Add a description..." novalidate=""></textarea></div><div class="manage-lib-input-wrapper"><div class="manage-lib-heading">Privacy</div><div class="manage-lib-create-visibility-input-container"><span kf-library-visibility-checkbox="" library="library"></span></div><div ng-switch="library.visibility" class="manage-lib-visibility-description"><div ng-switch-default="" class="manage-lib-visibility-description-content">Anyone can see and follow this library<div class="manage-lib-listed-visibility"><input type="checkbox" id="listed-visibility-checkbox" ng-model="library.membership.listed"> <label for="listed-visibility-checkbox"><span></span> List this library on my public profile</label></div></div><div ng-switch-when="secret" class="manage-lib-visibility-description-content">Only people you invite can see this library</div></div></div><div class="manage-lib-input-wrapper kf-color"><div class="manage-lib-heading">Color</div><label ng-repeat="hex in colors" class="manage-lib-color" style="background-color:{{hex}}"><input type="radio" class="manage-lib-color-radio" value="{{hex}}" ng-model="library.color"> <span class="svg-checkmark-thin"></span></label></div><div class="manage-lib-input-wrapper"><div class="manage-lib-integrations-title-wrapper" href="javascript:" ng-click="toggleIntegrations()"><div class="manage-lib-integrations-arrow" ng-class="{\'active\':showIntegrations}"></div><span class="manage-lib-integrations-title" ng-class="{\'active\':showIntegrations}">Integrations</span></div><div manage-lib-subs=""><div class="manage-lib-integration-view" ng-show="showIntegrations"><div class="manage-lib-subs-heading">Slack</div><div class="manage-lib-subs-instruct"><b>It\'s easy to push updates from this library to one of your company\'s Slack channels.</b><br>To configure the integration between Kifi and Slack:<li>Log into Slack, then <a href="https://slack.com/services/new/incoming-webhook" target="_blank">go to this page</a>.</li><li>Choose a default channel, then click "Add Incoming WebHooks Integration"</li><li>Copy the Webhook URL, and paste it in the URL fields below.</li><li>Enter the name of the #channel, @person, or group you want updates sent to, then "Save".</li>All new keeps added to this library will now appear in your Slack channel as well!</div><table class="manage-lib-subs-table"><form name="slackForm"><tr ng-repeat="subscription in library.subscriptions"><td class="manage-lib-sub-name-input" ng-keydown="preventNewline($event)"><input class="manage-lib-input manage-lib-sub-input ng-pristine ng-valid" ng-class="{\'manage-lib-input-error\': subscription.$error && subscription.$error.name}" ng-model="subscription.name" type="text" name="name" placeholder="Name" autocomplete="off" novalidate=""></td><td class="manage-lib-sub-url-input" ng-keydown="preventNewline($event)"><input class="manage-lib-input manage-lib-sub-input ng-pristine ng-valid" ng-class="{\'manage-lib-input-error\': subscription.$error && subscription.$error.url}" ng-model="subscription.info.url" placeholder="Webhook Url" autocomplete="off" novalidate=""></td><td><a class="manage-lib-sub-remove-x" ng-if="$index != (library.subscriptions.length-1) || library.subscriptions.length == 3" ng-click="removeSubscription($index)"></a><a class="manage-lib-sub-add-x" ng-if="$index == (library.subscriptions.length-1) && (library.subscriptions.length != 3)" ng-click="addSubscription()"></a></td></tr></form></table></div></div></div><div ng-if="$error.general" class="manage-lib-error">{{$error.general}}</div></div></div><div class="dialog-buttons"><button ng-if="!modifyingExistingLibrary" class="manage-lib-create-button" ng-click="saveLibrary()">Create Library</button> <button ng-if="modifyingExistingLibrary" class="manage-lib-delete-button" ng-click="openDeleteLibraryModal()">Delete library</button> <button ng-if="modifyingExistingLibrary" class="manage-lib-save-button" ng-click="saveLibrary()">Save</button></div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/manageLibraryModal.tpl.html",'<div kf-modal="" class="kf-manage-library" kf-width="600px"><div kf-manage-library=""></div></div>')}])}(),angular.module("kifi").directive("kfQuickKeep",["util","keepActionService","installService","libraryService","modalService","$rootScope",function(e,i,t,r,n,a){return{restrict:"A",replace:!0,scope:{library:"="},templateUrl:"libraries/quickKeep.tpl.html",link:function(o){o.quickKeep={},o.isOwnerOrCollaborator=function(){return o.library&&o.library.membership&&("owner"===o.library.membership.access||"read_write"===o.library.membership.access)},o.doQuickKeep=function(){var t=o.quickKeep.url||"";o.quickKeep.quickCheck=!0,r.trackEvent("user_clicked_page",o.library,{action:"clickedQuickKeep"}),t&&e.validateUrl(t)?i.keepToLibrary([{url:t}],o.library.id).then(function(e){if(o.quickKeep.quickCheck=!1,o.quickKeep={},e.failures&&e.failures.length)n.openGenericErrorModal();else if(r.fetchLibraryInfos(!0),0===e.alreadyKept.length)return i.fetchFullKeepInfo(e.keeps[0]).then(function(e){a.$emit("keepAdded",[e],o.library)})})["catch"](n.openGenericErrorModal):o.quickKeep.invalidUrl=!0},o.checkQuickKeepUrl=function(){var i=o.quickKeep.url||"";o.quickKeep.quickCheck&&(i&&e.validateUrl(i)||""===i?o.quickKeep.invalidUrl=!1:o.quickKeep.invalidUrl=!0)},o.triggerExtensionInstall=t.triggerInstall,o.canInstallExtension=t.canInstall}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/quickKeep.tpl.html",'<div class="kf-quick-add-keep" ng-show="::isOwnerOrCollaborator()"><div class="kf-quick-add-keep-explain">Add a Link to this library: {{something}}</div><div><input class="kf-quick-add-keep-input" placeholder="http://..." ng-model="quickKeep.url" ng-change="checkQuickKeepUrl()"> <button class="kf-quick-add-keep-button" ng-click="doQuickKeep()"><span class="svg-hearts-white"></span>Keep It</button></div><div class="kf-quick-add-keep-error" ng-show="quickKeep.invalidUrl">Please use a valid URL</div><div class="kf-quick-add-keep-get-extension" ng-if="canInstallExtension">Tip: To add links faster and find them in Google, <a href="#" ng-click="triggerExtensionInstall()">get the Kifi browser button</a>.</div></div>')}])}(),angular.module("kifi").directive("kfRelatedLibraries",["libraryService","platformService","signupService",function(e,i,t){return{restrict:"A",replace:!0,scope:{heading:"@",libraryId:"@",relatedLibraries:"="},templateUrl:"libraries/relatedLibraries.tpl.html",link:function(e){e.join=function(r){r.preventDefault(),e.$emit("trackLibraryEvent","click",{action:"clickedLibraryRecJoinNow"}),i.isSupportedMobilePlatform()?i.goToAppOrStore():t.register({libraryId:e.libraryId})},e.clickSeeMore=function(){e.$emit("trackLibraryEvent","click",{action:"clickedLibraryRecSeeMore"})}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/relatedLibraries.tpl.html",'<div class="kf-related-libraries"><header class="kf-related-library-explore-more-header">{{heading || \'Explore More Kifi Libraries\'}}</header><div class="kf-related-library-card" kf-small-library-card="" library="library" action="clickedLibraryRec" origin="libraryRec" ng-repeat="library in relatedLibraries"></div><footer ng-if="!$root.userLoggedIn" class="kf-related-library-footer"><a href="/libraries/featured" class="kf-related-libraries-see-more" ng-click="clickSeeMore($event)" target="_blank">See more &raquo;</a><div class="kf-related-libraries-card-your-own-card"><div>Create Your Own Library</div><a href="/signup" ng-click="join($event)" class="kf-related-libraries-card-your-own-card-btn">Join now</a></div></footer><div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/removeMemberConfirmModal.tpl.html",'<div kf-modal="" class="kf-remove-member-confirm-modal" ng-switch="::modalData.type + (modalData.isSelf ? \'_self\' : \'\')"><div ng-switch-when="collab_self"><div kf-basic-modal-content="" with-cancel="true" title="Leave this library?" with-warning="" action-text="Leave" action="modalData.remove()"><p>You will no longer be able to {{modalData.private ? \'access\' : \'contribute to\'}} this library.</p></div></div><div ng-switch-when="collab"><div kf-basic-modal-content="" with-cancel="true" title="Remove {{modalData.member.firstName}}?" with-warning="" action-text="Remove" action="modalData.remove()"><p>{{modalData.member.firstName}} will no longer be able to {{modalData.private ? \'access\' : \'contribute to\'}} this library.</p></div></div><div ng-switch-when="follow"><div kf-basic-modal-content="" with-cancel="true" title="Remove {{modalData.member.firstName}}?" with-warning="" action-text="Remove" action="modalData.remove()"><p>{{modalData.member.firstName}} will no longer be able to {{modalData.private ? \'view\' : \'receive updates about\'}} this library.</p></div></div></div>')}])}(),angular.module("kifi").directive("kfSmallLibraryCard",["$location","modalService","$window","platformService",function(e,i,t,r){function n(e){var i=e.membership;return i&&("owner"===i.access||"read_write"===i.access&&"collaborator"===e.whoCanInvite)}function a(e,i,t){var r=3;n(t.library)&&r--,t.maxNumCollaboratorsToShow=e>r?r-1:r}function o(e){r.isSupportedMobilePlatform()||i.open({template:"libraries/libraryMembersModal.tpl.html",modalData:{library:e,canManageMembers:n(e),amOwner:"owner"===(e.membership||{}).access,filterType:"collaborators_only",currentPageOrigin:s}})}function l(e){r.isSupportedMobilePlatform()||i.open({template:"libraries/libraryFollowersModal.tpl.html",modalData:{library:e,currentPageOrigin:s}})}var s="libraryPage.RelatedLibraries";return{restrict:"A",replace:!0,scope:{library:"=",action:"@",origin:"@"},templateUrl:"libraries/smallLibraryCard.tpl.html",link:function(e){e.maxNumFollowersToShow=3,n(e.library)?e.$watch("lib.numCollaborators",a):a(e.library.numCollaborators,null,e),e.openCollaboratorsList=o,e.openFollowersList=l,e.clickCard=function(){e.$emit("trackLibraryEvent","click",{action:e.action})}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/smallLibraryCard.tpl.html",'<div class="kf-slc-card" ng-style="{\'background-color\': library.color}"><a class="kf-slc-card-link" href="{{::library.path}}" ng-click="clickCard()" ng-attr-title="{{::library.description}}" kf-track-origin="{{::origin}}"><div class="kf-slc-card-cover"><div class="kf-slc-card-cover-image" style="{{::library.image|bgImageAndPos}}" ng-if="::library.image"></div></div><div class="kf-slc-card-name-align"><div class="kf-slc-card-name"><div class="kf-slc-card-name-clip">{{::library.name|preventOrphans:16:(library.name.length > 36 ? 1/3 : 0.6)}}</div></div></div><div class="kf-slc-count-line"><span class="kf-slc-card-collab svg-collaborators-white" title="A collaborative library" ng-if="::library.numCollaborators"></span> <span class="kf-slc-card-private svg-card-lock" ng-class="::{\'kf-collab\': library.numCollaborators}" title="A private library" ng-if="::library.kind !== \'system_secret\' && library.visibility === \'secret\'"></span> <span class="kf-slc-count" ng-pluralize="" count="::library.numKeeps" when="{\'1\':\'{} keep\',\'other\':\'{{library.numKeeps|num}} keeps\'}" ng-if="::library.numKeeps"></span></div><div class="kf-slc-card-foot" ng-switch="::library.reason || \'updated\'" ng-if="::library.reason || !library.followers.length"><span ng-switch-when="owner">More from this curator</span> <span ng-switch-when="popular">From Community</span> <span ng-switch-when="topic">Related</span> <span ng-switch-when="updated">Updated&nbsp;<time ng-attr-datetime="{{::library.lastKept}}" am-time-ago="library.lastKept"></time></span></div></a><a class="kf-slc-card-owner" ng-if="::!library.numCollaborators" href="{{::library.owner|profileUrl}}" kf-track-origin="libraryPage.RelatedLibraries/curator"><img class="kf-slc-card-owner-pic" ng-src="{{::library.owner|pic:100}}" alt="{{::library.owner|name}}"> <span class="kf-slc-card-by">by</span> <span class="kf-slc-card-by-name">{{::library.owner|name}}</span></a><div class="kf-slc-collabs" ng-if="::library.numCollaborators > 0"><span class="kf-slc-card-by">by</span> <a class="kf-slc-collab-pic-a" href="{{::library.owner|profileUrl}}" kf-track-origin="{{::currentPageOrigin}}/collaborator" kf-user-tooltip="::library.owner" desc="Owner"><img class="kf-slc-collab-pic" ng-src="{{::library.owner|pic:100}}" alt="{{::library.owner|name}}"></a> <a class="kf-slc-collab-pic-a" href="{{::collab|profileUrl}}" kf-track-origin="{{::currentPageOrigin}}/collaborator" kf-user-tooltip="::collab" desc="Collaborator" ng-repeat="collab in library.collaborators | limitTo:maxNumCollaboratorsToShow"><img class="kf-slc-collab-pic" ng-src="{{::collab|pic:100}}" alt="{{::collab|name}}"></a> <button class="kf-slc-more-collab" ng-if="library.numCollaborators > maxNumCollaboratorsToShow" ng-click="openCollaboratorsList(library)">{{library.numCollaborators - maxNumCollaboratorsToShow|num}}</button></div><div class="kf-slc-card-foot" ng-if="::!library.reason && library.followers.length"><div class="kf-slc-followers"><a href="{{::user|profileUrl}}" class="kf-slc-follower" ng-repeat="user in library.followers | limitTo:maxNumFollowersToShow" kf-track-origin="{{currentPageOrigin}}/follower" ng-attr-style="background-image:url({{::user|pic:100}})"></a> <a class="kf-slc-followers-number" href="javascript:" ng-click="openFollowersList(library); trackUplCardClick(library, \'clickedLibraryFollowersMoreFollowing\')"><span ng-if="library.numFollowers <= maxNumFollowersToShow" class="kf-slc-all-followers">{{library.numFollowers === 1 ? \'follows this library\' : \'are following\'}}</span> <span ng-if="library.numFollowers > maxNumFollowersToShow">+ <b class="kf-slc-follwers-n">{{library.numFollowers - maxNumFollowersToShow|num}}</b>{{library.numFollowers - maxNumFollowersToShow < 1000 ? \' are\' : \'\'}} following</span></a></div></div></div>')}])}(),angular.module("kifi").directive("kfSuggestedSearches",[function(){return{restrict:"A",replace:!0,scope:{library:"="},templateUrl:"libraries/suggestedSearches.tpl.html"}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("libraries/suggestedSearches.tpl.html",'<div class="kf-lss"><h2 class="kf-lss-title">Suggested Searches</h2><ul><li class="kf-lss-query" ng-repeat="query in library.suggestedSearches | limitTo: 10"><a class="kf-lss-query-a" href="{{library.url}}/find?q={{query}}">{{query}}</a></li></ul></div>')}])}(),angular.module("kifi").directive("kfManagePersona",["userPersonaActionService","routeService","$analytics","util","modalService","$rootScope","libraryService",function(e,i,t,r,n,a,o){return{restrict:"A",scope:{closeAction:"="},templateUrl:"persona/managePersona.tpl.html",link:function(i,l){var s;i.selectedPersonaIds=[],i.isModal=l.is("#kf-modal *"),i.closeText=i.isModal?"Update interests":"Done",i.loading=!1,i.selectPersona=function(n){n.selected=!0,i.selectedPersonaIds.push(n.id),i.isModal&&(e.addPersona(n.id),s=!0);var a=["selected","persona"].concat(n.id.split("_"));t.eventTrack("user_clicked_page",{type:n.id,action:r.toCamelCase(a)})},i.unselectPersona=function(n){n.selected=!1,_.pull(i.selectedPersonaIds,n.id),i.isModal&&(e.removePersona(n.id),s=!0);var a=["unselected","persona"].concat(n.id.split("_"));t.eventTrack("user_clicked_page",{type:n.id,action:r.toCamelCase(a)})},i.toggleSelect=function(e){e.selected?i.unselectPersona(e):i.selectPersona(e)},i.close=function(){i.selectedPersonaIds.length>0&&(_.isFunction(i.closeAction)?(i.loading=!0,e.selectPersonas(i.selectedPersonaIds).then(function(){i.closeAction(),o.fetchLibraryInfos(!0),i.loading=!1})):i.isModal&&(n.close(),s&&(a.$emit("refreshRecos"),o.fetchLibraryInfos(!0))),t.eventTrack("user_clicked_page",{action:"closed"}))};var c="https://d1dwdv9wd966qu.cloudfront.net/";e.getPersonas().then(function(e){_.map(e.personas,function(e){e.iconSrc=c+e.iconPath,e.activeIconSrc=c+e.activeIconPath,e.selected&&i.selectedPersonaIds.push(e.id)}),i.allPersonas=e.personas})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("persona/managePersona.tpl.html",'<div class="kf-mp dialog-content" ng-if="allPersonas.length > 0"><a class="dialog-x kf-mp-close-x" ng-if="isModal" ng-click="close()" ng-class="{visible: selectedPersonaIds.length > 0}"></a><div class="dialog-body-wrap"><div class="dialog-body"><h1 class="dialog-header">Who are you?</h1><div class="kf-mp-table"><div ng-repeat="persona in allPersonas" class="kf-mp-icon" ng-class="{active: persona.selected}" ng-click="toggleSelect(persona)"><div class="kf-mp-icon-image-wrapper"><img class="kf-mp-icon-image" ng-src="{{persona.iconSrc}}" ng-if="!persona.selected"> <img class="kf-mp-icon-image" ng-src="{{persona.activeIconSrc}}" ng-if="persona.selected"></div><div class="kf-mp-icon-display-name">{{persona.displayName}}</div></div></div><div class="dialog-button"><button class="kf-mp-exit-button" ng-class="{active: selectedPersonaIds.length > 0}" ng-click="close()" ng-if="!loading">{{closeText}}</button><div class="kf-mp-logo-overlay" ng-if="loading"><div class="kf-mp-loading-logo svg-small-new-logo"></div></div></div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("persona/managePersonaModal.tpl.html",'<div kf-modal="" class="kf-persona-modal" kf-width="650px"><div kf-manage-persona=""></div></div>')}])}(),angular.module("kifi").factory("userPersonaActionService",["$http","$q","routeService","Clutch",function(e,i,t,r){function n(e){return e.data}var a={cacheDuration:1e4},o=new r(function(){return e.get(t.getPersonas()).then(n)},a),l={getPersonas:function(){return o.get()},selectPersonas:function(i){var r={personas:i};return e.post(t.getPersonas(),r)},addPersona:function(i){return e.post(t.addPersona(i))},removePersona:function(i){return e["delete"](t.removePersona(i))}};return l}]),angular.module("kifi").directive("kfEditBio",["modalService","$timeout","profileService",function(e,i,t){return{restrict:"A",require:"^kfModal",templateUrl:"profile/editUserBio.tpl.html",link:function(e,i,r,n){var a=160,o=i.find(".kf-bio-input");o.focus().select(),e.bioText=e.modalData&&e.modalData.biography?e.modalData.biography:"",e.charactersLeft=a-e.bioText.length,e.checkOverLimit=function(){e.charactersLeft=a-e.bioText.length},e.saveBiography=function(){if(!(e.charactersLeft<0)){var i=e.bioText;t.changeBiography(i),n.close(),e.modalData&&_.isFunction(e.modalData.onClose)&&e.modalData.onClose(i)}},e.close=function(){n.close()}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/editUserBio.tpl.html",'<div class="dialog-content"><a class="dialog-x" ng-click="close()"></a><div class="dialog-body-wrap"><h1 class="dialog-header">Edit your profile biography</h1><div class="dialog-body dialog-centered"><textarea class="kf-bio-input" type="text" placeholder="Edit your biography here... Limit to 160 characters" ng-model="bioText" ng-change="checkOverLimit()">{{bioText}}</textarea><div class="kf-bio-chars" ng-if="charactersLeft >= 0" ng-pluralize="" count="charactersLeft" when="{\'0\': \'No characters left\', \'1\': \'1 character left\', \'other\': \'{} characters left\'}"></div><div class="kf-bio-chars kf-over" ng-if="charactersLeft < 0" ng-pluralize="" count="-charactersLeft" when="{\'1\': \'1 character over\', \'other\': \'{} characters over\'}"></div></div></div><div class="kf-bio-buttons"><button class="kf-bio-save" ng-class="{\'kf-over\': charactersLeft < 0}" ng-click="saveBiography()">Save</button></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/editUserBiographyModal.tpl.html",'<div kf-modal="" kf-width="550px"><div kf-edit-bio=""></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/emailChangeModal.tpl.html",'<div kf-modal=""><div kf-basic-modal-content="" with-cancel="" action-text="Continue" action="confirmSaveEmail()" cancel="cancelSaveEmail()"><p>You are about to change your primary email to <span class="email-address">{{emailInput.value}}</span>.</p><p>We will send a verification email to this email address to prove that you own it. To verify, please click on the verification link in the email.</p></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/emailDeleteModal.tpl.html",'<div kf-modal="" class="profile-email-delete-confirm"><div kf-basic-modal-content="" with-cancel="" with-warning="" title="Delete {{emailToBeDeleted}}?" action-text="Delete" action="confirmDeleteEmail()"><p>Are you sure you want to delete this email address?</p><ul><li>You will not be able to login with this email address</li><li>Your friends will not be able to find you by this email address</li></ul></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/emailImport.tpl.html",'<div><h3>Import your email contacts to Kifi</h3><h5>Message your email contacts directly from Kifi</h5><a class="profile-nw nw-email import-gmail" href="javascript:" ng-click="importGmailContacts()" ng-bind="addressBookImportText"></a><div ng-if="addressBooks"><div class="profile-email-accounts-wrapper"><div class="profile-email-accounts-overview"><span>Your imported accounts:</span><table class="profile-email-accounts"><tbody><tr ng-repeat="addressBook in addressBooks" class="profile-email-account {{addressBook.state}}" data-id="{{addressBook.id}}"><td class="profile-email-status"></td><td class="profile-email-address">{{addressBook.ownerEmail}}</td><td class="profile-email-separator">|</td><td class="profile-email-contact-count">{{addressBook.numContacts}} contacts imported</td></tr></tbody></table></div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/emailResendVerificationModal.tpl.html",'<div kf-modal=""><div kf-basic-modal-content="" title="{{emailForVerificationModalTitle}}"><p>You will shortly receive a verification email from us at the following address: <span class="email-address">{{emailForVerification}}</span>.</p><p>To verify, please click on a verification link on the email.</p></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/imageEditModal.tpl.html",'<div kf-modal=""><div kf-basic-modal-content="" with-cancel="" title="Position and size your photo" action-text="Submit" action="uploadImage()" cancel="resetChooseImage()"><div class="kf-profile-image-dialog-image"><div class="kf-profile-image-dialog-mask"></div></div><div class="kf-profile-image-dialog-slider" ui-slider="zoomSlider" ng-model="zoomSlider.value"></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/imageUploadFailedModal.tpl.html",'<div kf-modal="" show="showImageUploadFailedDialog.value"><div kf-basic-modal-content="" with-warning=""><div class="kf-modal-upload-image-header warning">Sorry, we could not upload your image. Please try again later.</div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/imageUploadingModal.tpl.html",'<div kf-modal="" no-user-hide="" force-close="forceClose"><div class="dialog-body-wrap"><div class="kf-modal-upload-image-header">Uploading image</div><div class="kf-modal-waiting"><div class="pace pace-active"><div class="pace-progress"></div><div class="pace-activity"></div></div></div></div></div>')}])}(),angular.module("kifi").controller("ProfileCtrl",["$scope","$http","modalService","profileService","routeService","$window","socialService","$analytics",function(e,i,t,r,n,a,o,l){function s(i){e.emailForVerification=i,
t.open({template:"profile/emailResendVerificationModal.tpl.html",scope:e})}function c(e){return i({url:n.emailInfoUrl,method:"GET",params:{email:e}})}function u(i,n){return n.isPrimary||n.isPendingPrimary?void r.fetchMe():n.isVerified?r.setNewPrimaryEmail(n.address):(f=i,t.open({template:"profile/emailChangeModal.tpl.html",scope:e}),r.successInputActionResult())}function d(e,i){return"available"!==i.status?r.failureInputActionResult("This email address is already added","Please use another email address."):(r.addEmailAccount(e),void s(e))}a.document.title="Kifi • Your Profile",o.refresh(),e.me=r.me,r.getMe(),e.emailInput={},e.$watch("me.primaryEmail.address",function(i){e.emailInput.value=i||""}),e.name={},e.$watch("me.firstName",function(i){e.name.firstName=i}),e.$watch("me.lastName",function(i){e.name.lastName=i}),e.addEmailInput={},e.validateName=function(e){return r.validateNameFormat(e)},e.saveName=function(e){r.setNewName(e)},e.validateEmail=function(e){return r.validateEmailFormat(e)},e.saveEmail=function(e){return c(e).then(function(i){return u(e,i.data)},function(e){return r.getEmailValidationError(e.status)})},e.addEmail=function(e){return c(e).then(function(i){return d(e,i.data)},function(e){return r.getEmailValidationError(e.status)})},e.isUnverified=function(e){return e.value&&!e.value.isPendingPrimary&&e.value.isPrimary&&!e.value.isVerified},e.resendVerificationEmail=function(i){!i&&e.me&&e.me.primaryEmail&&(i=e.me.primaryEmail.address),s(i),r.resendVerificationEmail(i)},e.cancelPendingPrimary=function(){r.cancelPendingPrimary()};var f;e.cancelSaveEmail=function(){e.emailInput.value=e.me.primaryEmail.address},e.confirmSaveEmail=function(){r.setNewPrimaryEmail(f)},e.showPersonaModal=function(){l.eventTrack("user_clicked_page",{type:"settings",action:"clickedUpdateInterests"}),t.open({template:"persona/managePersonaModal.tpl.html"})},e.showBiographyModal=function(){t.open({template:"profile/editUserBiographyModal.tpl.html",modalData:{biography:r.me.biography}})}}]).directive("kfFacebookConnectButton",["socialService",function(e){return{restrict:"A",link:function(i){i.isFacebookConnected=e.facebook&&!!e.facebook.profileUrl,i.facebook=e.facebook,i.$watch(function(){return e.facebook&&e.facebook.profileUrl},function(){var t=e.facebook;t&&t.profileUrl?(i.isFacebookConnected=!0,i.fbProfileUrl=t.profileUrl):(i.isFacebookConnected=!1,i.fbProfileUrl="")}),i.connectFacebook=e.connectFacebook,i.disconnectFacebook=e.disconnectFacebook}}}]).directive("kfTwitterConnectButton",["socialService",function(e){return{restrict:"A",link:function(i){i.isTwitterConnected=e.twitter&&!!e.twitter.profileUrl,i.twitter=e.twitter,i.$watch(function(){return e.twitter.profileUrl},function(){var t=e.twitter;t&&t.profileUrl?(i.isTwitterConnected=!0,i.twProfileUrl=t.profileUrl):(i.isTwitterConnected=!1,i.twProfileUrl="")}),i.connectTwitter=e.connectTwitter,i.disconnectTwitter=e.disconnectTwitter}}}]).directive("kfEmailImport",["profileService","$window","env","socialService",function(e,i,t,r){return{restrict:"A",replace:!0,scope:{},templateUrl:"profile/emailImport.tpl.html",link:function(e){e.addressBookImportText="Import a Gmail account",r.refresh().then(function(){e.addressBooks=r.addressBooks,r.addressBooks&&r.addressBooks.length>0&&(e.addressBookImportText="Import another Gmail account")}),e.importGmailContacts=r.importGmail}}}]).directive("kfProfileExportKeeps",["routeService",function(e){return{restrict:"A",replace:!0,scope:{},templateUrl:"profile/profileExportKeeps.tpl.html",link:function(i){i.getExportUrl=function(){return e.exportKeeps},i.exportKeeps=function(){i.exported=!0},i.getExportButtonText=function(){return i.exported?"Export Again":"Export Keeps"}}}}]).directive("kfProfileManageAccount",["$http","profileService","$analytics","$location",function(e,i,t,r){return{restrict:"A",scope:{},templateUrl:"profile/profileManageAccount.tpl.html",link:function(e){e.isOpen={uninstall:!1,close:!1,"export":!1},e.toggle=function(i){e.isOpen[i]=!e.isOpen[i]},e.closeAccount=function(){t.eventTrack("user_clicked_page",{action:"clickCloseAccount",path:r.path()})}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profile.tpl.html",'<div ng-controller="ProfileCtrl"><div class="profile-wrapper kf-width-bounded"><div class="profile"><h2>Settings</h2><div class="profile-container"><div kf-profile-image="" pic-url="me | pic:200"></div><div class="profile-input-wrapper"><div class="profile-input-title">Name</div><div kf-profile-name-input="" name="name" validate-name="validateName(name)" save-name="saveName(name)" explicit-enabling="true"></div></div><div class="profile-input-wrapper profile-email"><div class="profile-input-title">Contact email</div><div kf-profile-input="" input-state="emailInput" input-validate-action="validateEmail(value)" input-save-action="saveEmail(value)" explicit-enabling="true"><input class="profile-input-input profile-email-input" ng-disabled="!emailInput.editing" kf-focus-if="" focus-cond="emailInput.editing" ng-model="emailInput.value" type="text" name="email" placeholder="Enter your email address" novalidate=""></div></div><div class="profile-email-address-unverified" ng-if="isUnverified({value: me.primaryEmail})">Your email is pending your verification (<a class="profile-email-pending-resend" href="javascript:" ng-click="resendVerificationEmail()">Resend verification</a>).</div><div class="profile-email-address-pending" ng-if="me.primaryEmail.isPendingPrimary">Your new primary email, <span class="profile-email-address-pending-email">{{me.primaryEmail.address}}</span>, is pending your verification (<a class="profile-email-pending-resend" href="javascript:" ng-click="resendVerificationEmail()">Resend verification</a>, <a class="profile-email-pending-cancel" href="javascript:" ng-click="cancelPendingPrimary()">Cancel</a>).</div><div kf-profile-manage-settings=""></div><div kf-profile-change-password=""></div><div kf-profile-email-addresses="" input-state="addEmailInput" email-list="me.emails" validate-email-action="validateEmail(value)" add-email-action="addEmail(value)" resend-verification-email-action="resendVerificationEmail(value)"></div><button class="kf-profile-update-popup" ng-click="showPersonaModal()"><div class="profile-setting-arrow"></div><div class="profile-manage-settings-title">Update your interests</div></button> <button class="kf-profile-update-popup" ng-click="showBiographyModal()"><div class="profile-setting-arrow"></div><div class="profile-manage-settings-title">Update your biography</div></button></div><div class="profile-section"><h3>Connect your social networks to Kifi</h3><h5>Find which of your connections are using Kifi</h5><ul class="profile-networks"><li kf-facebook-connect-button="" data-network="facebook" ng-class="{ \'connected\': isFacebookConnected }"><a class="profile-nw nw-facebook" href="https://www.kifi.com/link/facebook" target="_self" ng-click="connectFacebook()" ng-show="!isFacebookConnected">Facebook</a> <a class="profile-nw nw-facebook" ng-href="{{fbProfileUrl}}" target="_blank" ng-show="isFacebookConnected">Facebook</a> <span class="profile-nw-connected"><span class="profile-placeholder">&nbsp;</span> <span class="profile-connected">Connected</span> <a class="profile-disconnect" href="javascript:" ng-click="disconnectFacebook()">Disconnect?</a></span></li><li kf-twitter-connect-button="" data-network="twitter" ng-class="{ \'connected\': isTwitterConnected }"><a class="profile-nw nw-twitter" href="https://www.kifi.com/link/twitter" target="_self" ng-click="connectTwitter()" ng-show="!isTwitterConnected">Twitter</a> <a class="profile-nw nw-twitter" ng-href="{{twProfileUrl}}" target="_blank" ng-show="isTwitterConnected">Twitter</a> <span class="profile-nw-connected"><span class="profile-placeholder">&nbsp;</span> <span class="profile-connected">Connected</span> <a class="profile-disconnect" href="javascript:" ng-click="disconnectTwitter()">Disconnect?</a></span></li></ul></div><div class="profile-section" kf-email-import=""></div><div class="profile-section"><h3>Export Your Keeps</h3><div kf-profile-export-keeps=""></div></div><div class="profile-section profile-section-manage-account"><h3>Manage Your Account</h3><div kf-profile-manage-account="" class="profile-manage-account-section-wrapper"></div></div></div></div></div>')}])}(),angular.module("kifi").directive("kfProfileChangePassword",["profileService","KEY",function(e,i){return{restrict:"A",scope:{},templateUrl:"profile/profileChangePassword.tpl.html",link:function(t,r){t.isOpen=!1,t.inputs={oldPassword:"",newPassword1:"",newPassword2:""},t.prefs=e.prefs,t.passwordAction="",t.hasNoPassword=!1,t.toggle=function(){t.isOpen=!t.isOpen,t.isOpen&&(t.successMessage="")},r.find("input").on("keydown",function(e){switch(e.which){case i.ESC:this.blur();break;case i.ENTER:t.$apply(t.updatePassword)}}),t.updatePassword=function(){t.successMessage="",!t.hasNoPassword&&t.inputs.oldPassword.length<7?t.errorMessage="Your current password is not correct.":t.inputs.newPassword1!==t.inputs.newPassword2?t.errorMessage="Your new passwords do not match.":t.inputs.newPassword1.length<7?t.errorMessage="Your password needs to be longer than 7 characters.":t.hasNoPassword||t.inputs.oldPassword!==t.inputs.newPassword1?(t.errorMessage="",e.sendChangePassword(t.inputs.oldPassword,t.inputs.newPassword1).then(function(){t.successMessage="Your password was successfully updated!",t.inputs={},t.toggle()},function(e){"bad_old_password"===e.data.error?t.errorMessage="Your current password is not correct.":"bad_new_password"===e.data.error?t.errorMessage="Your password needs to be longer than 7 characters.":t.errorMessage="An error occured. Try again?"})):t.errorMessage="Your new password needs to be different from your current one."},t.$watch(function(){return t.prefs.has_no_password},function(e){t.hasNoPassword=Boolean(e),t.passwordAction=t.hasNoPassword?"Set a password":"Change your password"})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profileChangePassword.tpl.html",'<div class="profile-change-password"><a class="profile-change-password-title-wrapper" href="javascript:" ng-click="toggle()"><div class="profile-setting-arrow" ng-class="{\'active\':isOpen}"></div><div class="profile-change-password-title" ng-class="{\'active\':isOpen}">{{passwordAction}}</div></a><div class="profile-change-password-change" ng-show="isOpen"><input ng-if="!hasNoPassword" class="profile-input-password" ng-model="inputs.oldPassword" type="password" name="old-password" placeholder="Enter your current password" value="" novalidate=""> <input class="profile-input-password" ng-model="inputs.newPassword1" type="password" name="new-password1" placeholder="Choose a new password" value="" novalidate=""> <input class="profile-input-password" ng-model="inputs.newPassword2" type="password" name="new-password2" placeholder="Confirm new password" value="" novalidate=""><div class="profile-change-password-error">{{errorMessage}}</div><div><a class="profile-change-password-save" href="javascript:" ng-click="updatePassword()">Update password</a></div></div><div class="profile-change-password-success">{{successMessage}}</div></div>')}])}(),angular.module("kifi").directive("kfProfileEmailAddresses",["$document","KEY","modalService","profileService",function(e,i,t,r){return{restrict:"A",scope:{state:"=inputState",emailList:"=",validateEmailAction:"&",addEmailAction:"&",resendVerificationEmailAction:"&"},templateUrl:"profile/profileEmailAddresses.tpl.html",link:function(n,a){function o(){n.$apply(function(){n.emailWithActiveDropdown=null}),e.unbind("click",o)}n.isOpen=!1,n.emailWithActiveDropdown=null,n.emailToBeDeleted=null,n.toggle=function(){n.isOpen=!n.isOpen},n.enableAddEmail=function(){n.state.editing=!0},n.validateEmail=function(e){return n.validateEmailAction({value:e})},n.addEmail=function(e){return n.addEmailAction({value:e})},n.resendVerificationEmail=function(e){return n.resendVerificationEmailAction({value:e})},n.openDropdownForEmail=function(i,t){n.emailWithActiveDropdown!==t&&(n.emailWithActiveDropdown=t,i.stopPropagation(),e.bind("click",o))},n.deleteEmail=function(e){n.emailToBeDeleted=e,t.open({template:"profile/emailDeleteModal.tpl.html",scope:n})},n.confirmDeleteEmail=function(){r.deleteEmailAccount(n.emailToBeDeleted)},n.makePrimary=function(e){r.makePrimary(e)},a.find("input").on("keydown",function(e){switch(e.which){case i.ESC:n.$apply(n.cancelAddEmail);break;case i.ENTER:n.$apply(n.addEmail)}})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profileEmailAddresses.tpl.html",'<div class="profile-email-addresses"><a class="profile-email-addresses-title-wrapper" href="javascript:" ng-click="toggle()"><div class="profile-setting-arrow" ng-class="{\'active\':isOpen}"></div><div class="profile-email-addresses-title" ng-class="{\'active\':isOpen}">Manage your email addresses</div></a><div class="profile-email-address-manage" ng-show="isOpen"><div class="profile-email-address-manage-description" ng-show="emailList.length > 0">NOTE: These are the email addresses associated with your Kifi account. You may log in with them and Kifi members can find you using these email addresses via search.</div><ul class="profile-email-address-list"><li ng-repeat="email in emailList" class="profile-email-address-item"><span class="profile-email-address-item-email" ng-class="{\'profile-email-address-item-email-important\': email.isPrimary || email.isPendingPrimary || email.isPlaceholderPrimary}">{{email.address}}</span> <span class="profile-email-address-item-primary" ng-if="email.isPrimary || email.isPlaceholderPrimary">(primary)</span> <span class="profile-email-address-item-pending-primary" ng-if="email.isPendingPrimary && !email.isPrimary && !email.isPlaceholderPrimary">(pending primary)</span> <span class="profile-email-address-item-unverified" ng-if="!email.isVerified">(<a class="profile-email-pending-resend" href="javascript:" ng-click="resendVerificationEmail(email.address)">unverified</a>)</span><div class="profile-email-address-item-arrow" href="javascript:" ng-if="!(email.isPrimary || email.isPendingPrimary || email.isPlaceholderPrimary)" ng-click="openDropdownForEmail($event, email.address)"><img class="profile-email-address-item-arrow-image" src="//d1dwdv9wd966qu.cloudfront.net/img/placeholder-icon.fc9c805.png"><ul class="profile-email-address-item-dropdown" ng-show="emailWithActiveDropdown === email.address"><li><a class="profile-email-address-item-make-primary" href="javascript:" ng-if="email.isVerified" ng-click="makePrimary(email.address)">Make primary</a></li><li><a class="profile-email-address-item-delete" href="javascript:" ng-click="deleteEmail(email.address)">Delete</a></li></ul></div></li></ul><a class="profile-email-address-add" href="javascript:" ng-click="enableAddEmail()" ng-show="!(state.editing || state.invalid)">+ add a new email address</a><div class="profile-email-address-add-box" ng-show="state.editing || state.invalid"><div kf-profile-input="" input-state="state" input-validate-action="validateEmail(value)" input-save-action="addEmail(value)" action-label="Add"><input class="profile-email-address-add-input" kf-focus-if="" focus-cond="state.editing" ng-model="state.value" type="text" name="new_email" placeholder="Type a new email address"></div></div><div class="profile-email-address-manage-footer"></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profileExportKeeps.tpl.html",'<div><h5>For all of your Keeps, the URL, date kept, and tags will be included in an HTML netscape format file</h5><a class="profile-export" ng-href="{{getExportUrl()}}" ng-click="exportKeeps()" target="_self" ng-class="{\'export-first\':!exported, \'export-again\':exported}">{{getExportButtonText()}}</a><p><span class="profile-export-status" ng-show="exported"><span class="profile-placeholder">&nbsp;</span> <span>You can find the file in your Downloads folder</span></span></p></div>')}])}(),angular.module("kifi").directive("kfProfileImage",["$document","$timeout","$compile","$templateCache","$window","$q","$http","env","modalService","profileService","$analytics","$location",function(e,i,t,r,n,a,o,l,s,c,u,d){return{restrict:"A",replace:!0,scope:{picUrl:"="},templateUrl:"profile/profileImage.tpl.html",link:function(t,r){function f(){if(E){var e=Math.pow(t.zoomSlider.value/t.zoomSlider.max,2);_.currentWidth=_.minimumWidth+e*(_.maximumWidth-_.minimumWidth),_.currentHeight=_.minimumHeight+e*(_.maximumHeight-_.minimumHeight),M.css({backgroundSize:_.currentWidth+"px "+_.currentHeight+"px"}),h(),m()}}function p(e,i,t){return e>i?i:t>e?t:e}function m(){M.css({backgroundPosition:_.currentLeft+"px "+_.currentTop+"px"})}function g(e,i){_.currentLeft=p(e,T,M.width()-T-_.currentWidth),_.currentTop=p(i,T,M.height()-T-_.currentHeight)}function h(){var e=M.width()/2-_.currentWidth*_.centerXRatio,i=M.height()/2-_.currentHeight*_.centerYRatio;g(e,i)}function v(){_.centerXRatio=(M.width()/2-_.currentLeft)/_.currentWidth,_.centerYRatio=(M.height()/2-_.currentTop)/_.currentHeight}function k(i){I.initialMouseX=i.pageX,I.initialMouseY=i.pageY,I.initialLeft=_.currentLeft,I.initialTop=_.currentTop,e.on("mousemove",b),e.on("mouseup",y)}function b(e){var i=I.initialLeft+e.pageX-I.initialMouseX,t=I.initialTop+e.pageY-I.initialMouseY;g(i,t),m()}function y(){e.off("mousemove",b),e.off("mousemove",y),v()}function w(){D.on("mousedown",k)}function C(e){var i=Array.prototype.filter.call(e,S)[0];if(i){F&&F.abort();var t=new n.XMLHttpRequest;F=t;var r=a.defer();return t.withCredentials=!0,t.upload.addEventListener("progress",function(e){e.lengthComputable&&r.notify(e.loaded/e.total)}),t.addEventListener("load",function(){r.resolve(n.JSON.parse(t.responseText))}),t.addEventListener("loadend",function(){F===t&&(F=null)}),t.open("POST",A,!0),t.send(i),{file:i,promise:r.promise}}}function S(e){return 0===e.type.search(/^image\/(?:bmp|jpg|jpeg|png|gif)$/)}function $(r){s.open({template:"profile/imageEditModal.tpl.html",scope:t}),i(function(){M=e.find(".kf-profile-image-dialog-image"),D=e.find(".kf-profile-image-dialog-mask"),w(),M.css({background:"url("+r+") no-repeat"}),x=M.width()-2*T;var i=new Image;i.onload=function(){var e=this;t.$apply(function(){_.imageWidth=e.width||1,_.imageHeight=e.height||1;var i=_.imageWidth/_.imageHeight,r=1.5;1>i?(_.minimumWidth=x,_.minimumHeight=_.minimumWidth/i,_.maximumWidth=r*Math.max(_.imageWidth,x),_.maximumHeight=_.maximumWidth/i):(_.minimumHeight=x,_.minimumWidth=_.minimumHeight*i,_.maximumHeight=r*Math.max(_.imageHeight,x),_.maximumWidth=_.maximumHeight*i),t.zoomSlider.value=50,_.centerXRatio=.5,_.centerYRatio=.5,E=!0,f()})},i.src=r},0)}function L(){t.forceClose=!0,i(function(){t.forceClose=!1,s.open({template:"profile/imageUploadFailedModal.tpl.html"}),t.resetChooseImage()},0)}var x,F,T=40,_={},I={},E=!1,A=l.xhrBase+"/user/pic/upload",P=l.xhrBase+"/user/pic";t.zoomSlider={orientation:"horizontal",min:0,max:100,change:f,slide:f};var M,D,U=r.find(".profile-image-file");t.selectFile=function(){U.click()},t.fileChosen=function(e){if(E=!1,t.files=e,0!==t.files.length){var i=new FileReader;i.onload=function(e){$(e.target.result)},i.readAsDataURL(t.files[0])}},t.resetChooseImage=function(){U.val(null)},t.uploadImage=function(){s.open({template:"profile/imageUploadingModal.tpl.html",scope:t});var e=C(t.files);e?e.promise.then(function(e){var i=_.imageWidth/_.currentWidth,r={picToken:e&&e.token,picWidth:_.imageWidth,picHeight:_.imageHeight,cropX:Math.floor(i*(T-_.currentLeft)),cropY:Math.floor(i*(T-_.currentTop)),cropSize:Math.floor(i*x)};o.post(P,r).then(function(){c.fetchMe(),t.forceClose=!0,t.resetChooseImage(),u.eventTrack("user_clicked_page",{action:"uploadImage",path:d.path()})},L)},L):L()}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profileImage.tpl.html",'<div class="profile-image-wrapper"><div class="profile-image-flip"><div class="profile-image" ng-style="{\'background-image\': \'url(\' + picUrl + \')\'}"></div><div class="profile-image-change" ng-click="selectFile()"><div class="profile-image-change-inner">change picture</div></div></div><label class="profile-image-label"><input class="profile-image-file" type="file" name="photo" accept="image/*" kf-file-change="fileChosen"></label></div>')}])}(),angular.module("kifi").directive("kfProfileInput",["$document","$q","$timeout","$window","KEY","util",function(e,i,t,r,n,a){return{restrict:"A",scope:{state:"=inputState",validateAction:"&inputValidateAction",saveAction:"&inputSaveAction",explicitEnabling:"=",actionLabel:"@"},transclude:!0,templateUrl:"profile/profileInput.tpl.html",link:function(o,l){function s(){o.state.value=o.state.currentValue,o.state.editing=!1}function c(i){angular.element(i.target).is(".profile-email-input, .profile-input-save")||(e.off("mousedown",c),o.$evalAsync(s))}function u(e){angular.element(e.target).is(".profile-email-input, .profile-input-save")||(r.removeEventListener("focus",u,!0),o.$evalAsync(s))}function d(e){o.state.value=o.state.currentValue=e}function f(e){o.state.invalid=!0,o.errorHeader=e.header||"",o.errorBody=e.body||""}function p(){o.state.editing=!0,o.state.invalid=!1,e.on("mousedown",c),r.addEventListener("focus",u,!0)}o.state.editing=o.state.invalid=!1,l.find("input").on("keydown",function(e){switch(e.which){case n.ESC:s();break;case n.ENTER:o.save()}}).on("focus",function(){t(function(){p()})}),o.edit=function(){o.state.currentValue=o.state.value,p()},o.save=function(){var t=a.trimInput(o.state.value),n=o.validateAction({value:t});return n&&!n.isSuccess&&n.error?void f(n.error):(o.state.prevValue=o.state.currentValue,d(t),o.state.editing=!1,e.off("mousedown",c),r.removeEventListener("focus",u,!0),void(t!==o.state.prevValue&&i.when(o.saveAction({value:t})).then(function(e){e&&!e.isSuccess&&(e.error&&f(e.error),d(o.state.prevValue))})))}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profileInput.tpl.html",'<div class="profile-input-box"><div class="profile-input-container" ng-class="{ error: state.invalid }"><div ng-transclude=""></div><div class="input-error" ng-show="state.invalid"><div class="error-header" ng-bind-html="errorHeader"></div><div class="error-body" ng-bind-html="errorBody"></div></div></div><a class="profile-input-edit" href="javascript:" ng-hide="state.editing" ng-click="edit()" ng-if="explicitEnabling">Edit</a> <a class="profile-input-save" href="javascript:" ng-show="!explicitEnabling || state.editing" ng-click="save()">{{actionLabel || \'Save\'}}</a></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profileManageAccount.tpl.html",'<a class="profile-manage-account-title-wrapper" href="javascript:" ng-click="toggle(\'uninstall\');"><div class="profile-setting-arrow" ng-class="{\'active\':isOpen.uninstall}"></div><div class="profile-manage-account-title" ng-class="{\'active\':isOpen.uninstall}">Uninstall the browser extension</div></a><div class="profile-uninstall-change" ng-show="isOpen[\'uninstall\']"><ul><li><a href="http://support.kifi.com/hc/en-us/articles/203735045-How-do-I-remove-the-Keeper-entirely-in-Firefox-" target="_blank">Instructions to uninstall the Firefox extension</a></li><li><a href="http://support.kifi.com/hc/en-us/articles/203012909-How-do-I-remove-the-Keeper-entirely-in-Chrome-" target="_blank">Instructions to uninstall the Chrome extension</a></li></ul></div><a class="profile-manage-account-title-wrapper" href="javascript:" ng-click="toggle(\'export\');"><div class="profile-setting-arrow" ng-class="{\'active\':isOpen.export}"></div><div class="profile-manage-account-title" ng-class="{\'active\':isOpen.export}">Export your keeps</div></a><div class="profile-manage-account-export-keeps-change" ng-show="isOpen.export"><div kf-profile-export-keeps=""></div></div><a class="profile-manage-account-title-wrapper" href="javascript:" ng-click="toggle(\'close\');"><div class="profile-setting-arrow" ng-class="{\'active\':isOpen.close}"></div><div class="profile-manage-account-title" ng-class="{\'active\':isOpen.close}">Close your account</div></a><div class="profile-manage-account-close-account-change" ng-show="isOpen.close"><p>Please request to close your account via the <a ng-click="closeAccount()" href="http://support.kifi.com/hc/en-us/articles/205385755-How-to-close-your-account-">support page</a>.</p></div>')}])}(),angular.module("kifi").directive("kfProfileManageSettings",["profileService",function(e){return{restrict:"A",scope:{},templateUrl:"profile/profileManageSettings.tpl.html",link:function(i){i.isOpen=!1,i.userProfileSettings={},i.toggleOpen=function(){i.isOpen=!i.isOpen},i.saveSettings=function(){e.setSettings(i.userProfileSettings)},e.getSettings().then(function(e){i.userProfileSettings=e.data})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profileManageSettings.tpl.html",'<div class="profile-manage-settings"><a class="profile-manage-settings-title-wrapper" href="javascript:" ng-click="toggleOpen()"><div class="profile-setting-arrow" ng-class="{\'active\':isOpen}"></div><div class="profile-manage-settings-title" ng-class="{\'active\':isOpen}">Manage your Profile</div></a><div class="profile-manage-settings-change" ng-show="isOpen"><div class="profile-manage-settings-group"><div class="profile-manage-settings-option"><label class="profile-manage-label"><input type="radio" class="profile-manage-input" ng-model="userProfileSettings.showFollowedLibraries" ng-value="true" ng-change="saveSettings()"> <span class="profile-manage-radio-check"></span> <span class="profile-settings-option-text">Show Libraries you are following on your Profile</span></label></div><div class="profile-manage-settings-option"><label class="profile-manage-label"><input type="radio" class="profile-manage-input" ng-model="userProfileSettings.showFollowedLibraries" ng-value="false" ng-change="saveSettings()"> <span class="profile-manage-radio-check"></span> <span class="profile-settings-option-text">Hide Libraries you are following on your Profile</span></label></div></div></div></div>')}])}(),angular.module("kifi").directive("kfProfileNameInput",["$document","$window","KEY","util",function(e,i,t,r){return{restrict:"A",scope:{name:"=",validateName:"&",saveName:"&",explicitEnabling:"="},templateUrl:"profile/profileNameInput.tpl.html",link:function(n,a){function o(){u(),f(),n.editing=!1}function l(i){angular.element(i.target).is(".profile-name-input, .profile-input-save")||(e.off("mousedown",l),n.$evalAsync(o))}function s(e){angular.element(e.target).is(".profile-name-input, .profile-input-save")||(i.removeEventListener("focus",s,!0),n.$evalAsync(o))}function c(e,i){"badFirstName"===e?n.badFirstName=!0:"badLastName"===e&&(n.badLastName=!0),n.errorHeader=i.header||"",n.errorBody=i.body||""}function u(){n.badFirstName=!1,n.badLastName=!1}function d(){m={firstName:n.name.firstName,lastName:n.name.lastName}}function f(){n.name={firstName:m.firstName,lastName:m.lastName}}function p(e,i){return e.firstName===i.firstName&&e.lastName===i.lastName}n.badFirstName=!1,n.badLastName=!1,n.errorHeader="",n.errorBody="",n.editing=!1;var m={};a.find("input").on("keydown",function(e){switch(e.which){case t.ESC:o();break;case t.ENTER:n.save()}}),n.edit=function(){u(),d(),n.editing=!0,e.on("mousedown",l),i.addEventListener("focus",s,!0)},n.save=function(){u();var t={firstName:r.trimInput(n.name.firstName),lastName:r.trimInput(n.name.lastName)},a=n.validateName({name:t.firstName});return a&&!a.isSuccess&&a.error?void c("badFirstName",a.error):(a=n.validateName({name:t.lastName}),a&&!a.isSuccess&&a.error?void c("badLastName",a.error):(n.editing=!1,e.off("mousedown",l),i.removeEventListener("focus",s,!0),void(p(t,m)||n.saveName({name:t}))))}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profileNameInput.tpl.html",'<div class="profile-input-box profile-name-input-box"><div class="profile-input-container" ng-class="{ error: badFirstName }"><input type="text" name="firstName" placeholder="first name" class="profile-input-input profile-name-input" ng-class="{editing: editing}" ng-disabled="!editing" ng-model="name.firstName" kf-focus-if="" focus-cond="editing" novalidate=""><div class="input-error" ng-show="badFirstName"><div class="error-header" ng-bind-html="errorHeader"></div><div class="error-body" ng-bind-html="errorBody"></div></div></div><div class="profile-input-container" ng-class="{ error: badLastName }"><input type="text" name="lastName" placeholder="last name" class="profile-input-input profile-name-input" ng-class="{editing: editing}" ng-disabled="!editing" ng-model="name.lastName" novalidate=""><div class="input-error" ng-show="badLastName"><div class="error-header" ng-bind-html="errorHeader"></div><div class="error-body" ng-bind-html="errorBody"></div></div></div><a class="profile-input-edit" href="javascript:" ng-if="explicitEnabling" ng-hide="editing" ng-click="edit()">Edit</a><a class="profile-input-save" href="javascript:" ng-show="!explicitEnabling || editing" ng-click="save()">Save</a></div>')}])}(),angular.module("kifi").factory("profileService",["$http","env","$q","util","routeService","socialService","$analytics","$location","$window","$rootScope","Clutch","$rootElement",function(e,i,t,r,n,a,o,l,s,c,u,d){function f(e,i){d.find("html").removeClass("kf-logged-in kf-logged-out").addClass(e?"kf-logged-in":"kf-logged-out"),c.userLoggedIn=H=e,V&&i&&c.$broadcast("userLoggedInStateChange",e),V=!0}function p(e){return angular.forEach(e,function(e,i){z[i]=e}),z.primaryEmail=k(z.emails),a.setExpiredTokens(z.notAuthed),z}function m(){return Y.expireAll(),Y.get()}function g(){return Y.get()}function h(i){return e.post(n.profileUrl,i).then(function(e){return o.eventTrack("user_clicked_page",{action:"updateProfile",path:l.path()}),p(e.data)})}function v(e){return h({firstName:e.firstName,lastName:e.lastName})}function k(e){var i=_.find(e,"isPrimary");if(i)return i;var t=_.find(e,"isVerified")||e[0]||null;return t&&_.map(e,function(e){e===t&&(e.isPlaceholderPrimary=!0)}),t}function b(e,i){e=e||z.emails;for(var t=e.length-1;t>=0;t--)e[t].address===i&&e.splice(t,1)}function y(e){var i=k(e);i&&(i.isPrimary=!1)}function w(e){return{emails:_.clone(e.emails,!0)}}function C(e){g().then(function(i){var t=w(i);return b(t.emails,e),y(t.emails),t.emails.unshift({address:e,isPrimary:!0}),h(t)})}function S(e){var i=w(z);return y(i.emails),_.find(i.emails,function(i){i.address===e&&(i.isPrimary=!0)}),h(i)}function $(i){return e({url:n.resendVerificationUrl,method:"POST",params:{email:i}})}function L(){g().then(function(e){return e.primaryEmail&&e.primaryEmail.isPendingPrimary?F(e.primaryEmail.address):void 0})}function x(e){var i=w(z);return i.emails.push({address:e,isPrimary:!1}),h(i)}function F(e){var i=w(z);return b(i.emails,e),h(i)}function T(e){return e?r.validateEmail(e)?A():M():E("This field is required")}function I(e){return e?A():E("This field is required")}function E(e,i){return{isSuccess:!1,error:{header:e,body:i}}}function A(){return{isSuccess:!0}}function P(e){switch(e){case 400:return M();case 403:return E("This email address is already taken","This email address belongs to another user.<br>Please enter another email address.")}}function M(){return E("Invalid email address","Please enter a valid email address");
}function D(i,t){return e.post(n.userPasswordUrl,{oldPassword:i,newPassword:t}).then(function(){o.eventTrack("user_clicked_page",{action:"changePassword",path:l.path()})})}function U(i){return e.post(n.userBiography,{biography:i}).then(function(e){return e.data?(z.biography=i,i):void 0})}function K(){return e.get(n.prefs).then(function(e){return r.replaceObjectInPlace(G,e.data),c.$emit("prefsChanged"),e.data})}function N(i){return _.isEmpty(i)?void 0:e.post(n.prefs,i).then(function(e){return _.assign(G,e.data),e.data})}function B(i,t,r){var a={score:i||void 0,comment:t||void 0,answerId:r||void 0};return e.post(n.postDelightedAnswer,a).then(function(e){return e.data&&e.data.answerId})}function O(){return e.post(n.cancelDelightedSurvey,{})}function R(i){return e.post(n.userCloseAccount,i)}function q(){return H}function j(){return e.get(n.profileSettings)}function W(i){return e.post(n.profileSettings,i)}var H,V=!1,z={},G={};c.$on("social.updated",function(){m()});var Y=new u(function(){var i=z.id;return e.get(n.profileUrl).then(function(e){return p(e.data),f(!0,z.id!==i),z})["catch"](function(e){403===e.status&&(r.replaceObjectInPlace(z,{}),f(!1,z.id!==i))})},{cacheDuration:5e3});return{initLoggedOut:function(){f(!1)},userLoggedIn:q,me:z,getSettings:j,setSettings:W,fetchMe:m,getMe:g,postMe:h,prefs:G,fetchPrefs:K,savePrefs:N,setNewName:v,setNewPrimaryEmail:C,makePrimary:S,resendVerificationEmail:$,cancelPendingPrimary:L,changeBiography:U,addEmailAccount:x,deleteEmailAccount:F,validateEmailFormat:T,validateNameFormat:I,failureInputActionResult:E,successInputActionResult:A,getEmailValidationError:P,sendChangePassword:D,postDelightedAnswer:B,cancelDelightedSurvey:O,closeAccountRequest:R}}]),angular.module("kifi").directive("kfProfileWidget",["$analytics","profileService","modalService",function(e,i,t){return{replace:!0,restrict:"A",templateUrl:"profile/profileWidget.tpl.html",link:function(r){r.me=i.me,r.registerEvent=function(i){e.eventTrack("user_clicked_page",{action:"clickedProfile"+i,type:"yourKeeps"})},r.bioClick=function(){"undefined"==typeof r.me.biography&&(this.registerEvent("AddBio"),t.open({template:"profile/editUserBiographyModal.tpl.html",modalData:{biography:"",onClose:function(e){r.me.biography=e}}}))}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("profile/profileWidget.tpl.html",'<div class="kf-pw"><div class="kf-pw-badge"><a href="{{me|profileUrl}}" ng-click="registerEvent(\'Photo\')" class="kf-pw-profileImg"><img ng-src="{{me|pic:100}}"></a><aside><h1><a href="{{me|profileUrl}}" ng-click="registerEvent(\'Name\')">{{me.firstName}} {{me.lastName}}</a></h1><p><a ng-class="me.biography ? \'\' : \'no-bio\'" ng-click="bioClick()" kf-ellipsis="" full-text="me.biography || \'Add a Bio\'" max-num-lines="2"></a></p></aside></div><div class="stats"><a href="{{me|profileUrl}}" ng-click="registerEvent(\'Libraries\')" class="stat"><h2>Libraries<h3>{{me.numLibraries}}</h3></h2></a> <a href="{{me|profileUrl:\'connections\'}}" ng-click="registerEvent(\'Connections\')" class="stat"><h2>Connections<h3>{{me.numConnections}} <span ng-if="me.pendingFriendRequests > 0">+{{me.pendingFriendRequests}}</span></h3></h2></a> <a href="{{me|profileUrl:\'followers\'}}" ng-click="registerEvent(\'Followers\')" class="stat"><h2>Followers<h3>{{me.numFollowers}}</h3></h2></a></div></div>')}])}(),angular.module("kifi").directive("kfGoodies",["$rootScope","$window","$location","$analytics","installService","extensionLiaison","modalService",function(e,i,t,r,n,a,o){return{restrict:"A",replace:!0,scope:{},templateUrl:"recos/goodies.tpl.html",link:function(l){l.installState=function(){return n.installState},l.triggerInstall=function(){n.triggerInstall(function(){o.open({template:"common/modal/installExtensionErrorModal.tpl.html"})})},l.triggerGuide=function(e){a.triggerGuide(),e&&r.eventTrack("user_clicked_page",{action:"startGuide",path:t.path()})},l.importBookmarks=function(){var t=i.document.documentElement.getAttribute("data-kifi-ext");return t?(e.$emit("showGlobalModal","importBookmarks"),void r.eventTrack("user_viewed_page",{type:"browserImport"})):void o.open({template:"common/modal/installExtensionModal.tpl.html",scope:l})},l.importBookmarkFile=function(){e.$emit("showGlobalModal","importBookmarkFile"),r.eventTrack("user_viewed_page",{type:"3rdPartyImport"})}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("recos/goodies.tpl.html",'<div class="kf-gd clearfix"><div class="kf-gd-top clearfix"><h2 class="kf-gd-title">Goodies</h2><button class="kf-gd-btn kf-gd-trigger-guide" ng-click="triggerGuide(true)" kf-min-version="3.3.0"><span class="sprite sprite-guide-icon"></span> <span class="kf-gd-line-1">Learn the ropes</span> <span class="kf-gd-line-2">Start our step-by-step guide</span></button> <button class="kf-gd-btn kf-gd-trigger-install" ng-click="triggerInstall()" ng-switch="installState()"><span class="sprite sprite-install-extension-icon"></span> <span class="kf-gd-line-1">Get the full browser experience</span> <span class="kf-gd-line-2" ng-switch-default="">Install Kifi Knowledge Keeper</span> <span class="kf-gd-line-2" ng-switch-when="installing">Installing…</span> <span class="kf-gd-line-2" ng-switch-when="done">Installed!</span></button> <button class="kf-gd-btn" ng-click="importBookmarks()"><span class="sprite sprite-import-bookmarks-icon"></span> <span class="kf-gd-line-1">Get better recommendations</span> <span class="kf-gd-line-2">Import your browser bookmarks</span></button> <button class="kf-gd-btn" ng-click="importBookmarkFile()"><span class="sprite sprite-import-from-other-services-icon"></span> <span class="kf-gd-line-1">Jumpstart your Kifi</span> <span class="kf-gd-line-2">Import from Delicious, Pocket, etc.</span></button></div><div class="kf-gd-bottom"><a class="kf-gd-help clearfix" href="http://support.kifi.com" target="_blank"><span class="kf-gd-help-qn-mark">?</span> <span class="kf-gd-line-1">Get the help you need</span> <span class="kf-gd-line-2">Visit our Help Center</span></a></div></div>')}])}(),angular.module("kifi").factory("recoActionService",["$http","$q","routeService","Clutch",function(e,i,t,r){function n(e){return"library"===e.recoData.kind?t.libraryRecoFeedback(e.recoLib.id):t.recoFeedback(e.recoKeep.urlId)}var a,o,l=[],s=[],c={cacheDuration:2e3},u=new r(function(i){var r={recency:i&&angular.isNumber(i.recency)?i.recency:.75,trackLibDelivery:i&&_.isBoolean(i.trackLibDelivery)?i.trackLibDelivery:void 0};return i&&i.more&&(r.uriContext=a,r.libContext=o),e.get(t.recos(r)).then(function(e){return e&&e.data?(l=e.data.recos,a=e.data.uctx,o=e.data.lctx,e.data.recos):void 0})},c),d={cacheDuration:2e3},f=new r(function(){return e.get(t.recosPublic()).then(function(e){return e&&e.data?(s=e.data,e.data):void 0})},d),p={get:function(e,t){if(e||0===l.length){a="",o="";var r={trackLibDelivery:t};return u.get(r)}return i.when(l)},getMore:function(e){return u.get({more:!0,recency:e})},getPopular:function(){return s.length>0?i.when(s):f.get()},trash:function(i){e.post(n(i),{trashed:!0})},vote:function(i,t){e.post(n(i),{vote:t})},trackKeep:function(i){e.post(t.recoFeedback(i.urlId),{kept:!0})},trackFollow:function(i){e.post(t.libraryRecoFeedback(i.id),{followed:!0})},trackClick:function(i){e.post(n(i),{clicked:!0})},improve:function(i,r){e.post(t.recoFeedback(i.urlId),{comment:r})}};return p}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("recos/recoDropdownMenu.tpl.html",'<div class="kf-reco-dropdown-menu-container"><span class="kf-reco-icon kf-reco-dropdown-menu-down"></span><menu class="kf-dropdown-menu"><button class="kf-dropdown-menu-item" ng-click="downVote(reco)">Don\'t recommend items like this to me</button> <button class="kf-dropdown-menu-item" ng-click="upVote(reco)">Recommend me more things like this</button> <button class="kf-dropdown-menu-item" ng-click="showModal()">How can we improve this?</button></menu></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("recos/recoImproveModal.tpl.html",'<div kf-modal="" class="kf-reco-improve-modal"><div kf-basic-modal-content="" action-text="Submit" action="submitImprovement(reco)"><p>Why was the recommendation not great?</p><ul><li><input type="radio" name="improvement" id="r1" value="irrelevant" ng-model="improvement.type"> <label for="r1">It\'s not relevant to my interests</label></li><li><input type="radio" name="improvement" id="r2" value="too similar" ng-model="improvement.type"> <label for="r2">It\'s too similar to what I\'m seeing</label></li><li><input type="radio" name="improvement" id="r3" value="offensive" ng-model="improvement.type"> <label for="r3">It\'s offensive</label></li></ul></div></div>')}])}(),angular.module("kifi").directive("kfRecoLibraryCard",["$FB","$q","$rootScope","$timeout","$twitter","env","libraryService","modalService","profileService","URI","linkify",function(e,i,t,r,n,a,o,l,s,c,u){return{restrict:"A",replace:!0,scope:{library:"=",followCallback:"&",clickLibraryCallback:"&"},templateUrl:"recos/recoLibraryCard.tpl.html",link:function(i){function r(){var e=300,t=180,r=i.library.description||"";if(r.length>e){var n=r.lastIndexOf(" ",t)+1||t;i.library.shortDescription=u(r.substr(0,n)),i.clippedDescription=!0}i.library.formattedDescription="<p>"+u(r).replace(/\n+/g,"<p>"),i.library.absUrl=a.origin+i.library.url}i.showLongDescription=function(){i.clippedDescription=!1},i.preloadFB=function(){e.init()},i.shareFB=function(){o.trackEvent("user_clicked_page",i.library,{type:"recommendations",action:"clickedShareFacebook"}),e.ui({method:"share",href:i.library.absUrl+"?utm_medium=vf_facebook&utm_source=library_share&utm_content=lid_"+i.library.id+"&kcid=na-vf_facebook-library_share-lid_"+i.library.id})},i.preloadTwitter=function(){n.load()},i.shareTwitter=function(e){o.trackEvent("user_clicked_page",i.library,{type:"recommendations",action:"clickedShareTwitter"}),e.target.href="https://twitter.com/intent/tweet"+c.formatQueryString({original_referer:i.library.absUrl,text:"Discover this amazing @Kifi library about "+i.library.name+"!",tw_p:"tweetbutton",url:i.library.absUrl+"?utm_medium=vf_twitter&utm_source=library_share&utm_content=lid_"+i.library.id+"&kcid=na-vf_twitter-library_share-lid_"+i.library.id})},i.followLibrary=function(){i.followCallback(),o.trackEvent("user_clicked_page",i.library,{type:"recommendations",action:"clickedFollowButton"}),o.joinLibrary(i.library.id)["catch"](l.openGenericErrorModal)},i.unfollowLibrary=function(){o.trackEvent("user_clicked_page",i.library,{type:"recommendations",action:"clickedUnfollowButton"}),o.leaveLibrary(i.library.id)["catch"](l.openGenericErrorModal)},i.showFollowers=function(){t.$emit("trackLibraryEvent","click",{action:"clickedViewFollowers"}),l.open({template:"libraries/libraryFollowersModal.tpl.html",modalData:{library:i.library,currentPageOrigin:"recommendationsPage"}})},[t.$on("libraryKeepCountChanged",function(e,t,r){t===i.library.id&&(i.library.numKeeps=r)}),t.$on("libraryJoined",function(e,t,r){var n=i.library;if(n&&t===n.id&&"none"===n.access){n.access=r.access,n.numFollowers++;var a=s.me;_.contains(n.followers,{id:a.id})||n.followers.push(_.pick(a,"id","firstName","lastName","pictureName","username"))}}),t.$on("libraryLeft",function(e,t){var r=i.library;r&&t===r.id&&"none"!==r.access&&(r.access="none",r.numFollowers--,_.remove(r.followers,{id:s.me.id}))})].forEach(function(e){i.$on("$destroy",e)}),i.Math=Math,i.clippedDescription=!1,r()}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("recos/recoLibraryCard.tpl.html",'<div class="kf-rcl"><div class="kf-rcl-card"><div class="kf-rcl-body"><div class="kf-rcl-name-wrap-2"><div class="kf-rcl-name-wrap-1"><a class="kf-rcl-name" href="{{library.url}}" ng-click="clickLibraryCallback()">{{library.name}}</a></div></div><div class="kf-rcl-color" ng-class="{\'kf-above-image\': library.image}" style="background-color:{{library.color}}"></div><a class="kf-rcl-cover-image" href="{{library.url}}" ng-if="library.image" style="{{library.image|bgImageAndPos}}"></a><div class="kf-rcl-info"><div class="kf-rcl-owner"><a href="{{library.owner|profileUrl}}" kf-track-origin="recommendationsPage/curator"><img ng-src="{{library.owner | pic:100}}" class="kf-rcl-owner-image" alt="{{library.owner|name}}"></a><div class="kf-rcl-owner-text"><div>Curator:</div><div class="kf-rcl-owner-name">{{library.owner|name}}</div></div></div><div ng-switch="clippedDescription" class="kf-rcl-desc-wrap"><p ng-switch-when="true" class="kf-rcl-desc"><span ng-bind-html="library.shortDescription" itemtype="description"></span>&hellip; <a href="javascript:" class="kf-rcl-desc-more" ng-click="showLongDescription()">More</a></p><p ng-switch-when="false" class="kf-rcl-desc" ng-bind-html="library.formattedDescription"></p></div><div class="kf-rcl-stats-line"><div class="kf-rcl-stats"><div class="kf-rcl-stat"><span class="kf-rcl-stat-name">Keeps</span> <span class="kf-rcl-stat-val">{{library.numKeeps | number}}</span></div><a class="kf-rcl-stat" ng-click="showFollowers()" href="javascript:"><span class="kf-rcl-stat-name">Followers</span> <span class="kf-rcl-stat-val">{{Math.max(library.numFollowers, library.followers.length) | number}}</span></a></div><div class="kf-rcl-followers" kf-library-follower-pics="library.followers" follower-widths="[[0,32,6],[480,42,8]]" num-followers="library.numFollowers" show-followers="showFollowers()" current-page-origin="recommendationsPage"></div></div></div></div><div class="kf-rcl-buttons clearfix"><div style="float:right"><div kf-library-share-search="" library="library" current-page-origin="recommendationsPage"></div><button class="kf-button kf-rcl-unfollow-btn" ng-if="library.access === \'read_only\'" ng-click="unfollowLibrary()"></button> <button class="kf-button kf-rcl-follow-btn" ng-if="library.access === \'none\'" ng-click="followLibrary()">Follow Library</button></div><a class="kf-button kf-button-text-optional" ng-focus="preloadTwitter()" ng-mouseenter="preloadTwitter()" ng-click="shareTwitter($event)" href="https://twitter.com/intent/tweet" target="_blank"><span class="kf-button-icon svg-twitter"></span> Tweet</a> <button class="kf-button kf-button-text-optional" ng-focus="preloadFB()" ng-mouseenter="preloadFB()" ng-click="shareFB()"><span class="kf-button-icon svg-facebook"></span> Post</button></div></div></div>')}])}(),angular.module("kifi").factory("recoStateService",[function(){var e=[],i={},t={recosList:e,populate:function(t){for(var r=!1,n=0;n<t.length;n++){var a=t[n],o=(a.recoLib||a.recoKeep).url;i[o]||(i[o]=!0,e.push(a),r=!0)}return r},empty:function(){e.length=0,i={}}};return t}]),angular.module("kifi").controller("RecosCtrl",["$scope","$rootScope","$analytics","$window","profileService","modalService","recoActionService","recoStateService","undoService",function(e,i,t,r,n,a,o,l,s){function c(i,t){e.loading=!0,l.empty(),o.get(i,t).then(function(i){var t=[];i.length>0?(i.forEach(function(e){t.push(f(e))}),l.populate(t),e.recosState="hasRecos",e.loading=!1,e.noMoreRecos=!1):o.getPopular().then(function(i){i.forEach(function(e){t.push(p(e))}),l.populate(t),e.recosState="noRecos",e.loading=!1,e.noMoreRecos=!1})})}function u(){_.remove(e.recos,function(e){return e.recoKeep&&_.any(e.recoKeep.keeps,_.identity)})}function d(){u(),e.recos.length>0?e.recosState="hasRecos":(c(!1,e.setRecosDelivered),e.setRecosDelivered=void 0)}function f(e){return m(e,"recommended")}function p(e){return m(e,"popular")}function m(e,i){var t={type:i,kind:e.kind},r=e.itemInfo;return"keep"===t.kind?(r.urlId=r.id,delete r.id,r.libraries&&(r.libraries=_.map(r.libraries,function(e){return[e,e.owner]})),{recoData:t,recoKeep:r}):(r.kind="user_created",r.visibility="published",r.access="none",{recoData:t,recoLib:r})}r.document.title="Kifi • Your Recommendation List",e.recos=l.recosList,e.recosState="loading",e.initialCardClosed=!1,e.noMoreRecos=!1,e.showHints=!1,e.autoShowPersona=void 0,e.getMore=function(i){e.loading=!0,l.empty(),o.getMore(i).then(function(i){if(i.length>0){var t=[];i.forEach(function(e){t.push(f(e))}),l.populate(t),e.recosState="hasRecos"}else e.recosState="noMoreRecos";e.loading=!1})},e.addMore=function(){e.moreLoading=!0,o.getMore().then(function(i){if(i.length>0){var t=[];i.forEach(function(e){t.push(f(e))}),l.populate(t)||(e.noMoreRecos=!0)}else e.noMoreRecos=!0})["catch"](function(){e.noMoreRecos=!0})["finally"](function(){e.moreLoading=!1})},e.trash=function(i){i.recoData&&o.trash(i);var t=_.findIndex(e.recos,i),r=e.recos.splice(t,1)[0];0===e.recos.length&&e.getMore(),s.add("Recommendation removed.",function(){e.recos.splice(t,0,r)})},e.showPopular=function(){e.loading=!0,l.empty(),o.getPopular().then(function(i){var t=[];i.forEach(function(e){t.push(p(e))}),l.populate(t),e.recosState="hasPopularRecos",e.loading=!1})},e.closeInitialCard=function(){e.initialCardClosed=!0},e.showPersonaModal=function(){t.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clickedUpdateInterests"}),a.open({template:"persona/managePersonaModal.tpl.html"})},e.closeAutoShowPersonas=function(){n.savePrefs({auto_show_persona:null})},e.showDelightedSurvey=n.prefs.show_delighted_question,e.$on("$destroy",i.$on("prefsChanged",function(){e.showDelightedSurvey=n.prefs.show_delighted_question})),e.hideDelightedSurvey=function(){e.showDelightedSurvey=!1},[i.$on("refreshRecos",function(){c(!0)})].forEach(function(i){e.$on("$destroy",i)}),e.setRecosDelivered=void 0;var g=e.$watch(function(){return n.prefs.auto_show_persona},function(i,t){e.autoShowPersona=i,!i&&t&&(e.showHints=!0,e.setRecosDelivered=!1,g()),null===i&&d()})}]).controller("RecoCtrl",["$scope","modalService","recoActionService",function(e,i,t){e.improvement={},e.showImprovementModal=function(){i.open({template:"recos/recoImproveModal.tpl.html",scope:e})},e.submitImprovement=function(i){i.recoData&&"keep"===i.recoData.kind&&t.improve(i.recoKeep,e.improvement.type)},e.trackRecoKeep=function(e){t.trackKeep(e)},e.trackLibraryFollow=function(e){t.trackFollow(e)},e.trackRecoClick=function(e){t.trackClick(e)}}]).directive("kfRecoDropdownMenu",["$document","recoActionService",function(e,i){return{restrict:"A",replace:!0,scope:{reco:"=",showImprovementModal:"&"},templateUrl:"recos/recoDropdownMenu.tpl.html",link:function(t,r){function n(e){0!==s.find(e.target).length||e.target.classList.contains("kf-reco-dropdown-menu-down")||o()}function a(){c=!0,s.show(),e.on("mousedown",n)}function o(){c=!1,s.hide(),e.off("mousedown",n)}var l=r.find(".kf-reco-dropdown-menu-down"),s=r.find(".kf-dropdown-menu"),c=!1;l.on("click",function(){c?o():a()}),t.upVote=function(e){o(),e.recoData&&i.vote(e,!0)},t.downVote=function(e){o(),e.recoData&&i.vote(e,!1)},t.showModal=function(){o(),t.showImprovementModal()}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("recos/recosView.tpl.html",'<div class="kf-recos-view" ng-controller="RecosCtrl"><div class="kf-recos-persona-overlay" ng-if="autoShowPersona"><div class="view-overlay"><div class="persona-wrapper"><div kf-manage-persona="" close-action="closeAutoShowPersonas"></div></div></div></div><div class="kf-recos-wrap" ng-if="!autoShowPersona"><div kf-delighted-survey="" hide="hideDelightedSurvey" ng-if="showDelightedSurvey"></div><h1 class="kf-recos-title">Recommendations</h1><div class="kf-reco-cols"><div class="kf-reco-col-1"><a href="javascript:" class="kf-recos-update-personas" ng-click="showPersonaModal()"><span class="kf-recos-update-personas-icon sprite sprite-update-personas"></span> Update your interests</a><div class="kf-reco kf-reco-info kf-reco-cta" ng-if="recosState === \'noRecos\' || showHints" ng-hide="initialCardClosed"><span class="kf-reco-cta-text">To get started, simply click the follow button on some of&nbsp;the libraries below</span> <img class="kf-reco-cta-image" src="//d1dwdv9wd966qu.cloudfront.net/img/webapp-ftui-follow-button-image.558ce32.png"></div><div class="kf-reco kf-reco-info" ng-if="recosState === \'noMoreRecos\'"><h4>No more recommendations for now :)</h4><p>Kifi works by recommending things based on what you\'ve kept. We\'ll cater to your interests over time and we can recommend more relevant and timely things if you <a href="/invite">connect with more friends</a>. Think about your most inspiring, interesing and knowledgeable friends and invite them to Kifi! Keep on keeping things that matter to you too!</p><p>In the meantime, you can enjoy popular things being kept on Kifi.</p><a href="javascript:" ng-click="showPopular()">See Popular Keeps on Kifi</a></div><div class="kf-recos" ng-if="!loading"><div class="kf-reco kf-reco-recommended" ng-repeat="reco in recos" reco="reco" ng-controller="RecoCtrl" ng-class="{\'kf-reco-with-invite\':!!reco.recoLib.invite}"><header class="kf-reco-top"><span class="kf-reco-icon kf-reco-close-x" ng-click="trash(reco)" ng-if="reco.recoData.type === \'recommended\'"></span><div ng-if="reco.recoData.type === \'recommended\'" kf-reco-dropdown-menu="" reco="reco" show-improvement-modal="showImprovementModal()"></div><span ng-if="reco.recoData.kind === \'keep\'">{{reco.recoData.type | titlecase}}</span> <span ng-switch="" on="reco.recoData.type" ng-if="reco.recoData.kind === \'library\'"><span ng-switch-when="popular">Featured</span> <span ng-switch-default="">Recommended Library</span></span></header><div class="kf-reco-keep" ng-if="::reco.recoData.kind === \'keep\'"><div kf-keep-card="reco.recoKeep" keep-callback="trackRecoKeep(keep)" click-callback="trackRecoClick(reco)" current-page-origin="recommendationsPage"></div></div><div ng-if="::reco.recoData.kind === \'library\'" kf-reco-library-card="" library="reco.recoLib" follow-callback="trackLibraryFollow(reco.recoLib)" click-library-callback="trackRecoClick(reco)"></div></div></div><div ng-if="!loading" class="kf-reco-get-more-container" ng-click="addMore()"><span ng-if="!moreLoading && !noMoreRecos" class="kf-reco-get-more">See more</span> <span ng-if="!moreLoading && noMoreRecos" class="kf-reco-no-more">No more recommendations right now.</span> <span ng-if="moreLoading" class="kf-reco-get-more-loading">Loading...</span></div><div class="kf-reco-loading-logo svg-small-new-logo" ng-if="loading"></div></div><div class="kf-reco-col-2"><div kf-profile-widget=""></div><div kf-people-you-may-know=""></div><div kf-goodies=""></div><div kf-user-checklist=""></div></div></div></div></div>')}])}(),angular.module("kifi").directive("kfUserChecklist",["$rootScope","$window","$location","$analytics","installService","extensionLiaison","modalService","profileService","net","routeService",function(e,i,t,r,n,a,o,l,s,c){return{restrict:"A",replace:!0,scope:{},templateUrl:"recos/userChecklist.tpl.html",link:function(t,u){function d(e){return e?"completed":"incomplete"}function f(e){for(var i=0;i<e.length;i++)if(!e[i].complete)return!1;return!0}var p=[{name:"invite_friends",title:"Invite 3 colleagues or friends to Kifi",subtitle:"Let them tap into your knowledge on Kifi",action:function(){i.open(c.socialInvite,"_blank"),r.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clickedInvite3Checklist",subaction:d(this.complete)})}},{name:"keep_pages",title:"Keep 5 pages",subtitle:"Keep from the site, browser add-on, or mobile",action:function(){r.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clickedKeep5Checklist",subaction:d(this.complete)})}},{name:"follow_libs",title:"Follow 5 libraries",subtitle:"Browse libraries in your recommendations",action:function(){i.open(c.followingLibraries,"_blank"),r.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clickedFollow5Checklist",subaction:d(this.complete)})}},{name:"install_ext",title:"Get the Kifi browser add-on",subtitle:"The most loved features are in the add-on",action:function(){n.triggerInstall(function(){o.open({template:"common/modal/installExtensionErrorModal.tpl.html"})}),r.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clickedGetAddOnChecklist",subaction:d(this.complete)})}},{name:"take_tour",title:"Take the Kifi browser addon tour",subtitle:"A quick walk-thru of our most popular features",action:function(){a.triggerGuide(),r.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clickedTakeTourChecklist",subaction:d(this.complete)})}},{name:"import_bookmarks",title:"Import bookmarks from your browser",subtitle:"The easiest way to add your favorites to Kifi",action:function(){var n=i.document.documentElement.getAttribute("data-kifi-ext");return n?(e.$emit("showGlobalModal","importBookmarks"),void r.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clickedBrowserImportChecklist",subaction:d(this.complete)})):void o.open({template:"common/modal/installExtensionModal.tpl.html",scope:t})}},{name:"import_third_party",title:"Bring in your links from 3rd parties",subtitle:"Pocket, Delicious, Pinboard, Instapaper & more",action:function(){e.$emit("showGlobalModal","importBookmarkFile"),r.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clicked3rdPartyImportChecklist",subaction:d(this.complete)})}},{name:"install_mobile",title:"Get the iOS or Android mobile app",subtitle:"Text a link to your phone for Kifi on the go",action:function(){o.open({template:"common/modal/sendMobileAppSMS.tpl.html",scope:t}),r.eventTrack("user_viewed_page",{type:"getMobileChecklist"}),r.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clickedGetMobileChecklist",subaction:d(this.complete)})}},{name:"twitter_sync",title:"Sign up for the Twitter Beta",subtitle:"Twitter meets deep search",action:function(){i.open(c.connectTwitter,"_blank"),r.eventTrack("user_clicked_page",{type:"yourKeeps",action:"clickedTwitterChecklist",subaction:d(this.complete)})}}];t.sms={phoneNumber:""},t.triggerSendSMS=function(){s.sendMobileAppSMS({phoneNumber:t.sms.phoneNumber})["catch"](function(){o.open({template:"common/modal/sendMobileAppSMSError.tpl.html"})}),t.sms.phoneNumber=""},t.$watchCollection(function(){return l.prefs&&l.prefs.checklist},function(e){return e?f(e)?void u.remove():void(t.checklist=e.map(function(e){var i=p.filter(function(i){return e.name===i.name}).pop();return i?(i.complete=e.complete,i):null}).filter(Boolean)):void 0})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("recos/userChecklist.tpl.html",'<div class="kf-uc" ng-if="checklist.length > 0"><h2 class="kf-uc-title">Get the most out of Kifi</h2><ul><li ng-repeat="item in $parent.checklist" class="kf-uc-item {{ item.complete ? \'kf-uc-item-complete\' : \'\' }}" ng-click="item.action($event)"><span class="kf-uc-check {{ item.complete ? \'svg-checkmark-green\' : \'\' }}"></span> <span class="kf-uc-item-title">{{ item.title }}</span><p class="kf-uc-item-subtitle">{{ item.subtitle }}</p></li></ul></div>')}])}(),angular.module("kifi").config(["$httpProvider","$locationProvider","$stateProvider","$urlRouterProvider",function(e,i,t,r){function n(e,i){var t=e.defer(),r=new Image;return r.onload=function(){t.resolve(r)},r.onerror=function(e){t.reject(e)},r.src=i,t.promise}i.html5Mode(!0).hashPrefix("!"),e.defaults.withCredentials=!0;var a=/^([^?#]+)\/([?#].*|$)/;r.rule(function(e,i){var t=i.url().match(a);return t?t[1]+t[2]:void 0}).when("/:username/libraries","/:username").otherwise("/"),t.state("home",{url:"/",templateUrl:"recos/recosView.tpl.html"}).state("invite",{url:"/invite",templateUrl:"invite/invite.tpl.html"}).state("manageTags",{url:"/tags/manage",templateUrl:"tagManage/tagManage.tpl.html",controller:"ManageTagCtrl"}).state("settings",{url:"/settings",templateUrl:"profile/profile.tpl.html",controller:"ProfileCtrl"}).state("search",{url:"/find?q&f",templateUrl:"search/search.tpl.html",controller:"SearchCtrl",resolve:{library:angular.noop},reloadOnSearch:!1}).state("userProfile",{url:"/:username",templateUrl:"userProfile/userProfile.tpl.html",controller:"UserProfileCtrl",resolve:{userProfileActionService:"userProfileActionService",profile:["userProfileActionService","$stateParams",function(e,i){return e.getProfile(i.username)}]},"abstract":!0}).state("userProfile.libraries",{url:"",templateUrl:"userProfile/userProfileLibraries.tpl.html",controller:"UserProfileLibrariesCtrl","abstract":!0}).state("userProfile.libraries.own",{url:"",templateUrl:"userProfile/userProfileLibrariesList.tpl.html"}).state("userProfile.libraries.following",{url:"/libraries/following",templateUrl:"userProfile/userProfileLibrariesList.tpl.html"}).state("userProfile.libraries.invited",{url:"/libraries/invited",templateUrl:"userProfile/userProfileLibrariesList.tpl.html"}).state("userProfile.connections",{url:"/connections",templateUrl:"userProfile/userProfileConnections.tpl.html",controller:"UserProfileConnectionsCtrl"}).state("userProfile.followers",{url:"/followers",templateUrl:"userProfile/userProfileFollowers.tpl.html",controller:"UserProfileFollowersCtrl"}).state("library",{url:"/:username/:librarySlug?authToken",templateUrl:"libraries/library.tpl.html",controller:"LibraryCtrl",resolve:{libraryService:"libraryService",library:["libraryService","$stateParams",function(e,i){return e.getLibraryByUserSlug(i.username,i.librarySlug,i.authToken)}],libraryImageLoaded:["$q","$timeout","env","library",function(e,i,t,r){if(r.image){var a=e.defer(),o=n(e,t.picBase+"/"+r.image.path).then(function(){a.resolve(!0)},function(){a.resolve(!1)});return i(function(){a.resolve({promise:o})},12),a.promise}return!1}]},"abstract":!0}).state("library.keeps",{url:"",templateUrl:"libraries/libraryKeeps.tpl.html"}).state("library.search",{url:"/find?q&f",templateUrl:"search/matchingKeeps.tpl.html",controller:"SearchCtrl",reloadOnSearch:!1})}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("search/matchingKeeps.tpl.html",'<div><div class="kf-smk-head"><div class="kf-smk-filters" ng-if="$root.userLoggedIn && !isLibrarySearch"><a class="kf-smk-filter" ng-class="{ selected: isFilterSelected(\'a\'), enabled: isEnabled(\'a\') }" ui-sref=".({f:\'a\'})" ng-click="onClickSearchFilter(\'a\')">All keeps</a> <a class="kf-smk-filter" ng-class="{ selected: isFilterSelected(\'m\'), enabled: isEnabled(\'m\') }" ui-sref=".({f:\'m\'})" ng-click="onClickSearchFilter(\'m\')">Your keeps ({{resultTotals.myTotal | number}})</a> <a class="kf-smk-filter" ng-class="{ selected: isFilterSelected(\'f\'), enabled: isEnabled(\'f\') }" ui-sref=".({f:\'f\'})" ng-click="onClickSearchFilter(\'f\')">Connections’ keeps ({{resultTotals.friendsTotal | number}})</a></div><div class="kf-smk-top"><span class="kf-smk-heading" ng-if="loading">Searching...</span> <span class="kf-smk-heading" ng-if="!loading" ng-pluralize="" count="resultKeeps.length" when="{0: \'No matching keeps\', 1: \'1 matching keep\', other: \'Top {} results\'}"></span><div class="kf-smk-bulk-add" ng-click="edit.enabled = !edit.enabled" ng-if="$root.userLoggedIn && resultKeeps.length > 1"><span class="sprite sprite-edit-pencil-icon"></span> <span class="kf-smk-bulk-add-text">{{edit.enabled ? \'Done\' : \'Bulk keep to library\'}}</span></div></div></div><div class="kf-keeps" kf-keeps="" keeps="resultKeeps" keeps-loading="loading" keeps-has-more="hasMore" scroll-disabled="!hasMore" scroll-next="getNextKeeps()" keep-click="analyticsTrack" edit="edit" current-page-origin="searchResultsPage"></div></div>')}])}(),angular.module("kifi").controller("SearchCtrl",["$scope","$rootScope","$location","$q","$state","$stateParams","$timeout","$window","$$rAF","$http","searchActionService","libraryService","routeService","util","library",function(e,i,t,r,n,a,o,l,s,c,u,d,f,p,m){
function g(i){switch(i){case"m":return e.resultTotals.myTotal;case"f":return e.resultTotals.friendsTotal;case"a":return e.resultTotals.myTotal+e.resultTotals.friendsTotal+e.resultTotals.othersTotal}}function h(){return E++,L=a.q||"",x=a.f||"a",L?(F=null,o.cancel(T),T=null,e.hasMore=!0,e.scrollDistance="100%",e.loading=!1,e.edit.enabled=!1,document.title=(m&&m.name?m.name+" • ":"")+L.replace(/^tag:/,"")+" • Kifi",u.reset(),e.getNextKeeps(!0),void o(function(){if(m){var e=angular.element(".kf-lib-content"),i=angular.element(".kf-lih,.kf-loh");e.length&&i.length&&v(e[0].getBoundingClientRect().top-i[0].offsetHeight)}else l.document.body.scrollTop=0})):void n.go(m?"library.keeps":"home")}function v(e){var i,t=l.document,r=t.defaultView,n="function"==typeof UIEvent?function(){return new r.UIEvent("scroll")}:function(){var e=t.createEvent("UIEvent");return e.initUIEvent("scroll",!1,!1,r,0),e},a=0,o=1/Math.max(400,Math.min(800,100*Math.log(Math.abs(e)))),c=I=function(t){if(c===I){i||(i=t);var l=Math.round(e*k(Math.min(1,(t-i)*o)));r.scrollBy(0,l-a),r.dispatchEvent(n()),a=l,Math.abs(a)<Math.abs(e)?s(c):I=null}};s(c)}function k(e){return.5>e?8*e*e*e*e:1-8*--e*e*e*e}function b(i){e.resultKeeps.push(i.shift()),i.length?T=o(angular.bind(null,b,i)):y()}function y(){e.loading=!1}function w(e){var i=e.followers||[];return{id:e.id,owner:e.owner,collaborators:e.collaborators,numCollaborators:e.numCollaborators,followers:i,numFollowers:e.numFollowers,numKeeps:e.numKeeps,name:e.name,description:e.description,color:e.color,image:e.image,path:e.path,membership:e.membership,modifiedAt:e.modifiedAt,reason:i.length||e.modifiedAt?"":"topic"}}function C(e){c.get(f.getLibraryCoverImages(_.pluck(e,"id"),400,400)).then(function(i){var t=i.data;_.each(e,function(e){e.image=t[e.id]})})}function S(){_.assign(a,_.pick(t.search(),"q","f")),h()}function $(){var i=0;e.resultKeeps.forEach(function(e){_.some(e.libraries,function(e){return!d.isLibraryIdMainOrSecret(e.id)})&&i++}),u.reportSearchAnalyticsOnUnload(e.resultKeeps.length,i)}var L,x,F,T,I,E=0;e.isLibrarySearch=!!m,e.resultKeeps=[],e.resultTotals={myTotal:0,friendsTotal:0,othersTotal:0},e.edit={enabled:!1,actions:{keepToLibrary:!0}},e.getNextKeeps=function(t){if(!e.loading&&""!==L){e.loading=!0;var r=!F;u.find(L,x,m,F,i.userLoggedIn).then(function(i,n){if(i===E){F=n.uris.context,t&&(e.resultKeeps.length=0,e.resultTotals.myTotal=0,e.resultTotals.friendsTotal=0,e.resultTotals.othersTotal=0),e.resultTotals.myTotal=e.resultTotals.myTotal||n.uris.myTotal,e.resultTotals.friendsTotal=e.resultTotals.friendsTotal||n.uris.friendsTotal,e.resultTotals.othersTotal=e.resultTotals.othersTotal||n.uris.othersTotal;var a=n.uris.hits;if(a.length?(e.hasMore=!!n.uris.mayHaveMore,T=o(angular.bind(null,b,a.slice()))):(e.hasMore=!1,y()),r){var l=e.matchingLibraries=n.libraries.hits.map(w);l.length&&C(l)}}}.bind(null,E))}},e.isFilterSelected=function(e){return x===e},e.isEnabled=function(i){return!e.isFilterSelected(i)&&!!g(i)},e.analyticsTrack=function(i,t){return u.reportSearchClickAnalytics(i,e.resultKeeps.indexOf(i),e.resultKeeps.length),[i,t]},e.onClickSearchFilter=function(e){t.search("f",e)},e.$on("$destroy",i.$on("searchTextUpdated",function(e,i,r){"/find"===t.path()?t.search("q",i).replace():r?i?a.q?t.search("q",i).replace():t.url(r+"/find?q="+i+"&f=a"):t.url(r):i&&(m=null,t.url("/find?q="+i)),S()})),e.$on("$locationChangeSuccess",function(e,t,r){var n=t.slice(0,t.indexOf("?")),o=r.slice(0,r.indexOf("?"));n===o&&(S(),i.$emit("newQueryFromLocation",a.q))}),l.addEventListener("beforeunload",$),e.$on("$destroy",function(){$(),l.removeEventListener("beforeunload",$)});var A=i.$on("keepAdded",function(i,t,r){t.forEach(function(i){var t=_.find(e.resultKeeps,{url:i.url});t&&!_.find(t.keeps,{id:i.id})&&t.keeps.push({id:i.id,libraryId:r.id,visibility:r.visibility})})});e.$on("$destroy",A),h()}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("search/search.tpl.html",'<div class="kf-sr"><section class="kf-sr-1"><div ng-include="\'search/matchingKeeps.tpl.html\'"></div></section><section class="kf-sr-2"><div kf-related-libraries="" related-libraries="matchingLibraries" heading="Matching Libraries" ng-if="matchingLibraries.length"></div><div ng-if="matchingLibraries && matchingLibraries.length === 0"><header class="kf-related-library-explore-more-header">Matching Libraries</header><div class="kf-sr-no-libs">No matching Kifi libraries</div></div></section></div>')}])}(),angular.module("kifi").factory("searchActionService",["$analytics","$location","$log","$q","net","profileService","libraryService",function(e,i,t,r,n,a,o){function l(){return Math.random().toString(16).slice(2)}function s(e,i,t,r){e.user=-1===e.user?a.me:i[e.user],e.library=t[e.library];var n=[],l=[];e.keepers=e.keepers||[],e.libraries=e.libraries||[];for(var s=0;s<e.libraries.length;s+=2){var c=e.libraries[s],u=e.libraries[s+1],d=t[c];-1!==u?l.push([d,i[u]]):r&&!o.isLibraryIdMainOrSecret(d.id)&&l.push([d,a.me])}if(r&&e.keepers.forEach(function(e){e>=0&&n.push(i[e])}),e.keepers=n,e.libraries=l,!e.summary){var f=e.image;e.summary={description:e.description,imageUrl:f&&f.url,imageWidth:f&&f.width,imageHeight:f&&f.height}}e.summary.wordCount=e.wordCount}function c(e,r,a){if(g&&g.query){var o=i.$$protocol+"://"+i.$$host;i.$$port&&(o=o+":"+i.$$port),n.search.searched({origin:o,uuid:g.uuid,experimentId:g.experimentId,query:g.query,filter:g.filter,maxResults:g.maxResults,kifiExpanded:!0,kifiResults:r,kifiResultsWithLibraries:a,kifiTime:g.kifiTime,kifiShownTime:g.kifiShownTime,kifiResultsClicked:g.clicks,refinements:h,pageSession:g.pageSession,endedWith:e})["catch"](function(e){t.log("res: ",e)})}else t.log("no search context to log")}function u(t,a,l,c,u){var d={q:t,f:a||[],l:l&&l.id||[],disablePrefixSearch:1,maxUris:5,maxLibraries:c?[]:6,uriContext:c||[]},f=n.search.search(d),p=u?o.fetchLibraryInfos(!1):null;return r.all([p,f]).then(function(t){var r=t[1].data,n=r.uris||{},a=n.hits||[];return _.forEach(a,function(e){s(e,n.keepers,n.libraries,u)}),e.eventTrack("user_clicked_page",{action:"searchKifi",hits:a.length,mayHaveMore:n.mayHaveMore,path:i.path()}),g={origin:i.origin,uuid:n.uuid,experimentId:r.experimentId,query:d.q,filter:d.f,maxResults:d.maxUris,kifiTime:null,kifiShownTime:null,kifiResultsClicked:null,refinements:++h,pageSession:v},r})}function d(){g=null,h=-1,v=l()}function f(e,i){c("unload",e,i)}function p(e,i){c("refinement",e,i)}function m(e,r,a){if(g&&g.query){var o=i.$$protocol+"://"+i.$$host;i.$$port&&(o=o+":"+i.$$port);var l=_.any(e.keeps,_.identity),s={isMyBookmark:l,isPrivate:l&&_.all(e.keeps,{visibility:"secret"}),count:a,keepers:_.map(e.keepers,"id"),libraries:e.libraries.map(function(e){return[e.id,e.owner.id]}),tags:e.tags,title:e.title,titleMatches:0,urlMatches:0};n.search.resultClicked({origin:o,uuid:g.uuid,experimentId:g.experimentId,query:g.query,filter:g.filter,maxResults:g.maxResults,kifiExpanded:!0,kifiResults:a,kifiTime:g.kifiTime,kifiShownTime:g.kifiShownTime,kifiResultsClicked:g.clicks,refinements:h,pageSession:g.pageSession,resultPosition:r,resultUrl:e.url,hit:s})["catch"](function(e){t.log("res: ",e)})}else t.log("no search context to log")}var g=null,h=-1,v=l();return{find:u,reset:d,reportSearchAnalyticsOnUnload:f,reportSearchAnalyticsOnRefine:p,reportSearchClickAnalytics:m}}]),angular.module("kifi").controller("GetTheAppModalCtrl",["$scope","platformService","profileService",function(e,i,t){e.platformName=null,i.isIPhone()?e.platformName="iOS":i.isAndroid()&&(e.platformName="Android"),e.goToAppOrStore=i.goToAppOrStore,e.name=t.me&&t.me.firstName}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("signup/getTheAppModal.tpl.html",'<div ng-controller="GetTheAppModalCtrl"><div kf-modal=""><div kf-basic-modal-content="" action-text="Get the App!" action="goToAppOrStore()"><div class="kf-get-the-app-modal"><p ng-if="name">Hi {{name}},</p><p>For the best experience and to use all Kifi features please get the official Kifi {{platformName}} app.</p></div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("signup/registerFinalizeModal.tpl.html",'<div kf-modal="" class="kf-register-modal" ng-class="{\'register-active-request\': requestActive}"><div class="kf-register-modal-loading"><div class="kf-logo-pulse svg-small-new-logo"></div></div><div class="register-modal-wrap"><div class="dialog-body"><div class="kf-register-header">Almost there! Create your account</div><form name="regFinalizeForm" ng-submit="registerFinalizeSubmit(regFinalizeForm)" novalidate=""><div class="register-field-wrap register-first-block"><span class="register-validation"><input type="text" name="firstName" ng-model="userData.firstName" placeholder="First Name" class="register-name-box right-space register-placeholder" required=""> <span ng-show="fieldHasError(regFinalizeForm.firstName)" class="register-help-block">Enter your first name</span></span> <span class="register-validation"><input type="text" name="lastName" ng-model="userData.lastName" placeholder="Last Name" class="register-name-box register-placeholder" required=""> <span ng-show="fieldHasError(regFinalizeForm.lastName)" class="register-help-block">Enter your last name</span></span></div><div class="register-field-wrap"><span class="register-validation"><input type="email" name="email" ng-model="userData.email" placeholder="Email" class="register-full-input register-placeholder" required=""> <span ng-show="fieldHasError(regFinalizeForm.email)" class="register-help-block">Enter a valid email address</span> <span ng-show="emailTaken" class="register-help-block">Someone already has this email. Did you mean to login?</span></span></div><div class="register-field-wrap"><span class="register-validation"><input type="password" name="password" ng-model="userData.password" placeholder="Password" class="register-full-input register-placeholder" required="" ng-minlength="7"> <span ng-show="fieldHasError(regFinalizeForm.password)" class="register-help-block">Passwords must be at least 7 characters long. Be safe!</span></span></div><div class="register-field-submit-wrap"><input type="submit" value="Sign Up" class="register-submit"></div></form><div class="register-tagline-login">By creating an account, you accept Kifi’s <a href="https://www.kifi.com/terms" target="_self" ng-click="onToSClick()">terms of service</a>.</div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("signup/registerModal.tpl.html",'<div kf-modal="" class="kf-register-modal" ng-class="{\'register-active-request\': requestActive}" disable-scroll="true"><div class="kf-register-modal-loading"><div class="kf-logo-pulse svg-small-new-logo"></div></div><a class="dialog-x" ng-click="close()"></a><div class="register-modal-wrap"><div class="dialog-body"><div ng-if="userData.invite"><div class="kf-register-header kf-register-header-centered">Join Kifi</div><div><img class="kf-register-inviter-pic" ng-src="{{userData.invite.inviter|pic}}"> <span class="kf-register-modal-invite-text">{{userData.invite.inviter.firstName}} invited you to {{userData.invite.access === \'read_only\' ? \'follow\' : \'collaborate on\'}} this library.</span></div></div><div ng-if="!userData.invite"><div class="kf-register-header" ng-if="!userData.toConnectWith">Join Kifi to get updates to this library</div><div class="kf-register-header" ng-if="userData.toConnectWith">Join Kifi to connect with {{userData.toConnectWith.firstName}}</div></div><div class="register-modal-social-block"><a ng-href="{{facebookSignupPath}}" target="_self" ng-click="fbAuth()"><div class="kf-register-button facebook">Continue with Facebook</div></a> <a ng-href="{{twitterSignupPath}}" target="_self" ng-click="twAuth()"><div class="kf-register-button twitter">Continue with Twitter</div></a><div class="register-modal-we-are-nice">We will never post without your explicit permission.</div></div><div class="kf-or-separator"><div class="kf-or-separator-circle">OR</div><div class="kf-modal-line"></div></div><div class="kf-register-header">Continue with email</div><form name="regEmailForm" class="register-email-form" ng-submit="submitEmail(regEmailForm)" novalidate=""><span class="register-validation"><input type="email" name="email" ng-model="userData.email" placeholder="Email" class="register-email-box register-placeholder" required=""><span ng-show="fieldHasError(regEmailForm.email)" class="register-help-block">Enter a valid email address</span></span><input type="submit" value="Continue" class="register-submit register-continue"></form></div><div class="register-tagline-login">Already a Kifi member?&nbsp; <a href="/login" target="_self" ng-click="onLoginClick()">Log in</a></div></div></div>')}])}(),angular.module("kifi").factory("signupService",["$rootScope","$compile","$window",function(e,i,t){var r={register:function(r,n){var a=angular.element('<div ng-controller="SignupCtrl"></div>'),o=e.$new();r=r||{},n=n||{},o.userData=r,o.onError=function(e){(n.onError||function(e){t.location.href=e&&e.redirect||"/signup"})(e)},o.onSuccess=function(){(n.onSuccess||function(){return!0})()},i(a)(o)}};return r}]).controller("SignupCtrl",["$scope","modalService","registrationService","$window","installService","$rootScope","$location","routeService","$state","util","$analytics",function(e,i,t,r,n,a,o,l,s,c,u){function d(t,r){t.close=i.close,t.$on("$destroy",function(){"function"==typeof r&&r(t),e.registerFinalizeSubmitted=!1,e.requestActive=!1})}function f(e,i,t){var r=s.current.name;c.startsWith(r,"library")?(i+="Library",u.eventTrack(e,{type:i,action:t})):c.startsWith(r,"userProfile")&&(i+="UserProfile",u.eventTrack(e,{type:i,action:t}))}function p(e,i,t){var r=s.current.name;c.startsWith(r,"library")?(i+="Library",t=_.extend({type:i},t||{}),a.$emit("trackLibraryEvent",e,t)):c.startsWith(r,"userProfile")&&(i+="UserProfile",t=_.extend({type:i},t||{}),a.$emit("trackUserProfileEvent",e,t))}e.userData=e.userData||{},e.fieldHasError=function(i){var t=i&&i.$invalid&&e.registerFinalizeSubmitted;return t},e.trackWebstore=function(){f("visitor_clicked_page","install","webstore")},e.trackGetChrome=function(){f("visitor_clicked_page","install","getChrome")},e.trackGetFirefox=function(){f("visitor_clicked_page","install","getFirefox")};var m=function(){p("view","signup"),e.onLoginClick=function(){f("visitor_clicked_page","signup","login")};var t=e.userData?{libraryId:e.userData.libraryId,intent:e.userData.intent,libAuthToken:e.userData.libAuthToken}:{};e.facebookSignupPath=l.socialSignup("facebook",t),e.twitterSignupPath=l.socialSignup("twitter",t),e.emailSubmitted=!1,d(i.open({template:"signup/registerModal.tpl.html",scope:e}),function(){e.emailSubmitted||f("visitor_clicked_page","signup","close")})};e.submitEmail=function(t){return e.registerFinalizeSubmitted=!0,e.emailSubmitted=!0,t.$valid?(p("click","signup",{action:"clickedSignUpButton"}),i.close(),e.userData.method="email",void g()):!1},e.twAuth=function(){p("click","signup",{action:"clickedAuthTwitter"})},e.fbAuth=function(){p("click","signup",{action:"clickedAuthFacebook"})};var g=function(){p("view","signup2"),e.onToSClick=function(){f("visitor_clicked_page","signup2","termsOfService")},e.requestActive=!1,e.registerFinalizeSubmitted=!1,d(i.open({template:"signup/registerFinalizeModal.tpl.html",scope:e}),function(){e.registerFinalizeSubmitted||f("visitor_clicked_page","signup2","close")})};e.registerFinalizeSubmit=function(n){e.registerFinalizeSubmitted=!0,e.requestActive=!0;var a;return n.$valid?(a={email:e.userData.email,password:e.userData.password,firstName:e.userData.firstName,lastName:e.userData.lastName,libraryPublicId:e.userData.libraryId,libAuthToken:e.userData.libAuthToken,hook:e.userData.hook},void t.emailFinalize(a).then(function(e){i.close(),f("visitor_clicked_page","signup2","signup"),r.location.href=e.uri||"/install"})["catch"](function(i){return i.data&&"user_exists_failed_auth"===i.data.error?(e.requestActive=!1,void(e.emailTaken=!0)):void e.onError({code:"email_fail",redirect:"https://www.kifi.com/signup"})})):(e.requestActive=!1,!1)},m()}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("signup/thanksForRegisteringModal.tpl.html",'<div kf-modal="" class="kf-register-modal"><a class="dialog-x" ng-click="close()"></a><div class="register-modal-wrap"><div class="dialog-body" ng-if="thanksVersion === \'installExt\'"><div class="kf-register-header">Experience the full power of Kifi</div><div class="register-logo svg-small-new-logo"></div><div class="register-logo-name svg-kifi-name"></div><div class="register-install-ext-btn" ng-click="installExtension()">Get Kifi for {{platformName}}</div><a href="https://chrome.google.com/webstore/detail/kifi/fpjooibalklfinmkiodaamcckfbcjhin?hl=en" title="Kifi in the Chrome Web Store" ng-click="trackWebstore()"><img src="//d1dwdv9wd966qu.cloudfront.net/img/available-in-chrome-webstore.16fe00c.png" class="register-chrome-webstore" ng-if="platformName === \'Chrome\'"></a></div><div class="dialog-body" ng-if="thanksVersion === \'notSupported\'"><div class="kf-register-header">Experience the full power of Kifi</div><div class="register-unsupported"><p class="register-unsupported-p">To get the most out of your Kifi experience, you should install the browser plug-in.</p><p class="register-unsupported-p">The Kifi plugin is not yet available for your browser.</p><p class="register-unsupported-p">In the meantime, you can try <a href="https://www.google.com/chrome/browser/" ng-click="trackGetChrome()">Chrome</a> or <a href="https://www.mozilla.org/en-US/firefox/new/" ng-click="trackGetFirefox()">Firefox</a> and come back to install the plugin.</p></div></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("social/addNetworksModal.tpl.html",'<div kf-modal="" kf-width="750px"><div kf-basic-modal-content="" centered="true" action-text="Done!"><div kf-social-connect-networks=""></div></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("social/connectNetworks.tpl.html",'<div class="kf-social-connect"><div class="kf-social-connect-title">Connect your social networks to Kifi</div><p class="kf-social-connect-desc">Connect your networks to quickly find people you may know already using Kifi.</p><div class="kf-social-connect-buttons"><div class="kf-social-connect-row"><div ng-if="facebook.profileUrl"><div class="kf-social-connected-button kf-facebook">Facebook Connected</div><span class="kf-social-notice-badge" ng-if="facebookStatus() === \'kf-good\'"><span class="kf-notice-button kf-good"></span></span> <span class="kf-social-notice-badge" ng-if="facebookStatus() === \'refreshing\'"><span class="kf-notice-message kf-import"><div class="kf-bouncy-ball"><div class="pace pace-active"><div class="pace-progress"></div><div class="pace-activity"></div></div></div>Importing your contacts</span></span> <span class="kf-social-notice-badge" ng-if="facebookStatus() === \'expired\'" ng-click="connectFacebook()"><span class="kf-notice-button kf-warn">×</span> <span class="kf-notice-message kf-refresh">Refresh connection</span></span></div><div ng-if="!facebook.profileUrl"><a class="kf-social-connect-button kf-facebook" href="javascript:" ng-click="connectFacebook()">Connect Facebook</a></div></div><div class="kf-social-connect-row"><div ng-if="twitter.profileUrl"><div class="kf-social-connected-button kf-twitter">Twitter Connected</div><span class="kf-social-notice-badge" ng-if="twitterStatus() === \'kf-good\'"><span class="kf-notice-button kf-good"></span></span> <span class="kf-social-notice-badge" ng-if="twitterStatus() === \'refreshing\'"><span class="kf-notice-message kf-import"><div class="kf-bouncy-ball"><div class="pace pace-active"><div class="pace-progress"></div><div class="pace-activity"></div></div></div>Importing your contacts</span></span> <span class="kf-social-notice-badge" ng-if="twitterStatus() === \'expired\'" ng-click="connectTwitter()"><span class="kf-notice-button kf-warn">×</span> <span class="kf-notice-message kf-refresh">Refresh connection</span></span></div><div ng-if="!twitter.profileUrl"><a class="kf-social-connect-button kf-twitter" href="javascript:" ng-click="connectTwitter()">Connect Twitter</a></div></div><div class="kf-social-connect-row" ng-if="gmail.length === 0"><a class="kf-social-connect-button kf-gmail" href="javascript:" ng-click="importGmail()">Connect Gmail</a></div><div ng-repeat="account in gmail" ng-if="gmail.length > 0"><div class="kf-social-connect-row kf-social-extended"><div class="kf-social-connected-button kf-gmail">Gmail Connected<div class="kf-social-account-name">{{account.ownerEmail}}</div></div><span class="kf-social-notice-badge"><span class="kf-notice-button kf-good"></span></span></div></div><div class="kf-social-more-accounts" ng-if="gmail.length > 0" ng-click="importGmail()">Refresh/Add more Gmail accounts</div></div></div>')}])}(),angular.module("kifi").directive("kfNetworksNeedAttention",["modalService","socialService",function(e,i){return{replace:!0,restrict:"A",templateUrl:"social/networksNeedAttention.tpl.html",link:function(t){t.networksNeedAttention=function(){return Object.keys(i.expiredTokens).length>0},t.data={},t.doShow=function(){e.open({template:"social/addNetworksModal.tpl.html"})}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("social/networksNeedAttention.tpl.html",'<div class="kf-networks-need-attention" ng-if="networksNeedAttention()"><div kf-alert-banner="" action-text="Fix it" action="doShow">One or more of your connected social networks needs your attention</div></div>')}])}(),angular.module("kifi").directive("kfSocialConnectNetworks",["socialService",function(e){return{scope:{},replace:!0,restrict:"A",templateUrl:"social/connectNetworks.tpl.html",link:function(i){i.facebook=e.facebook,i.gmail=e.gmail,i.twitter=e.twitter,i.expiredTokens=e.expiredTokens,i.connectFacebook=e.connectFacebook,i.connectTwitter=e.connectTwitter,i.importGmail=e.importGmail,i.isRefreshingSocialGraph=e.isRefreshingSocialGraph,i.refreshingGraphs=e.refreshingGraphs,i.facebookStatus=function(){return i.refreshingGraphs.network.facebook?"refreshing":i.expiredTokens.facebook?"expired":"good"},i.twitterStatus=function(){return i.refreshingGraphs.network.twitter?"refreshing":i.expiredTokens.twitter?"expired":"good"},e.refresh()}}}]),angular.module("kifi").factory("socialService",["routeService","$http","util","$rootScope","Clutch","$window","$q","$analytics","$location","$timeout",function(e,i,t,r,n,a,o,l,s,c){var u=[],d={},f={},p=[],m=[],g={},h=!1,v=!1,k={network:{},abook:{}},b=!1,y={cacheDuration:5e3},w=function(n){return b?void 0:(b=!0,n=void 0===n?10:n,0>n?(v=!1,t.replaceObjectInPlace(k,{network:{},abook:{}}),void(b=!1)):void i.get(e.importStatus).then(function(e){return t.replaceObjectInPlace(k,e.data),_.size(e.data.network)>0||_.size(e.data.abook)>0?(h=!0,v||(v=!0,n=20),void c(function(){b=!1,w(--n)},2e3)):v?(h=v=!1,b=!1,void r.$emit("social.updated")):void c(function(){b=!1,w(--n)},3e3)}))},C=new n(function(){return i.get(e.networks).then(function(e){return _.remove(e.data,function(e){return"fortytwo"===e.network}),t.replaceArrayInPlace(u,e.data),t.replaceObjectInPlace(d,_.find(u,function(e){return"facebook"===e.network})),t.replaceObjectInPlace(f,_.find(u,function(e){return"twitter"===e.network})),e.data})},y),S=new n(function(){return i.get(e.abooksUrl).then(function(e){return t.replaceArrayInPlace(m,e.data),t.replaceArrayInPlace(p,_.filter(m,function(e){return"gmail"===e.origin})),e.data})},y),$={networks:u,addressBooks:m,refresh:function(){return w(1),o.all([S.get(),C.get()])},facebook:d,twitter:f,gmail:p,refreshSocialGraph:function(){return h=!0,w(),i.post(e.refreshNetworks)},checkIfUpdatingGraphs:w,checkIfRefreshingSocialGraph:function(){return h},refreshingGraphs:k,connectFacebook:function(){l.eventTrack("user_clicked_page",{action:"connectFacebook",path:s.path()}),a.location.href=e.linkNetwork("facebook")},connectTwitter:function(){l.eventTrack("user_clicked_page",{action:"connectTwitter",path:s.path()}),a.location.href=e.linkNetwork("twitter")},importGmail:function(){l.eventTrack("user_clicked_page",{action:"importGmail",path:s.path()}),a.location.href=e.importGmail(s.path())},disconnectFacebook:function(){return i.post(e.disconnectNetwork("facebook")).then(function(e){return t.replaceObjectInPlace(d,{}),l.eventTrack("user_clicked_page",{action:"disconnectFacebook",path:s.path()}),e})},disconnectTwitter:function(){return i.post(e.disconnectNetwork("twitter")).then(function(e){return t.replaceObjectInPlace(f,{}),l.eventTrack("user_clicked_page",{action:"disconnectTwitter",path:s.path()}),e})},setExpiredTokens:function(e){var i={};e.forEach(function(e){i[e]=!0}),t.replaceObjectInPlace(g,i)},expiredTokens:g};return $}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("tagManage/deleteTagModal.tpl.html",'<div kf-modal="" class="kf-delete-tag-confirm-modal"><div kf-basic-modal-content="" with-cancel="true" title="Are you sure?" with-warning="" action-text="Delete Tag" action="deleteTag()">Deleting this tag will remove it from {{numKeepsInTag}} keeps.</div></div>')}])}(),angular.module("kifi").factory("manageTagService",["$http","$q","$state","$analytics","routeService","undoService","Clutch",function(e,i,t,r,n,a,o){var l=new o(function(i,t){return e.get(n.pageTags(i,t,100)).then(function(e){return e.data.tags})}),s=new o(function(t){return t&&t.trim()?e.get(n.searchTags(t,30)).then(function(e){return _.map(e.data.results,function(e){return{name:e.tag,keeps:e.keepCount}})}):i.when([])});return{reset:function(){l.expireAll()},getMore:function(e,i){return l.get(e,i)},search:function(e){return s.get(e)},remove:function(i){var o=e.post(n.deleteTag(i.id)).then(function(){a.add("Tag deleted.",function(){e.post(n.undeleteTag(i.id)).then(function(){t.go(t.current,void 0,{reload:!0}),r.eventTrack("user_clicked_page",{action:"unremoveTag",path:t.href(t.current)})})})});return r.eventTrack("user_clicked_page",{action:"removeTag",path:t.href(t.current)}),o}}}]),angular.module("kifi").controller("ManageTagCtrl",["$scope","$window","manageTagService","libraryService","routeService","$http","$location","modalService","$timeout",function(e,i,t,r,n,a,o,l,s){function c(){d||(d=!0,t.getMore(e.selectedSort,e.offset).then(function(i){d=!1,0===i.length?e.more=!1:(e.more=!0,e.offset+=1,e.tagList.push.apply(e.tagList,i))}))}function u(i){var t=i;return"name"===e.selectedSort?t=_.sortBy(t,function(e){return e.name.toLowerCase()}).reverse():"num_keeps"===e.selectedSort&&(t=_.sortBy(t,function(e){return e.keeps}).reverse()),t}i.document.title="Kifi • Manage Your Tags",e.selected={},e.selectedSort="name",e.tagList=[],e.selectedTag={},e.more=!1,e.offset=0,e.$watch("tagList",function(i){i&&(e.tagsToShow=e.tagList)}),e.tagsScrollDistance="100%",e.isTagScrollDisabled=function(){return!e.more},e.manageTagScrollNext=function(){c()},e.$watch("selectedSort",function(){""===e.filter.name?(e.tagList.length=0,e.offset=0,e.more=!0,t.reset(),c()):e.tagsToShow=u(e.tagsToShow)});var d=!1;e.$watch(function(){return i.innerWidth},function(i){1220>i?(e.copyToLibraryDisplay="Copy",e.moveToLibraryDisplay="Move"):(e.copyToLibraryDisplay="Copy to Library",e.moveToLibraryDisplay="Move to Library")}),e.filter={},e.filter.name="",e.isFilterFocused=!1,e.focusFilter=function(){e.isFilterFocused=!0},e.blurFilter=function(){e.isFilterFocused=!1},e.clearFilter=function(){e.filter.name="",e.tagsToShow=e.tagList,e.more=!0},e.onFilterChange=_.debounce(function(){return""===e.filter.name?(s(e.clearFilter,0),e.tagList):(e.more=!1,void t.search(e.filter.name).then(function(i){return e.tagsToShow=u(i),e.tagsToShow}))},200,{leading:!0}),e.copyToLibraryDisplay="Copy To Library",e.moveToLibraryDisplay="Move To Library",e.changeSelection=function(i){i.selected=!0,e.selectedTag=i},e.onWidgetExit=function(){e.selectedTag.selected=!1},e.onWidgetCopyLibraryClicked=function(i){r.copyKeepsFromTagToLibrary(i.id,e.selectedTag.name).then(function(){l.open({template:"tagManage/tagToLibModal.tpl.html",modalData:{library:i,action:"copy"}}),r.fetchLibraryInfos(!0)})["catch"](function(){l.open({template:"common/modal/genericErrorModal.tpl.html"})})},e.onWidgetMoveLibraryClicked=function(i){r.moveKeepsFromTagToLibrary(i.id,e.selectedTag.name).then(function(){l.open({template:"tagManage/tagToLibModal.tpl.html",modalData:{library:i,action:"move"}}),r.fetchLibraryInfos(!0)})["catch"](function(){l.open({template:"common/modal/genericErrorModal.tpl.html"})})},e.showRemoveTagModal=function(i){e.changeSelection(i),e.numKeepsInTag=i.keeps,l.open({template:"tagManage/deleteTagModal.tpl.html",scope:e})},e.deleteTag=function(){t.remove(e.selectedTag).then(function(){_.remove(e.tagsToShow,e.selectedTag)})}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("tagManage/tagManage.tpl.html",'<div class="manage-tag-wrapper kf-width-bounded"><div class="manage-tag"><h2>Manage your tags</h2><div class="manage-tag-container"><div class="manage-tag-header"><div class="manage-tag-search-box"><div class="manage-tag-input-box" ng-class="{ \'focused\': isFilterFocused }"><a class="manage-tag-input-clear" href="javascript:" ng-click="clearFilter(true)" ng-show="filter.name">&times;</a> <input class="manage-tag-filter-input" kf-no-drag-input="" name="filterName" placeholder="Search tags..." maxlength="32" ng-model="filter.name" ng-change="onFilterChange()" ng-focus="focusFilter()" ng-blur="blurFilter()"></div></div><div class="manage-tag-sort-by"><div class="manage-tag-sort-text">Sort by:</div><div class="manage-tag-sort-button" ng-class="{\'on\': selectedSort == \'num_keeps\'}" ng-click="selectedSort = \'num_keeps\'">Most used</div><div class="manage-tag-sort-button" ng-class="{\'on\': selectedSort == \'name\'}" ng-click="selectedSort = \'name\'">ABC</div></div></div><div class="manage-tag-content" smart-scroll="" scroll-distance="tagsScrollDistance" scroll-disabled="isTagScrollDisabled()" scroll-next="manageTagScrollNext()"><ul class="manage-tag-list"><li class="manage-tag-row" ng-repeat="tag in tagsToShow"><div class="manage-tag-row-name-section"><a class="manage-tag-row-name" title="{{tag.name}}" ng-href="{{tag.name|tagUrl}}" ng-class="{\'selected-tag\': tag.selected}">{{tag.name}}</a></div><span class="manage-tag-row-num-keeps-section" ng-pluralize="" count="tag.keeps|number:0" when="{\'0\': \'no keeps\', \'one\': \'1 keep\', \'other\':\'{} keeps\'}"></span> <span class="manage-tag-row-links-section"><span class="manage-tag-row-link-convert manage-tag-copy" title="Copy tagged keeps to a library" ng-click="changeSelection(tag)" kf-keep-to-library-widget="" widget-action-text="Copy" library-click-action="onWidgetCopyLibraryClicked(clickedLibrary)" widget-exit-action="onWidgetExit()" lib-select-down-offset="0" lib-select-max-up-offset="50" lib-select-left-offset="100">{{copyToLibraryDisplay}}</span>&middot;&nbsp; <span class="manage-tag-row-link-convert manage-tag-move" title="Move tagged keeps to a library" ng-click="changeSelection(tag)" kf-keep-to-library-widget="" widget-action-text="Move" library-click-action="onWidgetMoveLibraryClicked(clickedLibrary)" widget-exit-action="onWidgetExit()" lib-select-down-offset="0" lib-select-max-up-offset="50" lib-select-left-offset="100">{{moveToLibraryDisplay}}</span>&middot; <span class="manage-tag-row-link-delete" ng-click="showRemoveTagModal(tag)">Delete</span></span></li></ul></div><span ng-click="manageTagScrollNext()" ng-hide="isTagScrollDisabled()" class="kf-show-more">Show more</span></div></div></div>');
}])}(),angular.module("kifi").directive("kfTagLibrary",["$location","libraryService",function(e,i){return{restrict:"A",require:"^kfModal",templateUrl:"tagManage/tagToLibMsg.tpl.html",link:function(t,r,n,a){t.hide=function(){a.close()},t.navigateToLibrary=function(){i.getLibraryById(t.modalData.library.id,!0).then(function(){e.url(t.modalData.library.url)}),a.close()},t.action="copy"===t.modalData.action?"Copying":"Moving"}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("tagManage/tagToLibModal.tpl.html",'<div kf-modal="" class="kf-tag-lib-modal"><div kf-tag-library=""></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("tagManage/tagToLibMsg.tpl.html",'<div kf-modal="" class="kf-copy-tag-to-library-modal" kf-width="480px"><div kf-basic-modal-content="" title="{{action}} Keeps" action-text="Go to Library" action="navigateToLibrary()"><div>We\'re {{action.toLowerCase()}} your tagged keeps over, but it might take a second...<br>Feel free to continue managing your tags or visit the library.</div></div></div>')}])}(),angular.module("kifi").factory("hashtagService",["$http","$q","routeService","Clutch",function(e,i,t,r){var n={cacheDuration:2e4},a=new r(function(r,n,a){var o=e.get(t.suggestTags(r,n,a)),l=i.defer();return o.then(function(e){l.resolve(e.data)}),l.promise},n);return{suggestTags:function(e,i,t){return a.get(e,i,t)}}}]),angular.module("kifi").directive("kfUserCard",["$timeout","env","$filter","modalService","profileService","friendService","inviteService","signupService","platformService",function(e,i,t,r,n,a,o,l,s){return{restrict:"A",replace:!0,scope:{user:"=kfUserCard",mutualUserInfo:"="},templateUrl:"userCard/userCard.tpl.html",link:function(c,u){function d(){u.addClass("kf-clipped"),e(function(){u.removeClass("kf-clipped")},500)}c.$root.userLoggedIn&&(c.isSelf=n.me.id===c.user.id,c.mutual=_.pick(c.mutualUserInfo||c.user,"id","firstName","lastName","pictureName","username"),c.mutual.connections=c.user.mConnections,c.mutual.libraries=c.user.mLibraries,_.assign(c.mutual,_.pick(c.user,"isFriend","friendRequestSentAt","friendRequestReceivedAt","unsearched"))),c.showMutualConnections=function(){a.getMutualConnections(c.mutual.id).then(function(e){var i=_.pick(c.mutual,"id","username","pictureName","isFriend");i.fullName=c.mutual.firstName+" "+c.mutual.lastName,i.numMutualFriends=c.mutual.connections,i.mutualFriends=e.users,r.open({template:"friends/seeMutualFriendsModal.tpl.html",modalData:i})})},c.onClickPrimaryButton=function(){if(s.isSupportedMobilePlatform())s.goToAppOrStore(i.navBase+t("profileUrl")(c.user));else{if(c.connectBtnChanging)return;if(c.$root.userLoggedIn){if(c.mutual.isFriend)c.unfriend();else if(!c.mutual.friendRequestSentAt){var r=600,n=e(angular.noop,r+160);c.connectBtnChanging=!0;var a=function(){c.connectBtnChanging=!1,c.connectBtnChanged=!0,e(function(){c.connectBtnChanged=!1},r)};o.friendRequest(c.mutual.id).then(function(e){n.then(function(){delete c.mutual.friendRequestReceivedAt,e.sentRequest?c.mutual.friendRequestSentAt=Date.now():(e.acceptedRequest||e.alreadyConnected)&&(c.mutual.isFriend=!0),a()})},a)}}else l.register({toConnectWith:c.user})}},c.accept=function(){a.acceptRequest(c.mutual.id).then(function(){c.mutual.isFriend=!0,c.mutual.friendRequestReceivedAt=null,d()})},c.decline=function(){c.mutual.friendRequestReceivedAt=null,a.ignoreRequest(c.mutual.id),d()},c.unfriend=function(){r.open({template:"friends/unfriendConfirmModal.tpl.html",scope:_.assign(c.$root.$new(),{friend:c.mutual,reallyUnfriend:function(){c.mutual.isFriend=!1,a.unfriend(c.mutual.id).then(angular.noop,function(){c.mutual.isFriend=!0})}})})},c.toggleSearch=function(){var e=c.mutual.unsearched;a[e?"reSearchFriend":"unSearchFriend"](c.mutual.id).then(function(){c.mutual.unsearched=!e})}}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("userCard/userCard.tpl.html",'<li class="kf-upu-card" ng-class="{\'kf-self\': isSelf}"><div class="kf-upu-settings" kf-hover-menu="" ng-if="mutual.isFriend && !isSelf"><button class="kf-upu-settings-btn svg-settings-gear-gray"></button><menu class="kf-upu-settings-menu kf-dropdown-menu"><button class="kifi-upu-settings-unsearch kf-dropdown-menu-item" ng-click="toggleSearch()">{{mutual.unsearched ? \'Show\' : \'Hide\'}} {{mutual.firstName}}’s keeps in my search results</button> <button class="kifi-upu-settings-unfriend kf-dropdown-menu-item" ng-click="unfriend()">Remove connection</button></menu></div><a class="kf-upu-pic-a" href="{{user|profileUrl}}"><img class="kf-upu-pic" ng-src="{{user|pic:200}}"></a><div class="kf-upu-name-wrap-1"><div class="kf-upu-name-wrap-2"><div class="kf-upu-name-wrap-3"><a class="kf-upu-name" href="{{user|profileUrl}}">{{user|name}}</a></div></div></div><ul class="kf-upu-stats"><li class="kf-upu-stat" ng-if="user.libraries"><a class="kf-upu-stat-a" href="{{user|profileUrl:\'libraries\'}}">Libraries<div class="kf-upu-stat-n">{{user.libraries|num}}</div></a></li><li class="kf-upu-stat" ng-if="user.connections"><a class="kf-upu-stat-a" href="{{user|profileUrl:\'connections\'}}">Connections<div class="kf-upu-stat-n">{{user.connections|num}}</div></a></li><li class="kf-upu-stat" ng-if="user.followers"><a class="kf-upu-stat-a" href="{{user|profileUrl:\'followers\'}}">Followers<div class="kf-upu-stat-n">{{user.followers|num}}</div></a></li></ul><div class="kf-upu-counts" ng-if="$root.userLoggedIn"><div class="kf-upu-counts-title">You and {{mutual.firstName}} have:</div><button class="kf-upu-count" data-n="{{mutual.connections|num}}" ng-click="showMutualConnections()" ng-if="mutual.connections"><ng-pluralize count="mutual.connections" when="{\'one\': \'mutual connection\', \'other\': \'mutual connections\'}"></ng-pluralize></button> <span class="kf-upu-count" data-n="0" ng-if="!mutual.connections">mutual connections</span> <span class="kf-upu-count" data-n="{{mutual.libraries|num}}">libraries in common</span></div><button class="kf-upu-connect kf-upu-button" ng-class="{\'kf-connected\': mutual.isFriend, \'kf-sent\': mutual.friendRequestSentAt, \'kf-busy\': connectBtnChanging, \'kf-transit\': connectBtnChanging || connectBtnChanged}" ng-click="onClickPrimaryButton()"><span class="kf-upu-connect-text" ng-class="{\'svg-checkmark\': mutual.isFriend}"></span></button><div class="kf-upu-request" ng-if="mutual.friendRequestReceivedAt"><div class="kf-upu-request-text-1"><div class="kf-upu-request-text-2">{{mutual.firstName}} wants&nbsp;to&nbsp;connect</div></div><button class="kf-upu-decline kf-upu-button" ng-click="decline()">Decline</button> <button class="kf-upu-accept kf-upu-button" ng-click="accept()">Accept</button></div></li>')}])}(),angular.module("kifi").constant("userProfilePageNames",{own:"OwnedLibraries",following:"FollowedLibraries",invited:"InvitedLibraries",connections:"Connections"}).controller("UserProfileCtrl",["$scope","$analytics","$location","$rootScope","$state","$window","profile","inviteService","originTrackingService","profileService","installService","modalService","initParams","userProfilePageNames",function(e,i,t,r,n,a,o,l,s,c,u,d,f,p){function m(){e.platformName=u.getPlatformName(),e.platformName?(e.thanksVersion="installExt",e.installExtension=u.triggerInstall):e.thanksVersion="notSupported",e.close=d.close,d.open({template:"signup/thanksForRegisteringModal.tpl.html",scope:e})}function g(){var i=p[n.current.name.split(".").pop()];e.currentPageName=i,e.currentPageOrigin="profilePage"+i}function h(){var n=i.settings.pageTracking.basePath+t.url();i.pageTrack(n,s.applyAndClear({type:r.userLoggedIn?"userProfile":"userProfileLanding",profileOwnerUserId:o.id,profileOwnedBy:e.viewingOwnProfile?"viewer":o.isFriend?"viewersFriend":"other",libraryCount:o.numLibraries}))}function v(t){var n=_.extend(t||{},{type:t.type||(r.userLoggedIn?"userProfile":"userProfileLanding"),profileOwnerUserId:o.id,profileOwnedBy:e.viewingOwnProfile?"viewer":o.isFriend?"viewersFriend":"other"});i.eventTrack(r.userLoggedIn?"user_clicked_page":"visitor_clicked_page",n)}[r.$on("$stateChangeSuccess",function(e,i,t,r,n){/^userProfile/.test(i.name)&&/^userProfile/.test(r.name)&&t.username===n.username&&(h(),g())}),r.$on("getCurrentLibrary",function(e,i){i.callback({})}),r.$on("trackUserProfileEvent",function(e,i,t){"click"===i?v(t):"view"===i&&h(t)})].forEach(function(i){e.$on("$destroy",i)}),a.document.title=o.firstName+" "+o.lastName+" • Kifi",e.profile=_.cloneDeep(o),e.viewingOwnProfile=o.id===c.me.id,e.intent=f.getAndClear("intent"),".own"===n.current.name.slice(-4)&&0===o.numLibraries&&o.numFollowedLibraries>0?n.go("^.following",null,{location:"replace"}):(h(),g()),"1"!==f.getAndClear("install")||u.installedVersion||m()}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("userProfile/userProfile.tpl.html",'<div class="kf-user-profile"><div kf-user-profile-header="" profile="profile" intent="intent"></div><div class="kf-user-profile-content"><div ui-view=""></div></div></div>')}])}(),angular.module("kifi").factory("userProfileActionService",["$http","$q","routeService","Clutch",function(e,i,t,r){function n(e){return e.data}var a={cacheDuration:1e4},o=new r(function(i){return e.get(t.getUserProfile(i)).then(n)},a),l=new r(function(i,r,a,o){return e.get(t.getUserLibraries(i,r,a,o)).then(n)},a),s=new r(function(i,r){return e.get(t.getProfileConnections(i,r)).then(n)},a),c=new r(function(i,r){return e.get(t.getProfileFollowers(i,r)).then(n)},a);return{getProfile:angular.bind(o,o.get),getLibraries:angular.bind(l,l.get),getConnections:angular.bind(s,s.get),getFollowers:angular.bind(c,c.get),expireAllPeople:function(){s.expireAll(),c.expireAll()},getUsers:function(i){return e.get(t.getProfileUsers(i)).then(n)}}}]),angular.module("kifi").controller("UserProfileConnectionsCtrl",["$scope","$stateParams","userProfileActionService",function(e,i,t){var r,n=9,a=!0;e.fetchConnections=function(){if(!a){a=!0;var i=r.slice(0,n);t.getUsers(i).then(function(t){Array.prototype.push.apply(e.users,t.users),r=_.difference(r,i),a=!1})}},e.hasMoreConnections=function(){return!e.users||!r||r.length},t.getConnections(i.username,n).then(function(i){e.users=i.invitations?i.invitations.concat(i.users):i.users,r=i.ids,a=!1})}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("userProfile/userProfileConnections.tpl.html",'<div kf-user-profile-user-list="users" list-title="Connections" has-more="hasMoreConnections()" fetch-more="fetchConnections()" empty-text="{{viewingOwnProfile ? \'You do\' : profile.firstName + \' does\'}} not yet have any connections."></div>')}])}(),angular.module("kifi").controller("UserProfileFollowersCtrl",["$scope","$stateParams","userProfileActionService",function(e,i,t){var r,n,a=9,o=!0;e.fetchFollowers=function(){if(!o){o=!0;var e=n.slice(0,a);t.getUsers(e).then(function(i){r.push.apply(r,i.users),n=_.difference(n,e),o=!1})}},e.hasMoreFollowers=function(){return!r||!n||n.length},t.getFollowers(i.username,a).then(function(i){e.users=r=i.users,n=i.ids,o=!1})}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("userProfile/userProfileFollowers.tpl.html",'<div kf-user-profile-user-list="users" list-title="Followers" has-more="hasMoreFollowers()" fetch-more="fetchFollowers()" empty-text="{{viewingOwnProfile ? \'You do\' : profile.firstName + \' does\'}} not yet have any library followers."></div>')}])}(),angular.module("kifi").directive("kfUserProfileHeader",["$rootScope","$state","$timeout","profileService","inviteService","friendService","$document","modalService","linkify",function(e,i,t,r,n,a,o,l,s){return{restrict:"A",scope:{profile:"=",intent:"="},templateUrl:"userProfile/userProfileHeader.tpl.html",link:function(c,u){function d(){c.showFriendMenu=!0,o.on("mousedown",p)}function f(){c.showFriendMenu=!1,o.off("mousedown",p)}function p(e){var i=angular.element(e.target);c.showFriendMenu&&i.hasClass("kf-uph-action-menu-item")?(c.unfriend(),c.$evalAsync(f)):i.hasClass("kf-uph-connect-image")||c.$evalAsync(f)}function m(e){b.filter("[data-path="+h(e)+"]").removeAttr("href")}function g(e){b.filter("[data-path="+h(e)+"]").prop("href",i.href(e))}function h(e){return e&&e.name.split(".")[1]||'""'}function v(e){angular.element(e.target).is(".kf-uph-share,.kf-uph-share *,.kf-uph-share-url")||c.$apply(angular.bind(c,c.toggleSharing,!1))}function k(e){(9===e.keyCode||27===e.keyCode)&&c.$apply(angular.bind(c,c.toggleSharing,!1))}var b=angular.element();c.viewingOwnProfile=c.profile.id===r.me.id,c.isKifiCurator=["kifi","kifi-editorial","kifi-eng"].indexOf(c.profile.username)>=0,c.showFriendMenu=!1,c.connectionWithUser=c.viewingOwnProfile?"self":c.profile.isFriend?"friends":c.profile.friendRequestSentAt?"request_sent":c.profile.friendRequestReceivedAt?"request_received":e.userLoggedIn?"not_friends":"",c.showConnectCallout="connect"===c.intent&&"not_friends"===c.connectionWithUser,c.sharing=!1,c.trackClickedSettings=function(){e.$emit("trackUserProfileEvent","click",{action:"clickedSettings"})},c.toggleFriendMenu=function(){c.showFriendMenu?f():d()},c.sendFriendRequest=function(){c.showConnectCallout=!1,e.$emit("trackUserProfileEvent","click",{action:"clickedAddFriend"});var i=angular.element(".kf-uph-progress-bar"),t=angular.element(".kf-uph-progress-check"),r=n.friendRequest(c.profile.id);i.animate({width:"15%"},80),r.then(function(e){(e.sentRequest||e.acceptedRequest)&&i.animate({width:"100%"},200,function(){t.animate({opacity:1},100,function(){var e=angular.element(".kf-uph-connect"),i=e.find(".kf-uph-action-text.connect"),t=e.find(".kf-uph-action-text.hidden");i.css("display","none"),t.animate({width:"113px"},350,function(){t.animate({opacity:1},200,function(){c.$evalAsync(function(){c.connectionWithUser="request_sent"})})})})})})},c.acceptFriendRequest=function(){e.$emit("trackUserProfileEvent","click",{action:"clickedAcceptFriend"}),a.acceptRequest(c.profile.id).then(function(){c.connectionWithUser="friends"})},c.ignoreFriendRequest=function(){e.$emit("trackUserProfileEvent","click",{action:"clickedDeclineFriend"}),a.ignoreRequest(c.profile.id).then(function(){c.connectionWithUser="not_friends"})},c.unfriend=function(){a.unfriend(c.profile.id).then(function(){c.connectionWithUser="not_friends"})},c.showBiographyModal=function(){l.open({template:"profile/editUserBiographyModal.tpl.html",modalData:{biography:c.profile.biography,onClose:function(e){c.profile.biography=e}}})},c.toggleSharing=function(i){var r=c.sharing="boolean"==typeof i?i:!c.sharing;r&&t(function(){var t=u.find(".kf-uph-share-url")[0],r=document.createRange();r.selectNodeContents(t);var n=window.getSelection();n.removeAllRanges(),n.addRange(r),e.$emit("trackUserProfileEvent","click",{action:"clickedShare"}),"object"==typeof i&&i.pageX&&i.currentTarget===document.activeElement&&i.currentTarget.blur()}),angular.element(window)[r?"on":"off"]("mousedown",v)[r?"on":"off"]("keydown",k)},c.$watch("profile.biography",function(e){c.bioHtml=s(e||"")}),c.$on("$destroy",e.$on("$stateChangeSuccess",function(e,i,t,r){g(r),m(i)})),c.$on("$destroy",function(){angular.element(window).off("mousedown",v).off("keydown",k)}),t(function(){b=u.find(".kf-uph-nav-a"),m(i.current)})}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("userProfile/userProfileHeader.tpl.html",'<div class="kf-uph"><div class="kf-uph-connect-banner" ng-if="connectionWithUser===\'request_received\'"><span class="kf-uph-connect-banner-text">{{profile.firstName}} wants to connect with you on Kifi</span> <span class="kf-uph-connect-banner-btns"><button class="kf-uph-connect-banner-btn kf-decline" ng-click="ignoreFriendRequest()">Decline</button> <button class="kf-uph-connect-banner-btn kf-accept" ng-click="acceptFriendRequest()">Accept</button></span></div><div class="kf-uph-top" itemscope="" itemtype="http://schema.org/Person"><a class="kf-uph-pic-a" href="{{profile|profileUrl}}" itemprop="url"><img class="kf-uph-pic" ng-src="{{profile|pic:200}}" alt="{{profile|name}}" itemprop="image"></a><div class="kf-uph-actions" ng-if="!isKifiCurator" ng-switch="connectionWithUser"><button class="kf-uph-connect connect" ng-switch-when="not_friends" ng-click="sendFriendRequest()"><div class="kf-uph-action-text connect">Connect</div><span class="kf-uph-connect-image add-friend"></span><div class="kf-uph-action-text hidden">Invited to connect</div></button><div class="kf-uph-connect-callout kf-callout-bubble kf-callout-bubble-bottom" ng-if="showConnectCallout">Click to invite {{profile.firstName}} to connect.</div><div class="kf-uph-connect request-sent" ng-switch-when="request_sent"><span class="kf-uph-connect-image add-friend"></span> <span class="kf-uph-action-text">Invited to connect</span></div><div class="kf-uph-connect request-received" ng-switch-when="request_received"><span class="kf-uph-connect-image already-friends hidden"></span></div><button class="kf-uph-connect friends" ng-switch-when="friends" ng-click="toggleFriendMenu()"><span class="kf-uph-connect-image already-friends"></span><div class="kf-uph-action-menu" ng-class="{on: showFriendMenu}"><div class="kf-uph-action-menu-item">Remove connection</div></div></button><div ng-switch-when="self"><button class="kf-uph-share svg-share-arrow-white" ng-click="toggleSharing($event)"><span class="kf-uph-action-text">Share</span></button><div class="kf-uph-dropdown-parent" kf-hover-menu=""><a ui-sref="settings" ng-click="trackClickedSettings()"><span class="kf-uph-settings-icon svg-settings-gear"></span> <span class="kf-uph-action-text">Settings</span></a><menu class="kf-dropdown-menu"><button class="kf-dropdown-menu-item" ng-click="showBiographyModal()">Edit your biography</button> <a class="kf-dropdown-menu-item" ui-sref="settings" ng-click="trackClickedSettings()">More settings</a></menu></div><div class="kf-uph-share-url" ng-if="sharing">{{profile|absProfileUrl}}</div></div></div><div class="kf-uph-progress" ng-if="connectionWithUser===\'not_friends\'"><div class="kf-uph-progress-bar"></div><div class="kf-uph-progress-check"></div></div><h1 class="kf-uph-name" itemprop="name">{{profile|name}}</h1><button class="kf-uph-bio-add" ng-click="showBiographyModal()" ng-if="viewingOwnProfile && !profile.biography">Add a Bio</button><div class="kf-uph-bio" ng-bind-html="bioHtml"></div></div><nav class="kf-uph-nav"><a class="kf-uph-nav-a" href="{{profile|profileUrl:\'libraries\'}}" data-path="libraries"><div class="kf-uph-nav-name">Libraries</div><div class="kf-uph-nav-count">{{profile.numLibraries|num}}</div></a> <a class="kf-uph-nav-a" href="{{profile|profileUrl:\'connections\'}}" data-path="connections"><div class="kf-uph-nav-name">Connections</div><div class="kf-uph-nav-count">{{profile.numConnections|num}}</div></a> <a class="kf-uph-nav-a" href="{{profile|profileUrl:\'followers\'}}" data-path="followers" ng-if="profile.numFollowers"><div class="kf-uph-nav-name">Followers</div><div class="kf-uph-nav-count">{{profile.numFollowers|num}}</div></a></nav></div>')}])}(),angular.module("kifi").controller("UserProfileLibrariesCtrl",["$scope","$rootScope","$state","$stateParams","$timeout","profileService","userProfileActionService","modalService","userProfilePageNames",function(e,i,t,r,n,a,o,l,s){function c(){u=0,d=!0,f=!1,p={},e.libraries=null,e.fetchLibraries()}var u,d,f,p,m=r.username,g=12;e.libraries=null,e.libraryType=t.current.name.split(".").pop(),[i.$on("$stateChangeSuccess",function(i,t){/^userProfile\.libraries\./.test(t.name)&&(e.libraryType=t.name.split(".").pop(),c())}),i.$on("libraryDeleted",function(i,t){_.remove(e.libraries,{id:t})}),i.$on("libraryKeepCountChanged",function(i,t,r){(_.find(e.libraries,{id:t})||{}).keepCount=r})].forEach(function(i){e.$on("$destroy",i)}),e.fetchLibraries=function(){if(!f){f=!0;var i=e.libraryType;o.getLibraries(m,i,u,g).then(function(t){if(e.libraryType===i){var r=t[i];d=r.length===g,e.profile.id!==a.me.id||"own"!==i||_.isEmpty(p)||_.remove(r,function(e){return e.id in p}),e.libraries=(e.libraries||[]).concat(r),u++,f=!1}})}},e.hasMoreLibraries=function(){return d},e.showInvitedLibraries=function(){return e.profile&&e.profile.numInvitedLibraries&&e.viewingOwnProfile},e.openCreateLibrary=function(){function i(e){Math.abs(angular.element(".kf-upl-create-card").offset().left-angular.element(".kf-upl-lib-card").eq(1).offset().left)<10?e.justAddedBelowAcross=!0:e.justAddedBelow=!0,n(function(){e.justAddedBelow=!1,e.justAddedBelowAcross=!1})}l.open({template:"libraries/manageLibraryModal.tpl.html",modalData:{returnAction:function(t){i(t),p[t.id]=!0,(e.libraries||[]).splice(2,0,t)}}})},e.trackLibraryNav=function(e){i.$emit("trackUserProfileEvent","click",{action:"clicked"+s[e]})},c()}]).directive("kfUserProfileLibraryCard",["$rootScope","$location","profileService","libraryService","modalService","platformService","signupService",function(e,i,t,r,n,a,o){function l(e){var i=e.membership;return i&&("owner"===i.access||"read_write"===i.access&&"collaborator"===e.whoCanInvite)}function s(e,i,t){var r=3;l(t.lib)&&r--,t.maxNumCollaboratorsToShow=e>r?r-1:r}function c(e){n.open({template:"libraries/manageLibraryModal.tpl.html",modalData:{pane:"manage",library:e,currentPageOrigin:k,returnAction:function(){r.getLibraryById(e.id,!0).then(function(i){_.assign(e,_.pick(i.library,"name","slug","description","visibility","color","numFollowers","membership")),e.subscriptions=i.subscriptions,e.path=i.library.url,e.followers=_.take(i.library.followers,3)})["catch"](n.openGenericErrorModal)}}})}function u(e){a.isSupportedMobilePlatform()||n.open({template:"libraries/libraryFollowersModal.tpl.html",modalData:{library:e,currentPageOrigin:k}})}function d(t,l,s){if(a.isSupportedMobilePlatform()){var c=i.absUrl();return void a.goToAppOrStore(c+(c.indexOf("?")>0?"&":"?")+"follow=true")}return e.userLoggedIn===!1?o.register({libraryId:l.id,intent:"follow"}):(s.target.disabled=!0,void r[l.membership?"leaveLibrary":"joinLibrary"](l.id).then(function(e){p(t,l,e)})["catch"](function(e){n.openGenericErrorModal({modalData:403===e.status&&"cant_join_nonpublished_library"===e.data.error?{genericErrorMessage:"Sorry, the owner of this library has made it private. You’ll need an invitation to follow it."}:{}})})["finally"](function(){s.target.disabled=!1}))}function f(e,i,t){t.target.disabled=!0,r.joinLibrary(i.id).then(function(t){p(e,i,t)})["catch"](n.openGenericErrorModal)["finally"](function(){t.target.disabled=!1})}function p(e,i,r){var n=i.membership;if(i.membership=r,r){i.invite=null;var a=_.pick(t.me,"id","firstName","lastName","pictureName","username");"read_write"===r.access?(n&&"read_only"===n.access&&(i.numFollowers--,_.remove(i.followers,{id:t.me.id})),i.numCollaborators++,i.collaborators.push(a)):"read_only"===r.access&&(i.numFollowers++,i.followers.length<3&&"0.jpg"!==a.pictureName&&i.followers.push(a))}else i.numFollowers--,_.remove(i.followers,{id:t.me.id});e.canWrite=r&&{owner:!0,read_write:!0}[r.access]||!1}function m(e){r.updateSubscriptionToLibrary(e.id,!e.membership.subscribed).then(function(){e.membership.subscribed=!e.membership.subscribed})["catch"](n.openGenericErrorModal)}function g(i,t){e.$emit("trackUserProfileEvent","click",{action:"clickedLibraryCard",subAction:t,libraryName:i.name,libraryOwnerUserName:i.owner.username,libraryId:i.id,libraryOwnerUserId:i.owner.id,profileTab:v})}function h(e){n.open({template:"libraries/libraryMembersModal.tpl.html",modalData:{library:e,canManageMembers:l(e),amOwner:"owner"===(e.membership||{}).access,filterType:"collaborators_only",currentPageOrigin:k}})}var v,k;return{restrict:"A",replace:!0,scope:{lib:"=kfUserProfileLibraryCard",profileId:"@",libraryType:"@",currentPageName:"@",currentPageOrigin:"@"},templateUrl:"userProfile/userProfileLibraryCard.tpl.html",link:function(e){v=e.currentPageName,k=e.currentPageOrigin;var i=e.lib,r=i.membership||{};l(i)?e.$watch("lib.numCollaborators",s):s(e.lib.numCollaborators,null,e),e.myProfile=t.me.id===e.profileId,e.isOwner="owner"===r.access,e.canWrite=e.isOwner||"read_write"===r.access,e.$watch(function(){return i.invite?"invited":e.myProfile&&e.canWrite&&"published"===i.visibility&&!i.membership.listed?"unlisted":i.followers.length?"followers":i.lastKept?"updated":""},function(i){e.footerKind=i}),e.openModifyLibrary=c,e.openFollowersList=u,e.openCollaboratorsList=h,e.onFollowButtonClick=d,e.onCollabButtonClick=f,e.toggleSubscribed=m,e.trackUplCardClick=g}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("userProfile/userProfileLibraries.tpl.html",'<div class="kf-upl-nav-container"><nav class="kf-upl-nav"><a class="kf-upl-nav-link" ui-sref=".own" ng-class="{\'kf-selected\': libraryType === \'own\', \'kf-my\': viewingOwnProfile}" ng-click="trackLibraryNav(\'own\')">Libraries</a> <a class="kf-upl-nav-link" ui-sref=".following" ng-class="{\'kf-selected\': libraryType === \'following\'}" ng-click="trackLibraryNav(\'following\')">Following</a> <a class="kf-upl-nav-link" ui-sref=".invited" ng-class="{\'kf-selected\': libraryType === \'invited\'}" ng-if="showInvitedLibraries()" ng-click="trackLibraryNav(\'invited\')">Invited</a></nav></div><div class="kf-upl"><div ui-view=""></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("userProfile/userProfileLibrariesList.tpl.html",'<div class="kf-upl-card-list" smart-scroll="" scroll-distance="\'100%\'" scroll-disabled="!hasMoreLibraries()" scroll-next="fetchLibraries()"><button ng-if="viewingOwnProfile && libraryType === \'own\'" class="kf-upl-card kf-upl-create-card" ng-click="openCreateLibrary()"><span class="kf-upl-create-card-add-icon svg-create-library"></span><div class="kf-upl-create-card-text">CREATE A LIBRARY</div></button><div kf-user-profile-library-card="library" ng-repeat="library in libraries" current-page-name="{{::currentPageName}}" current-page-origin="{{::currentPageOrigin}}" library-type="{{::libraryType}}" profile-id="{{::profile.id}}"></div><div class="kf-upl-empty" ng-if="libraries.length === 0"><span ng-if="libraryType === \'own\'">{{viewingOwnProfile ? \'You have\' : profile.firstName + \' has\'}} not created any publicly viewable libraries.</span> <span ng-if="libraryType === \'following\'">{{viewingOwnProfile ? \'You are\' : profile.firstName + \' is\'}} not following any libraries.</span> <span ng-if="libraryType === \'invited\'">{{viewingOwnProfile ? \'You have\' : profile.firstName + \' has\'}} no pending invitations to follow a library.</span></div></div>')}])}(),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("userProfile/userProfileLibraryCard.tpl.html",'<div class="kf-upl-card kf-upl-lib-card" ng-style="{\'background-color\': lib.color}" ng-class="{\'justAddedBelow\': lib.justAddedBelow, \'justAddedBelowAcross\': lib.justAddedBelowAcross}"><a class="kf-upl-card-setting svg-settings-gear" ng-if="::myProfile && isOwner && lib.kind !== \'system_main\' && lib.kind !== \'system_secret\'" href="javascript:" ng-click="openModifyLibrary(lib, currentPageOrigin)"></a> <a class="kf-upl-card-link" href="{{lib|libPath}}" ng-click="trackUplCardClick(lib, \'clickedLibraryTitle\')"><div class="kf-upl-card-icon" ng-class="::{\'svg-card-star\': lib.kind === \'system_main\', \'svg-card-lock\': lib.kind === \'system_secret\'}" ng-if="::lib.kind.lastIndexOf(\'system\', 0) === 0"></div><div class="kf-upl-card-cover"><div class="kf-upl-card-cover-image" style="{{::lib.image|bgImageAndPos}}" ng-if="::lib.image"></div></div><div class="kf-upl-card-name-align"><div class="kf-upl-card-name"><div class="kf-upl-card-name-clip">{{lib.name|preventOrphans:16:(lib.name.length > 36 ? 1/3 : 0.6)}}</div></div></div><div class="kf-upl-count-line" ng-class="{\'kf-can-write\': canWrite}"><span class="kf-upl-card-collab svg-collaborators-white" title="A collaborative library" ng-if="lib.numCollaborators"></span> <span class="kf-upl-card-private svg-card-lock" ng-class="{\'kf-collab\': lib.numCollaborators}" title="A private library" ng-if="lib.kind !== \'system_secret\' && lib.visibility === \'secret\'"></span> <span class="kf-upl-count" ng-click="trackUplCardClick(lib, \'clickedLibraryKeepsTotal\')" ng-pluralize="" count="lib.numKeeps" when="{\'1\':\'{} keep\',\'other\':\'{{lib.numKeeps|num}} keeps\'}" ng-if="lib.numKeeps"></span></div><div class="kf-upl-card-foot" ng-switch="footerKind" ng-if="footerKind !== \'followers\'"><span ng-switch-when="unlisted">Hidden on public profile</span> <span ng-switch-when="updated">Updated&nbsp;<time ng-attr-datetime="{{lib.lastKept}}" am-time-ago="lib.lastKept"></time></span> <span ng-switch-when="invited">Invited&nbsp;<time ng-attr-datetime="{{::lib.invite.lastInvite}}" am-time-ago="lib.invite.lastInvite"></time></span></div></a><a class="kf-upl-card-owner" ng-if="!lib.numCollaborators" href="{{::lib.owner|profileUrl}}" kf-track-origin="{{::currentPageOrigin}}/curator" ng-click="trackUplCardClick(lib, \'clickedLibraryCurator\')"><img class="kf-upl-card-owner-pic" ng-src="{{::lib.owner|pic:100}}" alt="{{::lib.owner|name}}" ng-if="::libraryType !== \'own\'"> <span class="kf-upl-card-by">by</span> <span class="kf-upl-card-by-name">{{::lib.owner|name}}</span></a><div class="kf-upl-collabs" ng-if="lib.numCollaborators > 0"><span class="kf-upl-card-by">by</span> <a class="kf-upl-collab-pic-a" href="{{::lib.owner|profileUrl}}" kf-track-origin="{{::currentPageOrigin}}/collaborator" kf-user-tooltip="::lib.owner" desc="Owner"><img class="kf-upl-collab-pic" ng-src="{{::lib.owner|pic:100}}" alt="{{::lib.owner|name}}"></a> <a class="kf-upl-collab-pic-a" href="{{::collab|profileUrl}}" kf-track-origin="{{::currentPageOrigin}}/collaborator" kf-user-tooltip="::collab" desc="Collaborator" ng-repeat="collab in lib.collaborators | limitTo:maxNumCollaboratorsToShow"><img class="kf-upl-collab-pic" ng-src="{{::collab|pic:100}}" alt="{{::collab|name}}"></a> <button class="kf-upl-more-collab" ng-if="lib.numCollaborators > maxNumCollaboratorsToShow" ng-click="openCollaboratorsList(lib)">{{lib.numCollaborators - maxNumCollaboratorsToShow|num}}</button></div><div class="kf-upl-follow-wrap" ng-class="{\'kf-following\': lib.membership.access === \'read_only\', \'kf-no-unfollow\': followBtnJustClicked, \'kf-overflowing\': overSubsBtn}" ng-attr-style="background-color:{{lib.color}}" ng-if="!canWrite && lib.invite.access !== \'read_write\'"><button class="kf-upl-follow-btn" ng-click="followBtnJustClicked = !lib.membership || followBtnJustClicked; onFollowButtonClick($parent, lib, $event); trackUplCardClick(lib, \'clickedLibraryFollowButton\')" ng-mouseleave="followBtnJustClicked = false"></button> <button ng-attr-class="kf-upl-subs-btn {{lib.membership.subscribed ? \'svg-notification-on-white\' : \'svg-notification-off-white\'}}" ng-click="toggleSubscribed(lib)" ng-mouseenter="overSubsBtn = true" ng-mouseleave="overSubsBtn = false"></button><div class="kf-upl-subs-msg">Notifications {{lib.membership.subscribed ? \'enabled\' : \'disabled\'}}</div></div><button class="kf-upl-collab-btn" ng-attr-style="background-color:{{lib.color}}" ng-if="lib.invite.access === \'read_write\'" ng-click="onCollabButtonClick($parent, lib, $event)">Collaborate</button><div class="kf-upl-card-foot" ng-if="footerKind === \'followers\'"><div class="kf-upl-followers"><a href="{{user|profileUrl}}" class="kf-upl-follower" ng-repeat="user in lib.followers" kf-track-origin="{{currentPageOrigin}}/follower" ng-click="trackUplCardClick(lib, \'clickedLibraryFollowersFace\')" ng-attr-style="background-image:url({{user | pic:100}})"></a> <a class="kf-upl-followers-number" href="javascript:" ng-click="openFollowersList(lib); trackUplCardClick(lib, \'clickedLibraryFollowersMoreFollowing\')"><span ng-if="lib.numFollowers === lib.followers.length" class="kf-upl-all-followers">{{lib.numFollowers === 1 ? \'follows this library\' : \'are following\'}}</span> <span ng-if="lib.numFollowers > lib.followers.length">+ <b class="kf-upl-followers-n">{{lib.numFollowers - lib.followers.length | num}}</b>{{lib.numFollowers - lib.followers.length < 1000 ? \' are\' : \'\'}} following</span></a></div></div></div>');
}])}(),angular.module("kifi").directive("kfUserProfileUserList",["profileService",function(e){return{restrict:"A",replace:!0,scope:{users:"=kfUserProfileUserList",listTitle:"@",hasMore:"&",fetchMore:"&",emptyText:"@"},templateUrl:"userProfile/userProfileUserList.tpl.html",link:function(i){i.me=e.me}}}]),function(e){try{e=angular.module("kifi.templates")}catch(i){e=angular.module("kifi.templates",[])}e.run(["$templateCache",function(e){e.put("userProfile/userProfileUserList.tpl.html",'<div><h2 class="kf-upul-title">{{listTitle}}</h2><div class="kf-upul" smart-scroll="" scroll-distance="\'100%\'" scroll-disabled="!hasMore()" scroll-next="fetchMore()"><ul class="kf-upul-cards"><li kf-user-card="user" mutual-user-info="user.id === me.id ? $parent.$parent.$parent.profile : null" ng-repeat="user in users"></li><li class="kf-upul-empty" ng-if="users.length === 0">{{emptyText}}</li></ul></div></div>')}])}();
//# sourceMappingURL=kifi.min.js.map