<div class="kf-nav-group">
  <div class="kf-nav-lib-recos" ng-class="{ active: isActive('/') }">
    <a class="kf-nav-link" href="/">
      <span class="reco-icon svg-reco-icon"></span>
      <span class="kf-nav-name">Recommendations</span>
    </a>
  </div>

  <div>
    <div kf-callout class="kf-callout-bubble-right" ng-if="showCallout()">
        <div>Your main and private libraries hold all of your existing keeps. You can create additional libraries if you wish.</div>
        <div class="kf-callout-bubble-action">
          <div class="kf-callout-bubble-button" ng-click="closeCallout()">Got it</div>
        </div>
    </div>
    <ul class="kf-nav-lib-system">
      <li class="kf-nav-lib-item" ng-class="{ active: isActive(mainLib.url) }">
        <a class="kf-nav-link" ng-href="{{mainLib.url}}">
          <div class="library-icon svg-main-library-icon"></div>
          <div class="kf-nav-lib-info">
            <div class="kf-nav-lib-name">My Main Library</div>
            <div class="kf-nav-lib-text" ng-class="{ empty: !mainLib.numKeeps }">
              <ng-pluralize count="mainLib.numKeeps"
                      when="{'0': '',
                             'one': '1 keep',
                             'other': '{} keeps'}">
              </ng-pluralize>
            </div>
          </div>
        </a>
      </li>
      <li class="kf-nav-lib-item" ng-class="{ active: isActive(secretLib.url) }">
        <a class="kf-nav-link" ng-href="{{secretLib.url}}">
          <div class="library-icon svg-secret-library-icon"></div>
          <div class="kf-nav-lib-info">
            <div class="kf-nav-lib-name">My Private Library</div>
            <div class="kf-nav-lib-text" ng-class="{ empty: !secretLib.numKeeps }">
              <ng-pluralize count="secretLib.numKeeps"
                      when="{'0': '',
                             'one': '1 keep',
                             'other': '{} keeps'}">
              </ng-pluralize>
          </div>
        </a>
      </li>
    </ul>

    <div class="kf-nav-lib-item">
      <a class="kf-nav-link" ng-click="addLibrary()">
        <span class="library-icon svg-add-a-library-icon"></span>
        <span class="kf-nav-name">Create a new Library</span>
      </a>
    </div>

    <div class="kf-lib-search">
      <div class="kf-lib-input-box" ng-class="{ 'focused': isFilterFocused }">
        <a class="kf-lib-input-clear" href="javascript:" ng-click="clearFilter(true)" ng-show="filter.name">&times;</a>
        <input class="kf-lib-filter-input" kf-no-drag-input name="filterName" placeholder="Find a library..." maxlength="32" ng-model="filter.name" ng-change="onFilterChange()" ng-focus="focusFilter()" ng-blur="blurFilter()">
      </div>

      <div class="kf-sort-libs">
        <div class="kf-sort-libs-button" ng-class="{'on': sortingMenu.show }">
          <div class="kf-sort-img sprite sprite-arrow-gray-down"></div>
        </div>

        <ul class="dropdown-menu-content" ng-show="sortingMenu.show">
          <li class="dropdown-option" ng-click="sortingMenu.option='last_kept'">
            <div class="dropdown-option-check sprite sprite-small-checked-box" ng-show="sortingMenu.option=='last_kept'"></div>Last Kept To
          </li>
          <li class="dropdown-option" ng-click="sortingMenu.option='num_keeps'">
            <div class="dropdown-option-check sprite sprite-small-checked-box" ng-show="sortingMenu.option=='num_keeps'"></div>Keeps
          </li>
          <li class="dropdown-option" ng-click="sortingMenu.option='num_followers'">
            <div class="dropdown-option-check sprite sprite-small-checked-box" ng-show="sortingMenu.option=='num_followers'"></div>Followers
          </li>
          <li class="dropdown-option" ng-click="sortingMenu.option='name'">
            <div class="dropdown-option-check sprite sprite-small-checked-box" ng-show="sortingMenu.option=='name'"></div>Alphabetical
          </li>
          <li class="dropdown-option" ng-click="sortingMenu.option='last_viewed'">
            <div class="dropdown-option-check sprite sprite-small-checked-box" ng-show="sortingMenu.option=='last_viewed'"></div>Last Viewed
          </li>
        </ul>
      </div>
    </div>

    <div class="kf-scrollable-libs" antiscroll="{ autoHide: false }">
      <ul class="kf-nav-lib-users">
        <li ng-repeat="library in userLibsToShow" class="kf-nav-lib-item" ng-class="{ active: isActive(library.url) }">
          <div class="kf-nav-link-box">
            <a class="kf-nav-link" ng-href="{{library.url}}">
              <div class="library-icon-holder">
                <div class="library-icon svg-private-library-icon" ng-if="library.visibility=='secret'"></div>
                <div class="library-icon svg-public-library-icon" ng-if="library.visibility=='published'"></div>

                <!-- TODO: remove this when discoverable libraries have been converted to public libraries in the db. -->
                <div class="library-icon svg-yellow-card-with-globe" ng-if="library.visibility=='discoverable'"></div>

                <img class="library-icon-owner-img" ng-if="!library.isMine" ng-src="{{library.owner.image || 'https://www.kifi.com/assets/img/ghost.200.png'}}" title="{{library.owner.firstName + ' ' + library.owner.lastName}}"></img>
              </div>
              <div class="kf-nav-lib-info">
                <div kf-ellipsis full-text="library.name" max-num-lines=2 class="kf-nav-lib-name"></div>
                <div class="kf-nav-lib-text">
                  <ng-pluralize count="library.numKeeps"
                                when="{'0': '',
                                       'one': '1 keep',
                                       'other': '{} keeps'}"></ng-pluralize>
                  <ng-pluralize count="library.numFollowers"
                                when="{'0': '',
                                       'one': ' 1 follower',
                                       'other':' {} followers'}"></ng-pluralize>
                </div>
              </div>
            </a>
            <div kf-tooltip position="right" padding="3">
              <div kf-library-mini-card library="library"></div>
            </div>
          </div>
        </li>
        <li ng-repeat="library in invitedLibsToShow" class="kf-nav-lib-item" ng-class="{ active: isActive(library.url) }">
          <div class="kf-nav-link-box">
            <a class="kf-nav-link" ng-href="{{library.url}}">
              <div class="library-icon-holder">
                <div class="library-icon svg-library-card"></div>
                <img class="library-icon-owner-img" ng-if="!library.isMine" ng-src="{{library.owner.image || 'https://www.kifi.com/assets/img/ghost.200.png'}}" title="{{library.owner.firstName + ' ' + library.owner.lastName}}"></img>
              </div>
              <div class="kf-nav-lib-info">
                <div kf-ellipsis full-text="library.name" max-num-lines=2 class="kf-nav-lib-name"></div>
                <div class="kf-nav-lib-text">invitation pending</div>
              </div>
            </a>
            <div kf-tooltip position="right" padding="3">
              <div kf-library-mini-card library="library" invite="true"></div>
            </div>
          </div>

        </li>
      </ul>
    </div>

  </div>
</div>
