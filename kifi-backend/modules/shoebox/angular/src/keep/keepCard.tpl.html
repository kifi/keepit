<div class="kf-keep-card">

  <!-- Gallery card -->
  <div class="kf-gallery-card" ng-if="galleryView">
    <div class="kf-keep-top" ng-if="keep.user">
      <section class="kf-keep-top-l">
        <a class="kf-keep-keeper-pic" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}" ng-attr-style="background-image:url({{::keep.user|pic:100}})"></a>
        <a class="kf-keep-keeper-name" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}">{{::keep.user|name}}</a>
      </section>
      <section class="kf-keep-top-r">
        <a class="kf-keep-keeper-name" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}">{{::keep.user|name}}</a>
        <div class="kf-keep-time" ng-if="::keep.user">
          <a class="kf-keep-page-link" ng-href="{{ ::keep.path }}"><time ng-attr-datetime="{{::keep.createdAt}}" am-time-ago="::keep.createdAt" title="{{::keep.createdAt|localTime}}" ng-if="::keep.createdAt"></time></a>
          <span ng-if="::!keep.createdAt">kept this</span>
          <span ng-if="::showOriginLibrary">
            in <a class="kf-keep-lib-name" href="{{::keep.library.path}}">{{::keep.library.name}}</a>
          </span>
          <span ng-if="::showSaved && (showOriginLibrary || keep.user)">&mdash;</span>
          <span ng-if="showSaved"><a ng-href="https://www.kifi.com/k/cached?id={{keep.id}}">Saved</a></span>
        </div>
        <span ng-if="::keep.sourceAttribution.twitter.screenName">
          <a class="kf-keep-tweet-link" href="https://www.twitter.com/{{::keep.sourceAttribution.twitter.screenName}}/status/{{::keep.sourceAttribution.twitter.idString}}" target="_blank" ng-click="trackTweet()">
            <span class="kf-keep-twitter-logo svg-twitter-blue"></span>View the tweet
          </a>
        </span>
      </section>
    </div>

    <div class="kf-keep-note" ng-bind-html="::keep.note|noteHtml" ng-if="::keep.note || (keep.user.id === me.id && keep.library.permissions.indexOf('edit_own_keeps') !== -1)"></div>
    <div class="kf-keep-add-note" ng-if="::(keep.user.id === me.id && keep.library.permissions.indexOf('edit_own_keeps') !== -1)"><!-- wrapping button in div to reduce watch count on read-only libraries -->
      <button class="kf-keep-add-note-btn" ng-click="editKeepNote($event, keep)" ng-if="!keep.note">Add a note (type # to add a tag)</button>
    </div>

    <div class="kf-keep-body" ng-class="::{'kf-boxed': boxed != null, 'kf-side-by-side': image.w, 'kf-text-only': !image && !youtubeId}">

      <div class="kf-keep-video" ng-if="::youtubeId" ng-click="clickCallback({keep: keep, event: $event})">
        <div kf-youtube video-id="youtubeId"></div>
        <div class="kf-youtube-bottom-overlay"></div>
      </div>
      <a class="kf-keep-image" ng-if="::image" ng-class="::{'kf-bottom-clip': image.clipBottom}"
        ng-style="{'background': '#f7f7f7 url(\'' + image.url + '\') center / cover no-repeat', width: image.w ? image.w + 'px' : '', 'padding-top': image.h ? image.h + 'px' : ''}"
        ng-href="{{::keep.url}}" target="_blank" rel="nofollow" tabindex="-1"
        ng-click="clickCallback({keep: keep, event: $event})" click-action="clickedArticleImage">
      </a>

      <div class="kf-keep-content">
        <div class="kf-keep-meta">
          <span class="kf-keep-source">{{::keepSource}}</span>
          <span class="kf-keep-length" ng-if="::keep.summary.wordCount > 0 && !youtubeId">{{::keep.summary.wordCount|timeToRead}} read</span>
        </div>
        <div class="kf-keep-title">
          <a class="kf-keep-title-link" ng-href="{{::keep.url}}" target="_blank" ng-click="clickCallback({keep: keep, event: $event})" rel="nofollow" click-action="clickedArticleTitle" kf-ellipsis full-text="displayTitle" ng-bind="displayTitle" max-num-lines="2"></a>
        </div>
        <div class="kf-keep-description" kf-ellipsis ng-bind="keep.summary.description" full-text="keep.summary.description" max-num-lines="image.maxDescLines || defaultDescLines"></div>
      </div>

      <div class="clearfix"></div>

      <div class="kf-keep-footer">
        <div class="kf-keep-actions" ng-if="$root.userLoggedIn">
          <button ng-attr-class="kf-keep-keep-btn {{howKept ? 'state-kept-' + howKept : 'state-not-kept'}}"
            kf-keep-to-library-widget widget-action-text="Keep" library-click-action="onWidgetLibraryClicked(clickedLibrary)"
            kept-to-library-ids="keptToLibraryIds" lib-select-down-offset="180" lib-select-left-offset="20" ng-click="clickCallback({keep: keep, event: $event})" click-action="clickedKeep">
            <span ng-attr-class="{{howKept ? howKept === 'private' ? 'svg-small-lock' : 'svg-hearts-green' : 'svg-hearts-green-empty'}}"></span>
            <span>{{howKept ? 'Kept' : 'Keep'}}</span>
          </button>
          <button class="kf-keep-share-btn" ng-click="clickCallback({keep: keep, event: $event}); shareAction()" click-action="clickedShareArticle">
            <span class="svg-share-arrow-green"></span>
            <span>Share</span>
          </button>
        </div>
        <div class="kf-keep-who" ng-if="keep.keepers.length > 1 || (keep.keepers[0] && keep.keepers[0].id !== keep.user.id)">
          <span class="kf-keep-who-pic-box" ng-repeat="keeper in keep.keepers | limitTo:6" kf-user-tooltip="::keeper" library="::keeper.library" desc="Your Kifi connection">
            <a class="kf-keep-who-pic" ng-attr-style="background-image:url({{::keeper|pic:100}})" ng-href="{{::keeper.library.path || '/' + keeper.username}}" kf-track-origin="{{::currentPageOrigin}}/alsoKeptBy" ng-click="clickCallback({keep: keep, event: $event})" click-action="clickedOtherKeeper"></a>
          </span>
          <span class="kf-keep-who-num" ng-if="keep.keepersTotal - 1 > (keep.keepers.length || 0)">
            {{keep.keepersTotal - (keep.keepers.length || 0) | num}}
          </span>
        </div>
      </div>
    </div>
  </div>
  <!-- end Gallery card -->


  <!-- Compact card -->
  <div class="kf-compact-card" ng-if="!galleryView">

    <div class="kf-keep-body" ng-class="::{'kf-boxed': boxed != null}">

      <div class="kf-keep-header">
        <div class="kf-keep-header-l">
          <a class="kf-keep-keeper-pic" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}" ng-attr-style="background-image:url({{::keep.user|pic:100}})"></a>
          <a class="kf-keep-keeper-name" ng-if="::keep.user" ng-href="{{::keep.user|profileUrl}}">{{::keep.user|name}}</a>
          <span class="kf-keep-time-at" ng-if="::keep.createdAt">
            <time ng-attr-datetime="{{::keep.createdAt}}" am-time-ago="::keep.createdAt" title="{{::keep.createdAt|localTime}}"></time>
          </span>
        </div>
        <div class="kf-keep-header-r">
          <button ng-attr-class="kf-keep-keep-btn {{howKept ? 'state-kept-' + howKept : 'state-not-kept'}}"
            kf-keep-to-library-widget widget-action-text="Keep" library-click-action="onWidgetLibraryClicked(clickedLibrary)"
            kept-to-library-ids="keptToLibraryIds" lib-select-down-offset="180" lib-select-left-offset="20">
            <span ng-attr-class="{{howKept ? 'svg-hearts-green' : 'svg-hearts-green-empty'}}"></span>
          </button>
          <button class="kf-keep-share-btn" ng-click="clickCallback({keep: keep, event: $event}); shareAction()" click-action="clickedShareArticle">
            <span class="svg-share-arrow-green"></span>
          </button>
        </div>
      </div>

      <div class="kf-keep-video" ng-if="::youtubeId" ng-click="clickCallback({keep: keep, event: $event})">
        <div kf-youtube video-id="youtubeId"></div>
        <div class="kf-youtube-bottom-overlay"></div>
      </div>
      <a class="kf-keep-image kf-bottom-clip" ng-if="::image"
        ng-style="{'background-image': 'url(\'' + image.url + '\')', width: image.w ? image.w + 'px' : '', 'padding-top': image.h ? image.h + 'px' : ''}"
        ng-href="{{::keep.url}}" target="_blank" rel="nofollow" tabindex="-1"
        ng-click="clickCallback({keep: keep, event: $event})" click-action="clickedArticleImage">
      </a>

      <div class="kf-keep-content">
        <div class="kf-keep-title">
          <a class="kf-keep-title-link" ng-href="{{::keep.url}}" target="_blank" ng-click="clickCallback({keep: keep, event: $event})" rel="nofollow" click-action="clickedArticleTitle" kf-ellipsis full-text="displayTitle" ng-bind="displayTitle" max-num-lines="2"></a>
        </div>
        <div class="kf-keep-description" ng-hide="keep.note" kf-ellipsis ng-bind="keep.summary.description" full-text="keep.summary.description" max-num-lines="2"></div>
        <div class="kf-keep-note-icon" ng-if="keep.note" ng-click="editKeepNote($event, keep)">
          <span class="svg-note-gray"></span>
        </div>
        <div class="kf-keep-note-compact kf-keep-note" ng-bind-html="::keep.note|noteHtml" ng-if="::keep.note || keep.user.id === me.id"></div>
      </div>

      <div class="clearfix"></div>
    </div>
  </div>
  <!-- end Compact card -->

</div>
