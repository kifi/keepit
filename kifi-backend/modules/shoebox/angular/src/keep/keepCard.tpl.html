<div class="kf-keep-container" ng-hide="keep.unkept">
  <div class="kf-keep" ng-hide="keep.unkept"
       ng-class="{'editing': $parent.edit.enabled, 'compact': !galleryView, 'mine': (keep.user.id === me.id) }">
    <!-- Gallery card -->
    <div class="kf-gallery-card" ng-if="galleryView">
      <div class="kf-keep-top" ng-if="keep.user">
        <section>
          <div kf-keep-card-attribution
               keep="keep"
               show-library-attribution="::(currentPageOrigin !== 'libraryPage' || showOriginLibrary)"
               is-first-item="::isFirstItem"></div>
        </section>
        <div class="kf-keep-top-menu-container" kf-click-menu
             ng-if="menuItems.length > 0">
          <!-- This controls who gets the controls -->
          <button class="kf-keep-top-menu-btn"></button>
          <menu class="kf-dropdown-menu">
            <button class="kf-dropdown-menu-item"
                    ng-click="item.action($event, keep)"
                    ng-repeat="item in menuItems"
                    ng-bind="item.title">
            </button>
          </menu>
        </div>
      </div>

      <div class="kf-keep-note" ng-bind-html="::keep.note|noteHtml"
           ng-if="::keep.note || (keep.user.id === me.id && keep.library.permissions.indexOf('edit_own_keeps') !== -1)"></div>
      <div class="kf-keep-add-note"
           ng-if="::(keep.user.id === me.id && keep.library.permissions.indexOf('edit_own_keeps') !== -1)">
        <!-- wrapping button in div to reduce watch count on read-only libraries -->
        <button class="kf-keep-add-note-btn" ng-click="editKeepNote($event, keep)" ng-if="!keep.note">Add a note
          (type # to add a tag)
        </button>
      </div>

      <div class="kf-keep-body"
           ng-class="::{'kf-boxed': boxed != null, 'kf-side-by-side': image.w, 'kf-text-only': !image && !youtubeId}">

        <div class="kf-keep-video" ng-if="::youtubeId" ng-click="clickCallback({keep: keep, event: $event})">
          <div kf-youtube video-id="youtubeId"></div>
          <div class="kf-youtube-bottom-overlay"></div>
        </div>
        <a class="kf-keep-image" ng-if="::image" ng-class="::{'kf-bottom-clip': image.clipBottom}"
           ng-style="{'background': '#f7f7f7 url(\'' + image.url + '\') center / cover no-repeat', width: image.w ? image.w + 'px' : '', 'padding-top': image.h ? image.h + 'px' : ''}"
           ng-href="{{::keep.url}}" target="_blank" rel="nofollow" tabindex="-1"
           ng-click="clickCallback({keep: keep, event: $event})" click-action="clickedArticleImage">
        </a>

        <div class="kf-keep-content">
          <div class="kf-keep-meta">
            <span class="kf-keep-source">{{::keepSource}}</span>
            <span class="kf-keep-length" ng-if="::keep.summary.wordCount > 0 && !youtubeId">{{::keep.summary.wordCount|timeToRead}} read</span>
          </div>
          <div class="kf-keep-title">
            <a class="kf-keep-title-link" ng-href="{{::keep.url}}" target="_blank"
               ng-click="clickCallback({keep: keep, event: $event})" rel="nofollow"
               click-action="clickedArticleTitle" kf-ellipsis full-text="displayTitle"
               ng-bind="displayTitle" max-num-lines="2"></a>
          </div>
          <div class="kf-keep-description" kf-ellipsis ng-bind="keep.summary.description"
               full-text="keep.summary.description"
               max-num-lines="image.maxDescLines || defaultDescLines"></div>
        </div>

        <div class="clearfix"></div>

        <div class="kf-keep-footer">
          <div class="kf-keep-actions" ng-if="$root.userLoggedIn">
            <button ng-attr-class="kf-keep-keep-btn {{howKept ? 'state-kept-' + howKept : 'state-not-kept'}}"
                    kf-keep-to-library-widget widget-action-text="Keep"
                    library-click-action="onWidgetLibraryClicked(clickedLibrary)"
                    kept-to-library-ids="keptToLibraryIds" lib-select-down-offset="180"
                    lib-select-left-offset="20" ng-click="clickCallback({keep: keep, event: $event})"
                    click-action="clickedKeep">
              <span
                ng-attr-class="{{howKept ? howKept === 'private' ? 'svg-small-lock' : 'svg-hearts-green' : 'svg-hearts-green-empty'}}"></span>
              <span>{{howKept ? 'Kept' : 'Keep'}}</span>
            </button>
            <button class="kf-keep-share-btn"
                    ng-click="clickCallback({keep: keep, event: $event}); shareAction()"
                    click-action="clickedShareArticle">
              <span class="svg-share-arrow-green"></span>
              <span>Share</span>
            </button>
          </div>
          <div class="kf-keep-who"
               ng-if="keep.keepers.length > 1 || (keep.keepers[0] && keep.keepers[0].id !== keep.user.id)">
          <span class="kf-keep-who-pic-box" ng-repeat="keeper in keep.keepers | limitTo:6" kf-user-tooltip="::keeper"
                library="::keeper.library" desc="Your Kifi connection">
            <a class="kf-keep-who-pic" ng-attr-style="background-image:url({{::keeper|pic:100}})"
               ng-href="{{::keeper.library.path || '/' + keeper.username}}"
               kf-track-origin="{{::currentPageOrigin}}/alsoKeptBy"
               ng-click="clickCallback({keep: keep, event: $event})" click-action="clickedOtherKeeper"></a>
          </span>
          <span class="kf-keep-who-num" ng-if="keep.keepersTotal - 1 > (keep.keepers.length || 0)">
            {{keep.keepersTotal - (keep.keepers.length || 0) | num}}
          </span>
          </div>
        </div>
      </div>
    </div>
    <!-- end Gallery card -->


    <!-- Compact card -->
    <div class="kf-compact-card kf-flex-column" ng-if="!galleryView">
      <div class="kf-keep-card-attribution-container">
        <div kf-keep-card-attribution
             keep="keep"
             class="kf-keep-card-attribution-compact"
             show-library-attribution="::currentPageOrigin !== 'libraryPage'"></div>
        <div class="kf-keep-card-menu-container" kf-click-menu ng-if="menuItems.length > 0">
          <!-- This controls who gets the controls -->
          <button class="kf-keep-top-menu-btn"></button>
          <menu class="kf-dropdown-menu">
            <button class="kf-dropdown-menu-item"
                    ng-click="item.action($event, keep)"
                    ng-repeat="item in menuItems"
                    ng-bind="item.title">
            </button>
          </menu>
        </div>
      </div>
      <div class="kf-keep-card-flex-row">
        <div class="kf-flex-column kf-flex-grow">
          <div class="kf-keep-card-content kf-flex-grow">
            <div class="kf-keep-card-note" ng-bind-html="::keep.note|noteHtml"
                 ng-if="::keep.note || keep.user.id === me.id"></div>
            <div class="kf-keep-card-title">
              <a class="kf-keep-title-link" ng-href="{{::keep.url}}" target="_blank"
                 ng-click="clickCallback({keep: keep, event: $event})" rel="nofollow"
                 click-action="clickedArticleTitle" full-text="displayTitle"
                 ng-bind="displayTitle" max-num-lines="1"></a>
            </div>
          </div>
          <div class="kf-keep-card-flex-row">
            <button ng-attr-class="kf-keep-keep-btn {{howKept ? 'state-kept-' + howKept : 'state-not-kept'}}"
                    kf-keep-to-library-widget widget-action-text="Keep"
                    library-click-action="onWidgetLibraryClicked(clickedLibrary)"
                    kept-to-library-ids="keptToLibraryIds" lib-select-down-offset="180"
                    lib-select-left-offset="20" ng-click="clickCallback({keep: keep, event: $event})"
                    click-action="clickedKeep">
              <span
                ng-attr-class="{{howKept ? howKept === 'private' ? 'svg-small-lock' : 'svg-hearts-green' : 'svg-hearts-green-empty'}}"></span>
              <span>{{howKept ? 'Kept' : 'Keep'}}</span>
            </button>
            <button class="kf-keep-share-btn"
                    ng-click="clickCallback({keep: keep, event: $event}); shareAction()"
                    click-action="clickedShareArticle">
              <span class="svg-share-arrow-green"></span>
              <span>Share</span>
            </button>
          </div>
        </div>
        <div>
          <a class="kf-keep-card-image" ng-if="::image"
             ng-style="{'background-image': 'url(\'' + image.url + '\')'}"
             ng-href="{{::keep.url}}" target="_blank" rel="nofollow" tabindex="-1"
             ng-click="clickCallback({keep: keep, event: $event})" click-action="clickedArticleImage">
          </a>
        </div>
      </div>
    </div>

    <!-- end Compact card -->

    <div class="kf-keep-checkbox-wrap">
      <div class="kf-keep-checkbox-icon sprite sprite-checkbox-icon" ng-if="!$parent.selection.isSelected(keep)"
           ng-click="$parent.$parent.selection.toggleSelect(keep)"></div>
      <div class="kf-keep-checkbox-icon sprite sprite-checkbox-icon-active" ng-if="$parent.selection.isSelected(keep)"
           ng-click="$parent.$parent.selection.toggleSelect(keep)"></div>
    </div>

  </div>

  <div ng-if="hasKeepCommentsPermission" kf-keep-comments keep="keep"></div>
  â€¨
</div>


