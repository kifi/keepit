@import com.keepit.model.OrganizationMembershipAnalyticsInfo
@(
orgView: OrganizationAnalyticsView,
orgId: Id[Organization],
ownerId: Id[User],
candidatesInfo: Map[Id[User], OrganizationMembershipAnalyticsInfo]
)(implicit request: com.keepit.common.controller.UserRequest[_])

@admin("Organization: " + orgView.orgView.name, stylesheets = List("admin_user")) {
<table class="org-summary table table-bordered" style="width:600px">
    <tr><td>Id</td><td>@orgId</td></tr>
    <tr><td>Name</td>
        <td>
        <form action="#" method="POST" class="form-inline update-name">
            <input id="update-name-input" type="text" name="name" value="@orgView.orgView.name">
            <input type="Submit" value="Change">
        </form>
        </td></tr>
    <tr><td>Description</td>
        <td>
        <form action="#" method="POST" class="form-inline update-description">
            <input id="update-description-input" type="text" name="description" value="@orgView.orgView.description">
            <input type="Submit" value="Change">
        </form>
        </td></tr>
    <tr><td>Owner</td><td><a href="@com.keepit.controllers.admin.routes.AdminUserController.userView(ownerId)">@ownerId</a></td></tr>

</table>

<table class="org-members table table-bordered" style="width:600px">
    <tr>
        <th>Member Id</th>
        <th>Member Name</th>
        <th># of libraries</th>
        <th># of keeps</th>
    </tr>
    @for(uid <- orgView.membersInfo.keySet.toSeq.sorted) {
        <tr>
            <td><a href="@com.keepit.controllers.admin.routes.AdminUserController.userView(uid)">@uid</a></td>
            <td>@orgView.membersInfo(uid).basicUser.fullName</td>
            <td>@orgView.membersInfo(uid).numTotalLibraries</td>
            <td>@orgView.membersInfo(uid).numTotalKeeps</td>
        </tr>
    }
</table>

<table class="org-candidates table table-bordered" style="width:600px">
    <tr>
        <th>Candidate Id</th>
        <th>Candidate Name</th>
        <th># of libraries</th>
        <th># of keeps</th>
    </tr>
    @for(uid <- candidatesInfo.keySet.toSeq.sorted) {
        <tr>
            <td><a href="@com.keepit.controllers.admin.routes.AdminUserController.userView(uid)">@uid</a></td>
            <td>@candidatesInfo(uid).basicUser.fullName</td>
            <td>@candidatesInfo(uid).numTotalLibraries</td>
            <td>@candidatesInfo(uid).numTotalKeeps</td>
        </tr>
    }
</table>
<br/>
<form action="@com.keepit.controllers.admin.routes.AdminOrganizationController.addCandidate(orgId)" method="POST" class="form-inline add-candidate">
    <input id="add-candidate-input" type="text" name="candidate-id" placeholder="Candidate Id goes here">
    <input type="Submit" value="Add">
</form>

<script type="text/javascript">
    $(function() {
      $('.update-name').on("submit", function() {
        $.post("@com.keepit.controllers.admin.routes.AdminOrganizationController.setName(orgId)", $('.update-name').serialize())
        .done(function(data) {
          alert("Updated Organization Name");
        }).fail(function(data) {
          alert("Bad Request: " + data.responseText);
        });
        return false;
      });
      $('.update-description').on("submit", function() {
        $.post("@com.keepit.controllers.admin.routes.AdminOrganizationController.setDescription(orgId)", $('.update-description').serialize())
        .done(function(data) {
          alert("Updated Organization Description");
        }).fail(function(data) {
          alert("Bad Request: " + data.responseText);
        });
        return false;
      });
    });
</script>
}
