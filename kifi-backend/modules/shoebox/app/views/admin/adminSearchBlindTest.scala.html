@(configs: Seq[SearchConfigExperiment])

@admin("Search BlindTest"){

	<form id = "queryForm">
		<div>
			<input id = "userId" type = "text" value = "" placeholder = "userId">
			<input id = "queryText" type = "text" value = "" placeholder = "queryText">
			<input id = "maxHits" type = "text" value = "" placeholder = "maxHits">
			<button type = "submit">submit</button>
	  </div>
	</form>


	<table id = "configs">
		<thead>
			<tr>
				<th>
				<th> Id
				<th> Description
			</tr>
		</thead>

		@for(config <- configs){
			<tr>
				<td><input type="checkbox" class="checkbox" name = "selectedConfigs" value ="@config.id.get">
				<td>@config.id.get</td>
				<td>@config.description</td>
			</tr>
		}

	</table>

	<form id = "vote">
		<div>
			<div>which is better? </div>
			<input type="radio" name="win" value="config1">config 1<br>
			<input type="radio" name="win" value="config2">config 2<br>
			<input type="radio" name="win" value="equallyGood">equally good<br>
			<input type="radio" name="win" value="equallyBad">equally bad<br>
			<button type="submit">submit</button>
		</div>
	</form>
	<p id = "result"></p><br>
	<p id = "hits1" name = "configId" value = "1"></p><br><br>
	<p id = "hits2" name = "configId" value = "2"></p>


	<script type="text/javascript">

	$(document).ready(function(){

		$("#vote").hide()

		$("#queryForm").submit(function(event) {
			event.preventDefault();
			var selected = Array()
			$("input:[name=selectedConfigs]:checked").each(function(){ selected.push($(this).val()) })

			if (selected.length != 2){
				alert("please select 2 and only 2 config ids")
			} else{

				$.post(
					'@com.keepit.controllers.admin.routes.AdminSearchController.blindTest',
					{userId: $("#userId").val(), query: $("#queryText").val(), maxHits: $("#maxHits").val(), id1: selected[0], id2: selected[1]},
					function(data) {

		      	$("#result").empty();
		      	$("#hits1").empty();
		      	$("#hits2").empty();

		      	var msg = data.msg

		      	if (msg == "OK"){

		      		var hits1 = data.result1.hits
		      		var hits2 = data.result2.hits

		      		var id1 = data.result1.id
		      		var id2 = data.result2.id

		      		$("#hits1").attr("value", id1)
		      		$("#hits2").attr("value", id2)

		      		$("#hits1").append("<div><strong>" + hits1.length + " hits from config 1:" + "</strong></div>")
		      		$("#hits2").append("<div><strong>" + hits2.length + " hits from config 2:" + "</strong></div>")

		      		for(var i = 0 ; i < hits1.length; i++){
		      			var item = hits1[i]
		      			$("#hits1").append("<div>" + item.title + "</div>");
		      		  $("#hits1").append("<div><a href = " + item.url + "/a>" + item.url + "</div><br>");
		      		}

		      		for(var i = 0 ; i < hits2.length; i++){
		      			var item = hits2[i]
		      			$("#hits2").append("<div>" + item.title + "</div>");
		      		  $("#hits2").append("<div><a href = " + item.url + "/a>" + item.url + "</div><br>");
		      		}

		      		$("#vote").show()

		      	} else {
		      		$("#result").append(msg)
		      	}

	      	},
					"json"
				)	// post
			}		// else

		}) 		//submit


		$("#vote").submit(function(event){
			event.preventDefault();
			var checked = $('input[name="win"]:checked')
			if (checked.length == 0){
				alert("please check one radio button")
			} else {
				var voted = checked.val()
				var id1 = $("#hits1").attr("value")
				var id2 = $("#hits2").attr("value")
				var data = null
				if (voted == "config1") data = {configId1: id1, configId2: id2, vote: id1}
				else if (voted == "config2") data = {configId1: id1, configId2: id2, vote: id2}
				else if (voted == "equallyGood") data = {configId1: id1, configId2: id2, vote: "equallyGood"}
	 			else data = {configId1: id1, configId2: id2, vote: "equallyBad"}


	 			$("#vote").hide()
	 			$("#result").empty().append("Thanks. Vote was submitted!");
		    $("#hits1").empty();
		    $("#hits2").empty();

				$.post('@com.keepit.controllers.admin.routes.AdminSearchController.blindTestVoted', data)
			}


		})



	});

</script>


}