@import com.keepit.payments.AdminPaymentsDashboard
@import com.keepit.common.controller.PaginatedRequest

@(dash: AdminPaymentsDashboard)(implicit request: com.keepit.common.controller.UserRequest[_])

@views.html.admin.admin("Payments Dashboard", stylesheets = List("admin_user"), scripts = List("typeahead.bundle.min")) {

    <h1>We are making ~@{dash.totalAmortizedIncomePerMonth.cur.toDollarString} a month (from @{dash.totalAmortizedIncomePerMonth.old.toDollarString})</h1>

    <table class="table table-condensed table-striped">
        <thead>
        <th>Credit Changes</th><th>RewardsGranted</th><th>Charges</th>
        </thead>
        <tbody>
        <tr>
            <td>@{dash.creditChanges.cur} (from @{dash.creditChanges.old})</td>
            <td>@{dash.rewardsGranted.cur.values.sum} (from @{dash.rewardsGranted.old.values.sum})</td>
            <td>@{dash.chargesMade.cur} (from @{dash.chargesMade.old})</td>
        </tr>
        </tbody>
    </table>

    <table class="table table-condensed table-striped">
        <thead>
        <th>Plan</th><th>Number of Accounts</th><th>Number of Active Users</th>
        </thead>
        <tbody>
        @for(plan <- dash.plans) {
        <tr>
            <td>@{plan.displayName}</td>
            <td>@{dash.planEnrollment.cur(plan).numAccounts} (from @{dash.planEnrollment.old(plan).numAccounts})</td>
            <td>@{dash.planEnrollment.cur(plan).numActiveUsers} (from @{dash.planEnrollment.old(plan).numActiveUsers})</td>
        </tr>
        }
        </tbody>
    </table>

    @if(dash.frozenAccounts.nonEmpty) {
    <h2>Frozen Accounts!</h2>
    <ul>
        @for(account <- dash.frozenAccounts) {
            <li>
                @adminHelper.orgDisplay(account.organization)
            </li>
        }
    </ul>
    }

    @if(dash.failedAccounts.nonEmpty) {
    <h2>Some accounts have failed their most recent payment</h2>
    <ul>
        @for(account <- dash.failedAccounts) {
            <li>
                @adminHelper.orgDisplay(account.organization)
            </li>
        }
    </ul>
    }

    <h3>Rewards breakdown</h3>
    <table class="table table-condensed table-striped">
        <tbody>
        @for(kind <- dash.rewardsGranted.cur.keySet) {
        <tr>
            <td>@kind</td>
            <td>@{dash.rewardsGranted.cur(kind)} (from @{dash.rewardsGranted.old(kind)})</td>
        </tr>
        }
        </tbody>
    </table>
}
