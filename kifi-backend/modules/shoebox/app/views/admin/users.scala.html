@(userData: com.keepit.controllers.admin.UserStatisticsPage, searchTerm: Option[String])
@import com.keepit.controllers.admin.routes
@import com.keepit.controllers.admin.UserViewTypes._

@userSetDescription = {
    @userData.userViewType match {
        case AllUsersViewType => {Total Users}
        case RealUsersViewType => {Real Users}
        case FakeUsersViewType => {Fake Users}
    }
}

@otherPagesRoute(page: Int) = {
    @userData.userViewType match {
        case AllUsersViewType => {@com.keepit.controllers.admin.routes.AdminUserController.usersView(page)}
        case RealUsersViewType => {@com.keepit.controllers.admin.routes.AdminUserController.realUsersView(page)}
        case FakeUsersViewType => {@com.keepit.controllers.admin.routes.AdminUserController.fakeUsersView(page)}
    }
}

@kifiInstallations(kifiInstallations: Seq[KifiInstallation]) = {
  <ul>
    @for(installation <- kifiInstallations) {
      <li>@{installation.version}; @{installation.userAgent.name} @{installation.userAgent.version}; @{installation.userAgent.operatingSystemName}</li>
    }
  </ul>
}

@networkLogoLink(sui: SocialUserInfo) = {
  <a href="@com.keepit.controllers.admin.routes.AdminSocialUserController.socialUserView(sui.id.get)">
    <img src="/assets/securesocial/images/providers/@{sui.networkType}.png"
      alt="@sui.networkType" width="16" height="16"></a>
}

@pagination(page: Int, pageCount: Int) = {
  <div class="pagination pagination-centered pagination-mini">
    <ul>
      <li>
        @if(page > 0) {
          <a href="@otherPagesRoute(page - 1)">
        } else {
         <a href="#">
        }
        Prev
        </a>
      </li>
      @if(page - 20 > 0) {
        <li class="disabled">
          <a href="@otherPagesRoute(0)">...</a>
        </li>
      }
      @for(i <- (0.max(page - 20) to (pageCount - 1).min(page + 20))) {
        @if(i == page) {
          <li class="disabled">
            <a href="@otherPagesRoute(i)">@{i + 1}</a>
          </li>
        } else {
          <li class="active">
            <a href="@otherPagesRoute(i)">@{i + 1}</a>
          </li>
        }
      }
      @if(page + 20 < pageCount - 1) {
        <li class="disabled">
          <a href="@otherPagesRoute(pageCount - 1)">...</a>
        </li>
      }
      <li>
        @if(userData.users.size > 0 && page < pageCount - 1) {
          <a href="@otherPagesRoute(page + 1)">
        } else {
         <a href="#">
        }
        Next
        </a>
      </li>
    </ul>
  </div>
}

@admin(userData.count + " " + userSetDescription) {
  <h2> Showing @userData.users.length (page @(userData.page + 1)) </h2>

  @pagination(userData.page, userData.pageCount)

  <form class="form-inline" action="@com.keepit.controllers.admin.routes.AdminUserController.searchUsers()" method="POST">
    @if(searchTerm.isDefined){
      <input type="text" name="searchTerm" value="@{searchTerm.get}"/>
    } else {
      <input type="text" name="searchTerm" placeholder="User first and/or last name"/>
    }
    <input type="submit" value="Search"/></br>
    @if(searchTerm.isDefined){
      <a href="@otherPagesRoute(0)">Clear search</a>
    }
  </form>
  <table class="table table-bordered">
    <tr>
      <th>#</th>
      <th>Id</th>
      <th>User</th>
      <th>Networks</th>
      <th># of bookmarks</th>
      <th>Date joined</th>
      <th>Experiments</th>
      <th>Version</th>
    </tr>
  @for((userStatistics, i) <- userData.users.zipWithIndex) {
    <tr>
      <td>@{i+1}</td>
      <td><span class="badge">@userStatistics.user.id.get.id</span></td>
      <td>@adminHelper.userDisplay(userStatistics.user)</td>
      <td>@for(u <- userStatistics.socialUsers){ @networkLogoLink(u) }</td>
      <td>@userStatistics.bookmarksCount</td>
      <td>@{adminHelper.dateTimeDisplay(userStatistics.user.createdAt)}</td>
      <td>@userStatistics.experiments.mkString(", ")</td>
      <td>@kifiInstallations(userStatistics.kifiInstallations)</td>
    </tr>
  }
  </table>
  @pagination(userData.page, userData.pageCount)

}
