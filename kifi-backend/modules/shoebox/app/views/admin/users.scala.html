@(userData: com.keepit.controllers.admin.UserStatisticsPage, searchTerm: Option[String])
@import com.keepit.controllers.admin.routes
@import com.keepit.controllers.admin.UserViewTypes._

@userSetDescription = {
    @userData.userViewType match {
        case AllUsersViewType => {Total Users}
        case RealUsersViewType => {Real Users}
        case FakeUsersViewType => {Fake Users}
        case ByExperimentUsersViewType(exp) => {@exp.value}
    }
}

@otherPagesRoute(page: Int) = {
    @userData.userViewType match {
        case AllUsersViewType => {@com.keepit.controllers.admin.routes.AdminUserController.usersView(page)}
        case RealUsersViewType => {@com.keepit.controllers.admin.routes.AdminUserController.realUsersView(page)}
        case FakeUsersViewType => {@com.keepit.controllers.admin.routes.AdminUserController.fakeUsersView(page)}
        case ByExperimentUsersViewType(exp) => {@com.keepit.controllers.admin.routes.AdminUserController.byExperimentUsersView(page, exp.value)}
    }
}

@kifiInstallations(kifiInstallations: Seq[KifiInstallation]) = {
  <ul>
    @for(installation <- kifiInstallations) {
      <li>@{installation.version}; @{installation.userAgent.name} @{installation.userAgent.version}; @{installation.userAgent.operatingSystemName}</li>
    }
  </ul>
}

@networkLogoLink(sui: SocialUserInfo) = {
  <a href="@com.keepit.controllers.admin.routes.AdminSocialUserController.socialUserView(sui.id.get)">
    <img src="/assets/securesocial/images/providers/@{sui.networkType}.png"
      alt="@sui.networkType" width="16" height="16"></a>
}

@admin(userData.userCount + " " + userSetDescription) {
  <h2> Showing @userData.users.length (page @(userData.page + 1)) </h2>

  @adminHelper.pagination(userData.page, userData.userCount, userData.pageSize, otherPagesRoute _) {
      <form class="form-inline" action="@com.keepit.controllers.admin.routes.AdminUserController.searchUsers()" method="POST">
        @if(searchTerm.isDefined){
          <input type="text" name="searchTerm" value="@{searchTerm.get}"/>
        } else {
          <input type="text" name="searchTerm" placeholder="User first and/or last name"/>
        }
        <input type="submit" value="Search"/></br>
        @if(searchTerm.isDefined){
          <a href="@otherPagesRoute(0)">Clear search</a>
        }
      </form>
      <table class="table table-bordered">
        <tr>
          <th>#</th>
          <th>Id</th>
          <th>User</th>
          <th>kifi Conns</th>
          <th>Invite Sent</th>
          <th>Messages all/active/started</th>
          <th>Network</th>
          <th>Private Keeps</th>
          <th>Public Keeps</th>
          <th>Date Joined</th>
          <th>Experiment</th>
          <th>Version</th>
        </tr>
      @for((userStatistics, i) <- userData.users.zipWithIndex) {
        <tr>
          <td>@{i+1}</td>
          <td><span class="badge">@userStatistics.user.id.get.id</span></td>
          <td>@adminHelper.userDisplay(userStatistics.user)</td>
          <td>@userStatistics.connections</td>
          <td>@userStatistics.invitations</td>
          <td>@{userData.getUserThreadStats(userStatistics.user).all}/@{userData.getUserThreadStats(userStatistics.user).active}/@{userData.getUserThreadStats(userStatistics.user).started}</td>
          <td>@for(u <- userStatistics.socialUsers){ @networkLogoLink(u) }</td>
          <td>@userStatistics.privateKeeps</td>
          <td>@userStatistics.publicKeeps</td>
          <td>@adminHelper.dateTimeDisplay(userStatistics.user.createdAt)</td>
          <td>@userStatistics.experiments.mkString(", ")</td>
          <td>@kifiInstallations(userStatistics.kifiInstallations)</td>
        </tr>
      }
      </table>
  }
}
