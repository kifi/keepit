@(bookmarksAndUsers: Seq[(User, (Keep, NormalizedURI, Option[ScrapeInfo]))], page: Int, overallCount: Int, pageCount: Int, keeperKeepCount: Option[Int], privateKeeperKeepCount: Int, counts: Seq[(KeepSource, Int)], total: Int)
@import com.keepit.model.NormalizedURIStates._
@import com.keepit.controllers.admin.routes

@pagination(page: Int, pageCount: Int) = {
  <div class="pagination pagination-centered pagination-mini">
    <ul>
      <li>
        @if(page > 0) {
          <a href="@routes.AdminBookmarksController.bookmarksView(page - 1)">
        } else {
         <a href="#">
        }
        Prev
        </a>
      </li>
      @if(page - 20 > 0) {
        <li class="disabled">
          <a href="@routes.AdminBookmarksController.bookmarksView(0)">...</a>
        </li>
      }
      @for(i <- (0.max(page - 20) to (pageCount - 1).min(page + 20))) {
        @if(i == page) {
	        <li class="disabled">
	          <a href="@routes.AdminBookmarksController.bookmarksView(i)">@{i + 1}</a>
	        </li>
        } else {
	        <li class="active">
	          <a href="@routes.AdminBookmarksController.bookmarksView(i)">@{i + 1}</a>
	        </li>
	      }
      }
      @if(page + 20 < pageCount - 1) {
        <li class="disabled">
          <a href="@routes.AdminBookmarksController.bookmarksView(pageCount - 1)">...</a>
        </li>
      }
      <li>
        @if(bookmarksAndUsers.size > 0) {
          <a href="@routes.AdminBookmarksController.bookmarksView(page + 1)">
        } else {
         <a href="#">
        }
        Next
        </a>
      </li>
    </ul>
  </div>
}

@admin(overallCount + " Total Keeps") {

  <h2>Showing @bookmarksAndUsers.size (page @{page + 1})</h2>
  <h4>Keeps in the last 24 hours</h4>
  <ul>
    @if(keeperKeepCount.nonEmpty) {
      <li>Keeper keeps: @keeperKeepCount.get (@privateKeeperKeepCount private)</li>
    }
    <li>Counts per source:
      <ul>
        @for((source, count) <- counts) {
          <li>@{source}: @{count}</li>
        }
      </ul>
    </li>
    <li>Total: @total</li>
  </ul>

  @pagination(page, pageCount)

  <table class="table table-bordered" style = "clear: both">
    <tr>
      <th>#</th>
      <th>User</th>
      <th>Title</th>
      <th>Source</th>
      <th>Creation</th>
      <th>State</th>
      <th>Last Scrape</th>
      <th>URI Restriction</th>
    </tr>
    @for(((user, (bookmark, uri, scrapeInfo)), i) <- bookmarksAndUsers.zipWithIndex) {
    <tr>
      <td>@{i+1}</td>
      <td>@adminHelper.userDisplay(user)</td>
      <td>@adminHelper.bookmarkDisplay(bookmark)</td>
      <td>
        @{bookmark.source.value match {
          case "INIT_LOAD" | "bookmarkImport" => {
            <span class="label">Bookmark Import</span>
          }
          case "HOVER_KEEP" | "keeper"=> {
            <span class="label label-success">Keeper</span>
          }
          case "plugin_start" => {
            <span class="label label-info">Plugin Restart</span>
          }
          case "email" => {
            <span class="label label-success">Email</span>
          }
          case "site" => {
            <span class="label label-success">Website</span>
          }
          case "mobile" => {
            <span class="label label-success">Mobile</span>
          }
          case "default" => {
            <span class="label label-info">Default</span>
          }
        }}
      </td>
      <td>@adminHelper.dateTimeDisplay(bookmark.createdAt)</td>
      <td>@adminHelper.uriStateDisplay(uri)</td>
      <td>@scrapeInfo.map(si => adminHelper.dateTimeDisplay(si.lastScrape)).mkString</td>
      <td>@{uri.restriction.map{ r => r.context}.getOrElse("")}</td>
    </tr>
  }
  </table>
  @pagination(page, pageCount)
}

<script type="text/javascript">
  $.get("@routes.AdminArticleIndexerController.getSequenceNumber", function (data) {
    var sequenceNumber = data.sequenceNumber
    $(".uri-state").each(function () {
      var seq = $(this).data('seq');
      var indexed = seq <= sequenceNumber
      $(this)
        .find('.if-indexed').toggle(indexed).end()
        .find('.if-not-indexed').toggle(!indexed);
    });
  });
</script>
