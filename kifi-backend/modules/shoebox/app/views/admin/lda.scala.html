@(numTopics: Int)

@admin("LDA"){
  <h2>@numTopics topics</h2>

  <div>show topN topic words for topics with id between fromId and toId. Note: fromId >=0. toId < @numTopics. If fromId = toId, return one single topic. </div>
  <form id = "show_topics">
    <input id = "fromId" type = "text" value = "fromId">
    <input id = "toId" type = "text" value = "toId">
    <input id = "topN" type = "text" value = "topN words">
    <button type = "submit">submit</button>
  </form>


  <table id = "topic_words_table" class = "table table-bordered">
    <thead>
      <tr>
        <th> id
        <th> words
        <th> topic name
        <th> topic state
      <tr/>
    </thead>
    <tbody></tbody>
  </table>

  <form id = "save_changes">
    <button type = "submit">Save Above Changes</button>
  </form>

  <br><br>
  <div>Show word topic. Only the top few topics are returned.</div>
  <form id = "word_topic">
    <input id = "word" type = "text" value = "">
    <button type = "submit">submit</button>
  </form>

  <p id = "word_topic_result"></p>


  <br><br>
  <div>Paste some text here. Identify topics</div>
  <form id = "doc_topic">
    <textarea id = "doc"></textarea>
    <button type = "submit">submit</button>
  </form>

  <p id = "doc_topic_result"></p>




  <script type="text/javascript">

    $(document).ready(function(){
      $.postJson = function (uri, data, done) {
        return $.ajax({
          url: uri,
          type: 'POST',
          dataType: 'json',
          data: JSON.stringify(data),
          contentType: 'application/json',
          success: done || $.noop
        });
      };

      $("#show_topics").submit(function(event){
        event.preventDefault();

        $.post('@com.keepit.controllers.admin.routes.AdminLDAController.showTopics',
          {fromId: $('#fromId').val(), toId: $('#toId').val(), topN: $('#topN').val()}
        ).done(done).fail(fail);

        function done(data) {
          var x = JSON.parse(data)

          var fromId = parseInt($('#fromId').val())
          var topicIds = x.ids
          var topicWords = x.topicWords
          var topicNames = x.topicNames
          var states = x.states

          var sz = topicWords.length

          $("#topic_words_table > tbody").empty()
          for(var i = 0; i < sz; i++){

            var isActive = (states[i] == true)

            $("#topic_words_table").append(
              "<tr>" +
              "<td class = \"ids\" >" + topicIds[i] + "</td>" +
              "<td><pre>" + topicWords[i] + "</pre></td>" +
              "<td class = \"tnames\">" + $("<input>",{value: topicNames[i]}).prop('outerHTML') + "</td>" +
              "<td class = \"active\">" + $("<input/>", {type: "checkbox", checked: isActive}).prop('outerHTML') + "</td>" +
              "</tr>"
            )
          }
        }

        function fail() { alert("bad things happened") }

      })


      $('#save_changes').submit(function(event){
        event.preventDefault();

        var ids = $(".ids")
        var retIds = []
        for(var j = 0; j < ids.length; j++){
          retIds[j] = $(ids[j]).text()
        }

        var names = $(".tnames")
        var retNames = []
        for(var j = 0; j < names.length; j++){
          retNames[j] = $(names[j]).find("input").val()
        }

        var states = $(".active")
        var retStates = []
        for(var j = 0; j < states.length; j++){
          retStates[j] = $(states[j]).find("input").prop("checked")
        }

        $.postJson('@com.keepit.controllers.admin.routes.AdminLDAController.saveEdits',
          {topic_ids: retIds, topic_names: retNames, topic_states: retStates}
        ).done(done).fail(fail);

        function done(data){ alert("changes saved") }
        function fail() { alert("bad things happened") }


      })



      $('#word_topic').submit(function(event){
        event.preventDefault();

        $.post('@com.keepit.controllers.admin.routes.AdminLDAController.wordTopic',
          {word: $('#word').val()}
        ).done(done).fail(fail);

        function done(data){ $("#word_topic_result").empty().prepend(data) }
        function fail() { alert("bad things happened") }

      })


      $('#doc_topic').submit(function(event){
        event.preventDefault();

        $.post('@com.keepit.controllers.admin.routes.AdminLDAController.docTopic',
          {doc: $('#doc').val()}
        ).done(done).fail(fail);

        function done(data){ $("#doc_topic_result").empty().prepend(data) }
        function fail() { alert("bad things happened") }

      })



    });

  </script>


}
