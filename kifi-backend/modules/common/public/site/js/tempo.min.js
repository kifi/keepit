/*!
 * Tempo Template Engine 2.1
 * tempojs.com
 */
function TempoEvent(k, n, p) {
  this.type = k;
  this.item = n;
  this.element = p;
  return this
}
TempoEvent.Types = {RENDER_STARTING:"render_starting", ITEM_RENDER_STARTING:"item_render_starting", ITEM_RENDER_COMPLETE:"item_render_complete", RENDER_COMPLETE:"render_complete", BEFORE_CLEAR:"before_clear", AFTER_CLEAR:"after_clear"};
var Tempo = function(k) {
  function n(a, b) {
    this.params = a;
    this.defaultTemplate = null;
    this.namedTemplates = {};
    this.container = null;
    this.nestedItem = void 0 !== b ? b : null;
    this.escape = !0;
    this.var_brace_left = "\\{\\{";
    this.var_brace_right = "\\}\\}";
    this.tag_brace_left = "\\{%";
    this.tag_brace_right = "%\\}";
    this.dataIsMap = !1;
    this.attributes = {};
    if("undefined" !== typeof a) {
      for(var c in a) {
        "var_braces" === c ? (this.var_brace_left = a[c].substring(0, a[c].length / 2), this.var_brace_right = a[c].substring(a[c].length / 2)) : "tag_braces" === c ? (this.tag_brace_left = a[c].substring(0, a[c].length / 2), this.tag_brace_right = a[c].substring(a[c].length / 2)) : "undefined" !== typeof this[c] && (this[c] = a[c])
      }
    }
    return this
  }
  function p(a) {
    this.templates = a;
    this.listener = [];
    this.started = !1;
    this.varRegex = RegExp(this.templates.var_brace_left + "[ ]?([A-Za-z0-9$\\._\\[\\]]*?)([ ]?\\|[ ]?.*?)?[ ]?" + this.templates.var_brace_right, "g");
    this.tagRegex = RegExp(this.templates.tag_brace_left + "[ ]?([\\s\\S]*?)( [\\s\\S]*?)?[ ]?" + this.templates.tag_brace_right + "(([\\s\\S]*?)(?=" + this.templates.tag_brace_left + "[ ]?end\\1[ ]?" + this.templates.tag_brace_right + "))?", "g");
    this.filterSplitter = RegExp("\\|[ ]?(?=" + f.memberRegex(this.filters) + ")", "g");
    this.errorHandler = null;
    return this
  }
  var s = /(\d+)(\d{3})/, l, f = {memberRegex:function(a) {
    var b = "(", c;
    for(c in a) {
      a.hasOwnProperty(c) && (1 < b.length && (b += "|"), b += c)
    }
    return b + ")[\\.]?(?!\\w)"
  }, pad:function(a, b, c) {
    for(;a.length < c;) {
      a = b + a
    }
    return a
  }, trim:function(a) {
    return a.replace(/^\s*([\S\s]*?)\s*$/, "$1")
  }, startsWith:function(a, b) {
    return 0 === a.indexOf(b)
  }, clearContainer:function(a) {
    if(null !== a && void 0 !== a && void 0 !== a.childNodes) {
      for(var b = a.childNodes.length - 1;0 <= b;b--) {
        void 0 === a.childNodes[b] || (void 0 === a.childNodes[b].getAttribute || null === a.childNodes[b].getAttribute("data-template") && null === a.childNodes[b].getAttribute("data-template-for")) || a.childNodes[b].parentNode.removeChild(a.childNodes[b])
      }
    }
  }, isNested:function(a) {
    for(a = a.parentNode;a;) {
      if(this.hasAttr(a, "data-template") || this.hasAttr(a, "data-template-for")) {
        return!0
      }
      a = a.parentNode
    }
    return!1
  }, equalsIgnoreCase:function(a, b) {
    return a.toLowerCase() === b.toLowerCase()
  }, getElement:function(a, b) {
    if(-1 < navigator.appVersion.indexOf("MSIE") && f.equalsIgnoreCase(a.tagName, "tr")) {
      var c = l.document.createElement("div");
      c.innerHTML = "<table><tbody>" + b + "</tbody></table>";
      for(var d = 3;d--;) {
        c = c.lastChild
      }
      c.setAttribute("data-template", "");
      return c
    }
    a.innerHTML = b;
    return a
  }, typeOf:function(a) {
    return"object" === typeof a ? null === a ? "null" : a.constructor === [].constructor ? "array" : a.constructor === (new Date).constructor ? "date" : a.constructor === RegExp().constructor ? "regex" : ("object" === typeof HTMLElement ? a instanceof HTMLElement : a && "object" === typeof a && 1 === a.nodeType && "string" === typeof a.nodeName) ? "element" : "undefined" !== typeof jQuery && a instanceof jQuery ? "jquery" : "object" : typeof a
  }, hasAttr:function(a, b) {
    if(void 0 !== a) {
      if(void 0 !== a.hasAttribute) {
        return a.hasAttribute(b)
      }
      if(void 0 !== a.getAttribute) {
        return null !== a.getAttribute(b)
      }
    }
    return!1
  }, removeAttr:function(a, b) {
    void 0 !== a && (a.setAttribute(b, ""), a.removeAttribute && a.removeAttribute(b))
  }, merge:function(a, b) {
    var c = {}, d;
    for(d in a) {
      a.hasOwnProperty(d) && (c[d] = a[d])
    }
    for(var e in b) {
      b.hasOwnProperty(e) && (c[e] = b[e])
    }
    return c
  }, notify:function(a, b) {
    if(void 0 !== a && 0 < a.length) {
      for(var c = 0;c < a.length;c++) {
        b.type === a[c].type && a[c].listener(b)
      }
    }
  }, container:function(a) {
    "string" === f.typeOf(a) ? a = "*" === a ? l.document.getElementsByTagName("html")[0] : l.document.getElementById(a) : "jquery" === f.typeOf(a) && 0 < a.length && (a = a[0]);
    return a
  }, arrayContains:function(a, b) {
    if(Array.prototype.indexOf) {
      return-1 < a.indexOf(b)
    }
    for(var c = 0;c < this.length;c++) {
      if(this[c] === b) {
        return!0
      }
    }
    return!1
  }};
  n.prototype = {load:function(a, b) {
    function c(a) {
      return a.contentWindow ? a.contentWindow.document.documentElement.innerHTML : a.contentDocument ? a.contentDocument.body.innerHTML : a.document.body.innerHTML
    }
    if(null !== l.document.getElementById(a)) {
      b(c(l.document.getElementById(a)))
    }else {
      var d = l.document.createElement("iframe");
      d.id = a;
      d.name = a;
      d.style.height = 0;
      d.style.width = 0;
      d.src = a;
      d.attachEvent ? d.attachEvent("onload", function() {
        b(c(d))
      }) : d.onload = function() {
        b(c(d))
      };
      l.document.body.appendChild(d)
    }
  }, _insertTemplate:function(a, b, c, d) {
    return function(e) {
      f.removeAttr(a, "data-template-file");
      a.innerHTML = e;
      b.parse(c, d)
    }
  }, parse:function(a, b) {
    this.container = a;
    for(var c = a.getElementsByTagName("*"), d = !0, e = 0;e < c.length;e++) {
      if(!0 === d && void 0 !== b && f.hasAttr(c[e], "data-template-file")) {
        var g = c[e];
        0 < g.getAttribute("data-template-file").length && (d = !1, this.load(g.getAttribute("data-template-file"), this._insertTemplate(g, this, a, b)))
      }else {
        f.hasAttr(c[e], "data-template-fallback") && (c[e].style.display = "none")
      }
    }
    if(d) {
      d = {};
      for(e = 0;e < c.length;e++) {
        void 0 !== c[e].getAttribute && (f.hasAttr(c[e], "data-template-for") && 0 < c[e].getAttribute("data-template-for").length && this.nestedItem === c[e].getAttribute("data-template-for") && !d[this.nestedItem] ? (this.createTemplate(c[e]), d[this.nestedItem] = !0) : f.hasAttr(c[e], "data-template") && !f.isNested(c[e]) && this.createTemplate(c[e]))
      }
      f.clearContainer(this.container);
      void 0 !== b && b(this)
    }
  }, createTemplate:function(a) {
    var b = a.cloneNode(!0);
    b.style.removeAttribute ? b.style.removeAttribute("display") : b.style.removeProperty ? b.style.removeProperty("display") : b.style.display = "block";
    this.container = a.parentNode;
    var c = !1;
    for(a = 0;a < b.attributes.length;a++) {
      var d = b.attributes[a];
      f.startsWith(d.name, "data-if-") ? (c = "" === d.value ? !0 : "null" === d.value ? null : "'" + d.value + "'", this.namedTemplates[d.name.substring(8, d.name.length) + "==" + c] = b, f.removeAttr(b, d.name), c = !0) : "data-has" === d.name ? (this.namedTemplates[d.value + "!==undefined"] = b, f.removeAttr(b, d.name), c = !0) : "data-from-map" === d.name ? this.dataIsMap = !0 : !f.startsWith(d.name, "data-template") && f.startsWith(d.name, "data-") && (this.attributes[d.name.substring(5, d.name.length)] =
      d.value)
    }
    c || (this.defaultTemplate = b)
  }, templateFor:function(a) {
    for(var b in this.namedTemplates) {
      if(eval("a." + b)) {
        return this.namedTemplates[b].cloneNode(!0)
      }
    }
    if(this.defaultTemplate) {
      return this.defaultTemplate.cloneNode(!0)
    }
  }};
  p.prototype = {when:function(a, b) {
    this.listener.push({type:a, listener:b});
    return this
  }, _getValue:function(a, b, c, d) {
    a = null;
    return f.startsWith(b, "_tempo.") ? eval("d." + b.substring(7, b.length)) : a = "." === b ? eval("c") : "this" === b || null !== b.match(/this[\\[\\.]/) ? eval("c" + b.substring(4, b.length)) : "array" === f.typeOf(c) ? eval("c" + b) : eval("c." + b)
  }, _replaceVariables:function(a, b, c, d) {
    var e = this;
    return d.replace(this.varRegex, function(d, h, r) {
      try {
        var m = a._getValue(a, h, c, b);
        if(void 0 !== r && "" !== r) {
          var k = f.trim(f.trim(r).substring(1)).split(e.filterSplitter);
          for(d = 0;d < k.length;d++) {
            var q = f.trim(k[d]), l, n = q.indexOf(" ");
            ~n ? (l = q.substr(n).replace(/(^ *['"])|(['"] *$)/g, "").split(/['"] *, *['"]/), q = q.substr(0, n)) : l = [];
            m = a.filters[q](m, l)
          }
        }
        if(void 0 !== m) {
          return e.templates.escape && (m = e.filters.escape(m, {})), m
        }
      }catch(p) {
        e._onError.call(e, p)
      }
      return""
    })
  }, _replaceObjects:function(a, b, c, d, e) {
    return d.replace(e, function(d, e, l) {
      try {
        var m = a._getValue(a, e, c, b);
        if(void 0 !== m) {
          return"string" === f.typeOf(m) ? "'" + m + "'" : m
        }
      }catch(k) {
        self._onError.call(self, k)
      }
    })
  }, _applyAttributeSetters:function(a, b, c) {
    return c.replace(/(\b[A-z0-9]+?)(?:="[^"']*?"[^>]*?)data-\1="(.*?)"/g, function(a, b, c) {
      return"" !== c ? b + '="' + c + '"' : a
    })
  }, _applyTags:function(a, b, c) {
    return c.replace(this.tagRegex, function(c, e, f, h) {
      return a.tags.hasOwnProperty(e) ? (f = f.substring(f.indexOf(" ")).replace(/^[ ]*|[ ]*$/g, ""), f = f.split(/(?:['"])[ ]?,[ ]?(?:['"])/), a.tags[e](a, b, c, f, h)) : ""
    })
  }, starting:function(a) {
    this.started = !0;
    void 0 === a && (a = new TempoEvent(TempoEvent.Types.RENDER_STARTING, void 0, void 0));
    f.notify(this.listener, a);
    return this
  }, _renderNestedItem:function(a, b) {
    var c = this;
    return function(d) {
      d = new p(d);
      var e = null;
      if("*" === b || a.hasOwnProperty(b.split(".")[0])) {
        if(e = "*" === b ? a : eval("a." + b)) {
          try {
            if("array" === f.typeOf(e)) {
              for(var g = 0;g < e.length;g++) {
                "object" === f.typeOf(e[g]) && (e[g]._parent = a)
              }
            }else {
              e._parent = a
            }
          }catch(h) {
            c._onError.call(c, h)
          }
        }
      }
      d.render(e)
    }
  }, renderItem:function(a, b, c, d) {
    var e = RegExp("(?:__[\\.]?)((_tempo|\\[|" + f.memberRegex(c) + "|this)([A-Za-z0-9$\\._\\[\\]]+)?)", "g"), g = a.templates.templateFor(c);
    b = f.merge(b, a.templates.attributes);
    f.hasAttr(g, "data-template-for") && f.removeAttr(g, "data-template-for");
    f.hasAttr(g, "data-template-file") && f.removeAttr(g, "data-template-file");
    if(g && c) {
      f.notify(this.listener, new TempoEvent(TempoEvent.Types.ITEM_RENDER_STARTING, c, g));
      var h = g.innerHTML.match(/data-template-for="([^"]+?)"/g);
      if(h) {
        for(var k = 0;k < h.length;k++) {
          var m = h[k].match(/data-template-for="([^"]+?)"/);
          if(m && m[1]) {
            var l = new n(a.templates.params, m[1]);
            try {
              l.parse(g, this._renderNestedItem(c, m[1]))
            }catch(q) {
              this._onError.call(this, q)
            }
          }
        }
      }
      for(a = 0;a < g.attributes.length;a++) {
        h = g.attributes[a], null !== h && (h.specified && null !== h.value && 0 < h.value.length && null === h.name.match(/style|data-template.*/)) && (h.value = this._applyTags(this, c, h.value), h.value = this._replaceVariables(this, b, c, h.value))
      }
      a = g.innerHTML.replace(/%7B%7B/g, "{{").replace(/%7D%7D/g, "}}");
      a = this._applyTags(this, c, a);
      a = this._replaceVariables(this, b, c, a);
      a = this._replaceObjects(this, b, c, a, e);
      a = this._applyAttributeSetters(this, c, a);
      d.appendChild(f.getElement(g, a));
      f.notify(this.listener, new TempoEvent(TempoEvent.Types.ITEM_RENDER_COMPLETE, c, g))
    }
  }, _createFragment:function(a) {
    if(a) {
      var b = {}, c = l.document.createDocumentFragment();
      if("object" === f.typeOf(a)) {
        if(this.templates.dataIsMap) {
          var d = [], e;
          for(e in a) {
            if(a.hasOwnProperty(e) && "_parent" !== e) {
              var g = {};
              g.key = e;
              g.value = a[e];
              d.push(g)
            }
          }
          a = d
        }else {
          a = [a]
        }
      }
      for(d = 0;d < a.length;d++) {
        b.index = d, b.first = 1 > d, b.last = d == a.length - 1, this.renderItem(this, b, a[d], c)
      }
      return c
    }
    return null
  }, into:function(a) {
    void 0 !== a && (this.templates.container = f.container(a));
    return this
  }, render:function(a) {
    this.started || this.starting(new TempoEvent(TempoEvent.Types.RENDER_STARTING, a, this.templates.container));
    this.clear();
    this.append(a);
    return this
  }, append:function(a) {
    this.started || this.starting(new TempoEvent(TempoEvent.Types.RENDER_STARTING, a, this.templates.container));
    var b = this._createFragment(a);
    if(null !== b && null !== this.templates.container && null !== b) {
      for(var c = null, d = this.templates.container.childNodes.length;0 <= d;d--) {
        void 0 !== this.templates.container.childNodes[d] && (void 0 !== this.templates.container.childNodes[d].getAttribute && null !== this.templates.container.childNodes[d].getAttribute("data-after-template")) && (c = this.templates.container.childNodes[d])
      }
      null !== c ? this.templates.container.insertBefore(b, c) : this.templates.container.appendChild(b)
    }
    f.notify(this.listener, new TempoEvent(TempoEvent.Types.RENDER_COMPLETE, a, this.templates.container));
    return this
  }, prepend:function(a) {
    this.started || this.starting(new TempoEvent(TempoEvent.Types.RENDER_STARTING, a, this.templates.container));
    var b = this._createFragment(a);
    if(null !== b) {
      for(var c = null, d = 0;d < this.templates.container.childNodes.length;d++) {
        void 0 !== this.templates.container.childNodes[d] && (void 0 !== this.templates.container.childNodes[d].getAttribute && null !== this.templates.container.childNodes[d].getAttribute("data-before-template")) && (c = this.templates.container.childNodes[d])
      }
      null === c && (c = this.templates.container.firstChild);
      null !== c ? (null !== c.nextSibling && (c.getAttribute && null !== c.getAttribute("data-before-template")) && (c = c.nextSibling), this.templates.container.insertBefore(b, c)) : this.templates.container.appendChild(b)
    }
    f.notify(this.listener, new TempoEvent(TempoEvent.Types.RENDER_COMPLETE, a, this.templates.container));
    return this
  }, errors:function(a) {
    this.errorHandler = a;
    return this
  }, _onError:function(a) {
    null !== this.errorHandler && this.errorHandler.call(this, a)
  }, clear:function() {
    f.notify(this.listener, new TempoEvent(TempoEvent.Types.BEFORE_CLEAR, {}, this.templates.container));
    f.clearContainer(this.templates.container);
    f.notify(this.listener, new TempoEvent(TempoEvent.Types.AFTER_CLEAR, {}, this.templates.container))
  }, tags:{"if":function(a, b, c, d, e) {
    var g = f.memberRegex(b);
    d = d[0].replace(/&amp;/g, "&").replace(/&gt;/g, ">").replace(/&lt;/g, "<");
    d = d.replace(RegExp(g, "gi"), function(a) {
      return"b." + a
    });
    a = e.split(RegExp(a.templates.tag_brace_left + "[ ]?else[ ]?" + a.templates.tag_brace_right, "g"));
    return eval(d) ? a[0] : 1 < a.length ? a[1] : ""
  }}, filters:{escape:function(a, b) {
    return a.toString().replace(/[&<>]/g, function(a) {
      return{"&":"&amp;", "<":"&lt;", ">":"&gt;"}[a] || a
    })
  }, encodeURI:function(a, b) {
    return encodeURI(a.toString())
  }, decodeURI:function(a, b) {
    return decodeURI(a.toString())
  }, truncate:function(a, b) {
    if(void 0 !== a) {
      var c = 0, d = "...";
      0 < b.length && (c = parseInt(b[0], 10));
      1 < b.length && (d = b[1]);
      return a.length > c - 3 ? a.substr(0, c - 3) + d : a
    }
  }, format:function(a, b) {
    if(void 0 !== a) {
      1 === b.length && (a = parseFloat(a + "").toFixed(parseInt(b[0], 10)));
      for(var c = (a + "").split("."), d = c[0], c = 1 < c.length ? "." + c[1] : "";s.test(d);) {
        d = d.replace(s, "$1,$2")
      }
      return d + c
    }
  }, upper:function(a, b) {
    return a.toUpperCase()
  }, lower:function(a, b) {
    return a.toLowerCase()
  }, titlecase:function(a, b) {
    var c = [];
    void 0 !== b && 1 === b.length && (c = b[0].split(" "));
    return a.replace(/\w[a-z]\S*/g, function(a, b) {
      return 0 !== c.length && f.arrayContains(c, a) && 0 < b ? a : a.charAt(0).toUpperCase() + a.substr(1).toLowerCase()
    })
  }, trim:function(a, b) {
    return f.trim(a)
  }, replace:function(a, b) {
    return void 0 !== a && 2 === b.length ? a.replace(RegExp(b[0], "g"), b[1]) : a
  }, append:function(a, b) {
    return void 0 !== a && 1 === b.length ? a + "" + b[0] : a
  }, prepend:function(a, b) {
    return void 0 !== a && 1 === b.length ? b[0] + "" + a : a
  }, join:function(a, b) {
    return 1 === b.length && void 0 !== a && "array" === f.typeOf(a) ? a.join(b[0]) : a
  }, "default":function(a, b) {
    return void 0 !== a && null !== a ? a : 1 === b.length ? b[0] : a
  }, date:function(a, b) {
    if(void 0 !== a && 1 <= b.length && 2 >= b.length) {
      var c = new Date(a), d = b[0], e = 2 === b.length && "UTC" === b[1];
      if("localedate" === d) {
        return c.toLocaleDateString()
      }
      if("localetime" === d) {
        return c.toLocaleTimeString()
      }
      if("date" === d) {
        return c.toDateString()
      }
      if("time" === d) {
        return c.toTimeString()
      }
      var g = "January February March April May June July August September October November December".split(" "), h = "Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "), k = {YYYY:function(a) {
        return e ? a.getUTCFullYear() : a.getFullYear()
      }, YY:function(a) {
        return(e ? a.getUTCFullYear() : a.getFullYear()).toFixed().substring(2)
      }, MMMM:function(a) {
        return g[e ? a.getUTCMonth() : a.getMonth()]
      }, MMM:function(a) {
        return g[e ? a.getUTCMonth() : a.getMonth()].substring(0, 3)
      }, MM:function(a) {
        return f.pad(((e ? a.getUTCMonth() : a.getMonth()) + 1).toFixed(), "0", 2)
      }, M:function(a) {
        return(e ? a.getUTCMonth() : a.getMonth()) + 1
      }, DD:function(a) {
        return f.pad((e ? a.getUTCDate() : a.getDate()).toFixed(), "0", 2)
      }, D:function(a) {
        return e ? a.getUTCDate() : a.getDate()
      }, EEEE:function(a) {
        return h[e ? a.getUTCDay() : a.getDay()]
      }, EEE:function(a) {
        return h[e ? a.getUTCDay() : a.getDay()].substring(0, 3)
      }, E:function(a) {
        return e ? a.getUTCDay() : a.getDay()
      }, HH:function(a) {
        return f.pad((e ? a.getUTCHours() : a.getHours()).toFixed(), "0", 2)
      }, H:function(a) {
        return e ? a.getUTCHours() : a.getHours()
      }, h:function(a) {
        a = e ? a.getUTCHours() : a.getHours();
        return 13 > a ? 0 === a ? 12 : a : a - 12
      }, mm:function(a) {
        return f.pad((e ? a.getUTCMinutes() : a.getMinutes()).toFixed(), "0", 2)
      }, m:function(a) {
        return e ? a.getUTCMinutes() : a.getMinutes()
      }, ss:function(a) {
        return f.pad((e ? a.getUTCSeconds() : a.getSeconds()).toFixed(), "0", 2)
      }, s:function(a) {
        return e ? a.getUTCSeconds() : a.getSeconds()
      }, SSS:function(a) {
        return f.pad((e ? a.getUTCMilliseconds() : a.getMilliseconds()).toFixed(), "0", 3)
      }, S:function(a) {
        return e ? a.getUTCMilliseconds() : a.getMilliseconds()
      }, a:function(a) {
        return 12 > (e ? a.getUTCHours() : a.getHours()) ? "AM" : "PM"
      }};
      return d = d.replace(/(\\)?(Y{2,4}|M{1,4}|D{1,2}|E{1,4}|H{1,2}|h|m{1,2}|s{1,2}|S{1,3}|a)/g, function(a, b, d) {
        return!b && k.hasOwnProperty(d) ? k[d](c) : d
      })
    }
    return""
  }}};
  k.init = function(a) {
    l = a;
    return this
  };
  k.prepare = function(a, b, c) {
    a = f.container(a);
    b = new n(b);
    if(void 0 !== c) {
      b.parse(a, function(a) {
        c(new p(a))
      })
    }else {
      return b.parse(a), new p(b)
    }
  };
  k.exports = {templates:n, utils:f};
  k.test = {utils:f, templates:new n({}), renderer:new p(new n({}))};
  try {
    k.init(window)
  }catch(t) {
    exports.tempo = k
  }
  return k
}(Tempo || {});
