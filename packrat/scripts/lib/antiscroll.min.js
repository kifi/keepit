// @require styles/antiscroll.css
// github.com/2is10/antiscroll/tree/packrat
(function(b){function f(a,e){this.el=b(a);this.options=e||{};this.x=!1!==this.options.x||this.options.forceHorizontal;this.y=!1!==this.options.y||this.options.forceVertical;this.autoHide=!1!==this.options.autoHide;this.padding=void 0==this.options.padding?2:this.options.padding;var d=g();this.inner=this.el.find(".kifi-scroll-inner").css({width:this.y&&d?this.options.width?"calc("+d+"px + "+this.options.width+")":"+="+d:null,height:this.x&&d?this.options.height?"calc("+d+"px + "+this.options.height+
")":"+="+d:null});this.refresh()}function c(a){this.pane=a;this.pane.el.append(this.el);this.innerEl=this.pane.inner.get(0);this.shown=this.enter=this.dragging=!1;this.pane.el.mouseenter(b.proxy(this,"mouseenter"));this.pane.el.mouseleave(b.proxy(this,"mouseleave"));this.el.mousedown(b.proxy(this,"mousedown"));this.innerPaneScrollListener=b.proxy(this,"scroll");this.pane.inner.scroll(this.innerPaneScrollListener);this.innerPaneMouseWheelListener=b.proxy(this,"mousewheel");this.pane.inner.bind("mousewheel",
this.innerPaneMouseWheelListener);a=this.pane.options.initialDisplay;!1!==a&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(b.proxy(this,"hide"),parseInt(a,10)||3E3)))}function k(a,e){function d(){}d.prototype=e.prototype;a.prototype=new d}function g(){if(void 0===h){var a=b('<div class="kifi-root kifi-scroll-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"/></div>');b(b("body")[0]||"html").append(a);var e=b(a).innerWidth(),d=
b("div",a).innerWidth();b(a).remove();if(e>=d)h=e-d}return h||0}b.fn.antiscroll=function(a){return this.each(function(){b(this).data("antiscroll")&&b(this).data("antiscroll").destroy();b(this).data("antiscroll",new b.Antiscroll(this,a))})};b.Antiscroll=f;f.prototype.refresh=function(){var a=this.inner.get(0).scrollWidth>this.el.width()+(this.y?g():0),e=this.inner.get(0).scrollHeight>this.el.height()+(this.x?g():0);this.x&&(!this.horizontal&&a?this.horizontal=new c.Horizontal(this):this.horizontal&&!a?(this.horizontal.destroy(),
this.horizontal=null):this.horizontal&&this.horizontal.update());this.y&&(!this.vertical&&e?this.vertical=new c.Vertical(this):this.vertical&&!e?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update())};f.prototype.destroy=function(){this.horizontal&&(this.horizontal.destroy(),this.horizontal=null);this.vertical&&(this.vertical.destroy(),this.vertical=null);return this};f.prototype.rebuild=function(){this.destroy();this.inner.attr("style","");f.call(this,this.el,this.options);
return this};c.prototype.destroy=function(){this.el.remove();this.pane.inner.unbind("scroll",this.innerPaneScrollListener);this.pane.inner.unbind("mousewheel",this.innerPaneMouseWheelListener);return this};c.prototype.mouseenter=function(){this.enter=!0;this.show()};c.prototype.mouseleave=function(){this.enter=!1;this.dragging||this.pane.autoHide&&this.hide()};c.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||!this.pane.autoHide||(this.hiding=setTimeout(b.proxy(this,
"hide"),1500)));this.update()};c.prototype.mousedown=function(a){a.preventDefault();this.dragging=!0;this.startPageY=a.pageY-parseInt(this.el.css("top"),10);this.startPageX=a.pageX-parseInt(this.el.css("left"),10);var e=this;this.el.addClass("kifi-scroll-dragging");b(this.el[0].ownerDocument).on("selectstart.antiscroll-drag",function(){return!1}).on("mousemove.antiscroll-drag",b.proxy(this,"mousemove")).on("mouseup.antiscroll-drag",function(){e.dragging=!1;e.el.removeClass("kifi-scroll-dragging");
b(this).off(".antiscroll-drag");e.enter||e.hide()})};c.prototype.show=function(a){!this.shown&&this.update()&&(this.el.addClass("kifi-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)};c.prototype.hide=function(){!1!==this.pane.autoHide&&this.shown&&(this.el.removeClass("kifi-scrollbar-shown"),this.shown=!1)};c.Horizontal=function(a){this.el=b('<div class="kifi-scrollbar kifi-scrollbar-horizontal"/>',a.el);c.call(this,a)};k(c.Horizontal,c);c.Horizontal.prototype.update=
function(){var a=this.pane.el.width(),e=a-2*this.pane.padding,d=this.pane.inner.get(0);this.el.css("width",e*a/d.scrollWidth).css("left",e*d.scrollLeft/d.scrollWidth);return a<d.scrollWidth};c.Horizontal.prototype.mousemove=function(a){var e=this.pane.el.width()-2*this.pane.padding,d=a.pageX-this.startPageX;a=this.el.width();var b=this.pane.inner.get(0),d=Math.min(Math.max(d,0),e-a);b.scrollLeft=(b.scrollWidth-this.pane.el.width())*d/(e-a)};c.Horizontal.prototype.mousewheel=function(a,e,d,b){if(0>
d&&0==this.pane.inner.get(0).scrollLeft||0<d&&this.innerEl.scrollLeft+Math.ceil(this.pane.el.width())==this.innerEl.scrollWidth)return a.preventDefault(),!1};c.Vertical=function(a){this.el=b('<div class="kifi-scrollbar kifi-scrollbar-vertical"/>',a.el);c.call(this,a)};k(c.Vertical,c);c.Vertical.prototype.update=function(){var a=this.pane.el.height(),e=a-2*this.pane.padding,d=this.innerEl,b=e*a/d.scrollHeight,b=20>b?20:b,c=e*d.scrollTop/d.scrollHeight;c+b>e&&(c=c-(c+b-e)-3);this.el.css("height",b).css("top",
c);return a<d.scrollHeight};c.Vertical.prototype.mousemove=function(a){var b=this.pane.el.height(),d=b-2*this.pane.padding,c=a.pageY-this.startPageY;a=this.el.height();var f=this.innerEl,c=Math.min(Math.max(c,0),d-a);f.scrollTop=(f.scrollHeight-b)*c/(d-a)};c.Vertical.prototype.mousewheel=function(a,b,c,f){if(0<f&&0==this.innerEl.scrollTop||0>f&&this.innerEl.scrollTop+Math.ceil(this.pane.el.height())==this.innerEl.scrollHeight)return a.preventDefault(),!1};var h})(jQuery);
